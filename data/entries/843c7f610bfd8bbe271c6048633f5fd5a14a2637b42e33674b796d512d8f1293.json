{"title":"Spinning Up Multiple WordPress Sites Locally With DevKinsta","link":"https://smashingmagazine.com/2021/06/multiple-wordpress-sites-locally-devkinsta/","date":1623752100000,"content":"<p>When building themes and plugins for WordPress, we need to make sure they work well in all the different environments where they will be installed. We can sometimes control this environment when creating a theme for our own websites, but at other times we cannot, such as when distributing our plugins via the public WordPress repository for anyone to download and install it.</p>\n<p>Concerning WordPress, the <strong>possible combinations of environments</strong> for us to worry about include:</p>\n<ul>\n<li>Different versions of PHP,</li>\n<li>Different versions of WordPress,</li>\n<li>Different versions of the WordPress editor (aka the block editor),</li>\n<li>HTTPS enabled/disabled,</li>\n<li>Multisite enabled/disabled.</li>\n</ul>\n<p>Let’s see how this is the case. PHP 8.0, which is the latest version of PHP, has introduced <a href=\"https://kinsta.com/blog/php-8/\">breaking changes</a> from the previous versions. Since WordPress still officially supports PHP 5.6, our plugin may need to support 7 versions of PHP: PHP 5.6, plus PHP 7.0 to 7.4, plus PHP 8.0. If the plugin requires some specific feature of PHP, such as typed properties (introduced in PHP 7.4), then it will need to support that version of PHP onward (in this case, PHP 7.4 and PHP 8.0).</p>\n<p>Concerning versioning in WordPress, this software itself may occasionally introduce breaking changes, such as the update to a newer version of jQuery in WordPress 5.6. In addition, every major release of WordPress introduces new features (such as the new Gutenberg editor, introduced in version 5.0), which could be required for our products.</p>\n<p>The block editor it’s no exception. If our themes and plugins contain custom blocks, testing them for all different versions is imperative. At the very minimum, we need to worry about two versions of Gutenberg: the one shipped in WordPress core, and the one available as a standalone plugin.</p>\n<p>Concerning both HTTPS and multisite, our themes and plugins could behave differently depending on these being enabled or not. For instance, we may want to disable access to a REST endpoint when not using HTTPS or provide extended capabilities to the super admin from the multisite.</p>\n<p>This means there are many possible environments that we need to worry about. How do we handle it?</p>\nFiguring Out The Environments\n<p>Everything that can be automated, must be automated. For instance, to test the logic on our themes and plugins, we can create a continuous integration process that runs a set of tests on multiple environments. Automation takes a big chunk of the pain away.</p>\n<p>However, we can’t just rely on having machines do all the work for us. We will also need to access some testing WordPress site to visualize if, after some software upgrade, our themes still look as intended. For instance, if Gutenberg updates its global styles system or how a core block behaves, we want to check that our products were not impacted by the change.</p>\n<p>How many different environments do we need to support? Let’s say we are targeting 4 versions of PHP (7.2 to 8.0), 5 versions of WordPress (5.3 to 5.7), 2 versions of Gutenberg (core/plugin), HTTPS enabled/disabled, and multisite on/off. It all amounts to a total of 160 possible environments. That’s way too much to handle.</p>\n<p>To simplify matters, instead of producing a site for each possible combination, we can reduce it to a handful of environments that, overall, comprise all the different properties.</p>\n<p>For instance, we can produce these five environments:</p>\n<ol>\n<li>PHP 7.2 + WP 5.3 + Gutenberg core + HTTPS + multisite</li>\n<li>PHP 7.3 + WP 5.4 + Gutenberg plugin + HTTPS + multisite</li>\n<li>PHP 7.4 + WP 5.5 + Gutenberg plugin + no HTTPS + no multisite</li>\n<li>PHP 8.0 + WP 5.6 + Gutenberg core + HTTPS + no multisite</li>\n<li>PHP 8.0 + WP 5.7 + Gutenberg core + no HTTPS + no multisite</li>\n</ol>\n<p>Spinning up 5 WordPress sites is manageable, but it is not easy since it involves technical challenges, particularly enabling different versions of PHP, and providing HTTPS certificates.</p>\n<p>We want to spin up WordPress sites easily, even if we have limited knowledge of systems. And we want to do it quickly since we have our development and design work to do. How can we do it?</p>\nManaging Local WordPress Sites With DevKinsta\n<p>Fortunately, spinning up local WordPress sites is not difficult nowadays, since we can avoid the manual work, and instead rely on a tool that automates the process for us.</p>\n<p><a href=\"https://kinsta.com/devkinsta/\">DevKinsta</a> is exactly this kind of tool. It enables to launch a local WordPress site with minimum effort, for any desired configuration. The site will be created in less time it takes to drink a cup of coffee. And it certainly costs less than a cup of coffee: DevKinsta is 100% <strong>free and available for Windows, macOS, and Ubuntu users</strong>.</p>\n<p><img src=\"https://cloud.netlifyusercontent.com/assets/344dbf88-fdf9-42bb-adb4-46f01eedd629/5c54364e-5db0-4a2a-99c3-c7b07639f915/1-spinning-up-multiple-wordpress-sites-devkinsta.png\" /></p>\n<p>As its name suggests, DevKinsta was created by <a href=\"https://kinsta.com\">Kinsta</a>, one of the leading hosting providers in the WordPress space. Their goal is to simplify the process of working with WordPress projects, whether for designers or developers, freelancers, or agencies. The easier we can set up our environment, the more we can focus on our own themes and plugins, the better our products will be.</p>\n<p>The magic that powers DevKinsta is <a href=\"https://www.docker.com/\">Docker</a>, the software that enables to isolate an app from its environment via containers. However, we are not required to know about Docker or containers: DevKinsta hides the underlying complexity away, so we can just launch the WordPress site at the press of a button.</p>\n<p><img src=\"https://cloud.netlifyusercontent.com/assets/344dbf88-fdf9-42bb-adb4-46f01eedd629/b7679ba2-6bb4-40af-9f80-4e558235116b/2-spinning-up-multiple-wordpress-sites-devkinsta.png\" /></p>\n<p>In this article, we will explore how to use DevKinsta to launch the 5 different local WordPress instances for testing a plugin, and what nice features we have at our disposal.</p>\nLaunching A WordPress Site With DevKinsta\n<p>The images from above show DevKinsta when opening it for the first time. It presents 3 options for creating a new local WordPress site:</p>\n<ol>\n<li><strong>New WordPress site</strong><br />It uses the default configuration, including the latest WordPress release and PHP 8.</li>\n<li><strong>Import from Kinsta</strong><br />It clones the configuration from an existing site hosted at MyKinsta.</li>\n<li><strong>Custom site</strong><br />It uses a custom configuration, provided by you.</li>\n</ol>\n<p>Pressing on option #1 will literally produce a local WordPress site without even thinking about it. I could explain a bit further if only I could; there’s really not more to it than that.</p>\n<p>If you happen to be a Kinsta user, then pressing on option #2 allows you to directly import a site from <a href=\"https://kinsta.com/mykinsta/\">MyKinsta</a>, including a dump of its database. (Btw, it works in the opposite direction too: local changes in DevKinsta can be <a href=\"https://kinsta.com/knowledgebase/devkinsta/push-local-site-to-kinsta-staging/\">pushed to a staging site in MyKinsta</a>.)</p>\n<p>Finally, when pressing on option #3, we can specify what custom configuration to use for the local WordPress site.</p>\n<p>Let’s press the button for option #3. The configuration screen will look like this:</p>\n<p><img src=\"https://cloud.netlifyusercontent.com/assets/344dbf88-fdf9-42bb-adb4-46f01eedd629/d6135ed0-c04d-44bf-bc01-c420177ea6d3/3-spinning-up-multiple-wordpress-sites-devkinsta.png\" /></p>\n<p>A few inputs are read-only. These are options that are currently fixed but will be made configurable sometime in the future. For instance, the webserver is currently set to Nginx, but work to add Apache is underway.</p>\n<p>The options we can presently configure are the following:</p>\n<ul>\n<li>The site’s name (from which the local URL is calculated),</li>\n<li>PHP version,</li>\n<li>Database name,</li>\n<li>HTTPS enabled/disabled,</li>\n<li>The WordPress site’s title,</li>\n<li>WordPress version,</li>\n<li>The admin’s email, username and password,</li>\n<li>Multisite enabled/disabled.</li>\n</ul>\n<p>After completing this information for my first local WordPress site, called “GraphQL API on PHP 80”, and clicking on “Create site”, all it took for DevKinsta to create the site was just 2 minutes. Then, I’m presented the info screen for the newly-created site:</p>\n<p><img src=\"https://cloud.netlifyusercontent.com/assets/344dbf88-fdf9-42bb-adb4-46f01eedd629/4e78956f-439a-4940-af03-6a7aca43868a/4-spinning-up-multiple-wordpress-sites-devkinsta.png\" /></p>\n<p>The new WordPress site is available under its own local domain <code>graphql-api-on-php80.local</code>. Clicking on the “Open site” button, we can visualize our new site in the browser:</p>\n<p><img src=\"https://cloud.netlifyusercontent.com/assets/344dbf88-fdf9-42bb-adb4-46f01eedd629/8159aca9-bf4b-4b2c-8277-29a0fe86527f/5-spinning-up-multiple-wordpress-sites-devkinsta.png\" /></p>\n<p>I repeated this process for all the different required environments, and voilà, my 5 local WordPress sites were up and running in no time. Now, DevKinsta’s initial screen list down all my sites:</p>\n<p><img src=\"https://cloud.netlifyusercontent.com/assets/344dbf88-fdf9-42bb-adb4-46f01eedd629/fd64217b-cb0b-4860-8a31-70b8cc74755c/6-spinning-up-multiple-wordpress-sites-devkinsta.png\" /></p>\nUsing WP-CLI\n<p>From the required configuration for my environments, I’ve so far satisfied all items except one: installing Gutenberg as a plugin.</p>\n<p>Let’s do this next. We can install a plugin the usual via the WP admin, which we can access by clicking on the “WP admin” button from the site info screen, as seen in the image above.</p>\n<p>Even better, DevKinsta ships with <a href=\"https://wp-cli.org/\">WP-CLI</a> already installed, so we can interact with the WordPress site via the command-line interface.</p>\n<p>In this case, we need to have a minimal knowledge of Docker. Executing a command within a container is done like this:</p>\n<pre><code>docker exec {containerName} /bin/bash -c '{command}'</code></pre>\n\n<p>The needed parameters are:</p>\n<ul>\n<li>DevKinsta’s container is called <code>devkinsta_fpm</code>.</li>\n<li>The WP-CLI command to install and activate a plugin is <code>wp plugin install {pluginName} --activate --path={pathToSite} --allow-root</code></li>\n<li>The path to the WordPress site, within the container, is <code>/www/kinsta/public/{siteName}</code>.</li>\n</ul>\n<p>Putting everything together, the command to install and activate the Gutenberg plugin in the local WordPress site is this one:</p>\n<div>\n<pre><code>docker exec devkinsta_fpm /bin/bash -c 'wp plugin install gutenberg --activate --path=/www/kinsta/public/MyLocalSite --allow-root'</code></pre>\n</div>\n\n\n\nExploring Features\n<p>There are a couple of handy features available for our local WordPress sites.</p>\n<p>The first one is the integration with <a href=\"https://www.adminer.org/\">Adminer</a>, a tool similar to phpMyAdmin, to <a href=\"https://kinsta.com/blog/adminer/\">manage the database</a>. With this tool, we can directly fetch and edit the data through a custom SQL query. Clicking on the “Database manager” button, on the site info screen, will open Adminer in a new browser tab:</p>\n<p><img src=\"https://cloud.netlifyusercontent.com/assets/344dbf88-fdf9-42bb-adb4-46f01eedd629/7cb34e0c-cd68-491d-a797-1dab87878f17/7-spinning-up-multiple-wordpress-sites-devkinsta.png\" /></p>\n<p>The second noteworthy feature is the integration with <a href=\"https://github.com/mailhog/MailHog\">Mailhog</a>, the popular <a href=\"https://kinsta.com/blog/mailhog/\">email testing tool</a>. Thanks to this tool, any email sent from the local WordPress site is not actually sent out, but is captured, and displayed on the Email inbox:</p>\n<p><img src=\"https://cloud.netlifyusercontent.com/assets/344dbf88-fdf9-42bb-adb4-46f01eedd629/40910dcd-c0c4-4cb4-8aad-0355c9136f9c/8-spinning-up-multiple-wordpress-sites-devkinsta.png\" /></p>\n<p>Clicking on an email, we can see its contents:</p>\n<p><img src=\"https://cloud.netlifyusercontent.com/assets/344dbf88-fdf9-42bb-adb4-46f01eedd629/b6828627-7adf-44ab-affa-73ae06aad9c2/9-spinning-up-multiple-wordpress-sites-devkinsta.png\" /></p>\nAccessing The Local Installation Files\n<p>After installing the local WordPress site, its folder containing all of its files (including WordPress core, installed themes and plugins, and uploaded media items) will be publicly available:</p>\n<ul>\n<li><strong>Mac and Linux:</strong> under <code>/Users/{username}/DevKinsta/public/{siteName}</code>.</li>\n<li><strong>Windows:</strong> under <code>C:\\Users\\{username}\\DevKinsta\\public\\{siteName}</code>.</li>\n</ul>\n<p>(In other words: the local WordPress site’s files can be accessed not only through the Docker container, but also through the filesystem in our OS, such as using My PC on Windows, Finder in Mac, or any terminal.)</p>\n<p>This is very convenient since it offers a shortcut for installing the themes and plugins we’re developing, speeding up our work.</p>\n<p>For instance, to test a change in a plugin in all 5 local sites, we’d normally have to go to the WP admin on each site, and upload the new version of the plugin (or, alternatively, use WP-CLI).</p>\n<p>By having access to the site’s folder, though, we can simply clone the plugin from its repo, directly under <code>wp-content/plugins</code>:</p>\n<pre><code>$ cd ~/DevKinsta/public/MyLocalSite/wp-content/plugins\n$ git clone git@github.com:leoloso/MyAwesomePlugin.git</code></pre>\n\n<p>This way, we can just <code>git pull</code> to update our plugin to its latest version, making it immediately available in the local WordPress site:</p>\n<pre><code>$ cd MyAwesomePlugin\n$ git pull</code></pre>\n\n<p>If we want to test the plugin under development on a different branch, we can similarly do a <code>git checkout</code>:</p>\n<pre><code>git checkout some-branch-with-new-feature</code></pre>\n\n<p>Since we may have several sites with different environments, we can automate this procedure by executing a bash script, which iterates the local WordPress sites and, for each, executes a <code>git pull</code> for the plugin installed within:</p>\n<div>\n<pre><code>#!/bin/bash\n\niterateSitesAndGitPullPlugin(){\n  cd ~/DevKinsta/public/<br />  for file in *\n  do\n    if [ -d \"$file\" ]; then\n      cd ~/DevKinsta/public/$file/wp-content/plugins/MyAwesomePlugin\n      git pull\n    fi\n  done\n}\n\niterateSitesAndGitPullPlugin</code></pre>\n</div>\n\nConclusion\n<p>When designing and developing our WordPress themes and plugins, we want to be able to focus on our actual work, as much as possible. If we can automate setting up the working environment, we can then invest the extra time and energy into our product.</p>\n<p>This is what DevKinsta makes possible. We can spin up a local WordPress site by just pressing a button, and create many sites with different environments in just a few minutes.</p>\n<p>DevKinsta is being actively developed and supported. If you run into any issue or have some inquiry, you can browse through the <a href=\"https://kinsta.com/knowledgebase/devkinsta/\">documentation</a> or head to the <a href=\"https://community.devkinsta.com/\">Community forum</a>, where the creators of DevKinsta will help you out.</p>\n<p>All of this, for free. Sounds good? If so, <a href=\"https://kinsta.com/devkinsta/download/\">download DevKinsta</a> and go spin up your local WordPress sites.</p>","author":"","siteTitle":"Articles on Smashing Magazine — For Web Designers And Developers","siteHash":"ab069ca35bf300e9db0da36f49701f66485a5b0d2db0471dfeee07cef6204939","entryHash":"843c7f610bfd8bbe271c6048633f5fd5a14a2637b42e33674b796d512d8f1293","category":"Tech"}