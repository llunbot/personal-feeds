{"title":"Amazon EC2 Instance Metadata Service IMDSv2 by default","link":"https://aws.amazon.com/blogs/aws/amazon-ec2-instance-metadata-service-imdsv2-by-default/","date":1699290352000,"content":"<p>Effective mid-2024, newly released Amazon EC2 instance types will use only version 2 of the <a href=\"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-instance-metadata.html\">EC2 Instance Metadata Service</a> (IMDSv2). We are also taking a series of steps to make IMDSv2 the default choice for AWS Management Console Quick Starts and other launch pathways.</p> \n<p><span><strong>Background</strong></span><br /> This service is accessible from within an EC2 instance at a fixed IP address (<strong>169.254.169.254</strong> via IPv4 or <strong>fd00:ec2::254</strong> via IPv6 on Nitro instances). It gives you (or the code running on the instance) access to a wealth of static and dynamic data including the ID of the AMI that was used to launch the instance, block device mappings, temporary IAM credentials for roles that are attached to the instance, network interface information, user data, and much more, as detailed in <a href=\"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/instancedata-data-categories.html\">Instance Metadata Categories</a>.</p> \n<p>The v1 service uses a request/response access method and the v2 service uses a session-oriented method, as detailed in <a href=\"https://aws.amazon.com/blogs/security/defense-in-depth-open-firewalls-reverse-proxies-ssrf-vulnerabilities-ec2-instance-metadata-service/\">this blog post</a>. Both services are fully secure, but v2 provides additional layers of protection for four types of vulnerabilities that could be used to try to access IMDS.</p> \n<p>Many applications and instances are already using and benefiting from IMDSv2, but the full range of benefits become available only when IMDSv1 is disabled at the AWS account level.</p> \n<p><span><strong>Migration Plan</strong></span><br /> Here are the significant steps that we have taken, and those that plan to take, on the road to making IMDSv2 the default choice for new AWS infrastructure (allow a tiny bit of wiggle room on the 2023 and 2024 dates):</p> \n<p><strong>November 2019</strong> – We <a href=\"https://aws.amazon.com/blogs/security/defense-in-depth-open-firewalls-reverse-proxies-ssrf-vulnerabilities-ec2-instance-metadata-service/\">launched IMDSv2</a> and showed you how to use it to add defense in depth.</p> \n<p><strong>February 2020</strong> – We began to verify that all newly published products from AWS Marketplace sellers and AWS Partners support IMDSv2.</p> \n<p><strong>March 2023</strong> – We launched <a href=\"https://aws.amazon.com/linux/amazon-linux-2023/\">Amazon Linux 2023</a>, which uses IMDSv2 by default for all launches.</p> \n<p><strong>September 2023</strong> – We published a blog post to show you how to <a href=\"https://aws.amazon.com/blogs/security/get-the-full-benefits-of-imdsv2-and-disable-imdsv1-across-your-aws-infrastructure/\">Get the full benefits of IMDSv2 and disable IMDSv1 across your AWS infrastructure</a>.</p> \n<p><strong>November 2023</strong> – Starting today, all console Quick Start launches will use IMDSv2-only (all Amazon and Partner Quick Start AMIs support this). Here’s how this is specified in the EC2 Console within <strong>Advanced details</strong> when launching an instance:</p> \n<p><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2023/10/11/imds_template_v1.png\" width=\"623\" height=\"374\" /></p> \n<p><strong>February 2024</strong> – We plan to introduce a new API function that will allow you to control the use of IMDSv1 as the default at the account level. You can already control IMDSv1 usage in an IAM policy (taking away and limiting existing permission), or as an SCP that is applied globally across an account, an organizational unit (OU), or an entire organization. For example IAM policies read <a href=\"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ExamplePolicies_EC2.html#iam-example-instance-metadata\">Work with instance metadata</a>.</p> \n<p><strong>Mid-2024</strong> – Newly released Amazon EC2 instance types will use IMDSv2 only by default. For transition support, you will still be able to enable/turn on IMDSv1 at launch or after launch on an instance live without the need for a restart or stop/start.</p> \n<p><span><strong>What to Do</strong></span><br /> Now is the time to get started on your migration from IMDSv1 to IMDSv2 using the <a href=\"https://aws.amazon.com/blogs/security/get-the-full-benefits-of-imdsv2-and-disable-imdsv1-across-your-aws-infrastructure/\">Get the full benefits..</a> blog post as a guide. You should also become familiar with the <a href=\"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/instance-metadata-transition-to-version-2.html\">Tools for helping with the transition to IMDSv2</a>, along with the recommended path on the same page. In addition to recommending tools, this page shows you how to set up an IAM policy that disables the use of IMDSv1 and shows you how to use the <code>MetadataNoToken</code> CloudWatch metric to detect any remaining usage:</p> \n<p><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2023/10/11/imds_cw_no_token_1.png\" width=\"514\" height=\"350\" /></p> \n<p>Another helpful resource can be found on <a href=\"https://repost.aws/?trk=cb7ae1f6-c781-430a-b09e-41c9b0ecf01f&amp;sc_channel=el\">AWS re:Post</a>: <a href=\"https://repost.aws/knowledge-center/ssm-ec2-enforce-imdsv2\">How can I use Systems Manager automation to enforce that only IMDSv2 is used to access instance metadata from my Amazon EC2 instance?</a></p> \n<p>We want this transition to be as smooth as possible for you and for your customers. If you need any additional help, please contact <a href=\"https://aws.amazon.com/contact-us/\">AWS Support</a>.</p> \n<p>— <a href=\"https://twitter.com/jeffbarr\">Jeff</a>;</p>","author":"Jeff Barr","siteTitle":"AWS News Blog","siteHash":"6093e072e4117ec22616e844cb857d03ca62c57a411a8affc77cb5e8b6b15bf6","entryHash":"5b9774e9b6bab1103b4b9cf36973f2cc7576bd0e0200d7ee20936882aafb0d5c","category":"Tech"}