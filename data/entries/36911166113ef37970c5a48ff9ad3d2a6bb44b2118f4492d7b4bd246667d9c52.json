{"title":"การใช้งาน Data structure ใน Redis","link":"https://www.somkiat.cc/data-structure-with-redis/","date":1741933072000,"content":"<p><img width=\"150\" height=\"150\" src=\"https://www.somkiat.cc/wp-content/uploads/2025/03/redis-data-structure-150x150.jpg\" alt=\"\" loading=\"lazy\" srcset=\"https://www.somkiat.cc/wp-content/uploads/2025/03/redis-data-structure-150x150.jpg 150w, https://www.somkiat.cc/wp-content/uploads/2025/03/redis-data-structure-75x75.jpg 75w\" /></p>\n<figure><a href=\"https://www.somkiat.cc/wp-content/uploads/2025/03/redis-data-structure.jpg\"><img src=\"https://www.somkiat.cc/wp-content/uploads/2025/03/redis-data-structure.jpg\" alt=\"\" width=\"560\" height=\"313\" /></a></figure>\n\n\n\n<p>คำถามที่น่าสนใจเกี่ยวกับการจัดการข้อมูลใน Redis<br />ซึ่งเป็น key-value database และจัดเก็บข้อมูลลงใน memory เป็นหลัก<br />แต่ก็สามารถ persist ข้อมูลลลง disk ได้เช่นกัน<br />โดย use case หลัก ๆ  ของ Redis มักจะเป็น caching data<br />แต่ Redis นั้นมันเป็น data structure database<br />นั่นคือ เราสามารถจัดเก็บข้อมูลในรูปแบบต่าง ๆ  พื่อให้ง่ายต่อการใช้งาน<br />ดังนั้นเราลองมาทำความรู้จักกันนิดหน่อยว่ามีอะไรให้ใช้งานบ้าง ?</p>\n\n\n\n<span></span>\n\n\n\n<p>เป้าหมายหลัก ๆ  ลดการทำงาน และ เพิ่มประสิทธิภาพของระบบงาน<br />ตัวอย่างเช่น</p>\n\n\n\n<p><strong>ถ้าต้องการเก็บข้อมูล log หรือ transaction แล้วแสดงผลเรียงจากใหม่ไปเก่า</strong></p>\n\n\n\n<p>ถ้าเป็นการจัดเก็บใน database ปกติ ก็ insert ไปเรื่อย ๆ<br />จากนั้นก็ทำการ query ข้อมูล แล้ว order by จากวันที่สร้าง<br />แบบนี้มันดีไหม ?</p>\n\n\n\n<p>ทำไมไม่เก็บข้อมูลจากใหม่ไปเก่าเลยละ ?<br />จะได้ไม่ต้องมา order by ทีหลัง น่าคิดมาก ๆ<br />ดังนั้นถ้าใช้ Redis เราสามารถเลือกใช้งาน data structure ชื่อว่า <strong><a href=\"https://redis.io/docs/latest/develop/data-types/lists/\" target=\"_blank\">List</a></strong></p>\n\n\n\n<p>การใช้งานก็เพียงเพิ่มข้อมูลเข้าไปด้านหน้า หรือ ฝั่งซ้ายนั่นเอง<br />ใช้งานผ่าน command LPUSH<br />ดังนั้นเมื่อดึงข้อมูลก็ดึงจากซ้ายไปขวาก็ได้ข้อมูลเรียงจากใหม่ไปเก่าแล้ว !!</p>\n\n\n\n[gist id=\"b5c674dd98273d7bc2ab3e13c50b941e\" file=\"1.txt\"]\n\n\n\n<p>แต่ถ้าไม่ต้องการให้แต่ละ element หรือ member ใน List ไม่ซ้ำกัน<br />ก็สามารถเปลี่ยนไปใช้ data structure ชื่อว่า <strong><a href=\"https://redis.io/docs/latest/develop/data-types/sets/\" target=\"_blank\">Set</a></strong> ได้เลยแบบง่าย ๆ<br />หรือถ้าเป็นข้อมูลที่ต้องการทำแบบ append only เช่น logging<br />ก็สามารถเรื่องใช้ <strong><a href=\"https://redis.io/docs/latest/develop/data-types/streams/\" target=\"_blank\">Stream</a></strong> ได้อีกด้วย</p>\n\n\n\n<p><strong>ถ้าต้องการจัดการข้อมูลในรูปแบบของ Queue (First-In First-out)</strong></p>\n\n\n\n<p>อยากจัดการข้อมูลเข้าออกแบบ queue จะทำอย่างไรใน Redis<br />ปกติใน Redis จะมี <a href=\"https://redis.io/docs/latest/develop/interact/pubsub/\" target=\"_blank\">pub/sub</a> ให้ใช้งาน แต่ยังไม่ตรงตามที่ต้องการ<br />จึงทำการ implement ด้วยตัวเอง ผ่าน data structure และ command ของ Redis ดีกว่า<br />แนวคิดเป็นดังนี้</p>\n\n\n\n<ul>\n<li>ข้อมูลจะเก็บในรูปแบบของ List</li>\n\n\n\n<li>ข้อมูลเข้าจะมาทางซ้ายเสมอ ใช้งานผ่าน LPUSH</li>\n\n\n\n<li>ข้อมูลออกทางขวาเสมอ ใช้งานผ่าน RPOP</li>\n</ul>\n\n\n\n<p>ทำดังนี้</p>\n\n\n\n[gist id=\"b5c674dd98273d7bc2ab3e13c50b941e\" file=\"3.txt\"]\n\n\n\n<p><strong>ถ้าต้องการเก็บข้อมูลพวก raking ต่าง ๆ เช่น Leader board หรือ Top spender ของระบบ</strong></p>\n\n\n\n<p>เราจะออกแบบและดึงข้อมูลมากอย่างไร ?<br />ความต้องการประกอบไปด้วย</p>\n\n\n\n<ul>\n<li>ข้อมูลต้องไม่ซ้ำ ดังนั้นใช้ Set ได้</li>\n\n\n\n<li>ข้อมูลต้องเรียงลำดับจากคะแนนหรือยอดการสั่งซื้อ ดังนั้นถ้าใช้ Set มันไม่เรียงลำดับตามที่ต้องการให้ จึงต้องเปลี่ยนไปใช้ <strong><a href=\"https://redis.io/docs/latest/develop/data-types/#sorted-sets\" target=\"_blank\">SortedSet</a></strong> แทน</li>\n</ul>\n\n\n\n[gist id=\"b5c674dd98273d7bc2ab3e13c50b941e\" file=\"2.txt\"]\n\n\n\n<p></p>\n\n\n\n<p>หรือถ้าต้องการค้นหาข้อมูลก็สามารถใช้ Redisearch หรือ Vector type ได้เลย ...<br />หรือพวก bloom filter และ Cuckoo filter สำหรับการตรวจสอบข้อมูล ที่ลด memory ลงอย่างมาก<br />หรือข้อมูลแบบ time serie ก็มีให้ใช้งาน</p>\n\n\n\n<p>ลองศึกษาและนำไปใช้งานกันดูครับ<br />หัวใจสำคัญคือ data modeling ที่ต้องใช้งาน<br />เราพยายามลดขั้นตอนให้น้อยลง เลือกให้เหมาะสมกับงาน<br />ตัวอย่างเป็น Design for read นั่นเอง เพื่อให้ง่ายต่อการอ่านข้อมูล</p>\n","author":"somkiat","siteTitle":"cc :: somkiat","siteHash":"3a23a5a4389e1e40c6fbb16520a8cc20df5b3591c25145ce72aaa18b19e48201","entryHash":"36911166113ef37970c5a48ff9ad3d2a6bb44b2118f4492d7b4bd246667d9c52","category":"Thai"}