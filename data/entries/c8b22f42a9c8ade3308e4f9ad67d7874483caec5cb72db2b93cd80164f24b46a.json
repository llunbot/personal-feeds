{"title":"Simplify AWS CloudTrail log analysis with natural language query generation in CloudTrail Lake (preview)","link":"https://aws.amazon.com/blogs/aws/simplify-aws-cloudtrail-log-analysis-with-natural-language-query-generation-in-cloudtrail-lake-preview/","date":1718114520000,"content":"<p>Today, I am happy to announce in preview the generative artificial intelligence (generative AI)–powered natural language query generation in <a href=\"https://docs.aws.amazon.com/awscloudtrail/latest/userguide/cloudtrail-lake.html\">AWS CloudTrail Lake</a>, which is a managed data lake for capturing, storing, accessing, and analyzing <a href=\"https://aws.amazon.com/cloudtrail/\">AWS CloudTrail</a> activity logs to meet compliance, security, and operational needs. You can ask a question using natural language about these activity logs (management and data events) stored in CloudTrail Lake without having the technical expertise to write a SQL query or spend time to decode the exact structure of activity events. For example, you might ask, “Tell me how many database instances are deleted without a snapshot”, and the feature will convert that question to a CloudTrail Lake query, which you can run as-is or modify to get the requested event information. Natural language query generation makes the process of exploration of AWS activity logs simpler.</p> \n<p>Now, let me show you how to start using natural language query generation.</p> \n<p><span><strong>Getting started with natural language query generation</strong></span><br /> The natural language query generator uses generative AI to produce a ready-to-use SQL query from your prompt, which you can then choose to run in the query editor of CloudTrail Lake.</p> \n<p>In the <a href=\"https://console.aws.amazon.com/cloudtrail\">AWS CloudTrail console</a>, I choose <strong>Query</strong> under <strong>Lake</strong>. The query generator can only generate queries for event data stores that collect CloudTrail management and data events. I choose an event data store for my CloudTrail Lake query from the dropdown list in <strong>Event data store</strong>. In the <strong>Query generator</strong>, I enter the following prompt in the <strong>Prompt</strong> field using natural language:</p> \n<p><code>How many errors were logged during the past month?</code></p> \n<p>Then, I choose <strong>Generate query</strong>. The following SQL query is automatically generated:</p> \n<pre><code>SELECT COUNT(*) AS error_count\nFROM 8a6***\nWHERE eventtime &gt;= '2024-04-21 00:00:00'\n    AND eventtime &lt;= '2024-05-21 23:59:59'\n    AND (\n        errorcode IS NOT NULL\n        OR errormessage IS NOT NULL\n    )</code></pre> \n<p>I choose <strong>Run</strong> to see the results.</p> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/05/21/AWSNEWS-1114-figure1aa.png\"><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/05/21/AWSNEWS-1114-figure1aa.png\" width=\"1659\" height=\"1164\" /></a></p> \n<p>This is interesting, but I want to know more details. I want to see which services had the most errors and why these actions were erroring out. So I enter the following prompt to request additional details:</p> \n<p><code>How many errors were logged during the past month for each service and what was the cause of each error?</code></p> \n<p>I choose <strong>Generate query</strong>, and the following SQL query is generated:</p> \n<pre><code>SELECT eventsource,\n    errorcode,\n    errormessage,\n    COUNT(*) AS errorCount\nFROM 8a6***\nWHERE eventtime &gt;= '2024-04-21 00:00:00'\n    AND eventtime &lt;= '2024-05-21 23:59:59'\n    AND (\n        errorcode IS NOT NULL\n        OR errormessage IS NOT NULL\n    )\nGROUP BY 1,\n    2,\n    3\nORDER BY 4 DESC;</code></pre> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/05/21/AWSNEWS-1114-figure1bbb.png\"><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/05/21/AWSNEWS-1114-figure1bbb.png\" width=\"759\" height=\"604\" /></a></p> \n<p>I choose <strong>Run</strong> to see the results.</p> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/05/21/AWSNEWS-1114-figure1cc.png\"><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/05/21/AWSNEWS-1114-figure1cc.png\" width=\"1261\" height=\"703\" /></a></p> \n<p>In the results, I see that my account experiences most number of errors related to Amazon S3, and top errors are related to CORS and object level configuration. I can continue to dig deeper to see more details by asking further questions. But now let me give natural language query generator another instruction. I enter the following prompt in the <strong>Prompt</strong> field:</p> \n<p><code>What are the top 10 AWS services that I used in the past month? Include event name as well.</code></p> \n<p>I choose <strong>Generate query</strong>, and the following SQL query is generated. This SQL statement retrieves the field names (<code>eventSource</code>,<br /> <code>eventName</code>, <code>COUNT(*) AS event_count</code>), restricts the rows with the date interval of the past month in the <code>WHERE</code> clause, groups the rows by <code>eventSource</code> and <code>eventName</code>, sorts them by the usage count, and limit the result to 10 rows as I requested in a natural language.</p> \n<pre><code>SELECT eventSource,\n    eventName,\n    COUNT(*) AS event_count\nFROM 8a6***\nWHERE eventTime &gt;= timestamp '2024-04-21 00:00:00'\n    AND eventTime &lt;= timestamp '2024-05-21 23:59:59'\nGROUP BY 1,\n    2\nORDER BY 3 DESC\nLIMIT 10;</code></pre> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/05/21/AWSNEWS-1114-figure2a.png\"><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/05/21/AWSNEWS-1114-figure2a.png\" width=\"795\" height=\"603\" /></a></p> \n<p>Again, I choose <strong>Run</strong> to see the results.</p> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/05/21/AWSNEWS-1114-figure2b.png\"><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/05/21/AWSNEWS-1114-figure2b.png\" width=\"723\" height=\"626\" /></a></p> \n<p>I now have a better understanding of how many errors were logged during the past month, what service the error was for, and what caused the error. You can try asking questions in plain language and run the generated queries over your logs to see how this feature works with your data.</p> \n<p><span><strong>Join the preview</strong></span><br /> Natural language query generation is available in preview in the US East (N. Virginia) Region as part of <a href=\"https://docs.aws.amazon.com/awscloudtrail/latest/userguide/cloudtrail-lake.html\">CloudTrail Lake</a>.</p> \n<p>You can use natural language query generation in preview for no additional cost. CloudTrail Lake query charges apply when running the query to generate results. For more information, visit <a href=\"https://aws.amazon.com/cloudtrail/pricing/\">AWS CloudTrail Pricing</a>.</p> \n<p>To learn more and get started using natural language query generation, visit <a href=\"https://docs.aws.amazon.com/awscloudtrail/latest/userguide/cloudtrail-lake.html\">AWS CloudTrail Lake User Guide</a>.</p> \n<a href=\"https://www.linkedin.com/in/esrakayabali/\">— Esra</a>","author":"Esra Kayabali","siteTitle":"AWS News Blog","siteHash":"6093e072e4117ec22616e844cb857d03ca62c57a411a8affc77cb5e8b6b15bf6","entryHash":"c8b22f42a9c8ade3308e4f9ad67d7874483caec5cb72db2b93cd80164f24b46a","category":"Tech"}