{"title":"Tips ::  การใช้งาน Docker image ควรระบุด้วย tag หรือ digest ดี","link":"https://www.somkiat.cc/tips-docker-image-with-tag-or-digest/","date":1716823863000,"content":"<p><img width=\"150\" height=\"150\" src=\"https://www.somkiat.cc/wp-content/uploads/2024/05/docker-image-digest-150x150.png\" loading=\"lazy\" srcset=\"https://www.somkiat.cc/wp-content/uploads/2024/05/docker-image-digest-150x150.png 150w, https://www.somkiat.cc/wp-content/uploads/2024/05/docker-image-digest-75x75.png 75w\" /></p>\n<figure><a href=\"https://www.somkiat.cc/wp-content/uploads/2024/05/docker-image-digest.png\"><img src=\"https://www.somkiat.cc/wp-content/uploads/2024/05/docker-image-digest-1024x576.png\" width=\"545\" height=\"306\" /></a></figure>\n\n\n\n<p>มีคำถามจากการ share <a href=\"https://www.imcinstitute.com/\" target=\"_blank\">เรื่อง Docker จากสถาบัน IMC</a> ว่า<br />ในการใช้งาน docker image นั้น ควรระบุด้วย tag หรือ digest ดี ?</p>\n\n\n\n<p>โดยปกติในการใช้งาน docker image จาก container/image registry server<br />ยกตัวอย่างเช่น  nginx ใน Docker Hub<br />เราจะใช้งานด้วยการระบุชื่อพร้อม tag ที่ต้องการ<br />จาก best practice นั้น ไม่แนะนำให้ใช้ tag latest</p>\n\n\n\n<span></span>\n\n\n\n<p><strong><em>แต่ถ้าเรื่องความถูกต้อง และ ความปลอดภัย<br />แนะนำให้ทำการระบุชื่อ image พร้อม digest ของ image</em></strong><br /></p>\n\n\n\n<p>เนื่องจากถ้าทำการ build image ทับใน tag เดิม สามารถทำได้แน่นอน<br />ทำให้อาจจะเกิดปัญหาได้ เพราะว่า image ไม่เหมือนเดิม<br />ขัดกับแนวทางเรื่องของ immutable !!</p>\n\n\n\n<p>ดังนั้นเพื่อความมั่นใจให้ระบุด้วย <strong><a href=\"https://cloud.google.com/kubernetes-engine/docs/concepts/about-container-images\" target=\"_blank\">image digest</a></strong><br />สร้างขึ้นมาเพื่อไม่ให้เกิดการชนกันของ image แต่ละตัวที่ push ขึ้นมา<br />ซึ่งในแต่ละ tag และการ build จะมีการคำนวณ digest ให้ใหม่ <br />นำเอาทุก ๆ layer ของ image มา hash กันอีกรอบ !!<br />คล้ายกับ checksum นั่นเอง<br />สามารถดูเพิ่มเติมเรื่อง <a href=\"https://docs.docker.com/registry/\" target=\"_blank\">Manifest</a> ได้ (ถ้าว่าง ๆ จะมาอธิบายการคำนวณค่า digest ให้อีกครั้ง)<br />ดังนั้นถ้ามีการเปลี่ยนแปลงเพียงเล็กน้อยค่า digest ก็เปลี่ยน</p>\n\n\n\n<figure><a href=\"https://www.somkiat.cc/wp-content/uploads/2024/05/Screenshot-2567-05-27-at-22.30.17.png\"><img src=\"https://www.somkiat.cc/wp-content/uploads/2024/05/Screenshot-2567-05-27-at-22.30.17-1024x633.png\" width=\"502\" height=\"310\" /></a></figure>\n\n\n\n<p><br /><strong>ตัวอย่างการใช้งาน</strong></p>\n\n\n\n<p>ทำการ pull image ลงมา จากนั้นดู digest ของแต่ละ image ดังนี้</p>\n\n\n\n[gist id=\"cf92e2ee7e2739332cffadc33f10f799\" file=\"1.txt\"]\n\n\n\n<p>ใน Dockerfile ทำการระบุได้ดังนี้</p>\n\n\n\n[gist id=\"cf92e2ee7e2739332cffadc33f10f799\" file=\"Dockerfile\"]\n\n\n\n<p>เพียงเท่านี้ก็ทำให้เรามั่นใจขึ้นแล้วนะครับ<br />ลองดูครับ</p>\n\n\n\n<p>หรือเพื่อความปลอดภัยไปอีก ให้ทำการ signed Docker image ไปเลย<br />เช่น <a href=\"https://www.docker.com/blog/signing-docker-official-images-using-openpubkey/\" target=\"_blank\">OpenPubKey</a> , <a href=\"https://docs.docker.com/engine/security/trust/\">Docker T</a><a href=\"https://docs.docker.com/engine/security/trust/\" target=\"_blank\">r</a><a href=\"https://docs.docker.com/engine/security/trust/\">ust</a> และ <a href=\"https://sse-secure-systems.github.io/connaisseur/\" target=\"_blank\">Connaisseur</a></p>\n\n\n\n<p></p>\n","author":"somkiat","siteTitle":"cc :: somkiat","siteHash":"3a23a5a4389e1e40c6fbb16520a8cc20df5b3591c25145ce72aaa18b19e48201","entryHash":"db7fdc087b965d7f8a9f13e23404679cdf5a6c374ff14e191ffa434b35e8a2ff","category":"Thai"}