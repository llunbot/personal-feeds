{"title":"How French Broadcaster TF1 Used AWS Cloud Technology and Expertise to Bring the FIFA World Cup to Millions","link":"https://aws.amazon.com/blogs/aws/how-french-broadcaster-tf1-used-aws-cloud-technology-and-expertise-to-bring-the-fifa-world-cup-to-millions/","date":1679946188000,"content":"<p>Three years before millions of viewers saw, arguably, one of the most thrilling World Cup Finals ever broadcast, TF1, the leading private TV channel in France, started a project to redefine the foundations of its broadcasting platform, including adopting a new cloud-based architecture.</p> \n<p>They, and all other broadcasters, have been observing diminishing audiences for traditional over-the-air broadcasting and increasing popularity of digital platforms, such as smart TVs, and boxes like <a href=\"https://www.amazon.com/Amazon-Fire-TV-Family\">FireTV</a>, ChromeCast, and AppleTV, as well as laptops, tablets, and mobile phones. According to <a href=\"https://www.linkedin.com/in/thierry-bonhomme-251417100/\">Thierry Bonhomme</a>, CTO of eTF1 (the group within TF1 in charge of digital platforms) whom I recently interviewed for the <a href=\"https://aws.amazon.com/fr/blogs/france/podcasts/\">AWS French Podcast</a>, digital broadcasting now accounts for 20–25 percent of TF1’s total audience.</p> \n<p><img src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2023/03/27/Fifa-image2_400x200.jpeg\" alt=\"Image of a soccer ball in a large stadium\" /> This online and mobile usage drives very specific traffic patterns on IT systems: a huge peak of connections and authentications in the few minutes before the start of a game and millions of video streams that must be delivered reliably over a variety of changing network qualities. In addition to these technical challenges, there is also an economic challenge: to deliver advertisements at key moments, such as before a national anthem or during a 15-minute half-time. The digital platform sells its own set of commercials, which are different from the commercials broadcast over the air, and might also be different from region to region. All these video streams have to be delivered to millions of viewers on a wide range of devices and a variety of network conditions: from 1 Gbs fiber at home down to 3 G networks in remote areas.</p> \n<p>TF1’s approach to readiness included redesigning its digital architecture, setting up metrics showing how the new system is performing, and defining processes, roles and responsibilities for people in the team. As part of this preparation, AWS helped TF1 prepare their system to meet their scalability, performance, and security requirements.</p> \n<p>In my conversation with Thierry, he described the two main objectives the company had when designing its new technical architecture for the future of broadcasting: first, the scalability of the platform and second, meet the demand for performance. Scalability is key to absorbing the peaks of concurrent viewers. And performance is required to ensure that the video streams start quickly (in less than 3 seconds) and there is no interruption of the video player (known as re-buffering). After all, nobody wants to know their team just scored by hearing their neighbors yelling before seeing it happen on the screen they’re watching.</p> \n<p><strong><u>The Technology</u></strong><br /> Starting in 2019, TF1 started to redesign its digital broadcasting architecture and to rewrite significant parts of the code, such as the back-end API or the front-end applications running on set-top boxes, on Android, or on iOS devices. They adopted a micro service architecture, deployed on <a href=\"https://aws.amazon.com/eks/\">Amazon Elastic Kubernetes Service (EKS)</a> and written in the <a href=\"https://go.dev/\">Go programming language</a> for maximum performance. They designed a set of <a href=\"https://aws.amazon.com/what-is/restful-api/\">REST</a> and <a href=\"https://aws.amazon.com/graphql\">GraphQL</a> APIs to define the contracts between front and back-end applications, and an <a href=\"https://aws.amazon.com/what-is/eda\">event-driven architecture</a> with <a href=\"https://kafka.apache.org/\">Apache Kafka</a> for maximum scalability. They adopted multiple <a href=\"https://aws.amazon.com/what-is/cdn\">content delivery networks</a>, including <a href=\"https://aws.amazon.com/cloudfront/\">Amazon CloudFront</a>, to reliably distribute the video streams to client devices. In August 2020, TF1 got a chance to test the new platform on a large-scale sporting event when Bayern Munich beat Paris Saint Germain 1-0 at the <a href=\"https://en.wikipedia.org/wiki/2020_UEFA_Champions_League_final\">UEFA European Champion League.</a></p> \n<p><img src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2023/02/20/tf1-headquarters-small.jpg\" alt=\"TF1 headquarters in paris\" /></p> \n<p>Here’s a peek at what happens from the moment the action is shot on the field to the moment you see it on your mobile device: The high-quality video stream first <a href=\"https://en.wikipedia.org/wiki/TF1_Tower\">lands in the TF1 tower, located in Paris,</a> where hardware encoders create the necessary videos streams adapted to your device. <a href=\"https://aws.amazon.com/elemental-live/\">AWS Elemental Live</a> hardware encoders are able to generate up to eight different encodings: 4K for TVs, high-definition (1080), standard definition (720), and a variety of other formats suited to a wide range of mobile devices and network bandwidth. (This extra video encoding step is one of the reasons why you might sometimes observe a extra latency between the video you receive on your traditional TV and the feed you receive on your mobile device.) The system sends the encoded videos to <a href=\"https://aws.amazon.com/mediapackage/\">AWS Elemental Media Package</a> for packaging and, finally, to the CDNs where the player applications fetch the video segments. The player applications select the best video encoding depending on your device size and current network bandwidth available.</p> \n<p>At the end of 2021, one year before millions watched French player Kylian Mbappé <a href=\"https://www.reuters.com/lifestyle/sports/frances-mbappe-second-player-score-hat-trick-world-cup-final-2022-12-18\">score a hat trick</a> (three goals) for the first time in a World Cup final since 1966, TF1 started preparing for the big event by identifying risks based on previous experiences and areas needing improvement. Thierry described how they built hypotheses of the likely audience size based on different game scenarios: the longer the French national team might stay in the competition, the higher the expected traffic. They classified risks for each phase of the tournament (selection pools, quarter-final, semi-final, and final). Based on these scenarios, they figured that the platform must be able to sustain 4.5 million viewers connecting to the platform 15 minutes before the start of a game (that’s 5,000 new viewers every second).</p> \n<p>This level of scalability requires preparation from TF1’s team but also all external systems in use, such as the AWS cloud services, the authentication and authorization service, and the CDN services.</p> \n<p>A viewer arrival triggers multiple flows and API calls. The viewer must authenticate, and some must create a new account or reset their passwords. Once authenticated, the viewer sees the homepage that, in turn, triggers multiple API calls, one of them to the catalog service. When the viewer selects a live stream, other API calls are made to receive the video stream URL. Then the video part kicks in. The client-side player connects to the chosen CDN and starts to download video segments. Once the video is playing, the platform must ensure the stream is delivered smoothly, with high quality and no drop that would cause a re-buffering. All these elements are key to ensuring the best possible viewer experience.</p> \n<p><strong><u>The Preparation</u></strong><br /> Six months before France made it to the final and squared off against Argentina, TF1 started to work closely with their vendors, including AWS, to define requirements, reserve capacity, and start to work on test and execution plans. At this point, TF1 engaged with <a href=\"https://aws.amazon.com/premiumsupport/programs/iem/\">AWS Infrastructure Event Management</a>, a dedicated program of the AWS <a href=\"https://aws.amazon.com/premiumsupport/plans/enterprise/\">enterprise support plan</a>. Our experts offer architecture and guidance and operational support during the preparation and execution of planned events, such as shopping holidays, product launches, migrations – and in this case, the largest football (soccer) event in the world. For these events, AWS helps customers assess operational readiness, identify and mitigate risks, and execute confidently with AWS experts by their side.</p> \n<p>Special care was given to test the scalability of the API. The TF1 team developped a load-testing engine to simulate users connecting to the platform, authenticating, selecting a program, and starting a video stream. To closely simulate real traffic, TF1 used another hyperscale cloud provider to send requests to their AWS infrastructure. The testing allowed them to define the correct metrics to observe in their dashboards and the correct values to generate alarms. Thierry said the first time the load simulator ran full speed, simulating 5,000 new connections per second, it crashed the entire back end.</p> \n<p>But like any world class team, TF1 used this to their advantage. They took 2–3 weeks to tune the system. They eliminated redundant API calls from client applications and applied aggressive caching strategies. They learned how to scale their back-end platform in response to such traffic. They also learned to identify the value of key metrics under load. After a couple of back-end deployments and new releases for their Android and iOS apps, the system successfully passed the load test. It was a month before the start of the event. At that moment, TF1 decided to freeze all new developments or deployments until the first kickoff in Qatar, unless critical bugs were found.</p> \n<p><strong><u>Monitoring and Planning</u></strong><br /> The technological platform was only one piece of the project, Thierry told me. They also designed metric dashboards using <a href=\"https://www.datadoghq.com/\">Datadog</a> and <a href=\"https://grafana.com/\">Grafana</a> to monitor key performance indicators and detect anomalies during the event. Thierry noted that when observing average values, they often miss parts of the picture. For example, he said, observing a P95 <a href=\"https://en.wikipedia.org/wiki/Percentile\">percentile</a> value instead of an average shows the experience for five percent of your users. When you have three million of them, five percent represents 150K customers, so it is important to know what their experience is. (Incidentally, <a href=\"https://aws.amazon.com/blogs/aws/application-performance-percentiles-and-request-tracing-for-aws-application-load-balancer/\">this percentile technique is used routinely at Amazon and AWS</a> across all service teams, and <a href=\"https://aws.amazon.com/cloudwatch/\">Amazon CloudWatch</a> has built-in support to measure percentile values.)</p> \n<p>TF1 also prepared for the worst, he said, including the specter of having three million people staring at a black screen during a game. TF1 involved community managers and social media owners early on, and they prepared press releases and social media messages for multiple scenarios. The team also planned to gather all key team members together in a “war room” during each game to reduce communication and reaction time if something needed immediate action. This team included the AWS technical account manager, their counterpart from the authentication service, and other CDN vendors. AWS also had on-call engineers from service teams and premium support team monitoring the health of our services and ready to react in case something went wrong.</p> \n<p><strong><u>The Attacks Weren’t Just on the Field</u></strong><br /> Three key moments at the start of the tournament provided opportunities to test the platform for real: the opening ceremony, the first game, and particularly for TF1’s audience, the first game for the French team. As the tournament played out over the following weeks — with increased intensity, suspense, and load on IT systems as the French team progressed — the TF1 team would reevaluate its traffic estimates and conduct debriefs after each game. But while the intensity of the action was unfolding on the field, TF1’s team had some behind-the-scenes excitement of its own.</p> \n<p>Starting in the quarter final, the team noticed unusual activity from a wide range of distributed IP addresses, and they determined that the system was under a <a href=\"https://aws.amazon.com/shield/ddos-attack-protection/\">large distributed denial of service</a> (DDOS) attack from a network of compromised machines; someone was trying to take down the service and prevent millions of people from watching. TF1 is accustomed to these types of attacks, and their dashboard helped to identify the traffic patterns in real time. Services such as <a href=\"https://aws.amazon.com/shield/\">AWS Shield</a> and <a href=\"https://aws.amazon.com/waf\">AWS Web Application Firewall</a> helped to mitigate the incident without impacting the viewer experience. The TF1 security team and AWS experts conducted further analysis to proactively block some patterns of traffic and IP addresses for the next game.</p> \n<p>Still, the intensity of the attacks increased during the semi-finals and final game, when it peaked at 40 millions of requests for a ten-minute period. “These attacks are a cat-and-mouse game,” said Thierry: attackers try new strategies and apply new patterns, but the team in the war room detects them and dynamically updates the filtering rules to block them before viewers can even detect a change in the quality of the service. The long and detailed preparation served its purpose, and everybody knew what to do. Thierry reported that the attacks were successfully mitigated with no consequences.</p> \n<p><strong><u>The Thrilling Finale</u></strong><br /> <img src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2023/02/20/france-argentine-small.png\" alt=\"France Argentine\" />By the time France took to the pitch on Dec. 18, 2022, TF1 knew they would break records on the platform. Thierry said the traffic was higher than estimated, but the platform absorbed it. He also described that during the first part of the game, when Argentina was leading, the TF1 team observed a slow decline of connections… that is, until <a href=\"https://en.wikipedia.org/wiki/2022_FIFA_World_Cup_final\">the first goal scored by MBappé 10 minutes before the end of the game</a>. At that point, all dashboards showed a sudden return of viewers for the thrilling last moments of the game. At peak, more than 3.2 million digital players were connected at the same time, delivering 3.6 terabits per second of outgoing bandwidth through all four CDNs.</p> \n<p>Across the globe, <a href=\"https://aws.amazon.com/cloudfront/\">Amazon CloudFront</a> also helped 18 other broadcasters deliver video streams. In all, over 48 million unique client IPs connected to one of 450+ edge locations globally during the tournament, <a href=\"https://aws.amazon.com/blogs/networking-and-content-delivery/world-cup-2022-amazon-cloudfront-retrospective/\">peaking at just under 23 terabits</a> per second across these customer distributions during the final game of the tournament.</p> \n<p><strong><u>The Future</u></strong><br /> While Argentina ultimately triumphed and <a href=\"https://www.reuters.com/lifestyle/sports/magical-messi-hoists-world-cup-after-final-ages-2022-12-18\">Lionel Messi achieved his long-sought World Cup win</a>, the 2022 FIFA World Cup proved to the team at TF1 that their processes, their architecture, and their implementation are able to deliver a high-quality viewing experience to millions. The team is now confident the platform is ready to absorb the next planned large-scale events: <a href=\"https://www.rugbyworldcup.com/2023/\">the World Cup of Rugby in September 2023</a> and the next French presidential election in 2027. Thierry concluded our conversation predicting digital broadcasting will eventually attain a larger audience than over-the-air, and having 3+ millions simultaneous viewers will become the new normal.</p> \n<p><strong><em>If your company is also looking to transform its business using the power of cloud computing, consult with one of our <a href=\"https://aws.amazon.com/premiumsupport/plans/enterprise/?trk=2da82bdc-2ef2-42fa-9a62-0f0056314a81&amp;sc_channel=el\">AWS Enterprise support</a> advisors today. </em></strong></p> \n<p><a href=\"https://twitter.com/sebsto\">-- seb</a></p>","author":"Sébastien Stormacq","siteTitle":"AWS News Blog","siteHash":"6093e072e4117ec22616e844cb857d03ca62c57a411a8affc77cb5e8b6b15bf6","entryHash":"c6362076f431617184abca05c3e8482cdb4e4070cd9cd95ae75b5b418b8ef4a8","category":"Tech"}