{"title":"How to Accelerate Performance and Availability of Multi-region Applications with Amazon S3 Multi-Region Access Points","link":"https://aws.amazon.com/blogs/aws/s3-multi-region-access-points-accelerate-performance-availability/","date":1630597233000,"content":"<p>Building multi-region applications allows you to improve latency for end users, achieve higher availability and resiliency in case of unexpected disasters, and adhere to business requirements related to data durability and data residency. For example, you might want to reduce the overall latency of dynamic API calls to your backend services . Or you might want to extend a single-region deployment to handle internet routing issues, failures of submarine cables, or regional connectivity issues – and therefore avoid costly downtime. Today, thanks to multi-region data replication functions such as <a href=\"https://aws.amazon.com/dynamodb/\">Amazon DynamoDB</a> global tables, <a href=\"https://aws.amazon.com/rds/aurora/\">Amazon Aurora</a> global database, <a href=\"https://aws.amazon.com/elasticache/\">Amazon ElastiCache</a> global datastore, and <a href=\"https://aws.amazon.com/s3/\">Amazon Simple Storage Service (Amazon S3)</a> cross-region replication, you can build multi-region applications across 25 AWS Regions worldwide.</p> \n<p>Yet, when it comes to implementing multi-region applications, you often have to make your code region-aware and take care of the heavy lifting of interacting with the correct regional resources, whether it’s the closest or the most available. For example, you might have three S3 buckets with object replication across three AWS Regions. Your application code needs to be aware of how many copies of the bucket exist and where they are located, which bucket is the closest to the caller, and how to fall back to other buckets in case of issues. The complexity grows when you add new regions to your multi-region architecture and redeploy your stack in each region whenever a global configuration changes.</p> \n<p>Today, I’m happy to announce the general availability of <a href=\"https://aws.amazon.com/s3/features/multi-region-access-points/\">Amazon S3 Multi-Region Access Points</a>, a new S3 feature that allows you to define global endpoints that span buckets in multiple AWS Regions. With S3 Multi-Region Access Points, you can build multi-region applications with the same simple architecture used in a single region.</p> \n<p>S3 Multi-Region Access Points deliver built-in network resilience, building on top <a href=\"https://aws.amazon.com/global-accelerator/\">AWS Global Accelerator</a> to route S3 requests over the AWS global network. This is especially important to minimize network congestion and overall latency, while maintaining a simple application architecture. <span>AWS Global Accelerator</span> constantly monitors for regional availability and can shift requests to another region within seconds. By dynamically routing your requests to the lowest latency copy of your data, S3 Multi-Region Access Points increase upload and download performance by up to 60%. This is great not just for server-side applications that rely on S3 for reading configuration files or application data, but also for edge applications that need a performant and reliable write-only endpoint, such as IoT devices or autonomous vehicles.</p> \n<p><span><strong>S3 Multi-Region Access Points in Action</strong></span><br /> To get started, you create an S3 Multi-Region Access Point in the S3 console, via API, or with AWS CloudFormation.</p> \n<p>Let me show you how to create one using the S3 console. Each access point needs a name, unique at the account level.</p> \n<p>After it’s created, you can access it through its alias, which is generated automatically and globally unique. The alias will look like a random string ending with <code>.mrap</code> – for example, <code>mmqdt41e4bf6x.mrap</code>. It can also be accessed over the internet via <code>https://mmqdt41e4bf6x.mrap.s3-global.amazonaws.com</code>, via VPC, or on-premises using <a href=\"https://aws.amazon.com/privatelink/\">AWS PrivateLink</a>.</p> \n<p><img src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2021/06/07/s3-multi-region-access-point-create-name-1024x458.png\" /></p> \n<p>Then, you associate multiple buckets (new or existing) to the access point, one per Region. If you need data replication, you’ll need to enable bucket versioning too.</p> \n<p><img src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2021/06/07/s3-multi-region-access-point-create-buckets-1024x530.png\" /></p> \n<p>Finally, you configure the Block Public Access settings for the access point. By default, all public access is blocked, which works fine for most cases.</p> \n<p>The creation process is asynchronous, you can view the creation status in the Console or by listing the S3 Multi-Region Access Points from the CLI. When it becomes <strong>Ready</strong>, you can configure optional settings for the access point policy and object replication.</p> \n<p><img src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2021/06/07/s3-multi-region-access-point-list-1024x313.png\" /></p> \n<p>Similar to regular access points, you can customize the access control policy to limit the use of the access point with respect to the bucket’s permission. Keep in mind that both the access point and the underlying buckets must permit a request. S3 Multi-Region Access Points cannot extend the permissions, just limit (or equal) them. You can also use <a href=\"https://aws.amazon.com/iam/features/analyze-access/\">IAM Access Analyzer</a> to verify public and cross-account access for buckets that use S3 Multi-Region Access Points and preview access to your buckets before deploying permissions changes.</p> \n<p>Your S3 Multi-Region Access Point access policy might look like this:</p> \n<pre><code>{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"Default\",\n      \"Effect\": \"Allow\",\n      \"Principal\": {\n        \"AWS\": \"YOUR_ACCOUNT_ID\" \n      },\n      \"Action\": [\"s3:GetObject\", \"s3:PutObject\"],\n      \"Resource\": \"arn:aws:s3::YOUR_ACCOUNT_ID:accesspoint/YOUR_ALIAS/object/*\"\n    }\n   ]\n}</code></pre> \n<p>To replicate data between buckets used with your S3 Multi-Region Access Point, you configure S3 Replication. In some cases, you might want to store different content in each bucket, or have a portion of a regional bucket for use with a global endpoint and other portions that aren’t replicated and used only with a regional access point or direct bucket access. For example, an IoT device configuration might include references to other regional API endpoints or regional resources that will be different for each bucket.</p> \n<p>The new S3 console provides two basic templates that you can use to easily and centrally create replication rules:</p> \n<ul> \n <li><strong>Replicate objects from one or more source bucket to one or more destination buckets</strong>: This is ideal for ready-only use cases where data is always generated in a specific AWS Region and you want it to be available in all other Regions, too.</li> \n <li><strong>Replicate objects among all specified buckets</strong>: This is ideal for the IoT scenario I mentioned, where you’d define a write-only access point that devices use to upload data to the closest region, and you need this data to be available in all regions.</li> \n</ul> \n<p>Of course, thanks to filters and conditions, you can create more sophisticated replication setups. For example, you might want to replicate only certain objects based on a prefix or tags.</p> \n<p><img src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2021/06/07/s3-multi-region-access-point-replication-1024x717.png\" /></p> \n<p>Keep in mind that bucket versioning must be enabled for cross-region replication.</p> \n<p><img src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2021/06/07/s3-multi-region-access-point-replication-rules-961x1024.png\" /></p> \n<p>The console will take care of creating and configuring the replication rules and IAM roles. Note that to add or remove buckets, you would create a new the S3 Multi-Region Access Point with the revised list.</p> \n<p>In addition to the replication rules, here is where you configure replication options such as <a href=\"https://docs.aws.amazon.com/AmazonS3/latest/userguide/replication-time-control.html\">Replication Time Control (RTC)</a>, <a href=\"https://docs.aws.amazon.com/AmazonS3/latest/userguide/replication-metrics.html\">replication metrics and notifications</a>, and <a href=\"https://docs.aws.amazon.com/AmazonS3/latest/userguide/replication-for-metadata-changes.html\">bidirectional sync</a>. RTC allows you to replicate most new objects in seconds, and 99.99% of those objects within 15 minutes, for use cases where replication speed is important; replications metrics allow you to monitor how synchronized are your buckets in terms of object and byte count; bidirectional sync allows you to achieve an active-active configuration for put-heavy use cases in which object metadata needs to be replicated across buckets too.</p> \n<p><img src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2021/06/15/s3-multi-region-access-point-replication-options-1-1024x549.png\" /></p> \n<p>After replication is configured, you get a very useful visual and interactive summary that allows you to verify which AWS Regions are enabled. You’ll see where they are on the map, the name of the regional buckets, and which replication rules are being applied.</p> \n<p><img src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2021/06/07/s3-multi-region-access-point-replication-overview-1024x525.png\" /></p> \n<p>After the S3 Multi-Region Access Point is defined and correctly configured, you can start interacting with it through the S3 API, AWS CLI, or the AWS SDKs. For example, this is how you’d write and read a new object using the CLI (don’t forget to upgrade to the latest CLI version):</p> \n<pre><code># create a new object\naws s3api put-object --bucket arn:aws:s3::YOUR_ACCOUNT_ID:accesspoint/YOUR_ALIAS --key test.png --body test.png\n# retrieve the same object\naws s3api get-object --bucket arn:aws:s3::YOUR_ACCOUNT_ID:accesspoint/YOUR_ALIAS --key test.png test.png\n</code></pre> \n<p>Last but not least, you can use bucket metrics in <a href=\"https://aws.amazon.com/cloudwatch/\">Amazon CloudWatch</a> to keep track of how user requests are distributed across buckets in multiple AWS Regions.</p> \n<p><span><strong>CloudFormation Support at Launch</strong></span><br /> Today, you can start using two new CloudFormation resources to easily define an S3 Multi-Region Access Point: <code>AWS::S3::MultiRegionAccessPoint</code> and <code>AWS::S3::MultiRegionAccessPointPolicy</code>.</p> \n<p>Here is an example:</p> \n<pre><code>Resources:\n  MyS3MultiRegionAccessPoint:\n    Type: AWS::S3::MultiRegionAccessPoint\n    Properties:\n      Regions:\n        - Bucket: regional-bucket-ireland\n        - Bucket: regional-bucket-australia\n        - Bucket: regional-bucket-us-east\n      PublicAccessBlockConfiguration:\n        BlockPublicAcls: true\n        IgnorePublicAcls: true\n        BlockPublicPolicy: true\n        RestrictPublicBuckets: true\n  MyMultiRegionAccessPointPolicy:\n    Type: AWS::S3::MultiRegionAccessPointPolicy\n    Properties:\n      MrapName: !Ref MyS3MultiRegionAccessPoint\n      Policy:\n        Version: 2012-10-17\n        Statement:\n          - Action: '*'\n            Effect: Allow\n            Resource: !Sub\n              - 'arn:aws:s3::${AWS::AccountId}:accesspoint/${mrapalias}/object/*'\n              - mrapalias: !GetAtt\n                  - MyS3MultiRegionAccessPoint\n                  - Alias\n            Principal: {\"AWS\": !Ref \"AWS::AccountId\"}\n</code></pre> \n<p>The <code>AWS::S3::MultiRegionAccessPoint</code> resource depends only on the S3 bucket names. You don’t need to reference other regional stacks and you can easily centralize the S3 Multi-Region Access Point definition into its own stack. On the other hand, cross-region replication needs to be configured on each S3 bucket.</p> \n<p><strong><span>Cost considerations</span></strong><br /> When you use an S3 Multi-Region Access Point to route requests within the AWS global network, you pay a data routing cost of $0.0033 per GB processed, in addition to the standard charges for S3 requests, storage, data transfer, and replication. If your applications access the S3 Multi-Region Access Point over the internet, you’re also charged an internet acceleration cost per GB. This cost depends on the transfer type (upload or download) and whether the client and the bucket are in the same or different locations. For details, visit the <a href=\"https://aws.amazon.com/s3/pricing/\">S3 pricing page</a> and select the data transfer tab.</p> \n<p>Let me share a few practical examples:</p> \n<ul> \n <li><strong>All traffic within an AWS Region:</strong> In this simple case, your application runs in US East (N. Virginia) and you configure two S3 buckets in US East (N. Virginia) and US West (Oregon). The application uploads 100GB of data and the lowest latency bucket is in US East(N. Virginia). All the data is routed by your S3 Multi-Region Access Point in the same region and the total cost is $0.33.</li> \n <li><strong>All traffic across two AWS Regions:</strong> In this case, your application runs in US East (N. Virginia) and you configure two S3 buckets in US East (Ohio) and US West (Oregon). The application uploads 100GB of data and the lowest latency bucket is in US East (Ohio). All the data is routed by your S3 Multi-Region Access Point across two AWS Regions. The data routing cost for 100GB is the same of the previous example ($0.33), plus the S3 data transfer cost of $0.01 per GB, resulting in a total cost of $1.33.</li> \n <li><strong>All traffic over the internet across North America, Europe, and Asia Pacific (download and upload)</strong>: In this case, your application runs on customer devices in North America, Europe, and Asia, and you configure two S3 buckets in US East (N. Virginia) and Europe (Ireland). One customer in North America uploads 50GB of data, which is routed to the bucket in US East (N. Virginia); a second customer in Europe downloads 50GB of data from the bucket in Europe (Ireland); a third customer in Asia downloads 50GB of data from the bucket in Europe (Ireland). The data routing cost for 150GB is $0.495. Plus the data transfer out from S3 to Europe of $0.09 per GB ($9), the internet acceleration cost from North America to the S3 bucket in US East (N. Virginia) of $0.0025 per GB ($0.125), the internet acceleration cost from the S3 bucket in Europe (Ireland) to Europe of $0.005 per GB ($0.25), and the internet acceleration cost from the S3 bucket in Europe (Ireland) to Asia of $0.05 per GB ($2.5). The total cost is $12.37. Please note that this example is intended to demonstrate how the internet acceleration cost works across continents. Also note that the internet acceleration cost to Asia might be reduced by an order of magnitude with an additional S3 bucket in Asia (see next example).</li> \n <li><strong>All the traffic over the internet across North America, Europe, and Asia Pacific (only upload)</strong>: In this case, we consider the same conditions of the previous example. The only difference is that all customers only upload data and that you configure an additional bucket in Asia Pacific (Singapore). The data routing cost is the same ($0.495). Plus the internet acceleration cost from North America to the S3 bucket in US East (N. Virginia) of $0.0025 per GB ($0.125), the internet acceleration cost from Europe to the S3 bucket in Europe (Ireland) of $0.0025 per GB ($0.125), and the internet acceleration cost from Asia to the S3 bucket in Asia Pacific (Singapore) of $0.01 per GB ($0.5). The total cost is $1.24.</li> \n</ul> \n<p>In other words, the routing cost is easy to estimate and doesn’t depend on the application type or data access pattern. The internet acceleration cost depends on the access pattern (downloads are more expensive than uploads) and on the client location with respect to the closest AWS Region. For global applications that upload or download data over the internet, you can minimize the internet acceleration cost by configuring at least one S3 bucket in each continent.</p> \n<p><span><strong>Available Today</strong></span><br /> <a href=\"https://aws.amazon.com/s3/features/multi-region-access-points/\">Amazon S3 Multi-Region Access Points</a> allow you to increase resiliency and accelerate application performance up to 60% when accessing data across multiple AWS Regions. We look forward to feedback about your use cases so that we can iterate quickly and simplify how you design and implement multi-region applications.</p> \n<p>You can get started using the S3 API, CLI, SDKs, AWS CloudFormation or the <a href=\"https://console.aws.amazon.com/s3/mraps\">S3 Console</a>. This new functionality is available in 17 AWS Regions worldwide (<a href=\"https://docs.aws.amazon.com/AmazonS3/latest/userguide/MultiRegionAccessPointRestrictions.html\">see the full list of supported AWS Regions</a>).</p> \n<p><span><strong>Learn More</strong></span><br /> Listen to the <a href=\"https://aws.amazon.com/podcasts/470-introducing-amazon-s3-multi-region-access-points/?trkCampaign=AWS_Podcast_470_Podcast&amp;sc_channel=el&amp;sc_campaign=SM_2021_AWSWNL_470&amp;sc_outcome=Launch_Marketing\">latest episode of the Official AWS Podcast</a> for a deep dive into S3 Multi-Region Access Points.</p> \n<p>Watch this video to hear more and see a short demo.</p> \n<p></p> \n<p><a href=\"https://docs.aws.amazon.com/AmazonS3/latest/userguide/MultiRegionAccessPoints.html\">Check out the technical documentation for S3 Multi-Region Access Points.</a></p> \n<p>— <a href=\"https://twitter.com/alex_casalboni\">Alex</a></p>","author":"Alex Casalboni","siteTitle":"AWS News Blog","siteHash":"6093e072e4117ec22616e844cb857d03ca62c57a411a8affc77cb5e8b6b15bf6","entryHash":"d950f23bc9a35e840754b6eee4c9867f52489ee47b4bf47edfde0a915614f36a","category":"Tech"}