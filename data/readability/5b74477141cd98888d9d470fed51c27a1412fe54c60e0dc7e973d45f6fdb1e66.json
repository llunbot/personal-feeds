{"title":"Spring Boot 2.5 :: ลำดับการทำงานของการ initial data ใน Database","link":"https://www.somkiat.cc/spring-boot-initialization-ordering/","date":1631890042000,"content":"<div id=\"readability-page-1\" class=\"page\"><div id=\"page\"><article><div id=\"content_box\"><header><div><p><time>September 17, 2021</time> <span><a href=\"https://www.somkiat.cc/category/programming/\" rel=\"category tag\">Programming</a></span></p></div></header><div><figure><img src=\"https://www.somkiat.cc/wp-content/uploads/2021/09/spring-boot.jpg\" alt=\"\" srcset=\"https://www.somkiat.cc/wp-content/uploads/2021/09/spring-boot.jpg 900w, https://www.somkiat.cc/wp-content/uploads/2021/09/spring-boot-300x167.jpg 300w, https://www.somkiat.cc/wp-content/uploads/2021/09/spring-boot-768x427.jpg 768w\" sizes=\"(max-width: 900px) 100vw, 900px\"></figure><p>จาก <strong><a rel=\"noreferrer noopener\" href=\"https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-2.5-Release-Notes\" target=\"_blank\">Release note ของ Spring Boot 2.5</a></strong> นั้น<br>พบว่ามี feature เกี่ยวกับการจัดการลำดับการทำงาน<br>ของการ initial data ใน Database มาใหม่<br>ซึ่งเปลี่ยนจาก Milestone version ไปเลย<br>จึงทำการสรุปการทำงานและใช้งานไว้นิดหน่อย</p><p><strong>ขั้นตอนในการ initial data ใน database เป็นดังนี้</strong></p><ul><li>ถ้ามี ไฟล์ schema.sql และ data.sql จะทำงานเป็นอันดับแรก เหมือนกับการทำงานของ DB migration เช่น Flyway และ Liquibase</li><li>ต่อมาจึงทำงานกับพวก ORM เช่น JPA หรือ hibernate</li></ul><p><strong>ดังนั้นในการทำงานนั้น บ่อยครั้งต้องการให้ ORM ทำงานก่อน</strong><br>ยกตัวอย่างเช่นใช้งาน Spring Data JPA<br>เพื่อให้ทำการสร้าง table ต่าง ๆ ขึ้นมาก่อน<br>จากนั้นจึงทำการ initial data ใน table ด้วยไฟล์ data.sql<br>ซึ่งสามารถ config ได้ในไฟล์ application.properties ดังนี้</p><div id=\"highlighter_498313\"><table><tbody><tr><td><p>1</p></td><td><div><p><code>spring.jpa.defer-datasource-initialization=true</code></p></div></td></tr></tbody></table></div><p><strong>แต่ถ้าไม่ต้องการไม่ให้ทำการ execute ไฟล์ data.sql และ schema.sql แล้ว</strong><br>สามารถปิดการทำงานได้เช่นกัน ดังนี้</p><div id=\"highlighter_8600\"><table><tbody><tr><td><p>1</p></td><td><div><p><code>spring.sql.init.mode=never</code></p></div></td></tr></tbody></table></div><p><strong>หรือแม้แต่ในการ initial bean ต่าง ๆ ที่ใช้งาน @Bean</strong><br>ต้องการให้ทำงานหลังจากการ initial table แล้วเท่านั้นจริง ๆ<br>ก็เพิ่ม annotation @DependsOnDatabaseInitialization ได้เลย</p><p>จากความสามารถเหล่านี้ น่าจะทำให้ง่ายและสะดวกมากยิ่งขึ้น</p></div><div><p><img alt=\"\" src=\"https://secure.gravatar.com/avatar/e5cb9aad7bf4f0e43462bd51d6ff7021?s=90&amp;d=mm&amp;r=g\" srcset=\"https://secure.gravatar.com/avatar/e5cb9aad7bf4f0e43462bd51d6ff7021?s=180&amp;d=mm&amp;r=g 2x\" height=\"90\" width=\"90\"></p><h4>Article by <a href=\"https://www.facebook.com/somkiatspns\">Somkiat Puisungnoen</a></h4><p>To be Craftmanship</p></div></div></article></div></div>","author":"somkiat","siteTitle":"cc :: somkiat","siteHash":"3a23a5a4389e1e40c6fbb16520a8cc20df5b3591c25145ce72aaa18b19e48201","entryHash":"5b74477141cd98888d9d470fed51c27a1412fe54c60e0dc7e973d45f6fdb1e66","category":"Thai"}