{"title":"K6 :: ว่าด้วยเรื่องของ Result output ของการทดสอบ","link":"https://www.somkiat.cc/k6-with-result-output/","date":1689829807000,"content":"<p><img width=\"150\" height=\"150\" src=\"https://www.somkiat.cc/wp-content/uploads/2023/07/k6-grafana-150x150.jpg\" alt loading=\"lazy\" srcset=\"https://www.somkiat.cc/wp-content/uploads/2023/07/k6-grafana-150x150.jpg 150w, https://www.somkiat.cc/wp-content/uploads/2023/07/k6-grafana-75x75.jpg 75w\" /></p>\n<figure><a href=\"https://www.somkiat.cc/wp-content/uploads/2023/07/k6-grafana.jpg\"><img src=\"https://www.somkiat.cc/wp-content/uploads/2023/07/k6-grafana-1024x658.jpg\" alt width=\"648\" height=\"416\" /></a></figure>\n\n\n\n<p>เพิ่งแบ่งปันความรู้เรื่อง performance testing ไป<br />ซึ่งหนึ่งในเครื่องมือที่นำมาใช้งานและแนะนำคือ K6<br />พบว่ามีการเปลี่ยนแปลงเยอะเลย<br />เช่น <strong><a href=\"https://k6.io/docs/results-output/\" target=\"_blank\">Result output</a></strong> หรือผลของการทดสอบ</p>\n\n\n\n<span></span>\n\n\n\n<p>สามารถเก็บได้หลาย ๆ รูปแบบ ยกตัวอย่างเช่น</p>\n\n\n\n<ul>\n<li>ออก command line</li>\n\n\n\n<li>ออกเป็นไฟล์ เช่น CSV และ JSON </li>\n\n\n\n<li>เก็บข้อมูลแบบ realtime ไปยัง database ประเภทต่าง ๆ เช่น influxdb, prometheus, elasticsearch และ apache kafka เป็นต้น</li>\n</ul>\n\n\n\n<p>โครงสร้างการทำงาน</p>\n\n\n\n<figure><a href=\"https://www.somkiat.cc/wp-content/uploads/2023/07/Screenshot-2566-07-20-at-12.01.08.png\"><img src=\"https://www.somkiat.cc/wp-content/uploads/2023/07/Screenshot-2566-07-20-at-12.01.08.png\" alt width=\"402\" height=\"361\" /></a></figure>\n\n\n\n<p>และข้อมูลที่เก็บไว้ใน database ต่าง ๆ <br />สามารถนำมาแสดงผลในรูปแบบของ dashboard สวย ๆ ผ่าน <a href=\"https://k6.io/docs/results-output/grafana-dashboards/\" target=\"_blank\">Grafana</a> ได้อีกด้วย<br />ซึ่งสนับสนุน datasource ที่เก็บใน database จากข้างต้นไว้<br />จากที่ลองใช้งานหลาย ๆ ตัวพบว่า<br />การใช้งานร่วมกับ <a href=\"https://k6.io/docs/results-output/real-time/prometheus-remote-write/\" target=\"_blank\">Prometheus remote write</a> จะง่าย และ update ที่สุด<br />เพราะว่าพวก dashboard มีการสร้าง และ update ให้ตลอด<br />แถมเป็นแบบ official ด้วย<br />แต่ยังอยู่ในขั้นตอนของ experiment นะครับ</p>\n\n\n\n<p>ส่วนการใช้งานกับ influxdb นั้นจะมีทั้ง version 1 และ 2<br />พบว่า dashboard ต่าง ๆ ยังไม่สนับสนุน หรือ update ตาม</p>\n\n\n\n<p><strong>การใช้งาน K6 + Prometheus remote write ก็ไม่ยาก</strong></p>\n\n\n\n<p>ทำดังนี้</p>\n\n\n\n<p><strong>ขั้นที่ 1 ทำการ build k6 กับ <a href=\"https://github.com/grafana/xk6-output-prometheus-remote\" target=\"_blank\">xk6-output-prometheus-remote</a></strong></p>\n\n\n\n[code]\n$xk6 build --with github.com/grafana/xk6-output-prometheus-remote@latest \n[/code]\n\n\n\n<p><strong>ขั้นที่ 2 ทำการ run และส่งผลไปยัง Prometheus</strong></p>\n\n\n\n[code]\n$K6_PROMETHEUS_RW_SERVER_URL=http://prometheus:9090/api/v1/write\n$K6_PROMETHEUS_RW_TREND_AS_NATIVE_HISTOGRAM=true\n$K6_OUT=xk6-prometheus-rw\n$k6 run -o xk6-prometheus-rw demo.js\n[/code]\n\n\n\n<p>ผลที่ได้</p>\n\n\n\n<figure><a href=\"https://www.somkiat.cc/wp-content/uploads/2023/07/prom-dashboard-test-result.png\"><img src=\"https://www.somkiat.cc/wp-content/uploads/2023/07/prom-dashboard-test-result-1024x486.png\" alt width=\"723\" height=\"342\" /></a></figure>\n\n\n\n<p>เพียงเท่านี้ก็ได้ dashboard สวย ๆ<br />และมีประโยชน์ต่อการทดสอบอีกด้วย</p>\n","author":"somkiat","siteTitle":"cc :: somkiat","siteHash":"3a23a5a4389e1e40c6fbb16520a8cc20df5b3591c25145ce72aaa18b19e48201","entryHash":"5d625779f7f6e38c53cb228cb9f110652393bbeb0287275fe1d44b895eb05549","category":"Thai"}