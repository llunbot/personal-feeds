{"title":"How Vercel Shipped Cron Jobs in 2 Months Using Amazon EventBridge Scheduler","link":"https://aws.amazon.com/blogs/aws/how-vercel-shipped-cron-jobs-in-2-months-using-amazon-eventbridge-scheduler/","date":1693944270000,"content":"<p>Vercel implemented Cron Jobs using Amazon EventBridge Scheduler, enabling their customers to create, manage, and run scheduled tasks at scale. The adoption of this feature was rapid, reaching over 7 million weekly cron invocations within a few months of release. This article shows how they did it and how they handle the massive scale they’re experiencing.</p> \n<p><a href=\"https://vercel.com/\" target=\"_blank\">Vercel</a> builds a front-end cloud that makes it easier for engineers to deploy and run their front-end applications. <a href=\"https://youtu.be/7bY-YH70h8g\" target=\"_blank\">With more than 100 million deployments in Vercel in the last two years</a>, Vercel helps users take advantage of best-in-class AWS infrastructure with zero configuration by relying heavily on serverless technology. Vercel provides a lot of features that help developers host their front-end applications. However, until the beginning of this year, they hadn’t built Cron Jobs yet.</p> \n<p>A cron job is a scheduled task that automates running specific commands or scripts at predetermined intervals or fixed times. It enables users to set up regular, repetitive actions, such as backups, sending notification emails to customers, or processing payments when a subscription needs to be renewed. Cron jobs are widely used in computing environments to improve efficiency and automate routine operations, and they were a commonly requested feature from Vercel’s customers.</p> \n<p>In December 2022, Vercel hosted an internal hackathon to foster innovation. That’s where <a href=\"https://www.linkedin.com/in/vvoyer/\" target=\"_blank\">Vincent Voyer</a> and <a href=\"https://www.linkedin.com/in/andreas-schneider-79043021a/\" target=\"_blank\">Andreas Schneider</a> joined forces to build a prototype cron job feature for the Vercel platform. They formed a team of five people and worked on the feature for a week. The team worked on different tasks, from building a user interface to display the cron jobs to creating the backend implementation of the feature.</p> \n<p><span><strong>Amazon EventBridge Scheduler<br /> </strong></span>When the hackathon team started thinking about solving the cron job problem, their first idea was to use <a href=\"https://docs.aws.amazon.com/eventbridge/latest/userguide/eb-create-rule-schedule.html\" target=\"_blank\">Amazon EventBridge rules that run on a schedule</a>. However, they realized quickly that this feature has a limit of 300 rules per account per AWS Region, which wasn’t enough for their intended use. Luckily, one of the team members had read <a href=\"https://aws.amazon.com/blogs/compute/introducing-amazon-eventbridge-scheduler/\" target=\"_blank\">the announcement of Amazon EventBridge Scheduler</a> in the AWS Compute blog and they thought this would be a perfect tool for their problem.</p> \n<p>By using <a href=\"https://docs.aws.amazon.com/scheduler/latest/UserGuide/what-is-scheduler.html\" target=\"_blank\">EventBridge Scheduler</a>, they could schedule one-time or recurrently millions of tasks across over 270 AWS services without provisioning or managing the underlying infrastructure.</p> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2023/07/21/03-how-itworks-1.png\"><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2023/07/21/03-how-itworks-1.png\" alt=\"How cron jobs work\" width=\"1798\" height=\"614\" /></a></p> \n<p>For creating a new cron job in Vercel, a customer needs to define the frequency in which this task will run and the API they want to invoke. Vercel, in the backend, uses EventBridge Scheduler and creates a new schedule when a new cron job is created.</p> \n<p>To call the endpoint, the team used an <a href=\"https://aws.amazon.com/lambda/\" target=\"_blank\">AWS Lambda</a> function that receives the path that needs to be invoked as input parameters.</p> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2023/07/21/04-how-it-works-2.png\"><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2023/07/21/04-how-it-works-2.png\" alt=\"How cron jobs works\" width=\"2022\" height=\"506\" /></a></p> \n<p>When the time comes for the cron job to run, EventBridge Scheduler invokes the function, which then calls the customer website endpoint that was configured.</p> \n<p>By the end of the week, Vincent and his team had a working prototype version of the cron jobs feature, and they won a prize at the hackathon.</p> \n<p><span><strong>Building Vercel Cron Jobs<br /> </strong></span>After working for one week on this prototype in December, the hackathon ended, and Vincent and his team returned to their regular jobs. In early January 2023, Vicent and the Vercel team decided to take the project and turn it into a real product.</p> \n<p>During the hackathon, the team built the fundamental parts of the feature, but there were some details that they needed to polish to make it production ready. Vincent and Andreas worked on the feature, and in less than two months, on February 22, 2023, they announced Vercel Cron Jobs to the public. The <a href=\"https://twitter.com/vercel/status/1628439610454843400?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1628439610454843400%7Ctwgr%5E%7Ctwcon%5Es1_&amp;ref_url=notion%3A%2F%2Fwww.notion.so%2Fmavi888%2FWork-28038053883f41f4a4fd8bf1ac4b768b%3Fp%3D47b26211a2f04d3692d1f6e6645712f5pm%3Ds\" target=\"_blank\">announcement tweet</a> got over 400 thousand views, and the community loved the launch.</p> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2023/07/21/05-tweet.png\"><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2023/07/21/05-tweet-880x1024.png\" alt=\"Tweet from Vercel announcing cron jobs\" width=\"880\" height=\"1024\" /></a></p> \n<p>The adoption of this feature was very rapid. Within a few months of launching Cron Jobs, Vercel reached over 7 million cron invocations per week, and they expect the adoption to continue growing.</p> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2023/08/08/cron-invocations-week.png\"><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2023/08/08/cron-invocations-week.png\" alt=\"Cron jobs adoption\" width=\"1846\" height=\"834\" /></a></p> \n<p><span><strong>How Vercel Cron Jobs Handles Scale<br /> </strong></span>With this pace of adoption, scaling this feature is crucial for Vercel. In order to scale the amount of cron invocations at this pace, they had to make some business and architectural decisions.</p> \n<p>From the business perspective, they defined limits for their free-tier customers. Free-tier customers can create a maximum of two cron jobs in their account, and they can only have hourly schedules. This means that free customers cannot run a cron job every 30 minutes; instead, they can do it at most every hour. Only customers on Vercel paid tiers can take advantage of <a href=\"https://docs.aws.amazon.com/scheduler/latest/UserGuide/schedule-types.html#cron-based\" target=\"_blank\">EventBridge Scheduler minute granularity</a> for scheduling tasks.</p> \n<p>Also, for free customers, minute precision isn’t guaranteed. To achieve this, Vincent took advantage of the time window configuration from EventBridge Scheduler. The <a href=\"https://docs.aws.amazon.com/scheduler/latest/UserGuide/managing-schedule-flexible-time-windows.html\" target=\"_blank\">flexible time window</a> configuration allows you to start a schedule within a window of time. This means that the scheduled tasks are dispersed across the time window to reduce the impact of multiple requests on downstream services. This is very useful if, for example, many customers want to run their jobs at midnight. By using the flexible time window, the load can spread across a set window of time.</p> \n<p>From the architectural perspective, Vercel took advantage of hosting the APIs and owning the functions that the cron jobs invoke.</p> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2023/07/21/06-validate.png\"><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2023/07/21/06-validate.png\" alt=\"Validating the calls\" width=\"2230\" height=\"806\" /></a></p> \n<p>This means that when the Lambda function is started by EventBridge Scheduler, the function ends its run without waiting for a response from the API. Then Vercel validates if the cron job ran by checking if the API and Vercel function ran correctly from its observability mechanisms. In this way, the function duration is very short, less than 400 milliseconds. This allows Vercel to run a lot of functions per second without affecting their concurrency limits.</p> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2023/07/21/02-lambdainfo.png\"><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2023/07/21/02-lambdainfo.png\" alt=\"Lambda invocations and duration dashboard\" width=\"3002\" height=\"550\" /></a></p> \n<p><span><strong>What Was The Impact?<br /> </strong></span>Vercel’s implementation of Cron Jobs is an excellent example of what serverless technologies enable. In two months, with two people working full time, they were able to launch a feature that their community needed and enthusiastically adopted. This feature shows the completeness of Vercel’s platform and is an important feature to convince their customers to move to a paid account.</p> \n<p>If you want to get started with EventBridge Scheduler, see <a href=\"https://serverlessland.com/patterns?services=eventbridge-scheduler\" target=\"_blank\">Serverless Land patterns for EventBridge Scheduler</a>, where you’ll find a broad range of examples to help you.</p> \n<p>— <a href=\"https://twitter.com/mavi888uy\" target=\"_blank\">Marcia</a></p>","author":"Marcia Villalba","siteTitle":"AWS News Blog","siteHash":"6093e072e4117ec22616e844cb857d03ca62c57a411a8affc77cb5e8b6b15bf6","entryHash":"034472059e96699dd096f2d6d4df6b5bce075ba5171d09a1587651636f71dbbb","category":"Tech"}