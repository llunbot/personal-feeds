{"title":"How To Create Dynamic Donut Charts With TailwindCSS And React","link":"https://smashingmagazine.com/2023/03/dynamic-donut-charts-tailwind-css-react/","date":1678203000000,"content":"<p>CSS is amazing ‚Äî I‚Äôm regularly surprised at how far it has come in the years I‚Äôve been using it (~2005 ‚Äì present). One such surprise came when I noticed this tweet by <a href=\"https://twitter.com/shrutibalasa/status/1612785019159982080?s=20&amp;t=6TLkMmRjOFQxKP7W-jFPcA\">Shruti Balasa</a> which demonstrated how to create a pie chart using <a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/gradient/conic-gradient#gradient_pie-chart\"><code>conic-gradient()</code></a>.</p>\n<p>It‚Äôs fairly straightforward. Here‚Äôs a code snippet:</p>\n<pre><code>div {\n  background: conic-gradient(red 36deg, orange 36deg 170deg, yellow 170deg);\n  border-radius: 50%;\n}\n</code></pre>\n\n<p>Using this tiny amount of CSS, you can create gradients that start and stop at specific angles and define a color for each ‚Äòsegment‚Äô of the pie chart. </p>\n<p><img src=\"https://files.smashing.media//articles/dynamic-donut-charts-css-conic-gradient-tailwindcss-react/1-css-conic-gradient-charts.jpg\" /></p>\nHappy Days!\n<p>Brills, I thought I could use this instead of a charting library for a data dashboard project I‚Äôm working on for the new <a href=\"https://www.cockroachlabs.com/docs/api/cloud/v1.html#get-/api/v1/clusters\">CockroachDB Cloud API</a>, but I had a problem. I didn‚Äôt know the values for my chart ahead of time, and the values I was receiving from the API weren‚Äôt in degrees! </p>\n<p>Here‚Äôs a preview link and Open-source repo of how I worked around those two problems, and in the rest of this post, I‚Äôll explain how it all works.</p>\n<ul>\n<li>üöÄ Preview: <a href=\"https://css-conic-gradient-charts.vercel.app/\">https://css-conic-gradient-charts.vercel.app/</a></li>\n<li>‚öôÔ∏è Repo: <a href=\"https://github.com/PaulieScanlon/css-conic-gradient-charts\">https://github.com/PaulieScanlon/css-conic-gradient-charts</a></li>\n</ul>\nDynamic Data Values\n<p>Here‚Äôs some sample data from a <em>typical</em> API response which I‚Äôve sorted by <code>value</code>.</p>\n<pre><code>const data = [\n  {\n    name: 'Cluster 1',\n    value: 210,\n  },\n  {\n    name: 'Cluster 2',\n    value: 30,\n  },\n  {\n    name: 'Cluster 3',\n    value: 180,\n  },\n  {\n    name: 'Cluster 4',\n    value: 260,\n  },\n  {\n    name: 'Cluster 5',\n    value: 60,\n  },\n].sort((a, b) =&gt; a.value - b.value);\n</code></pre>\n\n<p>You can see that each item in the array has a <code>name</code> and a <code>value</code>. </p>\n<p>In order to convert the <code>value</code> from a number into a <code>deg</code> value to use with CSS, there are a few things you need to do:</p>\n<ul>\n<li>Calculate the total amount of all the values.</li>\n<li>Use the total amount to calculate the percentage that each value represents.</li>\n<li>Convert the percentage into degrees.</li>\n</ul>\n<p><strong>Note</strong>: <em>The code I‚Äôll be referring to in the steps below can be found in the repo here: <a href=\"https://github.com/PaulieScanlon/css-conic-gradient-charts/blob/main/components/donut-1.js\">/components/donut-1.js</a>.</em></p>\n<h3>Calculate The Total Amount</h3>\n<p>Using JavaScript, you can use this little one-liner to <em>sum</em> up each value from the data array, which results in a single total.</p>\n<pre><code>const total_value = data.reduce((a, b) =&gt; a + b.value, 0);\n\n// =&gt; 740\n</code></pre>\n\n<h3>Calculate The Percentage</h3>\n<p>Now that you have a <code>total_value</code>, you can convert each of the values from the data array to a percentage using a JavaScript function. I‚Äôve called this function <code>covertToPercent</code>.</p>\n<p><strong>Note</strong>: <em>I‚Äôve used the value of 210 from Cluster 1 in this example.</em></p>\n<pre><code>const convertToPercent = (num) =&gt; Math.round((num / total_value) * 100);\n\n// convertToPercent(210) =&gt; 28\n</code></pre>\n\n<h3>Convert Percentage to Degrees</h3>\n<p>Once you have a percentage, you can convert the percentage into degrees using another JavaScript function. I‚Äôve called this function <code>convertToDegrees</code>.</p>\n<pre><code>const convertToDegrees = (num) =&gt; Math.round((num / 100) * 360);\n\n// convertToDegrees(28) =&gt; 101\n</code></pre>\n\n<h3>The Result</h3>\n<p>As a temporary test, if I were to <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map\">map</a> over the items in the sorted data array, using the two functions explained above, you‚Äôd end up with the following output:</p>\n<pre><code>const test_output = data.map((item) =&gt; {\n  const percentage = convertToPercent(item.value);\n  const degrees = convertToDegrees(percentage);\n\n  return `${degrees}deg`;\n});\n\n// =&gt; ['14deg', '29deg', '86deg', '101deg', '126deg']\n</code></pre>\n\n<p>The return value of <code>test_output</code> is an array of the <code>value</code> (in degrees) + the string <code>deg</code>. </p>\n<p>This solves one of a two-part problem. I‚Äôll now explain the other part of the problem.</p>\n<p>To create a Pie chart using <a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/gradient/conic-gradient#gradient_pie-chart\"><code>conic-gradient()</code></a>, you need two <code>deg</code> values. The first is the angle from where the gradient should start, and the second is the angle where the gradient should stop. You‚Äôll also need a color for each segment, but I‚Äôll come to that in a moment.</p>\n<div>\n\n<pre><code> ['red ü§∑ 14deg', 'blue ü§∑ 29deg', 'green ü§∑ 86deg', 'orange ü§∑ 101deg', 'pink ü§∑ 126deg']\n</code></pre>\n</div>\n\n<p>Using the values from the <code>test_output</code>, I only have the end value (where the gradient should stop). The start angle for each segment is actually the end angle from the previous item in the array, and the end angle is the cumulative value of all previous end values plus the current end value. And to make matters worse, the start value for the first angle needs to be manually set to <code>0</code> ü•¥.</p>\n<p>Here‚Äôs a diagram to better explain what that means:</p>\n<p><img src=\"https://files.smashing.media/articles/dynamic-donut-charts-css-conic-gradient-tailwindcss-react/3-diagram-pie-chart-conic-gradient.png\" /></p>\n<p>If that sounds confusing, it‚Äôs because it is, but if you look at the output of a function that can do all this, it might make more sense.</p>\n<pre><code>\"#...\", 0, 14,\n\"#...\",, 14, 43,\n\"#...\",, 43, 130,\n\"#...\",, 130, 234,\n\"#...\",, 234, 360,\n</code></pre>\n\nThe Function That Can Do All This\n<p>And here‚Äôs the function that can indeed do all of this. It uses <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/reduce\"><code>reduce()</code></a> to iterate over the data array, performs the necessary addition to calculate the angles, and returns a new set of numbers that can be used to create the correct start and end angles for use in a Chart.</p>\n<div>\n\n<pre><code>const total_value = data.reduce((a, b) =&gt; a + b.value, 0);\nconst convertToPercent = (num) =&gt; Math.round((num / total_value) * 100);\nconst convertToDegrees = (num) =&gt; Math.round((num / 100) * 360);\n\nconst css_string = data\n  .reduce((items, item, index, array) =&gt; {\n    items.push(item);\n\n    item.count = item.count || 0;\n    item.count += array[index - 1]?.count || item.count;\n    item.start_value = array[index - 1]?.count ? array[index - 1].count : 0;\n    item.end_value = item.count += item.value;\n    item.start_percent = convertToPercent(item.start_value);\n    item.end_percent = convertToPercent(item.end_value);\n    item.start_degrees = convertToDegrees(item.start_percent);\n    item.end_degrees = convertToDegrees(item.end_percent);\n\n    return items;\n  }, [])\n  .map((chart) =&gt; {\n    const { color, start_degrees, end_degrees } = chart;\n    return <code>${color} ${start&amp;#95;degrees}deg ${end&amp;#95;degrees}deg</code>;\n  })\n  .join();\n</code></pre>\n</div>\n\n<p>I‚Äôve purposefully left this pretty verbose, so it‚Äôs easier to add in <code>console.log()</code>. I found this to be quite helpful when I was developing this function. </p>\n<p>You might notice the additional <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map\"><code>map</code></a> chained to the end of the <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/reduce\"><code>reduce</code></a>. By using a <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map\"><code>map</code></a> I‚Äôm able to modify the returned values and tack on <code>deg</code>, then return them all together as an array of strings. </p>\n<p>Using <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/join\"><code>join</code></a> right at the end converts the array back to a single <code>css_string</code>, which can be used with <code>conic-gradient()</code> üòÖ.</p>\n<pre><code>\"#...\" 0deg 14deg,\n\"#...\" 14deg 43deg,\n\"#...\" 43deg 130deg,\n\"#...\" 130deg 234deg,\n\"#...\" 234deg 360deg\n</code></pre>\n\n\n\nUsing The <code>css_string</code> With An SVG <code>foreignObject</code>\n<p>Now, unfortunately, you can‚Äôt use <code>conic-gradient()</code> with <a href=\"https://developer.mozilla.org/en-US/docs/Web/SVG\">SVG</a>. But you can wrap an HTML element inside a <a href=\"https://developer.mozilla.org/en-US/docs/Web/SVG/Element/foreignObject\"><code>foreignObject</code></a> and style the <code>background</code> using a <code>conic-gradient()</code>.</p>\n<div>\n\n<pre><code>&lt;svg viewBox='0 0 100 100' xmlns='<a href=\"http://www.w3.org/2000/svg'\">http://www.w3.org/2000/svg'</a> style={{ borderRadius: '100%' }}&gt;\n  &lt;foreignObject x='0' y='0' width='100' height='100'&gt;\n    &lt;div\n      xmlns='<a href=\"http://www.w3.org/1999/xhtml'\">http://www.w3.org/1999/xhtml'</a>\n      style={{\n        width: '100%',\n        height: '100%',\n        background: <code>conic-gradient(${css_string})</code>, // &lt;- ü•≥\n      }}\n    /&gt;\n  &lt;/foreignObject&gt;\n&lt;/svg&gt;\n</code></pre>\n</div>\n\n<p>Using the above, you should be looking at a Pie chart. In order to make a Donut chart, I‚Äôll need to explain how to make the hole.</p>\nLet‚Äôs Talk About the Hole\n<p>There‚Äôs only really one way you can ‚Äòmask‚Äô off the middle of the Pie chart to reveal the background. This approach involves using a <a href=\"https://developer.mozilla.org/en-US/docs/Web/SVG/Element/clipPath\"><code>clipPath</code></a>. This approach looks like the below code snippet. I‚Äôve used this for Donut 1.</p>\n<p><strong>Note</strong>: <em>The <code>src</code> for Donut 1 can be seen here: <a href=\"https://github.com/PaulieScanlon/css-conic-gradient-charts/blob/main/components/donut-1.js#L44\">components/donut-1.js</a>.</em></p>\n<div>\n\n<pre><code>&lt;svg viewBox='0 0 100 100' xmlns='<a href=\"http://www.w3.org/2000/svg'\">http://www.w3.org/2000/svg'</a> style={{ borderRadius: '100%' }}&gt;\n\n  &lt;clipPath id='hole'&gt;\n    &lt;path d='M 50 0 a 50 50 0 0 1 0 100 50 50 0 0 1 0 -100 v 18 a 2 2 0 0 0 0 64 2 2 0 0 0 0 -64' /&gt;\n  &lt;/clipPath&gt;\n\n  &lt;foreignObject x='0' y='0' width='100' height='100' clipPath='url(#hole)'&gt;\n    &lt;div\n      xmlns='<a href=\"http://www.w3.org/1999/xhtml'\">http://www.w3.org/1999/xhtml'</a>\n      style={{\n        width: '100%',\n        height: '100%',\n        background: <code>conic-gradient(${css_string})</code>\n      }}\n    /&gt;\n  &lt;/foreignObject&gt;\n&lt;/svg&gt;\n</code></pre>\n</div>\n\n<p>However, there is another way. This approach involves using a <code>&lt;circle /&gt;</code> element and placing it in the center of the pie chart. This will work if the fill of the <code>&lt;circle /&gt;</code> matches the background color of whatever the chart is placed on. In my example, I‚Äôve used a pattern background, and you‚Äôll notice if you look closely at Donut 3 that you can‚Äôt see the <a href=\"https://heropatterns.com/\">bubble pattern</a> through the center of the chart. </p>\n<p><strong>Note</strong>: <em>The <code>src</code> for Donut 3 can be seen here: <a href=\"https://github.com/PaulieScanlon/css-conic-gradient-charts/blob/main/components/donut-3.js#L44\">components/donut-3.js</a>.</em></p>\n<div>\n\n<pre><code>&lt;svg viewBox='0 0 100 100' xmlns='<a href=\"http://www.w3.org/2000/svg'\">http://www.w3.org/2000/svg'</a> style={{ borderRadius: '100%' }}&gt;\n  &lt;foreignObject x='0' y='0' width='100' height='100'&gt;\n    &lt;div\n      xmlns='<a href=\"http://www.w3.org/1999/xhtml'\">http://www.w3.org/1999/xhtml'</a>\n      style={{\n        width: '100%',\n        height: '100%',\n        background: <code>conic-gradient(${css&amp;#95;string})</code>\n      }}\n    /&gt;\n  &lt;/foreignObject&gt;\n  &lt;circle cx='50' cy='50' r='32' fill='white' /&gt;\n&lt;/svg&gt;\n</code></pre>\n</div>\n\n<p>IMO the <code>clipPath</code> approach is nicer, but it can be more difficult to amend the path points to get the desired thickness of the hole if you don‚Äôt have access to something like Figma or Illustrator.</p>\nFinally, Colors!\n<p>Colors for charts are something that always cause me problems. Most of the time, the colors I use are defined in CSS, and all this stuff is happening in JavaScript, so how do you use CSS variables in JavaScript?</p>\n<p>In my example site, I‚Äôm using <a href=\"https://tailwindcss.com/\">Tailwind</a> to style ‚Äòall the things‚Äô and by using <a href=\"https://gist.github.com/Merott/d2a19b32db07565e94f10d13d11a8574\">this trick</a>, I‚Äôm able to expose the CSS variables so they can be referred to by their name. </p>\n<p>If you want to do the same, you could add a <code>color</code> key to the data array:</p>\n<pre><code>data={[\n  {\n    name: 'Cluster 1',\n    value: 210,\n    color: 'var(--color-fuchsia-400)',\n  },\n  {\n    name: 'Cluster 2',\n    value: 30,\n    color: 'var(--color-fuchsia-100)',\n  },\n  {\n    name: 'Cluster 3',\n    value: 180,\n    color: 'var(--color-fuchsia-300)',\n  },\n  {\n    name: 'Cluster 4',\n    value: 260,\n    color: 'var(--color-fuchsia-500)',\n  },\n  {\n    name: 'Cluster 5',\n    value: 60,\n    color: 'var(--color-fuchsia-200)',\n  },\n].sort((a, b) =&gt; a.value - b.value)\n</code></pre>\n\n<p>And then reference the <code>color</code> key in the array <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map\"><code>map</code></a> to return it as part of the <code>css_string</code>. I‚Äôve used this approach in Donut 2.</p>\n<p><strong>Note</strong>: <em>You can see the <code>src</code> for Donut 2 here: <a href=\"https://github.com/PaulieScanlon/css-conic-gradient-charts/blob/main/components/donut-2.js#L25\">components/donut-2.js</a>.</em></p>\n<pre><code>.map((chart) =&gt; {\n  const { color, start_degrees, end_degrees } = chart;\n  return ` ${color} ${start_degrees}deg ${end_degrees}deg`;\n})\n.join();\n</code></pre>\n\n<p>You could even dynamically create the color name using a hard-coded value (<code>color-pink-</code>) + the <code>index</code> from the array. I‚Äôve used this approach in Donut 1.</p>\n<p><strong>Note</strong>: <em>You can see the <code>src</code> for Donut 1 here: <a href=\"https://github.com/PaulieScanlon/css-conic-gradient-charts/blob/main/components/donut-1.js#L26\">components/donut-1.js</a>.</em></p>\n<div>\n\n<pre><code>.map((chart, index) =&gt; {\n  const { start_degrees, end_degrees } = chart;\n  return <code>var(--color-pink-${(index + 1) &amp;#42; 100}) ${start&amp;#95;degrees}deg ${end&amp;#95;degrees}deg</code>;\n})\n.join();\n</code></pre>\n</div>\n\n\n\nIf You‚Äôre Lucky!\n<p>However, you might get lucky and be working with an API that actually returns values with an associated color. This is the case with the <a href=\"https://docs.github.com/en/graphql\">GitHub GraphQL API</a>. So. I popped together one last example. </p>\n<p><img src=\"https://files.smashing.media/articles/dynamic-donut-charts-css-conic-gradient-tailwindcss-react/2-ccs-conic-gradient-charts.png\" /></p>\n<p>You can see this working in your browser by visiting <a href=\"https://css-conic-gradient-charts.vercel.app/github\">/github</a>, and the <code>src</code> for both the GitHub Donut Chart and Legend can be found here:</p>\n<ul>\n<li><a href=\"https://github.com/PaulieScanlon/css-conic-gradient-charts/blob/main/components/github-chart.js\">components/github-chart.js</a>;</li>\n<li><a href=\"https://github.com/PaulieScanlon/css-conic-gradient-charts/blob/main/components/github-legend.js\">components/github-legend.js</a>.</li>\n</ul>\nWrapping Up\n<p>You might be thinking this is quite complicated, and it‚Äôs probably easier to use a Charting Library, and you‚Äôre probably right. It probably is. But this way is <strong>super lightweight</strong>. There are no additional libraries to install or maintain, and there‚Äôs no heavy JavaScript that needs to be downloaded by the browser in order for them to work. </p>\n<p>I experimented once before with creating Donut Charts using an SVG and the <a href=\"https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/stroke-dasharray\"><code>stroke-dashoffset</code></a>. You can read about that in my article, ‚Äú<a href=\"https://paulie.dev/posts/2021/01/react-svg-doughnut-chart/\">Create an SVG Doughnut Chart From Scratch For Your Gatsby Blog</a>.‚Äù That approach worked really well, but I think I prefer the approach described in this post. CSS is simply the best!  </p>\n<p>If you‚Äôd like to discuss any of the methods I‚Äôve used here, please come find me on Twitter: <a href=\"https://twitter.com/PaulieScanlon\">@PaulieScanlon</a>. </p>\n<p>See you around the internet!</p>","author":"","siteTitle":"Articles on Smashing Magazine ‚Äî For Web Designers And Developers","siteHash":"ab069ca35bf300e9db0da36f49701f66485a5b0d2db0471dfeee07cef6204939","entryHash":"955d89c6cacb73d9278f881d40518264792f7546b5a98d8877862497008d4b79","category":"Tech"}