{"title":"Streamline container application networking with built-in Amazon ECS support in Amazon VPC Lattice","link":"https://aws.amazon.com/blogs/aws/streamline-container-application-networking-with-native-amazon-ecs-support-in-amazon-vpc-lattice/","date":1731966942000,"content":"<p>Since its launch, <a href=\"https://aws.amazon.com/vpc/lattice/\">Amazon VPC Lattice</a> has streamlined complex networking tasks. As a result, my perspective on how to build and connect modern, multi-service applications has changed. As my colleague <a href=\"https://www.linkedin.com/in/dpoccia/\">Danilo</a> wrote in <a href=\"https://aws.amazon.com/blogs/aws/simplify-service-to-service-connectivity-security-and-monitoring-with-amazon-vpc-lattice-now-generally-available/\">his post</a> announcing the general availability of VPC Lattice:</p> \n<blockquote>\n <p>“By using VPC Lattice, you can focus on your application logic and improve productivity and deployment flexibility with consistent support for instances, containers, and serverless computing.”</p>\n</blockquote> \n<p>Today, we’re announcing Amazon VPC Lattice built-in support for <a href=\"https://aws.amazon.com/ecs/\">Amazon Elastic Container Service (Amazon ECS)</a>. With this new built-in integration, Amazon ECS services can now be directly associated with VPC Lattice target groups without the need for intermediate load balancers.</p> \n<p>Here’s a quick look at how you can find Amazon VPC Lattice integration while creating an Amazon ECS service:</p> \n<p><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/11/05/news_2024_lattice-ecs-17.png\" width=\"3352\" height=\"1590\" /></p> \n<p>The Amazon VPC Lattice integration with Amazon ECS works by registering and deregistering IP addresses from ECS tasks within a service as targets in a VPC Lattice target group. As ECS tasks for the service are launched, Amazon ECS will automatically register those tasks to the VPC Lattice target group.</p> \n<p>Furthermore, if ECS tasks fail VPC Lattice health checks, Amazon ECS will automatically replace the tasks. Also, if any task is terminated or scales down, it’s removed from the target group.</p> \n<p><span><strong>Using the Amazon VPC Lattice integration<br /> </strong></span>Let me walk you through how to use this new integration. In the following demo, I will deploy a simple application server running as an ECS service and configure the integration with VPC Lattice. Then, I’ll test the application server by connecting to the VPC Lattice domain name without having to configure additional load balancers on Amazon ECS.</p> \n<p>Before I can start with this integration, I need to make sure Amazon ECS will have the required permissions to register and deregister targets into VPC Lattice. To learn more, please visit the <a href=\"https://docs.aws.amazon.com/AmazonECS/latest/developerguide/infrastructure_IAM_role.html\">Amazon ECS infrastructure IAM role</a> documentation page.</p> \n<p>To use the integration with VPC Lattice, I need to define a task definition with at least one container and one port mapping. This is an example of my task definition.</p> \n<pre><code>{\n    \"containerDefinitions\": [\n        {\n            \"name\": \"webserver\",\n            \"image\": \"public.ecr.aws/ecs-sample-image/amazon-ecs-sample:latest\",\n            \"cpu\": 0,\n            \"portMappings\": [\n                {\n                    \"name\": \"web-80-tcp\",\n                    \"containerPort\": 80,\n                    \"hostPort\": 80,\n                    \"protocol\": \"tcp\",\n                    \"appProtocol\": \"http\"\n                }\n            ],\n            ...\n            *redacted for brevity*\n}\n</code></pre> \n<p>Then, I navigate to my ECS cluster and choose <strong>Create</strong>.</p> \n<p><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/11/05/news_2024_lattice-ecs-1.jpg\" width=\"2560\" height=\"1413\" /></p> \n<p>Next, I need to select the task definition and assign the service name.</p> \n<p><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/11/05/news_2024_lattice-ecs-2.jpg\" width=\"2094\" height=\"2212\" /></p> \n<p>In the VPC Lattice integration section, I choose <strong>Turn on VPC Lattice</strong> to start configuring the target group for VPC Lattice. I don’t need to specify a load balancer because I’ll use VPC Lattice. By default, VPC Lattice will use a round-robin routing algorithm to route requests to healthy targets.</p> \n<p><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/11/05/news_2024_lattice-ecs-3.jpg\" width=\"2560\" height=\"912\" /></p> \n<p>Now, I can start defining the integration for my ECS service in VPC Lattice. First, I select the infrastructure role for Amazon ECS. Then, I need to select the virtual private cloud (VPC) where I want my service to run. After that, I need to define the <strong>Target</strong><strong> groups </strong>that will receive traffic. After I’m done configuring the service with VPC Lattice integration, I create this service.</p> \n<p><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/11/05/news_2024_lattice-ecs-4.jpg\" width=\"2560\" height=\"1626\" /></p> \n<p>After a few minutes, I have my ECS service ready. I navigate to the service and choose <strong>Configuration and networking</strong>. If I scroll down to the <strong>VPC Lattice</strong> section, I can see the VPC Lattice target group created.</p> \n<p><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/11/05/6.png\" width=\"2934\" height=\"1181\" /></p> \n<p>To get more information on this target group, I select the target group name, which will redirect me to the VPC Lattice target group page. Here, I can see that Amazon ECS successfully registered the IP address of the running task.</p> \n<p><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/11/05/news_2024_lattice-ecs-7.jpg\" width=\"2560\" height=\"1363\" /></p> \n<p>Now, I need to create a VPC Lattice service and service network. My preference is always to create the VPC Lattice service then associate with the VPC Lattice service network later on. So, let’s do that.</p> \n<p>I choose <strong>Services</strong> under the <strong>VPC Lattice</strong> section and choose <strong>Create service</strong>.</p> \n<p><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/11/05/news_2024_lattice-ecs-8-1.jpg\" width=\"2560\" height=\"1265\" /></p> \n<p>I fill in all the details required to create a VPC Lattice service and choose <strong>Next</strong>.</p> \n<p><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/11/05/news_2024_lattice-ecs-9.jpg\" width=\"2560\" height=\"1722\" /></p> \n<p>Then, I add a listener, and for the <strong>Forward to target group</strong> on the <strong>Listener default action</strong>, I select the newly created target group.</p> \n<p><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/11/05/news_2024_lattice-ecs-10.jpg\" width=\"2560\" height=\"1449\" /></p> \n<p>On the next page, because I’m going to create the VPC Lattice service network later, I skip this step and choose <strong>Next</strong>, review the configurations, and create the service.</p> \n<p><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/11/05/news_2024_lattice-ecs-15.png\" width=\"2974\" height=\"1480\" /></p> \n<p>With VPC Lattice service created, now it’s time to create VPC Lattice service networks. I navigate to <strong>Service networks</strong> under the <strong>VPC Lattice</strong> section and choose <strong>Create service network</strong>.</p> \n<p><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/11/05/news_2024_lattice-ecs-14.png\" width=\"3010\" height=\"1482\" /></p> \n<p>First, I fill the VPC Lattice service network name.</p> \n<p><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/11/05/news_2024_lattice-ecs-11.jpg\" width=\"2560\" height=\"1851\" /></p> \n<p>Then, on the <strong>Service associations </strong>page, I select the service that I have created.</p> \n<p><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/11/05/news_2024_lattice-ecs-11-1.jpg\" width=\"2560\" height=\"792\" /></p> \n<p>I associate this service network to my VPC as well as the security group.</p> \n<p><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/11/05/news_2024_lattice-ecs-11-2.jpg\" width=\"2560\" height=\"1328\" /></p> \n<p>For the simplicity of this demo, I set <strong>Non</strong><strong>e</strong> for the <strong>Auth</strong> <strong>type</strong>. However, I highly recommend you to read how you can use <a href=\"https://docs.aws.amazon.com/vpc-lattice/latest/ug/security_iam_service-with-iam.html\">IAM to manage access to VPC Lattice</a>. Then, I choose <strong>Create service network</strong>.<br /> <img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/11/05/news_2024_lattice-ecs-11-3.jpg\" width=\"2560\" height=\"1111\" /></p> \n<p>At this stage, we have everything setup for this integration. My VPC Lattice service network is now associated with my VPC Lattice service and my VPC.</p> \n<p><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/11/05/news_2024_lattice-ecs-12.jpg\" width=\"2560\" height=\"1591\" /></p> \n<p>With everything set up, I copy the <strong>Domain name</strong> from my VPC Lattice service page.</p> \n<p><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/11/05/news_2024_lattice-ecs-13.jpg\" width=\"2301\" height=\"1134\" /></p> \n<p>Then, to access the service, I log in to the instance in the same VPC and call the service by using the domain name from VPC Lattice.</p> \n<pre><code>[ec2-user@ ~]$ curl http://service-a-XYZ.XYZ.vpc-lattice-svcs.XYZ.on.aws\n\n\"Hello there! I'm Amazon ECS.\"</code></pre> \n<p>One thing to note is if you’re not receiving traffic to your Amazon ECS workloads, check the security groups as described in the <a href=\"https://docs.aws.amazon.com/vpc-lattice/latest/ug/security-groups.html\">Control traffic in VPC Lattice using security groups</a> documentation page.</p> \n<p>I’m personally excited about this integration because it unlocks various possibilities while streamlining application architectures and improving overall system reliability. Now that <a href=\"https://docs.aws.amazon.com/vpc-lattice/latest/ug/target-groups.html#target-type\">all AWS compute types are inherently supported in VPC Lattice</a>, I can unify services across all my ECS clusters, AWS accounts, and VPCs.</p> \n<p><span><strong>Things to know<br /> </strong></span>Here are a couple of important points to note:</p> \n<ul> \n <li><strong>Availability</strong> – <a href=\"https://docs.aws.amazon.com/AmazonECS/latest/developerguide/ecs-vpc-lattice.html\">Amazon VPC Lattice integration with Amazon ECS</a> is now available in AWS Regions where Amazon VPC Lattice and Amazon ECS are available.</li> \n <li><strong>Compatibility</strong> – This integration supports all ECS launch types, including <a href=\"https://aws.amazon.com/ec2/\">Amazon Elastic Compute Cloud (Amazon EC2)</a> and <a href=\"https://aws.amazon.com/fargate/\">AWS Fargate</a>.</li> \n <li><strong>Pricing</strong> – Standard <a href=\"https://aws.amazon.com/vpc/lattice/pricing/\">VPC Lattice</a> and <a href=\"https://aws.amazon.com/ecs/pricing/\">Amazon ECS</a> pricing applies. There are no additional charges for using this integration.</li> \n <li><strong>Monitoring Amazon VPC Lattice</strong> – Check out <a href=\"https://docs.aws.amazon.com/vpc-lattice/latest/ug/monitoring-overview.html\">Monitoring Amazon VPC Lattice</a> in the VPC Lattice User Guide to learn how to monitor your Amazon VPC Lattice service networks, services, target groups, and VPC connections.</li> \n <li><strong>Migrating</strong> – Read <a href=\"https://aws.amazon.com/blogs/networking-and-content-delivery/migrate-amazon-ecs-service-communication-to-amazon-vpc-lattice/\">Migrate Amazon ECS service communication to Amazon VPC Lattice.</a></li> \n</ul> \n<p>Try this new capability of Amazon VPC Lattice today and see how it can streamline your container application communication running on Amazon ECS.</p> \n<p>Happy building!</p> \n<p>— <a href=\"https://linkedin.com/in/donnieprakoso\">Donnie Prakoso</a></p>","author":"Donnie Prakoso","siteTitle":"AWS News Blog","siteHash":"6093e072e4117ec22616e844cb857d03ca62c57a411a8affc77cb5e8b6b15bf6","entryHash":"1dd8861deefe98f2a0c29f46baf9d9a0dccee7d0c13631abf70cf2260a3db8c0","category":"Tech"}