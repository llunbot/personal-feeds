{"title":"AWS analytics services streamline user access to data, permissions setting, and auditing","link":"https://aws.amazon.com/blogs/aws/aws-analytics-services-streamline-user-access-to-data-permissions-setting-and-auditing/","date":1717001072000,"content":"<p>I am pleased to announce a new use case based on <a href=\"https://docs.aws.amazon.com/singlesignon/latest/userguide/trustedidentitypropagation-overview.html\">trusted identity propagation</a>, a recently introduced capability of <a href=\"https://aws.amazon.com/iam/identity-center/\">AWS IAM Identity Center</a>.</p> \n<p>Tableau, a commonly used business intelligence (BI) application, can now propagate end-user identity down to <a href=\"https://aws.amazon.com/redshift/\">Amazon Redshift</a>. This has a triple benefit. It <b>simplifies the sign-in experience</b> for end users. It allows data owners to <b>define access based on real end-user identity</b>. It allows auditors to <b>verify data access by users</b>.</p> \n<p>Trusted identity propagation allows applications that consume data (such as <a href=\"https://www.tableau.com/\">Tableau</a>, <a href=\"https://quicksight.aws\">Amazon QuickSight</a>, <a href=\"https://aws.amazon.com/redshift/query-editor-v2/\">Amazon Redshift Query Editor</a>, <a href=\"https://aws.amazon.com/emr/features/studio/\">Amazon EMR Studio</a>, and others) to propagate the user’s identity and group memberships to the services that store and manage access to the data, such as <span>Amazon Redshift</span>, <a href=\"https://aws.amazon.com/athena\">Amazon Athena</a>, <a href=\"https://aws.amazon.com/s3/\">Amazon Simple Storage Service (Amazon S3)</a>, <a href=\"https://aws.amazon.com/emr\">Amazon EMR</a>, and others. Trusted identity propagation is a capability of IAM Identity Center that improves the sign-in experience across multiple analytics applications, simplifies data access management, and simplifies audit. End users benefit from single sign-on and do not have to specify the IAM roles they want to assume to connect to the system.</p> \n<p>Before diving into more details, let’s agree on terminology.</p> \n<p>I use the term “<strong>identity providers”</strong> to refer to the systems that hold user identities and group memberships. These are the systems that prompt the user for credentials and perform the authentication. For example, <a href=\"https://docs.aws.amazon.com/singlesignon/latest/userguide/azure-ad-idp.html\">Azure Directory</a>, <a href=\"https://docs.aws.amazon.com/singlesignon/latest/userguide/okta-idp.html\">Okta</a>, <a href=\"https://docs.aws.amazon.com/singlesignon/latest/userguide/pingidentity.html\">Ping Identity</a>, and more. <a href=\"https://docs.aws.amazon.com/singlesignon/latest/userguide/supported-idps.html\">Check the full list of identity providers we support</a>.</p> \n<p>I use the term “<strong>user-facing applications”</strong> to designate the applications that consume data, such as <a href=\"https://www.tableau.com/\">Tableau</a>, <a href=\"https://powerbi.microsoft.com\">Microsoft PowerBI</a>, QuickSight, <a href=\"https://aws.amazon.com/redshift/query-editor-v2/\">Amazon Redshift Query Editor</a>, and others.</p> \n<p>And finally, when I write “<strong>downstream services”</strong>, I refer to the analytics engines and storage services that process, store, or manage access to your data: <span>Amazon Redshift</span>, Athena, S3, <span>EMR</span>, and others.</p> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/04/25/pez-high-level-v03-1.png\"><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/04/25/pez-high-level-v03-1.png\" alt=\"Trusted Identity Propagation - high-level diagram\" width=\"1589\" height=\"551\" /></a></p> \n<p>To understand the benefit of trusted identity propagation, let’s briefly talk about how data access was granted until today. When a user-facing application accesses data from a downstream service, either the upstream service uses generic credentials (such as “<code>tableau_user</code>“) or assumes an <span>IAM</span> role to authenticate against the downstream service. This is the source of two challenges.</p> \n<p>First, it makes it difficult for the downstream service administrator to define access policies that are fine-tuned for the actual user making the request. As seen from the downstream service, all requests originate from that common user or IAM role. If Jeff and Jane are both mapped to the <code>BusinessAnalytics</code> IAM role, then it is not possible to give them different levels of access, for example, readonly and read-write. Furthermore, if Jeff is also in the <code>Finance</code> group, he needs to choose a role in which to operate; he cannot access data from both groups in the same session.</p> \n<p>Secondly, the task of associating a data-access event to an end user involves some undifferentiated heavy lifting. If the request originates from an IAM role called <code>BusinessAnalytics</code>, then additional work is required to figure out which user was behind that action.</p> \n<p>Well, this particular example might look very simple, but in real life, organizations have hundreds of users and thousands of groups to match to hundreds of datasets. There was an opportunity for us to <a href=\"https://www.amazon.jobs/content/en/our-workplace/leadership-principles\">Invent and Simplify</a>.</p> \n<p>Once configured, the new trusted identity propagation provides a technical mechanism for user-facing applications to access data on behalf of the actual user behind the keyboard. Knowing the actual user identity offers three main advantages.</p> \n<p>First, it allows downstream service administrators to <strong>create and manage access policies based on actual user identities</strong>, the groups they belong to, or a combination of the two. Downstream service administrators can now assign access in terms of users, groups, and datasets. This is the way most of our customers naturally think about access to data—intermediate mappings to IAM roles are no longer necessary to achieve these patterns.</p> \n<p>Second, auditors now have access to the <strong>original user identity in system logs</strong> and can verify that policies are implemented correctly and follow all requirements of the company or industry-level policies.</p> \n<p>Third, users of BI applications can benefit from <strong>single sign-on between applications</strong>. Your end-users no longer need to understand your company’s AWS accounts and IAM roles. Instead, they can sign in to EMR Studio (for example) using their corporate single sign-on that they’re used to for so many other things they do at work.</p> \n<p><span><strong>How does trusted identity propagation work?<br /> </strong></span>Trusted identity propagation relies on standard mechanisms from our industry: <a href=\"https://datatracker.ietf.org/doc/html/rfc6749\">OAuth2</a> and <a href=\"https://datatracker.ietf.org/doc/html/rfc7519\">JWT</a>. OAuth2 is an open standard for access delegation that allows users to grant third-party user-facing applications access to data on other services (downstream services) without exposing their credentials. JWT (JSON Web Token) is a compact, URL-safe means of representing identities and claims to be transferred between two parties. JWTs are signed, which means their integrity and authenticity can be verified.</p> \n<p><span><strong>How to configure trusted identity propagation<br /> </strong></span>Configuring trusted identity propagation requires setup in IAM Identity Center, at the user-facing application, and at the downstream service because each of these needs to be told to work with end-user identities. Although the particulars will be different for each application, they will all follow this pattern:</p> \n<ol> \n <li><a href=\"https://docs.aws.amazon.com/singlesignon/latest/userguide/manage-your-identity-source.html\">Configure an identity source in AWS IAM Identity Center</a>. AWS recommends enabling automated provisioning if your identity provider supports it, as most do. Automated provisioning works through the <a href=\"https://docs.aws.amazon.com/singlesignon/latest/userguide/provision-automatically.html\">SCIM synchronization</a> standard to synchronize your directory users and groups into IAM Identity Center. You probably have configured this already if you currently use IAM Identity Center to federate your workforce into the <a href=\"https://console.aws.amazon.com\">AWS Management Console</a>. This is a one-time configuration, and you don’t have to repeat this step for each user-facing application.</li> \n <li>Configure your user-facing application to authenticate its users with your identity provider. For example, configure Tableau to use Okta.</li> \n <li>Configure the connection between the user-facing application and the downstream service. For example, configure Tableau to access Amazon Redshift. In some cases, it requires <a href=\"https://docs.aws.amazon.com/redshift/latest/mgmt/configuring-connections.html\">using the ODBC or JDBC driver for Redshift</a>.</li> \n</ol> \n<p>Then comes the configuration specific to trusted identity propagation. For example, imagine your organization has developed a user-facing web application that authenticates the users with your identity provider, and that you want to access data in AWS on behalf of the current authenticated user. For this use case, you would create a <a href=\"https://docs.aws.amazon.com/singlesignon/latest/userguide/using-apps-with-trusted-token-issuer.html\">trusted token issuer</a> in IAM Identity Center. This powerful new construct gives you a way to map your application’s authenticated users to the users in your IAM Identity Center directory so that it can make use of trusted identity propagation. <a href=\"https://aws.amazon.com/blogs/storage/how-to-develop-a-user-facing-data-application-with-iam-identity-center-and-s3-access-grants/\">My colleague Becky wrote a blog post to show you how to develop such an application</a>. This additional configuration is required only when using third-party applications, such as Tableau, or a customer-developed application, that authenticate outside of AWS. When using user-facing applications managed by AWS, such as Amazon QuickSight, no further setup is required.</p> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/04/17/Tableau-Okta-Integration.png\"><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/04/17/Tableau-Okta-Integration.png\" alt=\"setup an external IdP to issue trusted token\" width=\"800\" height=\"951\" /></a></p> \n<p>Finally, downstream service administrators must configure the access policies based on the user identity and group memberships. The exact configuration varies from one downstream service to the other. If the application reads or writes data in Amazon S3, the data owner may use <a href=\"https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-grants.html\">S3 Access Grants</a> in the Amazon S3 console to grant access for users and groups to prefixes in Amazon S3. If the application makes queries to an Amazon Redshift data warehouse, the data owner must configure IAM Identity Center trusted connection in the Amazon Redshift console and match the audience claim (<code>aud</code>) from the identity provider.</p> \n<p>Now that you have a high-level overview of the configuration, let’s dive into the most important part: the user experience.</p> \n<p><strong><span>The end-user experience</span><br /> </strong>Although the precise experience of the end user will obviously be different for different applications, in all cases, it will be simpler and more familiar to workforce users than before. The user interaction will begin with a redirect-based authentication single sign-on flow that takes the user to their identity provider, where they can sign in with credentials, multi-factor authentication, and so on.</p> \n<p>Let’s look at the details of how an end user might interact with Okta and Tableau when trusted identity propagation has been configured.</p> \n<p>Here is an illustration of the flow and the main interactions between systems and services.</p> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/04/17/pez-illustration-v02.png\"><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/04/17/pez-illustration-v02.png\" alt=\"Trusted Identity Propagation flow\" width=\"800\" height=\"500\" /></a></p> \n<p>Here’s how it goes.</p> \n<p>1. As a user, I attempt to sign in to Tableau.</p> \n<p>2. Tableau initiates a browser-based flow and redirects to the Okta sign-in page where I can enter my sign-in credentials. On successful authentication, Okta issues an authentication token (ID and access token) to Tableau.</p> \n<p>3. Tableau initiates a JDBC connection with Amazon Redshift and includes the access token in the connection request. The Amazon Redshift JDBC driver makes a call to Amazon Redshift. Because your Amazon Redshift administrator enabled IAM Identity Center, Amazon Redshift forwards the access token to IAM Identity Center.</p> \n<p>4. IAM Identity Center verifies and validates the access token and exchange the access token for an Identity Center issued token.</p> \n<p>5. Amazon Redshift will resolve the Identity Center token to determine the corresponding Identity Center user and authorize access to the resource. Upon successful authorization, I can connect from Tableau to Amazon Redshift.</p> \n<p>Once authenticated, I can start to use Tableau as usual.</p> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/04/17/Tableau-Okta-integration-3.png\"><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/04/17/Tableau-Okta-integration-3.png\" alt=\"Trusted Identity Propagation - Tableau usage\" width=\"800\" height=\"347\" /></a></p> \n<p>And when I connect to Amazon Redshift Query Editor, I can observe the <code>sys_query_history</code> table to check who was the user who made the query. It correctly reports <code>awsidc:&lt;email address&gt;</code>, the Okta email address I used when I connected from Tableau.</p> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/04/17/Tableau-Okta-Integration-4.png\"><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/04/17/Tableau-Okta-Integration-4.png\" alt=\"Trusted Identity Propagation - audit in Redshift\" width=\"800\" height=\"150\" /></a></p> \n<p>You can read <a href=\"https://help.tableau.com/current/online/en-us/config_oauth_redshift_iam.htm\">Tableau’s documentation</a> for more details about this configuration.</p> \n<p><span><strong>Pricing and availability<br /> </strong></span>Trusted identity propagation is provided at no additional cost in <a href=\"https://docs.aws.amazon.com/general/latest/gr/sso.html\">the 26 AWS Regions where AWS IAM Identity Center is available today</a>.</p> \n<p>Here are more details about trusted identity propagation and downstream service configurations.</p> \n<div> \n <div> \n  <div> \n   <div> \n    <div> \n     <div> \n      <div> \n       <div> \n        <div> \n         <div> \n          <div> \n           <div> \n            <ul> \n             <li><a href=\"https://aws.amazon.com/blogs/security/simplify-workforce-identity-management-using-iam-identity-center-and-trusted-token-issuers/\" target=\"_blank\">Simplify workforce identity management using IAM Identity Center and trusted token issuers</a></li> \n             <li><a href=\"https://aws.amazon.com/blogs/big-data/integrate-okta-with-amazon-redshift-query-editor-v2-using-aws-iam-identity-center-for-seamless-single-sign-on/\" target=\"_blank\">Integrate Okta with Amazon Redshift Query Editor V2 using AWS IAM Identity Center for seamless Single Sign-On</a></li> \n             <li><a href=\"https://aws.amazon.com/blogs/big-data/simplify-access-management-with-amazon-redshift-and-aws-lake-formation-for-users-in-an-external-identity-provider/\" target=\"_blank\">Simplify access management with Amazon Redshift and AWS Lake Formation for users in an External Identity Provider</a></li> \n             <li><a href=\"https://aws.amazon.com/blogs/big-data/bring-your-workforce-identity-to-amazon-emr-studio-and-athena/\" target=\"_blank\">Bring your workforce identity to Amazon EMR Studio and Athena</a></li> \n             <li><a href=\"https://aws.amazon.com/blogs/storage/how-to-develop-a-user-facing-data-application-with-iam-identity-center-and-s3-access-grants/\" target=\"_blank\">How to develop a user-facing data application with IAM Identity Center and S3 Access Grants</a> (in two parts)</li> \n            </ul> \n           </div> \n          </div> \n         </div> \n        </div> \n       </div> \n      </div> \n     </div> \n    </div> \n   </div> \n  </div> \n </div> \n</div> \n<div> \n <div> \n  <div> \n   <div> \n    <div> \n     <div> \n      <div> \n       <div> \n        <div> \n         <div> \n          <div></div> \n         </div> \n        </div> \n       </div> \n      </div> \n     </div> \n    </div> \n   </div> \n  </div> \n </div> \n</div> \n<p>Happy reading!</p> \n<p>With trusted identity propagation, you can now configure analytics systems to propagate the actual user identity, group membership, and attributes to AWS services such as <span>Amazon Redshift</span>, <a href=\"https://aws.amazon.com/athena\">Amazon Athena</a>, or Amazon S3. It simplifies the management of access policies on these services. It also allows auditors to verify your organization’s compliance posture to know the real identity of users accessing data.</p> \n<p>Get started now and configure your Tableau integration with Amazon Redshift.</p> \n<p><a href=\"https://twitter.com/sebsto\">-- seb</a></p> \n<p>PS: Writing a blog post at AWS is always a team effort, even when you see only one name under the post title. In this case, I want to thank <a href=\"https://www.linkedin.com/in/eva-mineva-8183672/\">Eva Mineva</a>, <a href=\"https://www.linkedin.com/in/lauradreith/\">Laura Reith</a>, and <a href=\"https://www.linkedin.com/in/robertomigli/\">Roberto Migli</a> for their much-appreciated help in understanding the many subtleties and technical details of trusted identity propagation.</p>","author":"Sébastien Stormacq","siteTitle":"AWS News Blog","siteHash":"6093e072e4117ec22616e844cb857d03ca62c57a411a8affc77cb5e8b6b15bf6","entryHash":"cd035678954473d63d78cc1d1def2babcc0a12119784d4c68a0fdf0c35479cc8","category":"Tech"}