{"title":"เรื่องที่น่าสนใจจากบทความเรื่อง Contextual Retrieval จาก Anthropic","link":"https://www.somkiat.cc/hello-contextual-retrieval-from-anthropic/","date":1727163780000,"content":"<p><img width=\"150\" height=\"150\" src=\"https://www.somkiat.cc/wp-content/uploads/2024/09/retrieval_LM-150x150.jpg\" loading=\"lazy\" srcset=\"https://www.somkiat.cc/wp-content/uploads/2024/09/retrieval_LM-150x150.jpg 150w, https://www.somkiat.cc/wp-content/uploads/2024/09/retrieval_LM-75x75.jpg 75w\" /></p>\n<figure><a href=\"https://www.somkiat.cc/wp-content/uploads/2024/09/retrieval_LM-scaled.jpg\"><img src=\"https://www.somkiat.cc/wp-content/uploads/2024/09/retrieval_LM-1024x410.jpg\" /></a></figure>\n\n\n\n<p>ทาง Anthropic ซึ่งเป็นเจ้าของ Claude.AI นั่นเอง<br />ได้เขียนบทความเรื่อง <strong><a href=\"https://www.anthropic.com/news/contextual-retrieval\" target=\"_blank\">Introducing Contextual Retrieval</a></strong><br />อธิบายเรื่องของการปรับปรุงความสามารถของ AI Model ต่าง ๆ<br />ด้วยแนวคิด Retrieval-Augmented Generation (RAG)</p>\n\n\n\n<span></span>\n\n\n\n<p><br />โครงสร้างของ RAG เป็นดังนี้</p>\n\n\n\n<figure><a href=\"https://www.somkiat.cc/wp-content/uploads/2024/09/rag-01.png\"><img src=\"https://www.somkiat.cc/wp-content/uploads/2024/09/rag-01-1024x574.png\" width=\"639\" height=\"357\" /></a></figure>\n\n\n\n<p><strong>โดยในบทความได้แนะนำสำหรับ Anthropic ไว้ดังนี้</strong></p>\n\n\n\n<p><strong>แบบที่ 1</strong></p>\n\n\n\n<p>ถ้าข้อมูลที่ต้องการเพิ่ม หรือ knowledge ไม่มากนัก<br />ซึ่งไม่เกิน 200,000 token หรือเอกสาร 500 หน้า<br />สามารถตรวจสอบผ่าน <a href=\"https://token-counter.app/anthropic\">Token counter </a>ได้เลย<br />ทำการส่งข้อมูลเหล่านี้ไปในส่วนของ context ใน user prompt ปกติได้เลย<br /><br />แต่ถ้ากลัวว่าถ้ามีหลาย ๆ  prompt ที่ใช้ข้อมูลเดิม<br />สามารถใช้งานผ่าน <a href=\"https://docs.anthropic.com/en/docs/build-with-claude/prompt-caching\" target=\"_blank\">feature Prompt caching</a> <br />ที่ทาง Anthropic เพิ่งปล่อยออกมาใน beta version<br />สามารถช่วยลดค่ายใช้จ่ายลงไปได้เยอะมาก ๆ<br />โดยที่อื่น ๆ  เช่น <a href=\"https://ai.google.dev/gemini-api/docs/caching?lang=python\" target=\"_blank\">Gemini</a> ก็มีให้ใช้งานด้วย</p>\n\n\n\n<p><strong>แบบที่ 2</strong></p>\n\n\n\n<p>ถ้าข้อมูลมีขนาดที่ใหญ่มาก ๆ  เกินแบบที่ 1<br />สามารถทำการ pre-processing ข้อมูลก่อน มีขั้นตอนดังนี้</p>\n\n\n\n<ul>\n<li>ทำการแบ่งข้อมูลเป็น chunk เล็ก ๆ</li>\n\n\n\n<li>สร้าง embedding model จาก check เล็ก ๆ  เพื่อจัดเก็บใน Vector database</li>\n\n\n\n<li>สร้าง TF-IDF(Term Frequency Inverse Document Frequency of records เพื่อจัดเก็บในการค้นหา หรือ ranking ข้อมูล </li>\n\n\n\n<li>เมื่อต้องส่ง user prompt ไปจะนำข้อมูลจากทั้งสองที่ไปใส่ เพื่อให้ได้ผลลัพธ์ที่ถูกต้องมากยิ่งขึ้น</li>\n\n\n\n<li>เมื่อได้ผลลัพธ์กลับมา จะทำการ ranking หรือ เรียงลำดับกลับออกมา</li>\n</ul>\n\n\n\n<p>แสดงการทำงานดังรูป</p>\n\n\n\n<figure><a href=\"https://www.somkiat.cc/wp-content/uploads/2024/09/rag-02.jpg\"><img src=\"https://www.somkiat.cc/wp-content/uploads/2024/09/rag-02.jpg\" width=\"648\" height=\"363\" /></a></figure>\n\n\n\n<p><strong>โดยที่ทาง Anthropic ได้เสนอแนวทางปรับปรุงออกมา คือ Contextual Retrieval</strong></p>\n\n\n\n<p>ทำการสร้าง Prompt template ออกมาให้ใช้งาน<br />โดยมีโครงสร้างดังนี้</p>\n\n\n\n<p></p>\n\n\n\n[gist id=\"39d846a3d826dbbb456efe9e1d604835\" file=\"1.txt\"]\n\n\n\n<p>จากนั้นทางระบบจะจัดการข้อมูลต่าง ๆ ใน pre-processing ให้อัตโนมัติ<br />และมีการทำ prompt caching ให้เลย <br />ค่าใช้จ่ายประมาณ 1.02 USD ต่อ 1 ล้าน token<br />ดังรูป</p>\n\n\n\n<figure><a href=\"https://www.somkiat.cc/wp-content/uploads/2024/09/rag-04.jpg\"><img src=\"https://www.somkiat.cc/wp-content/uploads/2024/09/rag-04.jpg\" width=\"642\" height=\"354\" /></a></figure>\n\n\n\n<p><strong>ตัวอย่างของการสร้าง Prompt พร้อมใช้งาน caching</strong></p>\n\n\n\n[gist id=\"39d846a3d826dbbb456efe9e1d604835\" file=\"demo.py\"]\n\n\n\n<p>โดยแนวทางนี้ช่วยปรับปรุงความถูกต้องของผลลัพธ์มากขึ้น<br />รวมทั้ง performance ที่ดีขึ้น<br />เป็นอีกแนวทางที่น่าสนใจมาก ๆ </p>\n","author":"somkiat","siteTitle":"cc :: somkiat","siteHash":"3a23a5a4389e1e40c6fbb16520a8cc20df5b3591c25145ce72aaa18b19e48201","entryHash":"37417c420a3a557ab99180bf050ce4fb1a4cbbace1da97850999ca0fbef2e730","category":"Thai"}