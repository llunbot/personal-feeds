{"title":"บันทึกปัญหาการใช้ Data structure ใน Redis","link":"https://www.somkiat.cc/data-structure-in-redis/","date":1628411050000,"content":"<p><img src=\"https://www.somkiat.cc/wp-content/uploads/2021/08/distributed-caching-in-aspdotnet-core-with-redis-1-150x150.png\" /></p>\n<p><strong>ปัญหาที่พบเจอสำหรับการจัดเก็บข้อมูลใน <a href=\"https://redis.io/\" target=\"_blank\">Redis</a></strong><br />นั่นก็คือ การเลือก data structure ที่ไม่เหมาะสมกับการใช้งาน<br />ส่งผลให้การทำงานในแต่ละ operation สูงขึ้น<br />ส่งผลให้ Redis รับงานได้น้อยลง<br />เนื่องจาก Redis ทำงานแบบ Single Thread นะ (แต่ก็ปรับปรุงมาเยอะ)<br />ดังนั้นจึงกลับมาดูที่ต้นเหตุ รวมทั้งความรู้พื้นฐานกันหน่อย</p>\n\n\n\n<span></span>\n\n\n\n<figure><img src=\"https://www.somkiat.cc/wp-content/uploads/2021/08/distributed-caching-in-aspdotnet-core-with-redis-1.png\" /></figure>\n\n\n\n<p><strong>โดยปกติข้อมูลที่เก็บใน Redis จะมี Data model แบบ Key-value</strong></p>\n\n\n\n<p>ซึ่ง value สามารถมีรูปแบบของข้อมูลหลัก ๆ ดังนี้</p>\n\n\n\n<ul><li><strong>Primitive data type</strong> เช่น string และ number</li><li><strong>Data structure</strong> ประกอบไปด้วย List, Set, Hash, SortedSet เป็นต้น</li></ul>\n\n\n\n<figure><img src=\"https://www.somkiat.cc/wp-content/uploads/2021/08/redis-data-structure-types.jpeg\" /></figure>\n\n\n\n<p>โดยส่วนใหญ่เราจำเป็นต้องทำความเข้าใจว่า<br />ระบบงานของเรานั้น ต้องการใช้ข้อมูลอย่างไร<br />เพื่อให้เลือก data structure ได้อย่างเหมาะสม<br />เนื่องจากการเข้าถึงข้อมูลใน Redis นั้น<br />จะมีการบอกและอธิบายไว้ชัดเจนว่ามี <strong><a href=\"https://en.wikipedia.org/wiki/Big_O_notation\" target=\"_blank\">Big O</a></strong> เท่าไร</p>\n\n\n\n<p><strong>ยกตัวอย่างเช่น การทำงานของ <a href=\"https://redis.io/commands/sort\" target=\"_blank\">SORT</a> operation</strong></p>\n\n\n\n<p>จะมี Big O คือ <strong>O(N+M*(log M))</strong> นั่นคือ<br />มีการทำงานตามจำนวนข้อมูลเป็นอย่างต่ำ</p>\n\n\n\n<figure><img src=\"https://www.somkiat.cc/wp-content/uploads/2021/08/Screen-Shot-2564-08-08-at-15.15.04-1024x538.png\" /></figure>\n\n\n\n<p>ดังนั้นจะดีกว่าไหม ถ้าเราลดเวลาการทำงานลงไป<br />ด้วยการเก็บข้อมูลที่ไม่ต้องมา SORT แบบนี้<br />หรือเป็นการเก็บข้อมูลแบบที่ SORT ให้เลยตั้งแต่แรก<br />นั่นคือการใช้ SortedSet<br />จากนั้นดึงข้อมูลก็ใช้ <a href=\"https://redis.io/commands/zrange\" target=\"_blank\">ZRANGE</a> operation <br />ที่มี Big O เพียง <strong>O(M*(log M))</strong><br />ซึ่งน่าจะงานได้มีประสิทธิภาพกว่าไหม ?</p>\n\n\n\n<figure><img src=\"https://www.somkiat.cc/wp-content/uploads/2021/08/Screen-Shot-2564-08-08-at-15.21.11-1024x497.png\" /></figure>\n\n\n\n<p><strong>ดังนั้นเรื่องของการออกแบบ ต้อง สัมพันธ์การ use case ของระบบ</strong></p>\n\n\n\n<p>ไม่ใช่เพียงแค่เก็บในสิ่งที่ทำงานได้รวดเร็วเท่านั้น<br />เพราะว่า แทนที่จะทำงานได้เร็ว กลับกลายเป็นคอขวด<br />เพราะว่าจะเก็บอย่างเดียว<br />โดยไม่ได้สนใจการนำมาใช้งาน ว่ามี operation cost มากเพียงใด</p>\n","author":"somkiat","siteTitle":"cc :: somkiat","siteHash":"3a23a5a4389e1e40c6fbb16520a8cc20df5b3591c25145ce72aaa18b19e48201","entryHash":"88a944db6a95e182b9ca0032b670cf731d87f5b8e25af0c4d99356b3280bb062","category":"Thai"}