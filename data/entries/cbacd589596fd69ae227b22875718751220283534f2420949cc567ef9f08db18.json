{"title":"Amazon S3 Express One Zone now supports AWS KMS with customer managed keys","link":"https://aws.amazon.com/blogs/aws/amazon-s3-express-one-zone-now-supports-aws-kms-with-customer-managed-keys/","date":1726607756000,"content":"<p><a href=\"https://docs.aws.amazon.com/AmazonS3/latest/userguide/s3-express-one-zone.html\">Amazon S3 Express One Zone</a>, a high-performance, single-Availability Zone (AZ) <a href=\"https://aws.amazon.com/s3/\">S3 storage</a> class, now supports server-side encryption with <a href=\"https://docs.aws.amazon.com/kms/latest/developerguide/overview.html\">AWS Key Management Service (KMS)</a> keys <a href=\"https://docs.aws.amazon.com/AmazonS3/latest/userguide/specifying-kms-encryption.html\">(SSE-KMS).</a> S3 Express One Zone already encrypts all objects stored in <a href=\"https://docs.aws.amazon.com/AmazonS3/latest/userguide/directory-buckets-overview.html\">S3 directory buckets</a> with <a href=\"https://docs.aws.amazon.com/AmazonS3/latest/userguide/UsingServerSideEncryption.html\">Amazon S3 managed keys (SSE-S3)</a> by default. Starting today, you can use <a href=\"https://docs.aws.amazon.com/kms/latest/developerguide/concepts.html#key-mgmt\">AWS KMS customer managed keys</a> to encrypt data at rest, with no impact on performance. This new encryption capability gives you an additional option to meet compliance and regulatory requirements when using S3 Express One Zone, which is designed to deliver consistent single-digit millisecond data access for your most frequently accessed data and latency-sensitive applications.</p> \n<p>S3 directory buckets allow you to specify only one customer managed key per bucket for SSE-KMS encryption. Once the customer managed key is added, you cannot edit it to use a new key. On the other hand, with S3 general purpose buckets, you can use multiple KMS keys either by changing the default encryption configuration of the bucket or during S3 PUT requests. When using SSE-KMS with S3 Express One Zone, <a href=\"https://docs.aws.amazon.com/AmazonS3/latest/userguide/bucket-key.html\">S3 Bucket Keys</a> are always enabled. S3 Bucket Keys are free and reduce the number of requests to AWS KMS by up to 99%, optimizing both performance and costs.</p> \n<p><span><strong>Using SSE-KMS with Amazon S3 Express One Zone</strong></span><br /> To show you this new capability in action, I first create an S3 directory bucket in the <a href=\"https://console.aws.amazon.com/s3/\">Amazon S3 console</a> following the steps to <a href=\"https://docs.aws.amazon.com/AmazonS3/latest/userguide/directory-bucket-create.html\">create a S3 directory bucket </a>and use <code>apne1-az4</code> as the <strong>Availability Zone.</strong> In <strong>Base name</strong>, I enter <code>s3express-kms</code> and a suffix that includes the Availability Zone ID wich is automatically added to create the final name. Then, I select the checkbox to acknowledge that <strong>Data is stored in a single Availability Zone.</strong></p> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/08/21/00-create-s3express.jpg\"><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/08/21/00-create-s3express-1024x938.jpg\" width=\"1024\" height=\"938\" /></a></p> \n<p>In the <strong>Default encryption</strong> section, I choose <strong>Server-side encryption with AWS Key Management Service keys (SSE-KMS)</strong>. Under <strong>AWS KMS Key</strong> I can <strong>Choose from your AWS KMS keys</strong>, <strong>Enter AWS KMS key ARN,</strong> or <strong>Create a KMS key</strong>. For this example, I previously created an AWS KMS key, which I selected from the list, and then choose <strong>Create bucket</strong>.</p> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/08/21/01-create-s3express-with-kms-3.jpg\"><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/08/21/01-create-s3express-with-kms-3-1024x919.jpg\" width=\"1024\" height=\"919\" /></a></p> \n<p>Now, any new object I upload to this S3 directory bucket will be automatically encrypted using my AWS KMS key.</p> \n<p><span><strong>SSE-KMS with Amazon S3 Express One Zone in action</strong></span><br /> To use SSE-KMS with S3 Express One Zone via the <a href=\"https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-welcome.html\">AWS Command Line Interface (AWS CLI)</a>, you need an <a href=\"https://docs.aws.amazon.com/IAM/latest/UserGuide/id_users.html\">AWS Identity and Access Management (IAM) user</a> or <a href=\"https://docs.aws.amazon.com/es_es/IAM/latest/UserGuide/id_roles.html\">role</a> with the following <a href=\"https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies.html\">policy</a> . This policy allows the <a href=\"https://docs.aws.amazon.com/AmazonS3/latest/API/API_CreateSession.html\">CreateSession API</a> operation, which is necessary to successfully upload and download encrypted files to and from your S3 directory bucket.</p> \n<div> \n <pre><code>{\n\t\"Version\": \"2012-10-17\",\n\t\"Statement\": [\n\t\t{\n\t\t\t\"Effect\": \"Allow\",\n\t\t\t\"Action\": [\n\t\t\t\t\"s3express:CreateSession\"\n\t\t\t],\n\t\t\t\"Resource\": [\n\t\t\t\t\"arn:aws:s3express:*:&lt;account&gt;:bucket/s3express-kms--apne1-az4--x-s3\"\n\t\t\t]\n\t\t},\n\t\t{\n\t\t\t\"Effect\": \"Allow\",\n\t\t\t\"Action\": [\n\t\t\t\t\"kms:Decrypt\",\n\t\t\t\t\"kms:GenerateDataKey\"\n\t\t\t],\n\t\t\t\"Resource\": [\n\t\t\t\t\"arn:aws:kms:*:&lt;account&gt;:key/&lt;keyId&gt;\"\n\t\t\t]\n\t\t}\n\t]\n}\n</code></pre> \n</div> \n<p>With the <a href=\"https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutObject.html\">PutObject</a><span> command, I upload a new file named </span><code>confidential-doc.txt</code><span> to my S3 directory bucket.</span></p> \n<div> \n <pre><code>aws s3api put-object --bucket s3express-kms--apne1-az4--x-s3 \\\n--key confidential-doc.txt \\\n--body confidential-doc.txt</code></pre> \n</div> \n<p>As a success of the previous command I receive the following output:</p> \n<div> \n <pre><code>{\n    \"ETag\": \"\\\"664469eeb92c4218bbdcf92ca559d03b\\\"\",\n    \"ChecksumCRC32\": \"0duteA==\",\n    \"ServerSideEncryption\": \"aws:kms\",\n    \"SSEKMSKeyId\": \"arn:aws:kms:ap-northeast-1:&lt;accountId&gt;:key/&lt;keyId&gt;\",\n    \"BucketKeyEnabled\": true\n}</code></pre> \n</div> \n<p>Checking the object’s properties with <a href=\"https://docs.aws.amazon.com/cli/latest/reference/s3api/head-object.html\">HeadObject</a> command, I see that it’s encrypted using SSE-KMS with the key that I created before:</p> \n<div> \n <pre><code>aws s3api head-object --bucket s3express-kms--apne1-az4--x-s3 \\\n--key confidential-doc.txt</code></pre> \n</div> \n<p>I get the following output:</p> \n<div> \n <pre> <code>\n{\n    \"AcceptRanges\": \"bytes\",\n    \"LastModified\": \"2024-08-21T15:29:22+00:00\",\n    \"ContentLength\": 5,\n    \"ETag\": \"\\\"664469eeb92c4218bbdcf92ca559d03b\\\"\",\n    \"ContentType\": \"binary/octet-stream\",\n    \"ServerSideEncryption\": \"aws:kms\",\n    \"Metadata\": {},\n    \"SSEKMSKeyId\": \"arn:aws:kms:ap-northeast-1:&lt;accountId&gt;:key/&lt;keyId&gt;\",\n    \"BucketKeyEnabled\": true,\n    \"StorageClass\": \"EXPRESS_ONEZONE\"\n}</code></pre> \n</div> \n<p>I download the encrypted object with <a href=\"https://docs.aws.amazon.com/AmazonS3/latest/API/API_GetObject.html\">GetObject</a>:</p> \n<div> \n <pre><code>aws s3api get-object --bucket s3express-kms--apne1-az4--x-s3 \\\n--key confidential-doc.txt output-confidential-doc.txt</code></pre> \n</div> \n<p>As my session has the necessary permissions, the object is downloaded and decrypted automatically.</p> \n<div> \n <pre><code>{\n    \"AcceptRanges\": \"bytes\",\n    \"LastModified\": \"2024-08-21T15:29:22+00:00\",\n    \"ContentLength\": 5,\n    \"ETag\": \"\\\"664469eeb92c4218bbdcf92ca559d03b\\\"\",\n    \"ContentType\": \"binary/octet-stream\",\n    \"ServerSideEncryption\": \"aws:kms\",\n    \"Metadata\": {},\n    \"SSEKMSKeyId\": \"arn:aws:kms:ap-northeast-1:&lt;accountId&gt;:key/&lt;keyId&gt;\",\n    \"BucketKeyEnabled\": true,\n    \"StorageClass\": \"EXPRESS_ONEZONE\"\n}</code></pre> \n</div> \n<p>For this second test, I use a different IAM user with a policy that is not granted the necessary KMS key permissions to download the object. This attempt fails with an <strong>AccessDenied</strong> error, demonstrating that the SSE-KMS encryption is functioning as intended.</p> \n<div> \n <pre><span><code>An error occurred (AccessDenied) when calling the CreateSession operation: Access Denied</code></span></pre> \n</div> \n<p>This demonstration shows how SSE-KMS works seamlessly with S3 Express One Zone, providing an additional layer of security while maintaining ease of use for authorized users.</p> \n<p><span><strong>Things to know</strong></span><br /> <strong>Getting started</strong> – You can enable SSE-KMS for S3 Express One Zone using the Amazon S3 console, AWS CLI, or <a href=\"https://docs.aws.amazon.com/sdkref/latest/guide/overview.html\">AWS SDKs</a>. Set the default encryption configuration of your S3 directory bucket to SSE-KMS and specify your AWS KMS key. Remember, you can only use one customer managed key per S3 directory bucket for its lifetime.</p> \n<p><strong>Regions </strong>– S3 Express One Zone support for SSE-KMS using customer managed keys is available in all <a href=\"https://docs.aws.amazon.com/AmazonS3/latest/userguide/s3-express-Endpoints.html\">AWS Regions where S3 Express One Zone is currently available</a>.</p> \n<p><strong>Performance</strong> – Using SSE-KMS with S3 Express One Zone does not impact request latency. You’ll continue to experience the same single-digit millisecond data access.</p> \n<p><strong>Pricing</strong> – You pay AWS KMS charges to generate and retrieve data keys used for encryption and decryption. Visit the <a href=\"https://aws.amazon.com/kms/pricing/\">AWS KMS pricing page</a> for more details. In addition, when using SSE-KMS with S3 Express One Zone, S3 Bucket Keys are enabled by default for all data plane operations except for <a href=\"https://docs.aws.amazon.com/AmazonS3/latest/API/API_CopyObject.html\">CopyObject</a> and <a href=\"https://docs.aws.amazon.com/AmazonS3/latest/API/API_UploadPartCopy.html\">UploadPartCopy</a>, and can’t be disabled. This reduces the number of requests to AWS KMS by up to 99%, optimizing both performance and costs.</p> \n<p><strong>AWS CloudTrail integration</strong> – You can audit SSE-KMS actions on S3 Express One Zone objects using <a href=\"https://aws.amazon.com/es/cloudtrail/\">AWS CloudTrail</a>. Learn more about that in <a href=\"https://aws.amazon.com/es/blogs/aws/monitor-data-events-in-amazon-s3-express-one-zone-with-aws-cloudtrail/\">my previous blog post.</a></p> \n<p>– <a href=\"https://www.linkedin.com/in/lizfue/\">Eli.</a></p>","author":"Elizabeth Fuentes","siteTitle":"AWS News Blog","siteHash":"6093e072e4117ec22616e844cb857d03ca62c57a411a8affc77cb5e8b6b15bf6","entryHash":"cbacd589596fd69ae227b22875718751220283534f2420949cc567ef9f08db18","category":"Tech"}