{"title":"RediSearch กับ Geolocation","link":"https://www.somkiat.cc/redisearch-with-geolocation/","date":1683387753000,"content":"<p><img width=\"150\" height=\"150\" src=\"https://www.somkiat.cc/wp-content/uploads/2023/05/redisearch-02-150x150.png\" alt srcset=\"https://www.somkiat.cc/wp-content/uploads/2023/05/redisearch-02-150x150.png 150w, https://www.somkiat.cc/wp-content/uploads/2023/05/redisearch-02-75x75.png 75w\" /></p>\n<figure><img src=\"https://www.somkiat.cc/wp-content/uploads/2023/05/redisearch-02.png\" alt width=\"558\" height=\"259\" /></figure>\n\n\n\n<p>จากงานเดิมใช้งาน <a href=\"https://www.somkiat.cc/use-redisearch/\" target=\"_blank\">RediSearch เกี่ยวการค้นหาข้อมูล (Full text search)</a> ไปแล้ว<br />ต่อมามี use case ต้องทำการค้นหาข้อมูล Geolocation (lat,lng) นั่นเอง<br />โดยมีความต้องการดังนี้</p>\n\n\n\n<ul><li>ยังค้นหาแบบ full text search ในข้อมูลจาก property ต่าง ๆ ได้</li><li>หาข้อมูลที่อยู่ใกล้</li><li>เรียงลำดับจากใกล้ไปไกลได้</li><li>กำหนดจำนวนข้อมูลที่ต้องการ</li></ul>\n\n\n\n<p>มาดูกันว่าทำอย่างไรได้บ้างใน Redis นั่นเอง</p>\n\n\n\n<span></span>\n\n\n\n<p>ขั้นตอนการออกแบบและทดลองใน Redis เป็นดังนี้</p>\n\n\n\n<p><strong>ขั้นตอนที่ 1 ทำการเตรียมข้อมูลที่ต้องการค้นหา</strong></p>\n\n\n\n<p>ประกอบไปด้วย property ต่าง ๆ ที่ต้องการเก็บเพื่อค้นหา และ กรองข้อมูล<br />รวมทั้งข้อมูล location (lat, lng) นั่นเอง<br />แต่ใน Redis + GEO type นั้นเป็น lng, lat นะ ตรงนี้ต้องระวัง</p>\n\n\n\n<p>ในส่วนนี้เก็บข้อมูลในรูปแบบของ HASH ดังนี้</p>\n\n\n\n[gist id=\"b0cc980e9642f57c03d3891c93a30da8\" file=\"1.txt\"]\n\n\n\n<p><strong>ขั้นตอนที่ 2 ทำการสร้าง index เพื่อทำการค้นหา</strong></p>\n\n\n\n[gist id=\"b0cc980e9642f57c03d3891c93a30da8\" file=\"2.txt\"]\n\n\n\n<p><strong>ขั้นตอนที่ 3 ทำการค้นหาผ่าน <a href=\"https://redis.io/commands/ft.search/\" target=\"_blank\">FT.SEARCH</a></strong></p>\n\n\n\n<p>ตรงนี้จะซับซ้อนขึ้นมาหน่อย เนื่องจากต้องการ</p>\n\n\n\n<ul><li>ค้นหา location ที่อยู่ในระยะทางที่ต้องการ</li><li>ทำการเรียงลำดับตามระยะทางได้ด้วย</li></ul>\n\n\n\n[gist id=\"b0cc980e9642f57c03d3891c93a30da8\" file=\"3.txt\"]\n\n\n\n<p>เพียงเท่านี้ก็ใช้งาน RediSearch สำหรับ use case นี้ได้แล้ว</p>\n","author":"somkiat","siteTitle":"cc :: somkiat","siteHash":"3a23a5a4389e1e40c6fbb16520a8cc20df5b3591c25145ce72aaa18b19e48201","entryHash":"48bf23c02a0612c57eb82e28ee477df56c1548447831d27750869e1c824450ef","category":"Thai"}