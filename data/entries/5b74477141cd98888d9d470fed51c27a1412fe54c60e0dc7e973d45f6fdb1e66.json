{"title":"Spring Boot 2.5 :: ลำดับการทำงานของการ initial data ใน Database","link":"https://www.somkiat.cc/spring-boot-initialization-ordering/","date":1631890042000,"content":"<p><img src=\"https://www.somkiat.cc/wp-content/uploads/2021/09/spring-boot-150x150.jpg\" /></p>\n<figure><img src=\"https://www.somkiat.cc/wp-content/uploads/2021/09/spring-boot.jpg\" /></figure>\n\n\n\n<p>จาก <strong><a href=\"https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-2.5-Release-Notes\" target=\"_blank\">Release note ของ Spring Boot 2.5</a></strong> นั้น<br />พบว่ามี feature เกี่ยวกับการจัดการลำดับการทำงาน<br />ของการ initial data ใน Database มาใหม่<br />ซึ่งเปลี่ยนจาก Milestone version ไปเลย<br />จึงทำการสรุปการทำงานและใช้งานไว้นิดหน่อย</p>\n\n\n\n<span></span>\n\n\n\n<p><strong>ขั้นตอนในการ initial data ใน database เป็นดังนี้</strong></p>\n\n\n\n<ul><li>ถ้ามี ไฟล์ schema.sql และ data.sql จะทำงานเป็นอันดับแรก เหมือนกับการทำงานของ DB migration เช่น Flyway และ Liquibase</li><li>ต่อมาจึงทำงานกับพวก ORM เช่น JPA หรือ hibernate</li></ul>\n\n\n\n<p><strong>ดังนั้นในการทำงานนั้น บ่อยครั้งต้องการให้ ORM ทำงานก่อน</strong><br />ยกตัวอย่างเช่นใช้งาน Spring Data JPA<br />เพื่อให้ทำการสร้าง table ต่าง ๆ ขึ้นมาก่อน<br />จากนั้นจึงทำการ initial data ใน table ด้วยไฟล์ data.sql<br />ซึ่งสามารถ config ได้ในไฟล์ application.properties ดังนี้</p>\n\n\n\n[code]spring.jpa.defer-datasource-initialization=true[/code]\n\n\n\n<p><strong>แต่ถ้าไม่ต้องการไม่ให้ทำการ execute ไฟล์ data.sql และ schema.sql แล้ว</strong><br />สามารถปิดการทำงานได้เช่นกัน ดังนี้</p>\n\n\n\n[code]spring.sql.init.mode=never[/code]\n\n\n\n<p><strong>หรือแม้แต่ในการ initial bean ต่าง ๆ ที่ใช้งาน @Bean</strong><br />ต้องการให้ทำงานหลังจากการ initial table แล้วเท่านั้นจริง ๆ<br />ก็เพิ่ม annotation @DependsOnDatabaseInitialization ได้เลย</p>\n\n\n\n<p>จากความสามารถเหล่านี้ น่าจะทำให้ง่ายและสะดวกมากยิ่งขึ้น</p>\n","author":"somkiat","siteTitle":"cc :: somkiat","siteHash":"3a23a5a4389e1e40c6fbb16520a8cc20df5b3591c25145ce72aaa18b19e48201","entryHash":"5b74477141cd98888d9d470fed51c27a1412fe54c60e0dc7e973d45f6fdb1e66","category":"Thai"}