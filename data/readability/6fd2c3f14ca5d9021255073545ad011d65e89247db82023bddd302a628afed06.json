{"title":"JUnit 5 :: ปรับปรุงการทดสอบด้วยการ run แบบ parallel","link":"https://www.somkiat.cc/junit-5-run-in-parallel/","date":1633261446000,"content":"<div id=\"readability-page-1\" class=\"page\"><div id=\"page\"><article><div id=\"content_box\"><header><div><p><time>October 3, 2021</time> <span><a href=\"https://www.somkiat.cc/category/programming/\" rel=\"category tag\">Programming</a></span></p></div></header><div><figure><img src=\"https://www.somkiat.cc/wp-content/uploads/2021/10/JUnit5-1-NoText.jpg\" alt=\"\" srcset=\"https://www.somkiat.cc/wp-content/uploads/2021/10/JUnit5-1-NoText.jpg 1024w, https://www.somkiat.cc/wp-content/uploads/2021/10/JUnit5-1-NoText-300x150.jpg 300w, https://www.somkiat.cc/wp-content/uploads/2021/10/JUnit5-1-NoText-768x384.jpg 768w\" sizes=\"(max-width: 1024px) 100vw, 1024px\"></figure><p>จาก course เกี่ยวกับ TDD with Java<br>มีคำถามเกี่ยวกับการปรับปรุงการทดสอบด้วย JUnit 5 ให้ดีและเร็วขึ้น<br>โดยความสามารถของ JUnit 5 ก็มีไว้ให้ประกอบไปด้วย</p><ul><li><strong><a href=\"https://junit.org/junit5/docs/current/user-guide/#writing-tests-tagging-and-filtering\" target=\"_blank\" rel=\"noreferrer noopener\">Tagging</a></strong> สำหรับแบ่งกลุ่มของ test case</li><li><strong><a href=\"https://junit.org/junit5/docs/current/user-guide/#writing-tests-parallel-execution\" target=\"_blank\" rel=\"noreferrer noopener\">Parellel execution</a></strong> สำหรับทำการ run test case แบบขนาน เนื่องจากกติแล้วจะทำการแบบ sequential</li></ul><p>มาดูตัวอย่างการใช้งานกัน</p><p><strong>ก่อนอื่นถ้า test case มีจำนวนมาก ๆ แล้ว</strong></p><p>จำเป็นต้องจัดกลุ่มของ test case ด้วย Tag ก่อน<br>ช่วยทำให้เราเลือกได้ว่าจะ run กลุ่ม หรือ tag ไหนก่อน<br>หรืออาจจะทดสอบแบบ parallel<br>หรือไปทดสอบแบบ distributed ได้ง่ายอีกด้วย<br>ตัวอย่างของการใช้งาน tag<br>ทั้งในระดับ class และ method</p><div itemprop=\"text\" id=\"gist112158500\" translate=\"no\"><table data-tab-size=\"8\" data-paste-markdown-skip=\"\"><tbody><tr><td id=\"file-firstgrouptest-java-L1\" data-line-number=\"1\"></td><td id=\"file-firstgrouptest-java-LC1\"><span>import</span> <span>org.junit.jupiter.api.Tag</span>;</td></tr><tr><td id=\"file-firstgrouptest-java-L2\" data-line-number=\"2\"></td><td id=\"file-firstgrouptest-java-LC2\"><span>import</span> <span>org.junit.jupiter.api.Test</span>;</td></tr><tr><td id=\"file-firstgrouptest-java-L3\" data-line-number=\"3\"></td><td id=\"file-firstgrouptest-java-LC3\"></td></tr><tr><td id=\"file-firstgrouptest-java-L4\" data-line-number=\"4\"></td><td id=\"file-firstgrouptest-java-LC4\"><span>@Tag</span>(<span><span>\"</span>group1<span>\"</span></span>)</td></tr><tr><td id=\"file-firstgrouptest-java-L5\" data-line-number=\"5\"></td><td id=\"file-firstgrouptest-java-LC5\"><span>public</span> <span>class</span> <span>FirstGroupTest</span> {</td></tr><tr><td id=\"file-firstgrouptest-java-L6\" data-line-number=\"6\"></td><td id=\"file-firstgrouptest-java-LC6\"></td></tr><tr><td id=\"file-firstgrouptest-java-L7\" data-line-number=\"7\"></td><td id=\"file-firstgrouptest-java-LC7\"><span>@Test</span></td></tr><tr><td id=\"file-firstgrouptest-java-L8\" data-line-number=\"8\"></td><td id=\"file-firstgrouptest-java-LC8\"><span>public</span> <span>void</span> <span>case01</span>() {}</td></tr><tr><td id=\"file-firstgrouptest-java-L9\" data-line-number=\"9\"></td><td id=\"file-firstgrouptest-java-LC9\"></td></tr><tr><td id=\"file-firstgrouptest-java-L10\" data-line-number=\"10\"></td><td id=\"file-firstgrouptest-java-LC10\"><span>@Test</span></td></tr><tr><td id=\"file-firstgrouptest-java-L11\" data-line-number=\"11\"></td><td id=\"file-firstgrouptest-java-LC11\"><span>public</span> <span>void</span> <span>case02</span>() {}</td></tr><tr><td id=\"file-firstgrouptest-java-L12\" data-line-number=\"12\"></td><td id=\"file-firstgrouptest-java-LC12\"></td></tr><tr><td id=\"file-firstgrouptest-java-L13\" data-line-number=\"13\"></td><td id=\"file-firstgrouptest-java-LC13\"><span>@Test</span></td></tr><tr><td id=\"file-firstgrouptest-java-L14\" data-line-number=\"14\"></td><td id=\"file-firstgrouptest-java-LC14\"><span>@Tag</span>(<span><span>\"</span>group2<span>\"</span></span>)</td></tr><tr><td id=\"file-firstgrouptest-java-L15\" data-line-number=\"15\"></td><td id=\"file-firstgrouptest-java-LC15\"><span>public</span> <span>void</span> <span>case03</span>() {}</td></tr><tr><td id=\"file-firstgrouptest-java-L16\" data-line-number=\"16\"></td><td id=\"file-firstgrouptest-java-LC16\"></td></tr><tr><td id=\"file-firstgrouptest-java-L17\" data-line-number=\"17\"></td><td id=\"file-firstgrouptest-java-LC17\">}</td></tr></tbody></table></div><p><strong>ทำการ run ดังนี้</strong></p><div id=\"gist112158500\" translate=\"no\"><article itemprop=\"text\"><h2>การ run ผ่าน Apache Maven</h2><pre><code>$mvn test -Dgroups=\"group1\"\nTests run: 3, Failures: 0, Errors: 0, Skipped: 0\n\n$mvn test -DexcludedGroups=\"group2\"\nTests run: 3, Failures: 0, Errors: 0, Skipped: 0\n</code></pre><h2>การ run ผ่าน Gradle</h2><h3>file build.gradle</h3><pre><code>task runGroup1(type: Test) {\n\tuseJUnitPlatform {\n\t\tincludeTags 'group1'\n\t}\n}\n</code></pre><p>ทำการ run</p><pre><code>$gradle test rungroup1\n</code></pre></article></div><p><strong>จากนั้นมาลองใช้งาน Parellel execution ใน JUnit 5</strong></p><p>ซึ่งยังเป็น experiment feature เท่านั้นนะ<br>ปกติจะทำงานแบบ sequential<br>โดยที่เราสามารถเปิด feature นี้<br>ด้วยการ config ในไฟล์ <strong><em>src/test/resources/junit-platform.properties</em></strong><br>กำหนดให้ run แบบ parallel ทั้งหมด หรือ แยกเป็นระดับ class ก็ได้ดังนี้</p><div itemprop=\"text\" id=\"gist112158500\" translate=\"no\"><table data-tab-size=\"8\" data-paste-markdown-skip=\"\"><tbody><tr><td id=\"file-junit-platform-properties-L1\" data-line-number=\"1\"></td><td id=\"file-junit-platform-properties-LC1\"><span>junit.jupiter.execution.parallel.enabled</span> = true</td></tr><tr><td id=\"file-junit-platform-properties-L2\" data-line-number=\"2\"></td><td id=\"file-junit-platform-properties-LC2\"><span>junit.jupiter.execution.parallel.mode.default</span> = concurrent</td></tr><tr><td id=\"file-junit-platform-properties-L3\" data-line-number=\"3\"></td><td id=\"file-junit-platform-properties-LC3\"></td></tr><tr><td id=\"file-junit-platform-properties-L4\" data-line-number=\"4\"></td><td id=\"file-junit-platform-properties-LC4\">หรือหรือในแต่ละ class ให้เป็นแบบ parallel แต่ method เป็นแบบ sequential ใน thread เดียวกัน</td></tr><tr><td id=\"file-junit-platform-properties-L5\" data-line-number=\"5\"></td><td id=\"file-junit-platform-properties-LC5\"></td></tr><tr><td id=\"file-junit-platform-properties-L6\" data-line-number=\"6\"></td><td id=\"file-junit-platform-properties-LC6\"><span>junit.jupiter.execution.parallel.enabled</span> = true</td></tr><tr><td id=\"file-junit-platform-properties-L7\" data-line-number=\"7\"></td><td id=\"file-junit-platform-properties-LC7\"><span>junit.jupiter.execution.parallel.mode.default</span> = same_thread</td></tr><tr><td id=\"file-junit-platform-properties-L8\" data-line-number=\"8\"></td><td id=\"file-junit-platform-properties-LC8\"><span>junit.jupiter.execution.parallel.mode.classes.default</span> = concurrent</td></tr><tr><td id=\"file-junit-platform-properties-L9\" data-line-number=\"9\"></td><td id=\"file-junit-platform-properties-LC9\"></td></tr><tr><td id=\"file-junit-platform-properties-L10\" data-line-number=\"10\"></td><td id=\"file-junit-platform-properties-LC10\">หรือในแต่ละ class ให้เป็นแบบ sequential แต่ method เป็นแบบ parallel</td></tr><tr><td id=\"file-junit-platform-properties-L11\" data-line-number=\"11\"></td><td id=\"file-junit-platform-properties-LC11\"></td></tr><tr><td id=\"file-junit-platform-properties-L12\" data-line-number=\"12\"></td><td id=\"file-junit-platform-properties-LC12\"><span>junit.jupiter.execution.parallel.enabled</span> = true</td></tr><tr><td id=\"file-junit-platform-properties-L13\" data-line-number=\"13\"></td><td id=\"file-junit-platform-properties-LC13\"><span>junit.jupiter.execution.parallel.mode.default</span> = concurrent</td></tr><tr><td id=\"file-junit-platform-properties-L14\" data-line-number=\"14\"></td><td id=\"file-junit-platform-properties-LC14\"><span>junit.jupiter.execution.parallel.mode.classes.default</span> = same_thread</td></tr></tbody></table></div><p>เพียงเท่านี้ก็สามารถปรับปรุงความเร็วของการทดสอบได้แล้ว<br>ยิ่งทำร่วมกับ distributed testing<br>ด้วยการแยกกลุ่มทดสอบไปทดสอบหลาย ๆ เครื่อง<br>ก็ยิ่งช่วยให้การทดสอบเร็วขึ้นไปอีก<br>แต่ก่อนอื่น เขียนก่อน และเขียนให้ดี</p></div><div><p><img alt=\"\" src=\"https://secure.gravatar.com/avatar/e5cb9aad7bf4f0e43462bd51d6ff7021?s=90&amp;d=mm&amp;r=g\" srcset=\"https://secure.gravatar.com/avatar/e5cb9aad7bf4f0e43462bd51d6ff7021?s=180&amp;d=mm&amp;r=g 2x\" height=\"90\" width=\"90\"></p><h4>Article by <a href=\"https://www.facebook.com/somkiatspns\">Somkiat Puisungnoen</a></h4><p>To be Craftmanship</p></div></div></article></div></div>","author":"somkiat","siteTitle":"cc :: somkiat","siteHash":"3a23a5a4389e1e40c6fbb16520a8cc20df5b3591c25145ce72aaa18b19e48201","entryHash":"6fd2c3f14ca5d9021255073545ad011d65e89247db82023bddd302a628afed06","category":"Thai"}