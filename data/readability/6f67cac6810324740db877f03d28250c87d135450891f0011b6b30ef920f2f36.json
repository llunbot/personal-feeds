{"title":"หัดเขียน K6 extension กันหน่อย","link":"https://www.somkiat.cc/develop-k6-extension/","date":1635777543000,"content":"<div id=\"readability-page-1\" class=\"page\"><div id=\"page\"><article><div id=\"content_box\"><header><div><p><time>November 1, 2021</time> <span><a href=\"https://www.somkiat.cc/category/programming/\" rel=\"category tag\">Programming</a>, <a href=\"https://www.somkiat.cc/category/tools/\" rel=\"category tag\">Tools</a></span></p></div></header><div><figure><img src=\"https://www.somkiat.cc/wp-content/uploads/2021/11/how-to-do-performance-testing-using-k6-1024x671.jpg\" alt=\"\" width=\"545\" height=\"357\" srcset=\"https://www.somkiat.cc/wp-content/uploads/2021/11/how-to-do-performance-testing-using-k6-1024x671.jpg 1024w, https://www.somkiat.cc/wp-content/uploads/2021/11/how-to-do-performance-testing-using-k6-300x197.jpg 300w, https://www.somkiat.cc/wp-content/uploads/2021/11/how-to-do-performance-testing-using-k6-768x503.jpg 768w, https://www.somkiat.cc/wp-content/uploads/2021/11/how-to-do-performance-testing-using-k6-1536x1007.jpg 1536w, https://www.somkiat.cc/wp-content/uploads/2021/11/how-to-do-performance-testing-using-k6.jpg 1620w\" sizes=\"(max-width: 545px) 100vw, 545px\"></figure><p>K6 เป็นเครื่องมือสำหรับการทำ performance testing<br>ซึ่งเขียนอธิบายการใช้งานง่าย ๆ ไปที่ <a rel=\"noreferrer noopener\" href=\"https://www.somkiat.cc/load-testing-with-k6/\" target=\"_blank\">Load testing with K6</a><br>โดย K6 นั้นพัฒนาด้วยภาษา Go<br>แต่เขียน script ของการทดสอบด้วยภาษา JavaScript<br>ซึ่งใช้งานผ่าน library ชื่อว่า <a rel=\"noreferrer noopener\" href=\"https://github.com/dop251/goja\" target=\"_blank\">Goja</a> นั่นเอง</p><p><strong>คำถามที่น่าสนใจคือ</strong></p><p>ถ้าต้องการเพิ่มความสามารถต่าง ๆ ของ K6 ขึ้นมาจะต้องทำอย่างไร ?<br></p><p><strong>คำตอบคือ K6 Extension นั่นเอง</strong></p><p>เป็น extension หรือส่วนต่อขยายของ K6<br>โดยมี library ภาษา Go ชื่อว่า <strong><a href=\"https://github.com/grafana/xk6\">xk6</a></strong><br>ช่วยให้นักพัฒนาและ tester เพิ่มในสิ่งที่ไม่มีใน K6 ได้ง่ายขึ้น<br>ดูตัวอย่าง <a rel=\"noreferrer noopener\" href=\"https://k6.io/docs/extensions/\" target=\"_blank\">extension ที่มีใน community</a></p><p><strong>ดังนั้นการทำความเข้าใจมากขึ้น มาลองเขียน extesion แบบง่าย ๆ ดีกว่า</strong></p><p>ซึ่งพัฒนาด้วยภาษา Go<br>ดังนั้นโดยมาทำ Hello World extension กัน<br></p><p><strong>ขั้นตอนที่ 1 ทำการติดตั้ง k6 และ xk6</strong></p><div itemprop=\"text\" id=\"gist112743083\" translate=\"no\"><table data-tab-size=\"8\" data-paste-markdown-skip=\"\"><tbody><tr><td id=\"file-1-txt-L1\" data-line-number=\"1\"></td><td id=\"file-1-txt-LC1\">$go get go.k6.io/xk6/cmd/xk6@v0.4.5</td></tr><tr><td id=\"file-1-txt-L2\" data-line-number=\"2\"></td><td id=\"file-1-txt-LC2\"></td></tr><tr><td id=\"file-1-txt-L3\" data-line-number=\"3\"></td><td id=\"file-1-txt-LC3\">go: downloading go.k6.io/xk6 v0.4.5</td></tr><tr><td id=\"file-1-txt-L4\" data-line-number=\"4\"></td><td id=\"file-1-txt-LC4\">go: found go.k6.io/xk6/cmd/xk6 in go.k6.io/xk6 v0.4.5</td></tr><tr><td id=\"file-1-txt-L5\" data-line-number=\"5\"></td><td id=\"file-1-txt-LC5\">go: downloading github.com/Masterminds/semver/v3 v3.1.0</td></tr></tbody></table></div><p><strong>ขั้นตอนที่ 2 ทำการสร้าง extension ด้วยภาษา Go</strong></p><div itemprop=\"text\" id=\"gist112743083\" translate=\"no\"><table data-tab-size=\"8\" data-paste-markdown-skip=\"\"><tbody><tr><td id=\"file-demo-go-L1\" data-line-number=\"1\"></td><td id=\"file-demo-go-LC1\"><span>package</span> demo</td></tr><tr><td id=\"file-demo-go-L2\" data-line-number=\"2\"></td><td id=\"file-demo-go-LC2\"></td></tr><tr><td id=\"file-demo-go-L3\" data-line-number=\"3\"></td><td id=\"file-demo-go-LC3\"><span>import</span> <span>\"go.k6.io/k6/js/modules\"</span></td></tr><tr><td id=\"file-demo-go-L4\" data-line-number=\"4\"></td><td id=\"file-demo-go-LC4\"></td></tr><tr><td id=\"file-demo-go-L5\" data-line-number=\"5\"></td><td id=\"file-demo-go-LC5\"></td></tr><tr><td id=\"file-demo-go-L6\" data-line-number=\"6\"></td><td id=\"file-demo-go-LC6\"><span>func</span> <span>init</span>() {</td></tr><tr><td id=\"file-demo-go-L7\" data-line-number=\"7\"></td><td id=\"file-demo-go-LC7\"><span>modules</span>.<span>Register</span>(<span>\"k6/x/demo\"</span>, <span>new</span>(<span>Demo</span>))</td></tr><tr><td id=\"file-demo-go-L8\" data-line-number=\"8\"></td><td id=\"file-demo-go-LC8\">}</td></tr><tr><td id=\"file-demo-go-L9\" data-line-number=\"9\"></td><td id=\"file-demo-go-LC9\"></td></tr><tr><td id=\"file-demo-go-L10\" data-line-number=\"10\"></td><td id=\"file-demo-go-LC10\"><span>type</span> <span>Demo</span> <span>struct</span>{}</td></tr><tr><td id=\"file-demo-go-L11\" data-line-number=\"11\"></td><td id=\"file-demo-go-LC11\"></td></tr><tr><td id=\"file-demo-go-L12\" data-line-number=\"12\"></td><td id=\"file-demo-go-LC12\"><span>func</span> (<span>*</span><span>Demo</span>) <span>Hello</span>(<span>name</span> <span>string</span>) <span>string</span> {</td></tr><tr><td id=\"file-demo-go-L13\" data-line-number=\"13\"></td><td id=\"file-demo-go-LC13\"><span>return</span> <span>\"Hello \"</span> <span>+</span> <span>name</span></td></tr><tr><td id=\"file-demo-go-L14\" data-line-number=\"14\"></td><td id=\"file-demo-go-LC14\">}</td></tr></tbody></table></div><p>จากนั้นทำการ build extension ด้วย xk6 ดังนี้</p><div itemprop=\"text\" id=\"gist112743083\" translate=\"no\"><table data-tab-size=\"8\" data-paste-markdown-skip=\"\"><tbody><tr><td id=\"file-2-txt-L1\" data-line-number=\"1\"></td><td id=\"file-2-txt-LC1\">$go mod init demo</td></tr><tr><td id=\"file-2-txt-L2\" data-line-number=\"2\"></td><td id=\"file-2-txt-LC2\">go: creating new go.mod: module demo</td></tr><tr><td id=\"file-2-txt-L3\" data-line-number=\"3\"></td><td id=\"file-2-txt-LC3\"></td></tr><tr><td id=\"file-2-txt-L4\" data-line-number=\"4\"></td><td id=\"file-2-txt-LC4\">$xk6 build --with github.com/up1/xk6-demo=.</td></tr></tbody></table></div><p><strong>ขั้นตอนที่ 3 ทำการเขียน test script ด้วยภาษา JavaScript</strong></p><p>โดยใช้งาน extension ชื่อว่า demo ดังนี้</p><div itemprop=\"text\" id=\"gist112743083\" translate=\"no\"><table data-tab-size=\"8\" data-paste-markdown-skip=\"\"><tbody><tr><td id=\"file-test-js-L1\" data-line-number=\"1\"></td><td id=\"file-test-js-LC1\"><span>import</span> <span>say</span> <span>from</span> <span>'k6/x/demo'</span><span>;</span></td></tr><tr><td id=\"file-test-js-L2\" data-line-number=\"2\"></td><td id=\"file-test-js-LC2\"></td></tr><tr><td id=\"file-test-js-L3\" data-line-number=\"3\"></td><td id=\"file-test-js-LC3\"><span>export</span> <span>default</span> <span>function</span> <span>(</span><span>)</span> <span>{</span></td></tr><tr><td id=\"file-test-js-L4\" data-line-number=\"4\"></td><td id=\"file-test-js-LC4\"><span>console</span><span>.</span><span>log</span><span>(</span><span>say</span><span>.</span><span>hello</span><span>(</span><span>\"World\"</span><span>)</span><span>)</span><span>;</span></td></tr><tr><td id=\"file-test-js-L5\" data-line-number=\"5\"></td><td id=\"file-test-js-LC5\"><span>}</span></td></tr></tbody></table></div><p>จากนั้นทำการ run script ด้วย k6<br>จะได้ผลการทำงานดังนี้</p><p>เพียงเท่านี้ก็สามารถสร้าง extension ของ K6 แบบง่าย ๆ ได้แล้ว</p></div><div><p><img alt=\"\" src=\"https://secure.gravatar.com/avatar/e5cb9aad7bf4f0e43462bd51d6ff7021?s=90&amp;d=mm&amp;r=g\" srcset=\"https://secure.gravatar.com/avatar/e5cb9aad7bf4f0e43462bd51d6ff7021?s=180&amp;d=mm&amp;r=g 2x\" height=\"90\" width=\"90\"></p><h4>Article by <a href=\"https://www.facebook.com/somkiatspns\">Somkiat Puisungnoen</a></h4><p>To be Craftmanship</p></div></div></article></div></div>","author":"somkiat","siteTitle":"cc :: somkiat","siteHash":"3a23a5a4389e1e40c6fbb16520a8cc20df5b3591c25145ce72aaa18b19e48201","entryHash":"6f67cac6810324740db877f03d28250c87d135450891f0011b6b30ef920f2f36","category":"Thai"}