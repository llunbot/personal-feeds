{"title":"Modern Java","link":"https://www.llun.me/posts/dev/2021-12-12-modern-java","date":1639267200000,"content":"<p>หลังจากห่างหายจาก Java ไปประมาณ 8 ปี ช่วงนี้ก็กลับมาใช้อีกครั้งเพราะงานแล้วก็พบว่า\nJava มีของเล่นใหม่เยอะมาก Modern ขึ้น แต่ก็ยังเยิ่นเย้อเหมือนเดิม งานจริงๆ ก็ไม่ได้แตะ\nJava ซะทีเดียวแต่ใช้ Kotlin ซึ่งภาษามันค่อนข้างคล้าย Ruby/Swift มากกว่า แต่ก็ทำให้\nคิดว่า สุดท้ายแล้ว ภาษาพวกนี้จะวิ่งเข้าหากันจนคล้ายกันหมดหรือป่าว</p>\n<p>กลับมาที่ Java จากเมื่อหลายปีก่อน version สุดท้ายที่ใช้คือ Java 6 ซึ่งก็จำไม่ได้แล้วว่า\nตัวภาษามันมีอะไรใหม่บ้างเทียบกับก่อนหน้า แต่ตอนนี้ Java 17 แล้ว เทียบกับ Java 6 ที่เคยเขียนนี่เยอะมาก เริ่มจาก</p>\n<h2>Lambda <a href=\"#lambda\">#</a></h2>\n<p>หลังจากเขียนภาษาอื่นที่สามารถส่งหรือสร้าง anonymous function ได้มานาน กลับมา Java\nก็พบว่ามีสิ่งที่คล้ายกันแล้วเรียกว่า Lambda แต่เนื่องจาก Java ไม่สามารถส่ง function เป็น\nparameter ได้ตรงๆ สิ่งที่เรียกว่า Lambda ใน Java ก็ไม่ค่อยเหมือนในภาษาอื่นนัก เพราะ\nจริงๆ แล้วมันคือ Anonymous class ที่ย่อรูปซะมากกว่า เช่น</p>\n<pre><code>interface CostCalculator {\n    int calculate(int n);\n}\n\nclass CrabSubmarines {\n    private final int[] input;\n\n    public CrabSubmarines(int[] input) {\n        this.input = Arrays.stream(input).sorted().toArray();\n    }\n\n    public int bestMovingCost(CostCalculator calculator) {\n        var min = input[0];\n        var max = input[input.length - 1];\n        var bestCost = Integer.MAX_VALUE;\n        for (int i = min; i &lt; max; i++) {\n            var cost = 0;\n            for (var val : input) {\n                cost = cost + calculator.calculate(Math.abs(val - i));\n            }\n            if (cost &lt; bestCost) bestCost = cost;\n        }\n        return bestCost;\n    }\n}\n</code></pre>\n<p>จาก <code>bestMovingCost</code> ถ้าเป็นภาษาอื่นก็จะรับ function เข้าไปตรงๆ อาจจะบอกหน่อยว่า\nfunction ที่รับเข้าไปมี parameter และ return อะไรบ้าง แต่ไม่จำเป็นต้องประกาศ interface\nแบบนี้เพื่อเอามาใช้เป็น parameter</p>\n<h2>Stream API <a href=\"#stream-api\">#</a></h2>\n<p>สิ่งที่คิดว่าเปลี่ยนเยอะสุด ระดับเดียวกับ Collections คงเป็น Stream API เพราะทำให้ Java\nดู Modern ขึ้น แม้จะไม่เท่ากับภาษาที่เกิดขึ้นมาหลังอย่าง Kotlin แต่ก็ทำให้กลับมาเขียนง่ายขึ้นเยอะ</p>\n<p>Stream API เป็นชุด function ที่ใส่มากับ Collections ทั้งหลายที่ทำให้ใช้ modern list functions ได้\nเช่น map, reduce, range จากแต่ก่อนพวกนี้ต้องเขียนเอง ทำให้การแปลงข้อมูลง่ายขึ้นมาใช้ utility\nพวกนี้ได้เลย ข้อเสียอย่างเดียวคือ เพราะ Java เป็น strong type language เวลาใช้พวกนี้บางทีก็\nปวดหัวว่าจะแปลง type ยังไง โดยเฉพาะ reduce ที่หลายครั้งจะใช้เพื่อแปลงเอาเข้า Map ไม่ใช่แค่\nconcat input หรือ sum</p>\n<pre><code>class Index {\n    public static IntFunction&lt;List&lt;Integer&gt;&gt; windowed(List&lt;Integer&gt; integers, int size) {\n        return (i -&gt; integers.subList(i, i + size));\n    }\n\n    public static Integer count(Integer total, List&lt;Integer&gt; element) {\n        return (element.get(1) &gt; element.get(0)) ? total + 1 : total;\n    }\n\n    public static void main(String[] args) throws IOException {\n        var lines = Files.lines(Paths.get(\"day1/input.txt\")).map(Integer::parseInt).collect(Collectors.toList());\n        System.out.println(IntStream\n                .range(0, lines.size() - 1)\n                .mapToObj(windowed(lines, 2))\n                .reduce(0, Index::count, Integer::sum));\n        var triples = IntStream\n                .range(0, lines.size() - 2)\n                .mapToObj(windowed(lines, 3))\n                .map(triple -&gt; triple.stream().reduce(0, Integer::sum))\n                .collect(Collectors.toList());\n        System.out.println(IntStream.range(0, triples.size() - 1)\n                .mapToObj(windowed(triples, 2))\n                .reduce(0, Index::count, Integer::sum));\n    }\n}\n</code></pre>\n<h2>อื่นๆ <a href=\"#%E0%B8%AD%E0%B8%B7%E0%B9%88%E0%B8%99%E0%B9%86\">#</a></h2>\n<p>อย่างอื่นนอกจาก <a href=\"https://openjdk.java.net/jeps/409\" target=\"_blank\">Sealed class</a> และ <a href=\"https://docs.oracle.com/javase/tutorial/essential/concurrency/forkjoin.html\" target=\"_blank\">Fork/Join</a>\nที่ยังไม่ได้เล่น ก็รู้สึกว่าเปลี่ยนไปพอสมควรเหมือนกัน แต่ไม่ impact เท่าสองอย่างบน ที่ใช้ไปบ้างแล้วก็มี</p>\n<ul>\n<li>foreach syntax <code>for (var value : iterator)</code></li>\n<li>method reference syntax ไว้ใช้กับ Lambda ได้เช่น <code>Index::count</code> ด้านบน</li>\n<li><code>var</code> แทนที่จะต้องประกาศประเภทตัวแปรทุกครั้ง</li>\n<li>Switch case advance ขึ้น match string ได้แล้วแถม return value ได้ด้วย <code>switch (variable) { case A -&gt; val; }</code></li>\n<li>Record class ทำให้เขียน class สั้นลงนิดนึง และ generate setter/getter ให้เลย ส่วนตัวชอบมากกว่า constructor สองระดับใน Kotlin นิดนึง</li>\n<li>Interface ใส่ static method implementation ได้</li>\n</ul>\n<p>จาก features ด้านบน Java มีอะไรมาใหม่เยอะมาก แต่ให้กลับมาใช้เป็นภาษาหลักมั้ยก็คงไม่เพราะชินกับการเขียน\nอะไรสั้นๆ ด้วย JavaScript แบบไม่ต้องใช้ IDE และไม่ต้อง compile ไปแล้ว ยกเว้นว่า Java จะมีวิธีที่ให้เขียน\nได้สั้นและเรียกใช้งานได้เร็วกว่านี้ อีกเรื่องที่ชินใน NodeJS environment ไปแล้วก็คงเป็น dependencies file\nที่ใน node เขียนน้อยกว่า Java เยอะ อีกอย่าง tooling javascript modern และเร็วกว่า​ (เช่น swc) มาก</p>\n","author":"Maythee Anegboonlap","siteTitle":"@llun story","siteHash":"e492a4c5a091b6624e5872d8d003bc73eb1166cc8f88db58c44e1f8dfb9c7252","entryHash":"deb9ec57a34e114057444b061426cf81cb79328d9dbcdb8fc7ee47a325d0f262","category":"Me"}