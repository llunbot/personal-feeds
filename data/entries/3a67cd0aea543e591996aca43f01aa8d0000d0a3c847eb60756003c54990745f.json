{"title":"ลองใช้งาน Atlas สำหรับทำ Database migration","link":"https://www.somkiat.cc/database-migration-with-atlas-go/","date":1690651593000,"content":"<p><img width=\"150\" height=\"150\" src=\"https://www.somkiat.cc/wp-content/uploads/2023/07/declarative-migration-blueprint-2-150x150.png\" alt loading=\"lazy\" srcset=\"https://www.somkiat.cc/wp-content/uploads/2023/07/declarative-migration-blueprint-2-150x150.png 150w, https://www.somkiat.cc/wp-content/uploads/2023/07/declarative-migration-blueprint-2-75x75.png 75w\" /></p>\n<p>เห็นใน feed มีการ share เครื่องมือในการทำ Database migration ชื่อว่า <strong><a href=\"https://atlasgo.io/\" target=\"_blank\">Atlas</a></strong><br />สิ่งที่น่าสนใจคือ มีรูปแบบการทำงาน 2 แบบ คือ</p>\n\n\n\n<ul>\n<li>Declarative</li>\n\n\n\n<li>Versioned หรือ change-based migration</li>\n</ul>\n\n\n\n<span></span>\n\n\n\n<p><strong>ตัวอย่างการทำงานแบบ Declarative แสดงดังรูป</strong></p>\n\n\n\n<p>มีขั้นตอนดังนี้</p>\n\n\n\n<ul>\n<li>Schema loader</li>\n\n\n\n<li>Schema inspection</li>\n\n\n\n<li>Diffing and planning</li>\n</ul>\n\n\n\n<figure><a href=\"https://www.somkiat.cc/wp-content/uploads/2023/07/declarative-migration-blueprint-2.png\"><img src=\"https://www.somkiat.cc/wp-content/uploads/2023/07/declarative-migration-blueprint-2.png\" alt width=\"589\" height=\"313\" /></a></figure>\n\n\n\n<p>โดย Atlas จะทำการตรวจสอบ schema ของ database<br />ระหว่าง schema ในการพัฒนาล่าสุด กับ schema ใน database ปลายทาง<br />จากนั้นจะทำการตรวจสอบการเปลี่ยนแปลงให้<br />และจะทำการ update ให้ตามการเปลี่ยนแปลงนั้น ๆ ให้เอง<br />ซึ่งถือว่าสะดวกมาก ๆ</p>\n\n\n\n<p>โดยรูปแบบของ schema นั้น รองรับทั้ง SQL และ <a href=\"https://atlasgo.io/atlas-schema/hcl\" target=\"_blank\">HCL</a> (HashiCorp Configuration Language)<br />ซึ่ง HCL เป็นการจัดการเชิง declarative<br />ที่มีรูปแบบเดียวกับการจัดการ Infrastructure หรือ IaaS เช่น terraform นั่นเอง<br /><a href=\"https://atlasgo.io/blog/2023/07/19/bridging-the-gap-between-iac-and-schema-management\" target=\"_blank\">ช่วยลด gap ตรงนี้ลงไป</a> น่าสนใจกับแนวคิดมาก ๆ<br />และยัง<a href=\"https://registry.terraform.io/providers/ariga/atlas/latest\" target=\"_blank\">ทำงานร่วมกับ Terraform</a> ได้อีกด้วย</p>\n\n\n\n<figure><a href=\"https://www.somkiat.cc/wp-content/uploads/2023/07/the-gap-compare.png\"><img src=\"https://www.somkiat.cc/wp-content/uploads/2023/07/the-gap-compare.png\" alt width=\"579\" height=\"323\" /></a></figure>\n\n\n\n<p><strong>มาดูตัวอย่างการใช้งานแบบง่าย ๆ</strong></p>\n\n\n\n<p>มีขั้นตอนการใช้งานร่วมกับ docker ได้ดังนี้</p>\n\n\n\n[gist id=\"50aae90bcab0aae261243c616624a506\" file=\"1.txt\"]\n\n\n\n<p>ตัวอย่างของ  HCL ที่ได้จากการ export ออกมาจาก database</p>\n\n\n\n[gist id=\"50aae90bcab0aae261243c616624a506\" file=\"schema.hcl\"]\n\n\n\n<p><strong>จากนั้นทำการ migrate database โดย Atlas จะตรวจสอบการเปลี่ยนแปลงให้</strong></p>\n\n\n\n<p>ในตัวอย่างจะทำการเพิ่ม table ใหม่เข้ามา</p>\n\n\n\n[gist id=\"50aae90bcab0aae261243c616624a506\" file=\"2.txt\"]\n\n\n\n<p>เพียงเท่านี้ก็ใช้งานแบบง่าย ๆ ได้แล้ว<br />ดูง่ายดีนะ</p>\n","author":"somkiat","siteTitle":"cc :: somkiat","siteHash":"3a23a5a4389e1e40c6fbb16520a8cc20df5b3591c25145ce72aaa18b19e48201","entryHash":"3a67cd0aea543e591996aca43f01aa8d0000d0a3c847eb60756003c54990745f","category":"Thai"}