{"title":"Clickhouse โชว์ฐานข้อมูลเร็วแม้ดิสก์ช้า เพราะอ่านเฉพาะส่วนที่ต้องใช้จริงๆ ทำความเร็วสูงขึ้นได้นับพันเท่า","link":"https://www.blognone.com/node/146041","date":1745506590000,"content":"<div><div><div><p>Clickhouse เขียนบล็อกถึงแนวทางการปรับปรุงประสิทธิภาพของตัวฐานข้อมูล บนเครื่องที่ดิสก์ไม่เร็วนัก แต่ด้วยเทคนิคจ่างๆ โดยเฉพาะ lazy materialization ที่โหลดเฉพาะส่วนที่จำเป็น ทำให้ Clickhouse สามารถคิวรีได้เร็วอยู่ดี</p>\n<p>เครื่องตัวอย่างที่ใช้สาธิตคือ <code>m6i.8xlarge</code> บน AWS ที่สตอเรจ SSD จำกัดอยู่ที่ 3,000 IOPS และ 125MiB throughput ใช้ตัวอย่างการคิวฐานข้อมูลรีวิวสินค้า 150 ล้านรายการ กระบวนการคิวรีนี้สามารถคิวรี column เล็กๆ เช่น คะแนนโหวตรีวิวว่ามีประโยชน์ได้อย่างรวดเร็วเพราะปริมาณข้อมูลที่ต้องอ่านขึ้นมามีไม่มากนัก แต่เมื่ออ่านข้อมูลในคอลัมน์ใหญ่ๆ เช่น เนื้อหาการรีวิวก็ช้าลงอย่างมาก (ประมาณ 3 นาที) เพราะเสียเวลาไปกับการอ่านข้อมูลจากดิสก์</p>\n<p>แนวทางแรกของ Clickhouse คือการทำ PREWHERE ด้วยการโหลดเฉพาะคอลัมน์ที่ต้องใช้ในการคิวรีขึ้นมาตรวจเงื่อนไขก่อน คอลัมน์เหล่านี้มักมีขนาดไม่ใหญ่มากทำให้สำรวจได้อย่างรวดเร็ว นอกจากนี้เมื่อแถว (row) ใดตกจากเงื่อนไขแรกๆ ที่ตรวจสอบแล้ว เมื่อตรวจสอบเงื่อนไขคอลัมน์ต่อๆ ไป Clickhouse ก็จะไม่โหลดข้อมูลแถวที่หลุดเงื่อนไขแล้วขึ้นหน่วยความจำอีก ทำให้ประสิทธิภาพรวมดีขึ้น แนวทางนี้ทำให้ Clickhouse ต้องโหลดข้อมูลสุดท้ายเฉพาะแถวที่เข้าเงื่อนไขเท่านั้น</p>\n<p>ฟีเจอร์ lazy materialization ทำงานคล้ายกัน คือหากต้องการข้อมูลบางส่วน เช่น รีวิวที่มีคะแนนโหวตสูงสุด ก็จะโหลดคอลัมน์คะแนนรีวิวขึ้นมาเรียงลำดับก่อน แล้วโหลดคอลัมน์ที่เหลือหลังจากมั่นใจแล้วว่าต้องการใช้ข้อมูลนั้นจริงๆ</p>\n<p>ตัวอย่างการเปิดฟีเจอร์ต่างๆ ทำให้คิวรีตัวอย่างที่ Clickhouse นำมาแสดงใช้เวลาลดลงจาก 220 วินาทีเหลือ 181ms โดยตัวคิวรียังเป็น SQL เดิม</p>\n<p>ที่มา - <a href=\"https://clickhouse.com/blog/clickhouse-gets-lazier-and-faster-introducing-lazy-materialization\">Clickhouse</a></p>\n<p><img alt=\"No Description\" src=\"https://www.blognone.com/sites/default/files/externals/88a1574bf71986574ebae3f511151077.png\" /></p>\n</div></div></div><div><div>Topics: </div><div><div><a href=\"/topics/clickhouse\">ClickHouse</a></div><div><a href=\"/topics/database\">Database</a></div></div></div>","author":"lew","siteTitle":"Blognone","siteHash":"ededadcf18490b3937e7dd89ebe8c00dc129addbdf1ebe4aff1f458146693da0","entryHash":"657760232a82c067f6d2eef96bae0d2a20404845b6d8f8663c2fad5a53be7b17","category":"Thai"}