{"title":"บันทึกเรื่อง Building more efficient Firestore web app","link":"https://www.somkiat.cc/note-from-building-a-more-efficient-firestore/","date":1680326010000,"content":"<p><img width=\"150\" height=\"150\" src=\"https://www.somkiat.cc/wp-content/uploads/2023/04/Firebase-load-data-faster-lower-cost-data-bundles-social-150x150.png\" alt srcset=\"https://www.somkiat.cc/wp-content/uploads/2023/04/Firebase-load-data-faster-lower-cost-data-bundles-social-150x150.png 150w, https://www.somkiat.cc/wp-content/uploads/2023/04/Firebase-load-data-faster-lower-cost-data-bundles-social-75x75.png 75w\" /></p>\n<figure><img src=\"https://www.somkiat.cc/wp-content/uploads/2023/04/Firebase-load-data-faster-lower-cost-data-bundles-social-1024x512.png\" alt /></figure>\n\n\n\n<p>จากงาน <a href=\"https://gdg.community.dev/events/details/google-gdg-bangkok-presents-firebase-dev-day-2023/\" target=\"_blank\">Firebase Dev Day 2023</a> นั้น<br />เข้ามาฟังเรื่อง <strong>Building a more Efficient Firestore Web App</strong> พอ<br />เป็นเรื่องที่น่าสนใจมาก ๆ สำหรับการใช้งาน Firestore ใน web application ของเรา<br />เน้นในเรื่องของการใช้งานให้ถูกต้องตามที่ต้องการ<br />รวมทั้งยังช่วยลดค่าใช้จ่ายลงไปอีกด้วย</p>\n\n\n\n<span></span>\n\n\n\n<p>เนื่องจากระบบงานส่วนใหญ่อัตราการ read จะมากกว่า write มาก ๆ<br />ดังนั้นถ้านำ Firestore มาใช้ในงานที่อ่านเยอะ ๆ<br />ค่าใช้จ่ายก็สูงตาม<br />ดังนั้นเราจำเป็นต้องรู้และเข้าใจวิธีการจัดการ หรือ แก้ไขด้วย<br />มิใช่ ใช้ไปเรื่อย ๆ แล้วก็เปลี่ยน free plan ไปเป็นเสียเงิน<br />แบบที่ยังไม่รู้ปัญหาว่าเพราะว่าอะไร</p>\n\n\n\n<p><strong>ยกตัวอย่างเช่น</strong></p>\n\n\n\n<ul><li><strong><em>เช่น ความแตกต่างของการใช้งาน getDocs() และ onSnapshot() ?</em></strong></li><li>ระบบแสดงผลจ้อมูลที่ไม่ค่อยเปลี่ยนแปลง แล้วมีผู้ใช้งานจำนวนมาก การไปอ่านจาก firestore ทุกครั้งคงไม่ดี</li><li>การนับจำนวนของเอกสาร เช่นการใช้ count() นั้น ก็ทำให้การ read สูงเยอะอีก แนะนำให้ใช้ aggregate query จะดีกว่านะ</li></ul>\n\n\n\n<figure><img src=\"https://www.somkiat.cc/wp-content/uploads/2023/04/snap.jpg\" alt width=\"493\" height=\"303\" /></figure>\n\n\n\n<p><strong>การแก้ไขเรื่องการอ่านมาก ๆ ก่อนหน้านี้อาจจะแก้ไขด้วย</strong><br />การเอา CDN มากั้นไปเลยในฝั่ง frontend</p>\n\n\n\n<figure><img src=\"https://www.somkiat.cc/wp-content/uploads/2023/04/cdn.png\" alt width=\"501\" height=\"227\" /></figure>\n\n\n\n<p><br />ส่วนทาง Firestore ก็แนะนำมา 2 ทางคือ</p>\n\n\n\n<ul><li>การใช้งาน <a href=\"https://firebase.google.com/docs/firestore/bundles\" target=\"_blank\">Firestore data bundle</a></li><li>การใช้งานร่วมกับ Readtime database</li></ul>\n\n\n\n<p><strong>การใช้งาน Firestore data bundle</strong></p>\n\n\n\n<p>จะทำการสร้างข้อมูลที่ใช้งานบ่อย ๆ ขึ้นมา และไม่ค่อยเปลี่ยนแปลง<br />หรือเป็นพวก configuration ต่าง ๆ ที่ต้อง load ตอน startup หน้าจอ<br /><br />มีรูปแบบเป็น binary นั่นหมายถึงเราสามารถไปเก็บใน binary storage ได้<br />ดังนั้นในฝั่งของ client นั้นสามารถนำ bundle ที่สร้างไปใช้งานได้เลย<br />เหมือนกับ caching data นั่นเอง<br />ทำให้ลดการเข้าถึง Firestore ลงไป</p>\n\n\n\n<figure><img src=\"https://www.somkiat.cc/wp-content/uploads/2023/04/firestore.png\" alt width=\"516\" height=\"234\" /></figure>\n\n\n\n<p>แต่ถ้ามีข้อมูลที่เป็น private/sensitive data ก็ไม่ควรเก็บใน bundle นะ !!<br />รวมทั้งข้อมูลที่เปลี่ยนบ่อย ๆ</p>\n\n\n\n<p><strong>แต่ปัญหาที่ตามมาคือ ถ้า Data Bundle มีขนาดใหญ่ละ ?</strong><br />จะจัดการอย่างไร<br />เพราะว่าแน่นอน caching data ฝั่ง client ใหญ่ขึ้น ภาระหนัก !!<br />หรือการเข้าถึง หรือ ค้นหาข้อมูลก็ช้าลงไปอีก</p>\n\n\n\n<p>ดังนั้นจากปัญหาก่อนหน้า ก็ได้ปัญหาใหม่มาอีก<br />ซึ่งแนวทางการแก้ไขก็คือ <strong>Client-Side Indexing</strong><br />มีมาใน Firestore SDK นั่นเอง<br />ปกติทำในฝั่ง server เท่านั้น แต่ก็มีใน client ด้วยเช่นกัน</p>\n\n\n\n<figure><img src=\"https://www.somkiat.cc/wp-content/uploads/2023/04/summary-firestore.jpg\" alt width=\"540\" height=\"348\" /></figure>\n\n\n\n<p><strong><em>ปล. การเลือก tech stack มันมันก็สำคัญ<br />แต่การเข้าใจ tech ที่เลือก และการใช้งานให้ถูกก็สำคัญด้วยเช่นกัน<br />การ scale มันต้องมาพร้อมกับ cost ที่สมเหตุสมผล</em></strong></p>\n\n\n\n<p><strong>Reference Websites</strong></p>\n\n\n\n<ul><li><a href=\"https://firebase.google.com/docs/firestore/best-practices\" target=\"_blank\">Firestore best practice</a></li><li><a href=\"https://dev.to/moga/decrease-read-costs-of-firestore-using-firestore-data-bundles-30e9\" target=\"_blank\">Decrease read costs of firestore using Firestore Data Bundles</a></li></ul>\n","author":"somkiat","siteTitle":"cc :: somkiat","siteHash":"3a23a5a4389e1e40c6fbb16520a8cc20df5b3591c25145ce72aaa18b19e48201","entryHash":"4b20dfc20111b47f8b00d3e3395c8196fabb55c4be2d80fa608c90c713bbddaf","category":"Thai"}