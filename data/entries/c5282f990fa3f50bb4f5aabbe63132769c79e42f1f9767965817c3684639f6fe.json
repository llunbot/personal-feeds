{"title":"0251 | whmcs line notify แจ้งเตือน invoice","link":"https://www.icez.net/blog/167470/whmcs-line-notify-invoice","date":1621322623000,"content":"<p>เอาไปใส่ใน folder includes/hooks/linenotify.php (อย่าลืมเปิด tag php)</p>\n<pre>\n__toString().\")\\n\";\n        }\n        $message .= \"\\nยอดค้างชำระ: \".$vars['mergefields']['invoice_balance']-&gt;__toString().\"\\nกำหนดชำระ: \".$vars['mergefields']['invoice_date_due'].\"\\nhttps://www.thzhost.com/viewinvoice.php?id=\".$vars['mergefields']['invoice_id'];\n        line_notify_message($vars['mergefields']['client_custom_field_linenotifytoken'], $message);\n\n    }\n    elseif ($vars['messagename'] == 'Invoice Payment Reminder')\n    {\n        $message = \"THZHost.com: ยอดชำระคงค้างใกล้ถึงกำหนดชำระ\\n\\n\";\n        foreach ($vars['mergefields']['invoice_items'] as $item) {\n            $message .= strip_tags($item['description']).\" (\".$item['amount']-&gt;__toString().\")\\n\";\n        }\n        $message .= \"\\nยอดค้างชำระ: \".$vars['mergefields']['invoice_balance']-&gt;__toString().\"\\nกำหนดชำระ: \".$vars['mergefields']['invoice_date_due'].\"\\nhttps://www.thzhost.com/viewinvoice.php?id=\".$vars['mergefields']['invoice_id'];\n        line_notify_message($vars['mergefields']['client_custom_field_linenotifytoken'], $message);\n    }\n    elseif ($vars['messagename'] == 'Invoice Payment Confirmation')\n    {\n        $message = \"THZHost.com: ยืนยันการชำระเงิน\\n\\n\";\n        foreach ($vars['mergefields']['invoice_items'] as $item) {\n            $message .= strip_tags($item['description']).\" (\".$item['amount']-&gt;__toString().\")\\n\";\n        }\n        $message .= \"\\nยอดรวม: \".$vars['mergefields']['invoice_total']-&gt;__toString().\"\\nขอบคุณที่ชำระค่าบริการ\";\n        line_notify_message($vars['mergefields']['client_custom_field_linenotifytoken'], $message);\n    }\n});\n\nfunction line_notify_message($line_token, $message)\n{\n    file_put_contents('/tmp/linenotify', print_r($message, true));\n    $line_api = 'https://notify-api.line.me/api/notify';\n\n    $queryData = array('message' =&gt; $message);\n    $queryData = http_build_query($queryData,'','&amp;');\n    $headerOptions = array(\n        'http'=&gt;array(\n            'method'=&gt;'POST',\n            'timeout' =&gt; 5,\n            'header'=&gt; \"Content-Type: application/x-www-form-urlencoded\\r\\n\"\n                .\"Authorization: Bearer \".$line_token.\"\\r\\n\"\n                .\"Content-Length: \".strlen($queryData).\"\\r\\n\",\n            'content' =&gt; $queryData\n        )\n    );\n    $context = stream_context_create($headerOptions);\n    $result = file_get_contents($line_api, FALSE, $context);\n    $res = json_decode($result);\n    return $res;\n}\n</pre>","author":"icez","siteTitle":"icez network","siteHash":"88787adba55f9deb5660f47c4b8baf580eb765815e4a6d536737656e8ab8bde4","entryHash":"c5282f990fa3f50bb4f5aabbe63132769c79e42f1f9767965817c3684639f6fe","category":"Thai"}