{"title":"[PostgreSQL] How to check null in jsonb array","link":"http://visibletrap.blogspot.com/2020/12/postgresql-how-to-check-null-in-jsonb.html","date":1608524520004,"content":"<div> Use <span>jsonb_array_elements</span>  to convert jsonb array to set (queriable similar to normal table) then we can use  <span>where x::text = 'null'</span> to match the null value.</div><div><br />Examples:</div><div><br /><span>=&gt; select x-&gt;'id' as id <br /></span><span>from jsonb_array_elements(<br /></span><span>'[{\"id\": 4, \"val\": [null,1,null]}, <br /></span><span>{\"id\": 2, \"val\": [3]}]'::jsonb<br /></span><span>) as x, <br /></span><span>jsonb_array_elements(x-&gt;'val') as y <br /></span><span>where y::text = 'null';<br /></span><span> id <br /></span><span>----<br /></span><span> 4<br /></span><span> 4<br /></span><span>(2 rows)</span><span><br /></span><span><br /></span><span><br /></span><span>=&gt; select x-&gt;'id' as id<br /></span><span>from jsonb_array_elements(<br /></span><span>'[{\"id\": 4, \"val\": [null,1,null]}, <br /></span><span>{\"id\": 2, \"val\": [3]}]'::jsonb<br /></span><span>) as x, <br /></span><span>jsonb_array_elements(x-&gt;'val') as y <br /></span><span>group by x-&gt;'id' <br /></span><span>having count(x) filter (where y::text  = 'null') &gt; 1;<br /></span><span> id <br /></span><span>----------<br /></span><span> 4<br /></span><span>(1 row)</span></div><div><span><br /></span></div><div><span><br /></span></div><div><span>Adapted from: <a href=\"https://dba.stackexchange.com/a/257799\">https://dba.stackexchange.com/a/257799</a></span></div><p><span></span></p>","author":"Tap","siteTitle":"tAp's blog","siteHash":"ec0b5758aa5280680c8b6839677ce27021dd9d4295725ce4f0e9f298aad77c91","entryHash":"ab0240bb7bd8b8364ababb35eb49c0d742f02d08310bfce5dc18f1a6e025854d","category":"Tech"}