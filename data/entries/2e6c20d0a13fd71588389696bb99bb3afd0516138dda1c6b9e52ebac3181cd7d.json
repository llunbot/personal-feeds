{"title":"Terraform Cloud Operator 2.3 adds workspace run operations","link":"https://www.hashicorp.com/blog/terraform-cloud-operator-2-3-adds-workspace-run-operations","date":1710777600000,"content":"<p>In <a href=\"https://www.hashicorp.com/blog/terraform-cloud-operator-v2-for-kubernetes-is-now-ga\">November 2023</a>, we announced the general availability of the <a href=\"https://github.com/hashicorp/terraform-cloud-operator\">Terraform Cloud Operator for Kubernetes</a>. The Terraform Cloud Operator streamlines infrastructure management, allowing platform teams to offer a Kubernetes-native experience for their users while standardizing on Terraform workflows. Today we are excited to announce the general availability of version 2.3 of the Terraform Cloud Operator, with the ability to initiate workspace runs declaratively.</p>\n\n<h2>Introducing workspace run operations</h2>\n\n<p>In previous versions of the Terraform Cloud Operator v2, the only way to start a run was by patching the <code>restartedAt</code> timestamp in the <code>Module</code> resource. But this approach was not intuitive, did not work for all types of workspaces and workflows, and did not allow users to control the type of run to perform. This challenge hindered migration efforts to the newest version of the Terraform Cloud Operator. . Now with version 2.3, users can declaratively start plan, apply, and refresh runs on workspaces. This enhances self-service by allowing developers to initiate runs on any workspace managed by the Operator, including VCS-driven workspaces.</p>\n\n<p>The <code>Workspace</code> custom resource in version 2.3 of the operator supports three new <a href=\"https://developer.hashicorp.com/terraform/cloud-docs/integrations/kubernetes/annotations-and-labels\">annotations</a> to initiate workspace runs:</p>\n\n<ul>\n<li> <code>workspace.app.terraform.io/run-new</code>: Set this annotation to <code>\"true\"</code> to trigger a new run.</li>\n<li> <code>workspace.app.terraform.io/run-type</code>: Set to <code>plan</code> (default), <code>apply</code>, or <code>refresh</code> to control the type of run.</li>\n<li> <code>workspace.app.terraform.io/run-terraform-version</code>: Specifies the version of Terraform to use for a speculative <code>plan</code> run. For other run types, the workspace version is used.</li>\n</ul>\n\n<p>As an example, a basic <code>Workspace</code> resource looks like this:</p>\n<pre><code>apiVersion: app.terraform.io/v1alpha2\nkind: Workspace\nmetadata:\n  name: this\nspec:\n  organization: kubernetes-operator\n  token:\n    secretKeyRef:\n      name: tfc-operator\n      key: token\n  name: kubernetes-operator</code></pre><p>Using <code>kubectl</code> as shown here, annotate the above resource to immediately start a new apply run:</p>\n<pre><code>kubectl annotate workspace this \\\n    workspace.app.terraform.io/run-new=\"true\" \\\n    workspace.app.terraform.io/run-type=apply --overwrite</code></pre><p>The annotation is reflected in the <code>Workspace</code> resource for observability:</p>\n<pre><code>apiVersion: app.terraform.io/v1alpha2\nkind: Workspace\nmetadata:\n annotations:\n    workspace.app.terraform.io/run-new: \"true\"\n    workspace.app.terraform.io/run-type: apply\n  name: this\nspec:\n  organization: kubernetes-operator\n  token:\n    secretKeyRef:\n      name: tfc-operator\n      key: token\n  name: kubernetes-operator</code></pre><p>After the run is successfully triggered, the operator will set the <code>run-new</code> value back to <code>\"false\"</code>.</p>\n\n<h2>Learn more and get started</h2>\n\n<p>HashiCorp works to continuously improve the Kubernetes ecosystem by enabling platform teams at scale. Learn more about the Terraform Cloud Operator by reading the <a href=\"https://developer.hashicorp.com/terraform/cloud-docs/integrations/kubernetes\">documentation</a> and the <a href=\"https://developer.hashicorp.com/terraform/tutorials/kubernetes/kubernetes-operator-v2\">Deploy infrastructure with the Terraform Cloud Kubernetes Operator v2</a> tutorial. If you are completely new to Terraform, <a href=\"https://app.terraform.io/public/signup/account?utm_campaign=21Q3_WW_TERRAFORMCLOUDSIGNUPS_CLOUD-SERVICES&amp;utm_medium=WEB&amp;utm_offer=TRIAL&amp;utm_source=WEBSITE\">sign up for Terraform Cloud</a> and get started using the Free offering today.</p>\n","author":"Aurora Chun","siteTitle":"HashiCorp Blog","siteHash":"219aa6310b3388f2335eba49871f4df9581f2c58eaeb5e498363b54e835b7001","entryHash":"2e6c20d0a13fd71588389696bb99bb3afd0516138dda1c6b9e52ebac3181cd7d","category":"Tech"}