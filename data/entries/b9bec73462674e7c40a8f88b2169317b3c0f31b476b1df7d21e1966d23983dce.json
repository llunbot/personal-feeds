{"title":"Use your on-premises infrastructure in Amazon EKS clusters with Amazon EKS Hybrid Nodes","link":"https://aws.amazon.com/blogs/aws/use-your-on-premises-infrastructure-in-amazon-eks-clusters-with-amazon-eks-hybrid-nodes/","date":1733085393000,"content":"<p>Today, we’re announcing the general availability of <a href=\"https://aws.amazon.com/eks/hybrid-nodes/?trk=f4bc0305-3e3d-470e-bbb5-02917c6bc4c6&amp;sc_channel=el\">Amazon Elastic Kubernetes Service (Amazon EKS) Hybrid Nodes</a>, a new feature that you can use to attach your on-premises and edge infrastructure as nodes to EKS clusters in the cloud.</p> \n<p>With Amazon EKS Hybrid Nodes, you can unify Kubernetes management across cloud and on-premises environments and take advantage of the scale and availability of Amazon EKS in all the places your applications need to run. You can use your existing on-premises hardware, while oﬄoading the responsibility for managing Kubernetes control planes to EKS and conserving on-premises capacity for your workloads. Using Amazon EKS Hybrid Nodes, you can adopt consistent operational practices and tooling across your cloud and on-premises environments.</p> \n<p>Amazon EKS Hybrid Nodes expands our support for hybrid Kubernetes deployments, adding to <a href=\"https://aws.amazon.com/blogs/aws/deploy-your-amazon-eks-clusters-locally-on-aws-outposts/\">Amazon EKS on AWS Outposts</a> and <a href=\"https://aws.amazon.com/eks/eks-anywhere/\">Amazon EKS Anywhere</a>, which we introduced previously. You can compare how Kubernetes and hardware components are managed with each of the EKS hybrid deployment options.</p> \n<table> \n <tbody> \n  <tr> \n   <td><strong>Component</strong></td> \n   <td><strong>EKS on Outposts</strong></td> \n   <td><strong>EKS Hybrid Nodes</strong></td> \n   <td><strong>EKS Anywhere</strong></td> \n  </tr> \n  <tr> \n   <td><strong>Hardware</strong></td> \n   <td>Managed by AWS</td> \n   <td>Managed by customer</td> \n  </tr> \n  <tr> \n   <td><strong>Kubernetes control plane</strong></td> \n   <td>Hosted and managed by AWS</td> \n   <td>Hosted and managed by customer</td> \n  </tr> \n  <tr> \n   <td><strong>Kubernetes nodes</strong></td> \n   <td>Amazon EC2</td> \n   <td>Customer-managed physical or virtual machines</td> \n  </tr> \n </tbody> \n</table> \n<p>When you use Amazon EKS Hybrid Nodes to attach your on-premises and edge infrastructure to EKS clusters, you can use other Amazon EKS features and integrations, including <a href=\"https://docs.aws.amazon.com/eks/latest/userguide/eks-add-ons.html\">Amazon EKS add-ons</a>, <a href=\"https://docs.aws.amazon.com/eks/latest/userguide/pod-identities.html\">Pod Identities</a>, <a href=\"https://aws.amazon.com/blogs/containers/a-deep-dive-into-simplified-amazon-eks-access-management-controls/\">cluster access entries</a>, <a href=\"https://docs.aws.amazon.com/eks/latest/userguide/cluster-insights.html\">cluster insights</a>, and extended Kubernetes version support. Amazon EKS Hybrid Nodes inherently integrates with AWS services including <a href=\"https://aws.amazon.com/systems-manager/\">AWS Systems Manager</a>, <a href=\"https://docs.aws.amazon.com/rolesanywhere/latest/userguide/introduction.html\">AWS IAM Roles Anywhere</a>, <a href=\"https://aws.amazon.com/prometheus/\">Amazon Managed Service for Prometheus</a>, <a href=\"https://aws.amazon.com/cloudwatch/\">Amazon CloudWatch</a>, and <a href=\"https://aws.amazon.com/guardduty/\">Amazon GuardDuty</a> for centralized monitoring, logging, and identity management.</p> \n<p><strong><u>Get started with Amazon EKS Hybrid Nodes</u></strong><br /> Here are steps to use Amazon EKS Hybrid Nodes. First, create an EKS cluster and specify your on-premises node and pod subnets. After setting up network connectivity and <a href=\"https://aws.amazon.com/iam\">AWS Identity and Access Management (AWS IAM)</a> permissions for your on-premises environment, run the Amazon EKS Hybrid Nodes CLI (<code>nodeadm</code>) on each host that will join the cluster. When hybrid nodes join your cluster, required networking components, such as kube-proxy and CoreDNS, are automatically installed. Before your hybrid nodes become ready to serve applications, you must install a compatible Container Network Interface (CNI) driver. The Cilium and Calico CNI drivers are supported for use with Amazon EKS Hybrid Nodes.</p> \n<p><strong> 1. Prerequisites </strong></p> \n<p>You must have certain prerequisites in place before your on-premises infrastructure can join your EKS cluster as hybrid nodes, including the following:</p> \n<p><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/11/24/2024-eks-hybrid-nodes-1-diagram.png\" width=\"1946\" height=\"942\" /></p> \n<ul> \n <li>Hybrid network connectivity from your on-premises environment to and from AWS using with <a href=\"https://aws.amazon.com/vpn/site-to-site-vpn/\">AWS Site-to-Site VPN</a>, <a href=\"https://aws.amazon.com/directconnect/\">AWS Direct Connect</a>, or another virtual private network (VPN) solution</li> \n <li>A virtual private cloud (VPC) with routes in its routing table for your on-premises node and, optionally, pod networks, with your virtual private gateway (VGW) or transit gateway (TGW) as the target</li> \n <li>Infrastructure in the form of physical or virtual machines</li> \n <li>Operating system that is compatible with hybrid nodes</li> \n <li>Either <a href=\"https://docs.aws.amazon.com/rolesanywhere/latest/userguide/getting-started.html\">AWS IAM Roles Anywhere</a> or <a href=\"https://docs.aws.amazon.com/systems-manager/latest/userguide/systems-manager-managedinstances.html\">AWS Systems Manager</a> set up to authenticate your hybrid nodes with the control plane</li> \n <li>An <a href=\"https://docs.aws.amazon.com/eks/latest/userguide/create-cluster.html\">EKS cluster IAM role</a> and an <a href=\"https://docs.aws.amazon.com/eks/latest/userguide/hybrid-nodes-creds.html\"><u>EKS Hybrid Nodes IAM role</u></a></li> \n</ul> \n<p>You can use Amazon Linux 2023, Ubuntu 20.04, Ubuntu 22.04, Ubuntu 24.04, or Red Hat Enterprise Linux (RHEL) 8 and 9 as the node operating system for your hybrid nodes. AWS supports the hybrid nodes integration with these operating systems but doesn’t provide support for the operating systems themselves. You’re responsible for operating system provisioning and management.</p> \n<p>To learn more, visit <a href=\"https://docs.aws.amazon.com/eks/latest/userguide/hybrid-nodes-prereqs.html\">Prerequisites for EKS Hybrid Nodes</a> in the Amazon EKS User Guide.</p> \n<p><strong> 2. Create EKS cluster and enable hybrid nodes</strong></p> \n<p>Go to the <a href=\"https://console.aws.amazon.com/eks/home#/cluster-create\">Amazon EKS console</a> and start to create your EKS cluster. In the <strong>Step 2 Specify networking</strong> screen, turn on <strong>Specify the CIDR blocks for your on-premises environments that you will use for hybrid nodes</strong> in the <strong>Configure remote networks to enable hybrid nodes</strong> option.</p> \n<p><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/11/24/2024-eks-hybrid-nodes-2-configure.png\" width=\"2614\" height=\"2782\" /></p> \n<p>The Classless Inter-Domain Routing (CIDRs) of remote nodes and pods need to be RFC-1918 IPv4 IPv4 addresses, and they can’t overlap with the VPC CIDR or the EKS cluster Kubernetes service CIDR. Additionally, the remote node CIDR and the remote pod CIDR can’t overlap. Specifying a pod CIDR block is required if you will run webhooks on your nodes or if your CNI doesn’t use NAT for pod addresses as pod traffic leaves your nodes.</p> \n<p>You can also create an EKS cluster using <a href=\"https://aws.amazon.com/cli\">AWS Comand Line Interface (AWS CLI)</a>, <a href=\"https://eksctl.io/\">eksctl</a>, and <a href=\"https://aws.amazon.com/cloudformation/\">AWS CloudFormation</a>. To enable your cluster for Amazon EKS Hybrid Nodes, use the <code>remote-network-config</code> flag to specify your remote node and, optionally, your remote pod CIDR blocks.</p> \n<pre><code>$ aws eks create-cluster --name channy-hybrid-cluster --region=us-east-1 \\\n    --role-arn arn:aws:iam::012345678910:role/eks-cluster-role \\\n    --resources-vpc-config subnetIds=subnet-1234a11a,subnet-5678b11b \\\n    --remote-network-config \\\n{\"remoteNodeNetworks\":[{\"cidrs\":[\"10.80.0.0/16\"]}],\"remotePodNetworks\":[{\"cidrs\":[\"10.85.0.0/16\"]}]}}</code></pre> \n<p>Your cluster must be configured with <code>API</code> or <code>API_AND_CONFIG_MAP</code> cluster access authentication modes. Create an Amazon EKS access entry for your EKS Hybrid Nodes IAM role to enable nodes to join the cluster.</p> \n<pre><code>$ aws eks create-access-entry \\\n  --cluster-name my-hybrid-cluster \\\n  --principal-arn arn:aws:iam::012345678910:role/eksHybridNodesRole \\ \n  --type HYBRID_LINUX</code></pre> \n<p>Amazon EKS Hybrid Nodes use temporary IAM credentials provisioned by AWS Systems Manager hybrid activations or AWS IAM Roles Anywhere to authenticate with the EKS cluster. Before connecting your on-premises nodes, you must either create an AWS Systems Manager hybrid activation or add certificates and keys to your nodes for use with AWS IAM Roles Anywhere. To learn more, visit <a href=\"https://docs.aws.amazon.com/eks/latest/userguide/hybrid-nodes-creds.html\">Prepare credentials for EKS Hybrid Nodes</a> in the Amazon EKS User Guide.</p> \n<p><strong> 3. Connect your hybrid nodes to the EKS cluster</strong></p> \n<p>You’re now ready to connect Amazon EKS Hybrid Nodes to your EKS cluster. You can use the Amazon EKS Hybrid Nodes CLI (<code>nodeadm</code>) to simplify the installation, configuration, and registration of your hosts as hybrid nodes. <code>nodeadm</code> automatically installs the required AWS Systems Manager or IAM Roles Anywhere components when you run the <code>nodeadm</code> install command.</p> \n<p>You can run the <code>nodeadm</code> install process on each running host, or you can run <code>nodeadm</code> install as part of your operating system build pipelines to produce an image with the components needed to join your host to an EKS cluster.</p> \n<pre><code>$ nodeadm install 1.31 --credential-provider &lt;ssm, iam-ra&gt;\n{\"level\":\"info\",\"ts\":...,\"caller\":\"...\",\"msg\":\"Loading configuration\",\"configSource\":\"file://nodeConfig.yaml\"}\n{\"level\":\"info\",\"ts\":...,\"caller\":\"...\",\"msg\":\"Validating configuration\"}\n{\"level\":\"info\",\"ts\":...,\"caller\":\"...\",\"msg\":\"Validating Kubernetes version\",\"kubernetes version\":\"1.30\"}\n{\"level\":\"info\",\"ts\":...,\"caller\":\"...\",\"msg\":\"Using Kubernetes version\",\"kubernetes version\":\"1.30.0\"}\n{\"level\":\"info\",\"ts\":...,\"caller\":\"...\",\"msg\":\"Installing SSM agent installer...\"}\n{\"level\":\"info\",\"ts\":...,\"caller\":\"...\",\"msg\":\"Installing kubelet...\"}\n{\"level\":\"info\",\"ts\":...,\"caller\":\"...\",\"msg\":\"Installing kubectl...\"}\n{\"level\":\"info\",\"ts\":...,\"caller\":\"...\",\"msg\":\"Installing cni-plugins...\"}\n{\"level\":\"info\",\"ts\":...,\"caller\":\"...\",\"msg\":\"Installing image credential provider...\"}\n{\"level\":\"info\",\"ts\":...,\"caller\":\"...\",\"msg\":\"Installing IAM authenticator...\"}\n{\"level\":\"info\",\"ts\":...,\"caller\":\"...\",\"msg\":\"Finishing up install...\"}</code></pre> \n<p>Create a <code>nodeConfig.yaml</code> file on each host that contains the information required to connect to your EKS cluster. Here is an example <code>nodeConfig.yaml</code> that uses AWS Systems Manager hybrid activations.</p> \n<pre><code>apiVersion: node.eks.aws/v1alpha1\nkind: NodeConfig\nmetadata:\n  name: hybrid-node\nspec:\n  cluster:\n    name: my-cluster\n    region: us-east-1\n  hybrid:\n    roleArn: arn:aws:iam:012345678910:role/eksHybridNodesRole\n    ssm:\n      activationCode: &lt;activation-code&gt;\n      activationId: &lt;activation-id&gt;</code></pre> \n<p>Now, run <code>nodeadm</code> on each host.</p> \n<pre><code>$ nodeadm init -c file:/// nodeConfig.yaml</code></pre> \n<p>If the preceding command is completed successfully, your hybrid node has joined your EKS cluster. You can verify this in the Amazon EKS console or with the <code>kubectl get nodes</code> command. Before your hybrid nodes have status as <code>Ready</code>, you must install a compatible CNI. To learn more, visit <a href=\"https://docs.aws.amazon.com/eks/latest/userguide/hybrid-nodes-cni.html\">Install CNI for EKS Hybrid Nodes</a> in the Amazon EKS User Guide.</p> \n<p><strong>4. View and manage connected your hybrid nodes in EKS console</strong></p> \n<p>Now that the nodes are ready, you can view your hybrid nodes and the resources running on them in the EKS console.</p> \n<p><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/11/24/2024-eks-hybrid-nodes-3-node-1.jpg\" width=\"2066\" height=\"2330\" /></p> \n<p>You’re responsible for managing your hybrid nodes and updating the software they run. You can update to the latest version of the Amazon EKS Hybrid Nodes CLI to pull in the latest fixes and updates and upgrade Kubernetes versions. To learn more, visit <a href=\"https://docs.aws.amazon.com/eks/latest/userguide/hybrid-nodes-upgrade.html\">Upgrade EKS Hybrid Nodes</a> in the Amazon EKS User Guide.</p> \n<p><strong><u>Now available</u></strong><br /> <a href=\"https://aws.amazon.com/eks/hybrid-nodes/?trk=f4bc0305-3e3d-470e-bbb5-02917c6bc4c6&amp;sc_channel=el\">Amazon EKS Hybrid Nodes</a> is now available in all AWS Regions except the AWS GovCloud (US) Regions and the China Regions.</p> \n<p>There are no upfront commitments or minimum fees, and you pay for the hourly usage of your EKS cluster and EKS Hybrid Nodes as you use them. EKS clusters with your hybrid nodes have the same per cluster per hour cost as EKS clusters with nodes running in AWS Cloud for both standard and extended support. Additionally, EKS clusters with your hybrid nodes incur an hourly fee per hybrid node vCPU. To learn more, visit the <a href=\"https://aws.amazon.com/eks/pricing\">Amazon EKS pricing page</a>.</p> \n<p>Give EKS Hybrid Nodes a try in the <a href=\"https://console.aws.amazon.com/eks/home#/cluster-create\">Amazon EKS console</a>. To learn more, visit the <a href=\"https://docs.aws.amazon.com/eks/latest/userguide/hybrid-nodes-overview.html\">EKS Hybrid Nodes documentation</a> and send feedback to <a href=\"https://repost.aws/tags/TA4IvCeWI1TE66q4jEj4Z9zg/amazon-elastic-kubernetes-service\">AWS re:Post for EKS</a> or through your usual AWS Support contacts.</p> \n<p>— <a href=\"https://twitter.com/channyun\">Channy</a></p>","author":"Channy Yun (윤석찬)","siteTitle":"AWS News Blog","siteHash":"6093e072e4117ec22616e844cb857d03ca62c57a411a8affc77cb5e8b6b15bf6","entryHash":"b9bec73462674e7c40a8f88b2169317b3c0f31b476b1df7d21e1966d23983dce","category":"Tech"}