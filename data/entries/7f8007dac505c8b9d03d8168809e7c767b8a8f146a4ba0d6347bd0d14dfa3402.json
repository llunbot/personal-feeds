{"title":"Unify DNS management using Amazon Route 53 Profiles with multiple VPCs and AWS accounts","link":"https://aws.amazon.com/blogs/aws/unify-dns-management-using-amazon-route-53-profiles-with-multiple-vpcs-and-aws-accounts/","date":1713820122000,"content":"<p>If you are managing lots of accounts and <a href=\"https://aws.amazon.com/vpc/\">Amazon Virtual Private Cloud (Amazon VPC)</a> resources, sharing and then associating many DNS resources to each VPC can present a significant burden. You often hit limits around sharing and association, and you may have gone as far as building your own orchestration layers to propagate DNS configuration across your accounts and VPCs.</p> \n<p>Today, I’m happy to announce <a href=\"https://aws.amazon.com/route53/\">Amazon Route 53</a> Profiles, which provide the ability to unify management of DNS across all of your organization’s accounts and VPCs. Route 53 Profiles let you define a standard DNS configuration, including Route 53 private hosted zone (PHZ) associations, Resolver forwarding rules, and Route 53 Resolver DNS Firewall rule groups, and apply that configuration to multiple VPCs in the same AWS Region. With Profiles, you have an easy way to ensure all of your VPCs have the same DNS configuration without the complexity of handling separate Route 53 resources. Managing DNS across many VPCs is now as simple as managing those same settings for a single VPC.</p> \n<p>Profiles are natively integrated with <a href=\"https://aws.amazon.com/ram/\">AWS Resource Access Manager (RAM)</a> allowing you to share your Profiles across accounts or with your <a href=\"https://aws.amazon.com/organizations/\">AWS Organizations</a> account. Profiles integrates seamlessly with Route 53 private hosted zones by allowing you to create and add existing private hosted zones to your Profile so that your organizations have access to these same settings when the Profile is shared across accounts. <a href=\"https://aws.amazon.com/cloudformation/\">AWS CloudFormation</a> allows you to use Profiles to set DNS settings consistently for VPCs as accounts are newly provisioned. With today’s release, you can better govern DNS settings for your multi-account environments.</p> \n<p><strong><u>How Route 53 Profiles works</u></strong><br /> To start using the Route 53 Profiles, I go to the <a href=\"https://console.aws.amazon.com\">AWS Management Console</a> for Route 53, where I can create Profiles, add resources to them, and associate them to their VPCs. Then, I share the Profile I created across another account using AWS RAM.</p> \n<p>In the navigation pane in the Route 53 console, I choose <strong>Profiles</strong> and then I choose <strong>Create profile</strong> to set up my Profile.</p> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/03/21/AWSNEWS-1937-Figure1.png\"><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/03/21/AWSNEWS-1937-Figure1.png\" width=\"2638\" height=\"1266\" /></a></p> \n<p>I give my Profile configuration a friendly name such as <code>MyFirstRoute53Profile</code> and optionally add tags.</p> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/03/21/AWSNEWS-1937-Figure2.png\"><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/03/21/AWSNEWS-1937-Figure2.png\" width=\"2174\" height=\"1668\" /></a></p> \n<p>I can configure settings for DNS Firewall rule groups, private hosted zones and Resolver rules or add existing ones within my account all within the Profile console page.</p> \n<p>I choose <strong>VPCs</strong> to associate my VPCs to the Profile. I can add tags as well as do configurations for recursive DNSSEC validation, the failure mode for the DNS Firewalls associated to my VPCs. I can also control the order of DNS evaluation: First VPC DNS then Profile DNS, or first Profile DNS then VPC DNS.</p> \n<p>I can associate one Profile per VPC and can associate up to 5,000 VPCs to a single Profile.</p> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/04/22/AWSNEWS-1937-Figure3v2.png\"><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/04/22/AWSNEWS-1937-Figure3v2.png\" width=\"2426\" height=\"1424\" /></a></p> \n<p>Profiles gives me the ability to manage settings for VPCs across accounts in my organization. I am able to disable reverse DNS rules for each of the VPCs the Profile is associated with rather than configuring these on a per-VPC basis. The Route 53 Resolver automatically creates rules for reverse DNS lookups for me so that different services can easily resolve hostnames from IP addresses. If I use <a href=\"https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/resolver-dns-firewall.html\">DNS Firewall</a>, I am able to select the failure mode for my firewall via settings, to fail open or fail closed. I am also able to specify if I wish for the VPCs associated to the Profile to have recursive DNSSEC validation enabled without having to use DNSSEC signing in Route 53 (or any other provider).</p> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/04/22/AWSNEWS-1937-Figure4v2.png\"><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/04/22/AWSNEWS-1937-Figure4v2.png\" width=\"2438\" height=\"1314\" /></a></p> \n<p>Let’s say I associate a Profile to a VPC. What happens when a query exactly matches both a resolver rule or PHZ associated directly to the VPC and a resolver rule or PHZ associated to the VPC’s Profile? Which DNS settings take precedence, the Profile’s or the local VPC’s? For example, if the VPC is associated to a PHZ for <strong>example.com</strong> and the Profile contains a PHZ for <strong>example.com</strong>, that VPC’s local DNS settings will take precedence over the Profile. When a query is made for a name for a conflicting domain name (for example, the Profile contains a PHZ for <strong>infra.example.com</strong> and the VPC is associated to a PHZ that has the name <strong>account1.infra.example.com</strong>), the most specific name wins.</p> \n<p><strong><u>Sharing Route 53 Profiles across accounts using AWS RAM</u></strong><br /> I use <a href=\"https://aws.amazon.com/ram/\">AWS Resource Access Manager (RAM)</a> to share the Profile I created in the previous section with my other account.</p> \n<p>I choose the <strong>Share profile</strong> option in the Profiles detail page or I can go to the AWS RAM console page and choose <strong>Create resource share</strong>.</p> \n<p>I provide a name for my resource share and then I search for the ‘Route 53 Profiles’ in the <strong>Resources</strong> section. I select the Profile in <strong>Selected resources</strong>. I can choose to add tags. Then, I choose <strong>Next</strong>.</p> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/04/22/AWSNEWS-1937-Figure5v2.png\"><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/04/22/AWSNEWS-1937-Figure5v2.png\" width=\"2822\" height=\"2106\" /></a></p> \n<p>Profiles utilize RAM managed permissions, which allow me to attach different permissions to each resource type. By default, only the owner (the network admin) of the Profile will be able to modify the resources within the Profile. Recipients of the Profile (the VPC owners) will only be able to view the contents of the Profile (the ReadOnly mode). To allow a recipient of the Profile to add PHZs or other resources to it, the Profile’s owner will have to attach the necessary permissions to the resource. Recipients will not be able to edit or delete any resources added by the Profile owner to the shared resource.</p> \n<p>I leave the default selections and choose <strong>Next</strong> to grant access to my other account.</p> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/04/22/AWSNEWS-1937-Figure6v2.png\"><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/04/22/AWSNEWS-1937-Figure6v2.png\" width=\"2850\" height=\"1692\" /></a></p> \n<p>On the next page, I choose <strong>Allow sharing with anyone,</strong> enter my other account’s ID and then choose <strong>Add</strong>. After that, I choose that account ID in the <strong>Selected principals</strong> section and choose <strong>Next</strong>.</p> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/04/22/AWSNEWS-1937-Figure7v3.png\"><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/04/22/AWSNEWS-1937-Figure7v3.png\" width=\"2834\" height=\"1812\" /></a></p> \n<p>In the <strong>Review and create</strong> page, I choose <strong>Create resource share</strong>. Resource share is successfully created.</p> \n<p>Now, I switch to my other account that I share my Profile with and go to the RAM console. In the navigation menu, I go to the <strong>Resource shares</strong> and choose the resource name I created in the first account. I choose <strong>Accept resource share</strong> to accept the invitation.</p> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/04/22/AWSNEWS-1937-Figure8v2.png\"><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/04/22/AWSNEWS-1937-Figure8v2.png\" width=\"2940\" height=\"1060\" /></a></p> \n<p>That’s it! Now, I go to my Route 53 Profiles page and I choose the Profile shared with me.</p> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/03/21/AWSNEWS-1937-Figure9.png\"><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/03/21/AWSNEWS-1937-Figure9.png\" width=\"2334\" height=\"594\" /></a></p> \n<p>I have access to the shared Profile’s DNS Firewall rule groups, private hosted zones, and Resolver rules. I can associate this account’s VPCs to this Profile. I am not able to edit or delete any resources. Profiles are Regional resources and cannot be shared across Regions.</p> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/04/22/AWSNEWS-1937-Figure10v2.png\"><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/04/22/AWSNEWS-1937-Figure10v2.png\" width=\"2428\" height=\"1292\" /></a></p> \n<p><strong><u>Available now</u></strong><br /> You can easily get started with Route 53 Profiles using the <a href=\"https://console.aws.amazon.com\">AWS Management Console</a>, <a href=\"https://docs.aws.amazon.com/Route53/latest/APIReference/Welcome.html\">Route 53 API</a>, <a href=\"https://aws.amazon.com/cli/\">AWS Command Line Interface (AWS CLI)</a>, <a href=\"https://aws.amazon.com/cloudformation/\">AWS CloudFormation</a>, and <a href=\"https://aws.amazon.com/tools/\">AWS SDKs</a>.</p> \n<p>Route 53 Profiles will be available in all AWS Regions, except in Canada West (Calgary), the AWS GovCloud (US) Regions and the Amazon Web Services China Regions.</p> \n<p>For more details about the pricing, visit the <a href=\"https://aws.amazon.com/route53/pricing/\">Route 53 pricing</a> page.</p> \n<p>Get started with <a href=\"https://aws.amazon.com/route53/\">Profiles</a> today and please let us know your feedback either through your usual AWS Support contacts or the <a href=\"https://repost.aws/tags/TAceSYwryvTxuK8Uw1UKOTVA/amazon-route-53\">AWS re:Post</a> for Amazon Route 53.</p> \n<a href=\"https://www.linkedin.com/in/esrakayabali/\">— Esra</a> \n<p><em>23-Apr-2024: Screenshots were updated.</em></p>","author":"Esra Kayabali","siteTitle":"AWS News Blog","siteHash":"6093e072e4117ec22616e844cb857d03ca62c57a411a8affc77cb5e8b6b15bf6","entryHash":"7f8007dac505c8b9d03d8168809e7c767b8a8f146a4ba0d6347bd0d14dfa3402","category":"Tech"}