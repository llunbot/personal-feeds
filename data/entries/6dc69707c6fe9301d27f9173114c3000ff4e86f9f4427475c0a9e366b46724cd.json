{"title":"Elastic รายงานช่องโหว่ log4j กระทบ Elasticsearch, Logstash พร้อมคำแนะนำบรรเทาช่องโหว่ระหว่างรอแพทซ์","link":"https://www.blognone.com/node/126276","date":1639310914000,"content":"<div><div><div><p>ช่องโหว่ zero-day ของ log4j <a href=\"https://www.blognone.com/node/126257\">ที่ปล่อยออกมาล่าสุดนั้น</a>ได้เริ่ม<a href=\"https://www.blognone.com/node/126261\">ส่งผลกระทบเป็นวงกว้าง</a>เนื่องจากเป็นไลบรารีที่ได้รับความนิยมในภาษา Java และเป็นช่องโหว่ร้ายแรงทำให้ผู้พัฒนาโครงการหลายอย่างที่ใช้ Java ต้องวางแผนในการออกอัพเกรดซอฟต์แวร์เพื่อแก้ปัญหานี้ให้เร็วที่สุด</p>\n<p>ล่าสุด Elastic ผู้พัฒนาซอฟต์แวร์ Elastic Stack ที่นิยมใช้ในงานมอนิเตอร์ได้ออกประกาศรายละเอียดผลกระทบของผลิตภัณฑ์แล้ว พร้อมคำแนะนำในการบรรเทาช่องโหว่ระหว่างรอแพทซ์ โดยหลังจากตรวจสอบแล้วพบว่าผลิตภัณฑ์ที่ได้รับผลกระทบคือ Elasticsearch, Logstash และ APM Java Agent มีรายละเอียดดังนี้</p>\n<p>ตัว <strong>Elasticsearch</strong> ในรายงานระบุว่ากระทบตั้งแต่เวอร์ชัน 5.0.0 ขึ้นไป แต่เนื่องจาก Elastic ใช้ระบบ Java Security Manager อยู่แล้ว ทำให้โอกาสในการรันโค้ดผ่านช่องโหว่นี้ไม่ง่าย ถือเป็นการบรรเทาความร้ายแรงของช่องโหว่นี้ไปในตัว แต่เพื่อป้องกันปัญหา Elastic จึงแนะนำให้ใส่ JVM Options <code>-Dlog4j2.formatMsgNoLookups=true</code> ไว้ก่อนระหว่างรออัพเดต ซึ่ง Elastic ระบุว่าจะออก Elasticsearch เวอร์ชัน 6.8.21 และ 7.16.1 เพื่อแก้ปัญหาเร็ว ๆ นี้</p>\n<p>ส่วน <strong>Logstash</strong> ถ้าใช้เวอร์ชัน 6.8.x และ 7.x หรือใหม่กว่า เมื่อคอนฟิกให้ใช้ JDK ที่ต่ำกว่า 8u191 และ 11.0.1 จะมีความเสี่ยงสูงเพราะเปิดให้โหลด class ของ Java จากระยะไกลได้ แต่ Logstash ที่ใช้ JDK เวอร์ชันใหม่ จะลดความเสี่ยงตรงจุดนี้ได้ (แต่ก็ยังมีความเสี่ยงอยู่หากโดน DoS) ส่วนวิธีแก้ปัญหา เนื่องจาก JVM Options <code>-Dlog4j2.formatMsgNoLookups=true</code> ใช้ไม่ได้ (เพราะ Logstash เซ็ทอัพ log4j ให้ไม่อ่าน flag) จึงต้องลบคลาส JndiLookup ออกจาก log4j2 core jar แทน โดยใช้คอมมานด์</p>\n<p><code>zip -q -d /logstash-core/lib/jars/log4j-core-2.* org/apache/logging/log4j/core/lookup/JndiLookup.class</code></p>\n<p>ฝั่ง <strong>APM Java Agent</strong> กระทบตั้งแต่เวอร์ชัน 1.17.0-1.28.0 และออกอัพเดตเวอร์ชัน 1.28.1 เพื่อแก้ปัญหาแล้ว โดย Elastic แนะนำให้ผู้ใช้อัพเกรดไปเป็นเวอร์ชันถัดไป แต่ถ้ายังไม่สามารถอัพเกรดได้ แนะนำให้ผู้ใช้บรรเทาด้วยการใส่ <code>-Dlog4j2.formatMsgNoLookups=true</code> ไปก่อนได้ ซึ่งช่องโหว่นี้จะกระทบเฉพาะเมื่อกำหนด <code>log_level=trace</code> และใช้ฟอร์แมตเป็น PLAIN_TEXT เท่านั้น</p>\n<p>รายละเอียดเกี่ยวกับผลิตภัณฑ์อื่น ๆ</p>\n<ul>\n<li>Elastic Cloud, Elastic Cloud Enterprise และ Swiftype จากการตรวจสอบเบื้องต้นยังไม่ได้รับผลกระทบ แต่จะอัพเดต log4j เป็นเวอร์ชันใหม่ให้เร็วที่สุด</li>\n<li>Elastic Cloud on Kubernetes ไม่ได้รับผลกระทบโดยตรง แต่ตัว Elasticsearch ที่อยู่ภายใต้การจัดการของ ECK ควรเซ็ทค่าเพื่อบรรเทาผลกระทบตามที่ระบุไว้ข้างต้น</li>\n<li>APM Server, Beats, Cmd, Elastic Endgame, Elastic Map Service, Endpoint Security, Enterprise Search, Kibana และ Machine Learning ไม่ได้รับผลกระทบ</li>\n</ul>\n<p>ส่วนอัพเดตเพิ่มเติม Elastic ระบุว่าแนะนำให้ติดตามได้ผ่านช่องทาง <a href=\"https://discuss.elastic.co/c/announcements/security-announcements/31\">Security Announcement</a></p>\n<p>ที่มา - <a href=\"https://discuss.elastic.co/t/apache-log4j2-remote-code-execution-rce-vulnerability-cve-2021-44228-esa-2021-31/291476\">Elastic</a></p>\n<p><img src=\"https://www.blognone.com/sites/default/files/externals/66f2e952c283d4f61439bda5d9a05958.png\" /><br />\nภาพจาก <a href=\"https://www.elastic.co/blog/whats-new-elastic-7-16-0\">Elastic</a></p>\n</div></div></div><div><div>Topics: </div><div><div><a href=\"/topics/elastic\">Elastic</a></div><div><a href=\"/topics/elasticsearch\">Elasticsearch</a></div></div></div>","author":"nutmos","siteTitle":"Blognone","siteHash":"ededadcf18490b3937e7dd89ebe8c00dc129addbdf1ebe4aff1f458146693da0","entryHash":"6dc69707c6fe9301d27f9173114c3000ff4e86f9f4427475c0a9e366b46724cd","category":"Thai"}