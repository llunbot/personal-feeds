{"title":"ทำความรู้จักกับ YARP: Yet Another Reverse Proxy","link":"https://www.somkiat.cc/hello-yarp-yet-another-reverse-proxy/","date":1711875093000,"content":"<p><img width=\"150\" height=\"150\" src=\"https://www.somkiat.cc/wp-content/uploads/2024/03/yarp-01-150x150.png\" loading=\"lazy\" srcset=\"https://www.somkiat.cc/wp-content/uploads/2024/03/yarp-01-150x150.png 150w, https://www.somkiat.cc/wp-content/uploads/2024/03/yarp-01-75x75.png 75w\" /></p>\n<figure><a href=\"https://www.somkiat.cc/wp-content/uploads/2024/03/yarp-01.png\"><img src=\"https://www.somkiat.cc/wp-content/uploads/2024/03/yarp-01-1024x546.png\" width=\"614\" height=\"326\" /></a></figure>\n\n\n\n<p>เห็นทาง Microsoft แนะนำ <strong><a href=\"https://microsoft.github.io/reverse-proxy/\" target=\"_blank\">YARP</a></strong> มา สำหรับจัดการ API ต่าง ๆ<br />โดยที่ดูมานั้น เป้าหมายเพื่อสร้าง internal tool ที่ใช้งานภายในองค์กร<br />เนื่องจากพบว่าหลาย ๆ ทีมมักจะทำงานเดียวกันซ้ำ ๆ<br />จึงสร้าง YARP ขึ้นมาซึ่งเป็น proxy นั่นเอง<br />ดังนั้นมาดูกันว่าเป็นอย่างไรบ้าง</p>\n\n\n\n<span></span>\n\n\n\n<p><strong>โดยที่ YARP นั้นสนับสนุน protocol ต่าง ๆ ดังนี้</strong></p>\n\n\n\n<ul>\n<li>HTTP/ 1.1</li>\n\n\n\n<li>HTTP/ 2 สำหรับ gRPC</li>\n\n\n\n<li>HTTP 3</li>\n\n\n\n<li>WebSocket</li>\n</ul>\n\n\n\n<p>สามารถ custom หรือ เพิ่มความสามารถต่าง ๆ <br />เข้าไปได้ด้วยการเขียน code ด้วย C#<br />และใช้งานได้กับ .NET 6 ขึ้นไป<br />มาเป็น dependnency ที่เพิ่มเข้า .NET project ได้เลย</p>\n\n\n\n<p><strong>Reverse proxy</strong> นั้นทำหน้าที่ forward request จาก client<br />ไปยัง server ที่เหมาะสม ตามที่กำหนดเอาไว้<br />ช่วยทำการซ่อน implementation หรือ server ไว้จาก client นั่นเอง<br />ความสามารถพื้นฐานของ reverse proxy ประกอบไปด้วย</p>\n\n\n\n<ul>\n<li>Load balancing</li>\n\n\n\n<li>Caching</li>\n\n\n\n<li>Security</li>\n\n\n\n<li>SSL termination</li>\n</ul>\n\n\n\n<p>แสดงดังรูป</p>\n\n\n\n<figure><a href=\"https://www.somkiat.cc/wp-content/uploads/2024/03/reverse_proxy-01.png\"><img src=\"https://www.somkiat.cc/wp-content/uploads/2024/03/reverse_proxy-01-1024x591.png\" width=\"688\" height=\"396\" /></a></figure>\n\n\n\n<p><strong>ทำการติดตั้ง dependency หรือ <a href=\"https://www.nuget.org/packages/Yarp.ReverseProxy/\" target=\"_blank\">package</a> ได้เลย</strong></p>\n\n\n\n[code]\n$dotnet add package Yarp.ReverseProxy --version 2.1.0\n[/code]\n\n\n\n<p>จากนั้นเขียน code เล็กน้อยสำหรับ reverse proxy</p>\n\n\n\n[gist id=\"00de7da8cf124931da75d9607acb7f53\" file=\"1.cs\"]\n\n\n\n<p>สามารถทำการ config พวก route, transform ในไฟล์ appsettings.json ได้เลยดังนี้</p>\n\n\n\n[gist id=\"00de7da8cf124931da75d9607acb7f53\" file=\"appsettings.json\"]\n\n\n\n<p>เราสามารถเพิ่มความสามารถต่าง ๆ เข้าไปได้อีก<br />หรือใช้สิ่งที่มีให้ใช้งานได้เลย เช่น</p>\n\n\n\n<ul>\n<li>Request/response transformation</li>\n\n\n\n<li><a href=\"https://github.com/microsoft/reverse-proxy/blob/release/1.1/docs/docfx/articles/distributed-tracing.md\" target=\"_blank\">Distributed tracing + OpenTelemetry</a></li>\n\n\n\n<li>Authentication</li>\n\n\n\n<li>Rate limit</li>\n</ul>\n\n\n\n<p>ลองใช้งานกันดูครับ</p>\n\n\n\n<p><strong>Reference Websites</strong></p>\n\n\n\n<ul>\n<li><a href=\"https://www.milanjovanovic.tech/blog/implementing-an-api-gateway-for-microservices-with-yarp\" target=\"_blank\">Implementing an API Gateway For Microservices With YARP</a></li>\n\n\n\n<li><a href=\"https://medium.com/codenx/yarp-net-core-reverse-proxy-9b20ceb76995\" target=\"_blank\">YARP - .NET Core Reverse Proxy</a></li>\n</ul>\n","author":"somkiat","siteTitle":"cc :: somkiat","siteHash":"3a23a5a4389e1e40c6fbb16520a8cc20df5b3591c25145ce72aaa18b19e48201","entryHash":"552b5432936995fbcff96a3444dedc5df89333d8cbb9786c4d119ac0b03838c9","category":"Thai"}