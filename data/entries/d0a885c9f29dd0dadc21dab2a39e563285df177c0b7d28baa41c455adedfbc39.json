{"title":"เป็นล้านคะแนนนับวิเดียวเสร็จ Cloudflare โอเพนซอร์ส pingora-limits ไลบรารีนับคะแนนประสิทธิภาพสูง","link":"https://www.blognone.com/node/133834","date":1684129223000,"content":"<div><div><div><p>Cloudflare ปล่อยโค้ด pingora-limits ตัวนับอีเวนต์ (event) ใน<a href=\"https://www.blognone.com/node/130408\">พรอกซี่ Pingora</a> ที่ Cloudflare พัฒนาชึ้นมาใช้งานแทน NGINX โดยตัวเซิร์ฟเวอร์ต้องนับสถิติต่างๆ โดยยังต้องมีประสิทธิภาพสูง ไม่ทำให้บริการโดยรวมช้าลง</p>\n<p>Pingora ต้องนับสถิติจากอีเวนต์ต่างๆ ถึง 20 ล้านครั้งต่อวินาที เช่น มีเหตุเซิร์ฟเวอร์ไม่ตอบสนอง เกินจำนวนครั้งที่กำหนดก็ต้องตัดเซิร์ฟเวอร์ตัวนั้นออก โดยตัวนับนี้มีเงื่อนไขว่าต้องรองรับการทำงานแบบขนานอย่างหนัก และขณะที่กำลังเพิ่มค่าที่นับไม่ต้องล็อกหน่วยความจำไปทั้งหมด ไม่เช่นนั้นจะกลายเป็นคอขวดของระบบ</p>\n<p>ทาง Cloudflare ใช้โครงสร้างข้อมูล count–min sketch ที่ประสิทธิภาพการนับเป็น O(1) ขณะที่ประสิทธิภาพในแง่ขนาดหน่วยความจำเป็น O(log(n)) โดยกระบวนการนับคะแนนไม่ล็อกหน่วยความจำและแฮชค่ากุญแจของอีเวนต์ทีละหลายๆ รูปแบบ แม้จะมีบางรูปแบบที่แฮชชนกับอีเวนต์อื่นๆ บ้างก็ไม่ต้องสนใจ และเมื่อต้องการดูคะแนนสุดท้ายก็จะดูค่าที่น้อยที่สุดของกุญแจอีเวนต์นั้น</p>\n<p>ผลการใช้งานจริงพบว่า pingora-limits ใช้หน่อยความจำน้อยมาก แต่ได้ประสิทธิภาพสูง <a href=\"https://github.com/cloudflare/pingora\">ตัวโค้ดส่วนนี้เปิดอยู่ใน GitHub</a></p>\n<p>ที่มา - <a href=\"https://blog.cloudflare.com/how-pingora-keeps-count/\">Cloudflare</a></p>\n<p><img src=\"https://blog.cloudflare.com/content/images/2023/05/image2-4.png\" alt /></p>\n</div></div></div><div><div>Topics: </div><div><div><a href=\"/topics/cloudflare\">Cloudflare</a></div><div><a href=\"/topics/algorithm\">Algorithm</a></div></div></div>","author":"lew","siteTitle":"Blognone","siteHash":"ededadcf18490b3937e7dd89ebe8c00dc129addbdf1ebe4aff1f458146693da0","entryHash":"d0a885c9f29dd0dadc21dab2a39e563285df177c0b7d28baa41c455adedfbc39","category":"Thai"}