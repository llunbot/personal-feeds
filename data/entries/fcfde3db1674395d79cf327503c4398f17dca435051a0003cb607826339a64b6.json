{"title":"HCP Packer improves usage visibility with audit logs","link":"https://www.hashicorp.com/blog/hcp-packer-improves-usage-visibility-with-audit-logs","date":1690488000000,"content":"<p>HCP Packer, a powerful tool for tracking, governing, and managing image artifacts across multi-cloud environments, has just added audit logs. This enhancement provides a way for organizations to document and monitor user activity across HCP Packer and gain visibility into the activity occurring in the registry. Audit logs are now generally available for all Plus-tier artifact registries.</p>\n\n<p>Understanding resource lifecycles is crucial to successfully implement secure multi-cloud infrastructure. According to the <a href=\"https://www.hashicorp.com/state-of-the-cloud\">2023 HashiCorp State of the Cloud Strategy Survey</a>, security ranks as the #1 factor in determining the success of an organization’s multi-cloud strategy. But without granular data and effective monitoring capabilities, it can be difficult to uncover security and compliance risks or identify if a breach has occurred. A lack of historical user activity data can also prevent organizations from uncovering insights regarding workflow inefficiencies and wasteful cloud spend.</p>\n\n<h2>Introducing audit logs</h2>\n\n<p>Organizations can now gain complete visibility into their HCP Packer activity by relying on the audit log capabilities of the HashiCorp Cloud Platform (HCP). This offers insight into the lifecycles of their image iterations, buckets, and channels. This new functionality provides users with a description, metadata, and streaming capabilities for critical user activity information.</p>\n\n<h3>Audit log descriptions and metadata</h3>\n\n<p>HCP Packer’s audit logs consist of a description (string) and metadata field (JSON object/hashmap). All HCP Packer audit logs contain common metadata, which relays information such as audit log status, type of operation being performed, organization and project ID, timestamp, and who initiated the operation.</p>\n\n<p>In addition to the common fields, audit logs also send messages on specific operations taking place in HCP Packer such as:</p>\n\n<ul>\n<li><strong>Buckets:</strong> Image bucket creation, deletion, updates, and labeling</li>\n<li><strong>Iterations:</strong> Image iteration creation, completion, revocation, deletion, and restoration</li>\n<li><strong>Builds:</strong> Build creation and updates</li>\n<li><strong>Channels:</strong> Channel creation, updates, deletion, and iteration assignments</li>\n</ul>\n\n<p>For a full list of all audit log types, their descriptions, and metadata, please refer to the <a href=\"https://developer.hashicorp.com/hcp/docs/packer/audit-logs/messages-and-metadata\">HCP Packer documentation</a>.</p>\n\n<p>Below is an example of the metadata received when a user updates an image build:</p>\n<pre><code>{  \"action\":\"update\",\n   \"actor\":{\n      \"principal_id\":\"test-auditlogs-911479@77f447d4-def0-46f2-bf09-6850d36745ed\",\n      \"service\":{\n         \"id\":\"test-auditlogs-911479@77f447d4-def0-46f2-bf09-6850d36745ed\",\n         \"name\":\"test-auditlogs\",\n         \"user_managed\":true\n      },\n      \"type\":\"TYPE_SERVICE\"\n   },\n   \"bucket\":{\n      \"id\":\"01GXXGSNEE1EMJEZ0TEH7KCQVX\",\n      \"slug\":\"bucket-test\"\n   },\n   \"build\":{\n      \"cloud_provider\":\"aws\",\n      \"component_type\":\"aws\",\n      \"id\":\"01H5APPBYYF4D0NMVZCRKR85E7\",\n      \"images\":[\n         {\n            \"image_id\":\"ami-f2\",\n            \"region\":\"us-west-2\"\n         }\n      ],\n      \"labels\":{\n         \"os\":\"ubuntu\"\n      },\n      \"status\":\"DONE\"\n   },\n   \"description\":\"Updated build\",\n   \"iteration\":{\n      \"fingerprint\":\"f14\",\n      \"id\":\"01H5APNAK1BNEVMK3HPS7KZANV\",\n      \"version\":\"v5\"\n   },\n   \"organization_id\":\"77f447d4-def0-46f2-bf09-6850d36745ed\",\n   \"project_id\":\"a98c3c31-5760-4db1-b62b-0988080a66ad\",\n   \"registry\":{\n      \"id\":\"01GNZQS84K3PTGVVB2YY9R81BC\"\n   },\n   \"status\":\"OK\",\n   \"timestamp\":\"2023-07-14T17:21:09Z\" }</code></pre><h3>Audit log streaming</h3>\n\n<p>HCP Packer’s audit logs allow for near real-time streaming of audit events using industry-standard monitoring solutions such as Amazon CloudWatch or Datadog. Forwarding audit logs into these services allow organizations to observe higher-level correlations across all services and activities based on user or resource. Simply select the appropriate provider, enter the configuration details, and begin monitoring the full request and response objects for every interaction with the resource. </p>\n\n<h4>Amazon CloudWatch</h4>\n<img src=\"https://www.datocms-assets.com/2885/1690488319-hcpp-audit-cloudwatch-config.png\" alt=\"Enabling\" /><p>The log group and log streams are dynamically created and can be found in the Amazon CloudWatch console with the prefix “/hashicorp”. This lets you clearly see audit logs coming from HashiCorp separately from other log inputs you may have in CloudWatch.</p>\n<img src=\"https://www.datocms-assets.com/2885/1690488349-hcpp-audit-cloudwatch.png\" alt=\"HCP\" /><h4>Datadog</h4>\n<img src=\"https://www.datocms-assets.com/2885/1690488386-hcpp-audit-datadog-config.png\" alt=\"HCP\" /><p>Logs arrive within your Datadog environment a few minutes after Packer usage. Refer to the <a href=\"https://docs.datadoghq.com/getting_started/logs/#explore-your-logs\">Datadog documentation</a> for details on log exploration.</p>\n<img src=\"https://www.datocms-assets.com/2885/1690488512-hcpp-audit-datadog.png\" alt=\"HCP\" /><h2>Key benefits of audit logs</h2>\n\n<p>Collecting activity data with HCP Packer’s audit logs helps organizations improve their:</p>\n\n<p><strong>Visibility:</strong> by enabling administrators to actively monitor a stream of user activity and answer important questions such as who is changing what? When? And where?</p>\n\n<p><strong>Security:</strong> by providing access to a historical audit trail that enables security teams to ensure compliance standards are met in accordance with regulatory requirements</p>\n\n<h2>Summary and resources</h2>\n\n<p>For more information on audit logs for HCP Packer, please refer to the documentation:</p>\n\n<ul>\n<li><a href=\"https://developer.hashicorp.com/hcp/docs/packer/audit-logs/messages-and-metadata\">Audit log descriptions and metadata</a></li>\n<li><a href=\"https://developer.hashicorp.com/hcp/docs/packer/audit-logs/streaming\">Audit log streaming</a></li>\n</ul>\n\n<p><a href=\"https://www.hashicorp.com/products/packer\">Get started with HCP Packer for free</a> to track and manage artifacts across all your cloud environments.</p>\n","author":"Mitchell Ross","siteTitle":"HashiCorp Blog","siteHash":"219aa6310b3388f2335eba49871f4df9581f2c58eaeb5e498363b54e835b7001","entryHash":"fcfde3db1674395d79cf327503c4398f17dca435051a0003cb607826339a64b6","category":"Tech"}