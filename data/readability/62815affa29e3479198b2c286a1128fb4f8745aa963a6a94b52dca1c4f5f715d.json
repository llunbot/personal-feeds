{"title":"Dart :: การจัดการ exception ที่น่าสนใจ","link":"https://www.somkiat.cc/dart-with-exception-handling/","date":1627576913000,"content":"<div id=\"readability-page-1\" class=\"page\"><div id=\"page\"><article><div id=\"content_box\"><header><div><p><time>July 29, 2021</time> <span><a href=\"https://www.somkiat.cc/category/programming/\" rel=\"category tag\">Programming</a></span></p></div></header><div><figure><img src=\"https://www.somkiat.cc/wp-content/uploads/2021/07/dart-logo-for-shares-1024x575.png\" alt=\"\" width=\"566\" height=\"317\" srcset=\"https://www.somkiat.cc/wp-content/uploads/2021/07/dart-logo-for-shares-1024x575.png 1024w, https://www.somkiat.cc/wp-content/uploads/2021/07/dart-logo-for-shares-300x168.png 300w, https://www.somkiat.cc/wp-content/uploads/2021/07/dart-logo-for-shares-768x431.png 768w, https://www.somkiat.cc/wp-content/uploads/2021/07/dart-logo-for-shares-1536x862.png 1536w, https://www.somkiat.cc/wp-content/uploads/2021/07/dart-logo-for-shares-2048x1150.png 2048w\" sizes=\"(max-width: 566px) 100vw, 566px\"></figure><p>วันนี้ทำการแก้ไข code ที่พัฒนาด้วยภาษา Dart<br>ก็ไปเจอรูปแบบการจัดการ exception/error หลายรูปแบบ<br>ที่ทำงานกับ async function<br>จึงลองทำการสรุปไว้นิดหน่อย</p><p><strong>พื้นฐานเล็กน้อยสำหรับ Dart</strong></p><div><p>โดยที่ Dart จะแยก Error กับ Exception ออกจากกัน</p><p><strong>Error</strong> นั้นจะใช้สำหรับปัญหาในระดับ system เช่น memory error เป็นต้น<br>แน่นอนว่าเราไม่สามารถคาดเดาได้เลย</p><p>ส่วน <strong>Exception</strong> นั้นใช้สำหรับระดับ application<br>เพิ่มเติมคือ รายละเอียดของปัญหาต่าง ๆ มาด้วย<br>ซึ่งทำให้สามารถดักจับได้ง่าย<br>รวมทั้งแก้ไขได้ง่ายขึ้น<br>แน่นอนว่าเรารู้ว่า น่าจะมีปัญหาอะไรเกิดขึ้นมาบ้าง</p><p>โดยการใช้งานทั้งคู่ ควรที่จะสร้าง custom error/exception ขึ้นมาใช้<br>จะดีกว่าการใช้งานตรง ๆ ไปเลย</p></div><p><strong>รูปแบบที่น่าสนใจประกอบไปด้วย</strong></p><ul><li>try-catch-finally ปกติ + async-await</li><li>catchError()</li><li>onError ในการเรียกพวก async generator</li><li>ใช้งาน <strong><a rel=\"noreferrer noopener\" href=\"https://api.flutter.dev/flutter/dart-async/Zone-class.html\" target=\"_blank\">Zone class </a></strong>มาช่วย</li></ul><p>มาดูตัวอย่าง code ในแต่ละรูปแบบกัน</p><p><strong>แบบที่ 1 try-catch-finally ปกติ + async-await</strong></p><div itemprop=\"text\" id=\"gist110985665\" translate=\"no\"><table data-tab-size=\"8\" data-paste-markdown-skip=\"\"><tbody><tr><td id=\"file-1-dart-L1\" data-line-number=\"1\"></td><td id=\"file-1-dart-LC1\"><span>void</span> <span>main</span>() <span>async</span> {</td></tr><tr><td id=\"file-1-dart-L2\" data-line-number=\"2\"></td><td id=\"file-1-dart-LC2\"><span>try</span> {</td></tr><tr><td id=\"file-1-dart-L3\" data-line-number=\"3\"></td><td id=\"file-1-dart-LC3\"><span>await</span> <span>doSth</span>();</td></tr><tr><td id=\"file-1-dart-L4\" data-line-number=\"4\"></td><td id=\"file-1-dart-LC4\">} <span>catch</span> (e) {</td></tr><tr><td id=\"file-1-dart-L5\" data-line-number=\"5\"></td><td id=\"file-1-dart-LC5\"><span>print</span>(e.<span>toString</span>());</td></tr><tr><td id=\"file-1-dart-L6\" data-line-number=\"6\"></td><td id=\"file-1-dart-LC6\">}</td></tr><tr><td id=\"file-1-dart-L7\" data-line-number=\"7\"></td><td id=\"file-1-dart-LC7\">}</td></tr><tr><td id=\"file-1-dart-L8\" data-line-number=\"8\"></td><td id=\"file-1-dart-LC8\"></td></tr><tr><td id=\"file-1-dart-L9\" data-line-number=\"9\"></td><td id=\"file-1-dart-LC9\"><span>Future</span><span>&lt;</span><span>void</span><span>&gt;</span> <span>doSth</span>() <span>async</span> {</td></tr><tr><td id=\"file-1-dart-L10\" data-line-number=\"10\"></td><td id=\"file-1-dart-LC10\"><span>await</span> <span>Future</span>.<span>delayed</span>(<span>Duration</span>(seconds<span>:</span> <span>1</span>), () {</td></tr><tr><td id=\"file-1-dart-L11\" data-line-number=\"11\"></td><td id=\"file-1-dart-LC11\"><span>throw</span> <span>Exception</span>(<span>'Exception from doSth'</span>);</td></tr><tr><td id=\"file-1-dart-L12\" data-line-number=\"12\"></td><td id=\"file-1-dart-LC12\">});</td></tr><tr><td id=\"file-1-dart-L13\" data-line-number=\"13\"></td><td id=\"file-1-dart-LC13\">}</td></tr></tbody></table></div><p><strong>แบบที่ 2 catchError()</strong></p><div itemprop=\"text\" id=\"gist110985665\" translate=\"no\"><table data-tab-size=\"8\" data-paste-markdown-skip=\"\"><tbody><tr><td id=\"file-2-dart-L1\" data-line-number=\"1\"></td><td id=\"file-2-dart-LC1\"><span>void</span> <span>main</span>() {</td></tr><tr><td id=\"file-2-dart-L2\" data-line-number=\"2\"></td><td id=\"file-2-dart-LC2\"><span>doSth</span>().<span>catchError</span>((e) {</td></tr><tr><td id=\"file-2-dart-L3\" data-line-number=\"3\"></td><td id=\"file-2-dart-LC3\"><span>print</span>(e.<span>toString</span>());</td></tr><tr><td id=\"file-2-dart-L4\" data-line-number=\"4\"></td><td id=\"file-2-dart-LC4\">});</td></tr><tr><td id=\"file-2-dart-L5\" data-line-number=\"5\"></td><td id=\"file-2-dart-LC5\">}</td></tr></tbody></table></div><p><strong>แบบที่ 3 onError ในการเรียกพวก async generator</strong></p><div itemprop=\"text\" id=\"gist110985665\" translate=\"no\"><table data-tab-size=\"8\" data-paste-markdown-skip=\"\"><tbody><tr><td id=\"file-3-dart-L1\" data-line-number=\"1\"></td><td id=\"file-3-dart-LC1\"><span>void</span> <span>main</span>() {</td></tr><tr><td id=\"file-3-dart-L2\" data-line-number=\"2\"></td><td id=\"file-3-dart-LC2\"><span>doSth</span>().<span>onError</span>((e, _) {</td></tr><tr><td id=\"file-3-dart-L3\" data-line-number=\"3\"></td><td id=\"file-3-dart-LC3\"><span>print</span>(e.<span>toString</span>());</td></tr><tr><td id=\"file-3-dart-L4\" data-line-number=\"4\"></td><td id=\"file-3-dart-LC4\">});</td></tr><tr><td id=\"file-3-dart-L5\" data-line-number=\"5\"></td><td id=\"file-3-dart-LC5\">}</td></tr></tbody></table></div><p><strong>แบบที่ 4 ใช้งาน Zone class มาช่วย</strong></p><div itemprop=\"text\" id=\"gist110985665\" translate=\"no\"><table data-tab-size=\"8\" data-paste-markdown-skip=\"\"><tbody><tr><td id=\"file-4-dart-L1\" data-line-number=\"1\"></td><td id=\"file-4-dart-LC1\"><span>import</span> <span>'dart:async'</span>;</td></tr><tr><td id=\"file-4-dart-L2\" data-line-number=\"2\"></td><td id=\"file-4-dart-LC2\"></td></tr><tr><td id=\"file-4-dart-L3\" data-line-number=\"3\"></td><td id=\"file-4-dart-LC3\"><span>void</span> <span>main</span>() {</td></tr><tr><td id=\"file-4-dart-L4\" data-line-number=\"4\"></td><td id=\"file-4-dart-LC4\"><span>runZonedGuarded</span>(() {</td></tr><tr><td id=\"file-4-dart-L5\" data-line-number=\"5\"></td><td id=\"file-4-dart-LC5\"><span>doSth</span>();</td></tr><tr><td id=\"file-4-dart-L6\" data-line-number=\"6\"></td><td id=\"file-4-dart-LC6\">}, (e, s) {</td></tr><tr><td id=\"file-4-dart-L7\" data-line-number=\"7\"></td><td id=\"file-4-dart-LC7\"><span>print</span>(e.<span>toString</span>());</td></tr><tr><td id=\"file-4-dart-L8\" data-line-number=\"8\"></td><td id=\"file-4-dart-LC8\">});</td></tr><tr><td id=\"file-4-dart-L9\" data-line-number=\"9\"></td><td id=\"file-4-dart-LC9\">}</td></tr></tbody></table></div><p><strong><em>ปล. Exception ทุกอย่างของ Dart นั้นจะเป็น unchecked exception ทั้งหมด</em></strong></p><p>ดูเพิ่มเติมได้ที่</p><ul><li><a href=\"https://dart.dev/guides/libraries/futures-error-handling\" target=\"_blank\" rel=\"noreferrer noopener\">Future and Error handling</a></li><li><a href=\"https://dart.dev/guides/language/language-tour#exceptions\" target=\"_blank\" rel=\"noreferrer noopener\">Dart tour :: Exceptions</a></li></ul></div><div><p><img alt=\"\" src=\"https://secure.gravatar.com/avatar/e5cb9aad7bf4f0e43462bd51d6ff7021?s=90&amp;d=mm&amp;r=g\" srcset=\"https://secure.gravatar.com/avatar/e5cb9aad7bf4f0e43462bd51d6ff7021?s=180&amp;d=mm&amp;r=g 2x\" height=\"90\" width=\"90\"></p><h4>Article by <a href=\"https://www.facebook.com/somkiatspns\">Somkiat Puisungnoen</a></h4><p>To be Craftmanship</p></div></div></article></div></div>","author":"somkiat","siteTitle":"cc :: somkiat","siteHash":"3a23a5a4389e1e40c6fbb16520a8cc20df5b3591c25145ce72aaa18b19e48201","entryHash":"62815affa29e3479198b2c286a1128fb4f8745aa963a6a94b52dca1c4f5f715d","category":"Thai"}