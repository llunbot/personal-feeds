{"title":"Detect runtime security threats in Amazon ECS and AWS Fargate, new in Amazon GuardDuty","link":"https://aws.amazon.com/blogs/aws/introducing-amazon-guardduty-ecs-runtime-monitoring-including-aws-fargate/","date":1701051735000,"content":"<p>Today, we’re announcing <a href=\"https://aws.amazon.com/guardduty/\">Amazon GuardDuty</a> <strong>ECS Runtime Monitoring</strong> to help detect potential runtime security issues in <a href=\"https://aws.amazon.com/ecs/\">Amazon Elastic Container Service (Amazon ECS)</a> clusters running on both <a href=\"https://aws.amazon.com/fargate/\">AWS Fargate</a> and <a href=\"https://aws.amazon.com/ec2/\">Amazon Elastic Compute Cloud (Amazon EC2)</a>.</p> \n<p>GuardDuty combines machine learning (ML), anomaly detection, network monitoring, and malicious file discovery against various AWS data sources. When threats are detected, GuardDuty generates security findings and automatically sends them to <a href=\"https://aws.amazon.com/security-hub/\">AWS Security Hub</a>, <a href=\"https://aws.amazon.com/eventbridge\">Amazon EventBridge</a>, and <a href=\"https://aws.amazon.com/detective\">Amazon Detective</a>. These integrations help centralize monitoring for AWS and partner services, initiate automated responses, and launch security investigations.</p> \n<p>GuardDuty ECS Runtime Monitoring helps detect runtime events such as file access, process execution, and network connections that might indicate runtime threats. It checks hundreds of threat vectors and indicators and can produce over 30 different finding types. For example, it can detect attempts of privilege escalation, activity generated by crypto miners or malware, or activity suggesting reconnaissance by an attacker. This is in addition<a href=\"https://aws.amazon.com/guardduty/faqs/#product-faqs#guardduty-faqs#activating-guardduty\"> to GuardDuty‘s primary detection categories</a>.</p> \n<p>GuardDuty ECS Runtime Monitoring uses a managed and lightweight security agent that adds visibility into individual container runtime behaviors. When using AWS Fargate, there is no need for you to install, configure, manage, or update the agent. We take care of that for you. This simplifies the management of your clusters and reduces the risk of leaving some tasks without monitoring. It also helps to improve your security posture and pass regulatory compliance and certification for runtime threats.</p> \n<p>GuardDuty ECS Runtime Monitoring findings are visible directly in the console. You can configure GuardDuty to also send its findings to multiple AWS services or to third-party monitoring systems connected to your <a href=\"https://en.wikipedia.org/wiki/Security_operations_center\">security operations center (SOC)</a>.</p> \n<p>With this launch, Amazon Detective now receives security findings from GuardDuty ECS Runtime Monitoring and includes them in its collection of data for analysis and investigations. Detective helps to analyze, investigate, and quickly identify the root cause of potential security issues or suspicious activities. It collects log data from AWS resources and uses machine learning, statistical analysis, and graph theory to build a linked set of data that enables you to easily conduct security investigations.</p> \n<p><strong><u>Configure GuardDuty ECS Runtime Monitoring on AWS Fargate<br /> </u></strong>For this demo, I choose to show the experience provided for AWS Fargate. When using Amazon ECS, you must ensure your EC2 instances have the GuardDuty agent installed. You can install the agent manually, bake it into your AMI, or use GuardDuty‘s provided <a href=\"https://aws.amazon.com/systems-manager/\">AWS Systems Manager</a> <a href=\"https://docs.aws.amazon.com/systems-manager/latest/userguide/documents.html\">document</a> to install it (go to Systems Manager in the console, select Documents, and then search for GuardDuty). The documentation has <a href=\"https://docs.aws.amazon.com/guardduty/latest/ug/managing-gdu-agent-ec2-manually.html\">more details about installing the agent on EC2 instances</a>.</p> \n<p>When operating from a GuardDuty administrator account, I can enable GuardDuty ECS Runtime Monitoring at the <a href=\"https://docs.aws.amazon.com/organizations/latest/userguide/orgs_introduction.html\">organization</a> level to monitor all ECS clusters in all organizations’ AWS accounts.</p> \n<p>In this demo, I use the <a href=\"https://console.aws.amazon.com\">AWS Management Console</a> to enable <strong>Runtime Monitoring</strong>. Enabling GuardDuty ECS Runtime Monitoring in the console has an effect on all your clusters.</p> \n<p>When I want GuardDuty to automatically deploy the GuardDuty ECS Runtime Monitoring agent on Fargate, I enable <strong>GuardDuty agent management</strong>. To exclude individual clusters from automatic management, I can tag them with <code>GuardDutyManaged=false</code>. I make sure I tag my clusters before enabling ECS Runtime Monitoring in the console. When I don’t want to use the automatic management option, I can leave the option disabled and selectively choose the clusters to monitor with the tag <code>GuardDutyManaged=true</code>.</p> \n<p>The Amazon ECS or AWS Fargate cluster administrator must have authorization to manage tags on the clusters.</p> \n<p>The IAM <code>TaskExecutionRole</code> you attach to tasks must have permissions to download the GuardDuty agent from a private ECR repository. This is done automatically when you use the <code>AmazonECSTaskExecutionRolePolicy</code> <a href=\"https://docs.aws.amazon.com/AmazonECS/latest/developerguide/task_execution_IAM_role.html\">managed IAM policy</a>.</p> \n<p>Here is my view of the console when the Runtime Monitoring and agent management are enabled.</p> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2023/10/29/2023-10-29_16-20-38.png\"><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2023/10/29/2023-10-29_16-20-38.png\" alt=\"guardduty ecs enbale monitoring\" width=\"800\" height=\"806\" /></a></p> \n<p>I can track the deployment of the security agent by assessing the <strong>Coverage statistics</strong> across all the ECS clusters.</p> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2023/11/07/2023-11-07_08-02-42.png\"><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2023/11/07/2023-11-07_08-02-42.png\" alt=\"guardduty ecs cluster coverage\" width=\"800\" height=\"427\" /></a></p> \n<p>Once monitoring is enabled, there is nothing else to do. Let’s see what findings it detects on my simple demo cluster.</p> \n<p><strong><u>Check out GuardDuty ECS runtime security findings<br /> </u></strong>When GuardDuty ECS Runtime Monitoring detects potential threats, they appear in a list like this one.</p> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2023/11/08/Screenshot-2023-11-08-at-11.57.19-AM.png\"><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2023/11/08/Screenshot-2023-11-08-at-11.57.19-AM.png\" alt=\"ECS Runtime Monitoring - finding list\" width=\"800\" height=\"512\" /></a></p> \n<p>I select a specific finding to view more details about it.</p> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2023/11/08/Screenshot-2023-11-08-at-11.58.41-AM.png\"><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2023/11/08/Screenshot-2023-11-08-at-11.58.41-AM.png\" alt=\"ECS Runtime Monitoring - finding details\" width=\"800\" height=\"523\" /></a></p> \n<p><span><strong>Things to know<br /> </strong></span>By default, a Fargate task is immutable. GuardDuty won’t deploy the agent to monitor containers on existing tasks. If you want to monitor containers for already running tasks, you must stop and start the tasks after enabling GuardDuty ECS Runtime Monitoring. Similarly, when using <a href=\"https://docs.aws.amazon.com/AmazonECS/latest/developerguide/ecs_services.html\">Amazon ECS services</a>, you must force a new deployment to ensure tasks are restarted with the agent. As I mentioned already, be sure the tasks have IAM permissions to download the GuardDuty monitoring agent from Amazon ECR.</p> \n<p>We designed the GuardDuty agent to have little impact on performance, but <a href=\"https://docs.aws.amazon.com/AmazonECS/latest/developerguide/fargate-tasks-services.html#fargate-tasks-size\">you should plan for it in your Fargate task sizing calculations</a>.</p> \n<p>When you choose automatic agent management, GuardDuty also creates a <a href=\"https://docs.aws.amazon.com/whitepapers/latest/aws-privatelink/what-are-vpc-endpoints.html\">VPC endpoint</a> to allow the agent to communicate with GuardDuty APIs. When—just like me—you create your cluster with a <a href=\"https://docs.aws.amazon.com/cdk/v2/guide/ecs_example.html\">CDK or CloudFormation script</a> with the intention to delete the cluster after a period of time (for example, in a continuous integration scenario), bear in mind that the VPC endpoint must be deleted manually to allow CloudFormation to delete your stack.</p> \n<p><span><strong>Pricing and availability<br /> </strong></span>You can now use GuardDuty ECS Runtime Monitoring on AWS Fargate and Amazon EC2 instances. For a full list of Regions where GuardDuty ECS Runtime Monitoring is available, visit our <a href=\"https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_regions.html#gd-regional-feature-availability\">Region-specific feature availability</a> page.</p> \n<p>You can try GuardDuty ECS Runtime Monitoring for free for 30 days. When you enable GuardDuty for the first time, you have to explicitly enable GuardDuty ECS Runtime Monitoring. At the end of the trial period, we charge you per vCPU per hour of the monitoring agents. The <a href=\"https://aws.amazon.com/guardduty/pricing/\">GuardDuty pricing</a> page has all the details.</p> \n<p>Get insights about the threats to your container and <a href=\"https://us-east-1.console.aws.amazon.com/guardduty/home?region=us-east-1#/runtime-monitoring\">enable GuardDuty ECS Runtime Monitoring today</a>.</p> \n<a href=\"https://twitter.com/sebsto\">-- seb</a>","author":"Sébastien Stormacq","siteTitle":"AWS News Blog","siteHash":"6093e072e4117ec22616e844cb857d03ca62c57a411a8affc77cb5e8b6b15bf6","entryHash":"41984b471254d8890cc058e4fc5446e7e0823f24320edb9d95ea5c1773fce19d","category":"Tech"}