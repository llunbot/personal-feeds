{"title":"บันทึกการอ่านเรื่อง Migrating 3.7 Million Lines of Flow Code to TypeScript ของ Pinterest","link":"https://www.somkiat.cc/note-pinterest-migrating-code-to-typescript/","date":1748097975000,"content":"<p><img width=\"150\" height=\"150\" src=\"https://www.somkiat.cc/wp-content/uploads/2025/05/pinterest-code-01-150x150.jpeg\" alt=\"\" loading=\"lazy\" srcset=\"https://www.somkiat.cc/wp-content/uploads/2025/05/pinterest-code-01-150x150.jpeg 150w, https://www.somkiat.cc/wp-content/uploads/2025/05/pinterest-code-01-75x75.jpeg 75w\" /></p>\n<figure><a href=\"https://www.somkiat.cc/wp-content/uploads/2025/05/pinterest-code-01.jpeg\"><img src=\"https://www.somkiat.cc/wp-content/uploads/2025/05/pinterest-code-01.jpeg\" alt=\"\" width=\"564\" height=\"301\" /></a></figure>\n\n\n\n<p>จากบทความเรื่อง <strong><a href=\"https://medium.com/pinterest-engineering/migrating-3-7-million-lines-of-flow-code-to-typescript-8a836c88fea5\" target=\"_blank\">Migrating 3.7 Million Lines of Flow Code to TypeScript</a></strong><br />โดยทีมของ Pinterest ทำการเปลี่ยน code ของระบบ<br />จาก <a href=\"https://flow.org/\" target=\"_blank\">Flow</a> มาเป็น <strong>TypeScript </strong>ภายใน 8 เดือน<br />ซึ่งช่วยให้ code ดีขึ้น<br />ทั้ง performance<br />ทั้งเรื่องของ type safty<br />และที่สำคัญคือ การหาคนหรือจ้างคนมาพัฒนาที่ง่ายขึ้น<br />มาดูกันว่า ทีมของ Pinterest มีแนวคิดและแนวทางในการย้ายอย่างไรบ้าง ?</p>\n\n\n\n<span></span>\n\n\n\n<p>ทีมจะใช้ <a href=\"https://github.com/stripe-archive/flow-to-typescript-codemod\" target=\"_blank\">Codemod Stripe</a> ในการ migrate มาเป็น TypeScript<br />ซึ่งทีมได้เปิด PR เข้าไปเพิ่มด้วย</p>\n\n\n\n<p><strong>ทุกอย่างมันเริ่มจากปัญหาเสมอ ?</strong></p>\n\n\n\n<p>ในปี 2016 ทางทีมทำการเพิ่ม type เข้าไปยัง code ของระบบที่พัฒนาด้วย JavaScript<br />ซึ่งเลือก Flow มาใช้งาน ด้วยเหตุผลกังนี้</p>\n\n\n\n<ul>\n<li>ง่ายต่อการพัฒนาแบบ incremental สามารถเพิ่ม type แบบ file-by-file ได้</li>\n\n\n\n<li>ทำงานร่วมกับ ReactJS ได้ดี</li>\n</ul>\n\n\n\n<p>แต่ในปี 2023 นั้น TypeScript นั้นเป็นที่นิยม และ เข้ามาเป็น standard ของ type checking<br />ซึ่ง trend การนำไปใช้งานสูงอย่างมาก ๆ<br />ส่วน Flow นั้นไม่มีการใช้งานเท่าไร !!<br />ดังนั้น ทีมจึงตัดสินใจนำ TypeScript มาใช้งาน</p>\n\n\n\n<p>แต่ก็ได้ทำการทดลองหรือ PoC ก่อน<br />มีเครื่องมือในการ migrate จาก Flow เป็น TypeScript</p>\n\n\n\n<p>ส่วนอื่น ๆ ที่เพิ่มความมั่นใจในการย้าย คือ</p>\n\n\n\n<ul>\n<li>Community ที่ใหญ่ และ active</li>\n\n\n\n<li>ความสามารถของภาษาที่ดี เช่น <a href=\"https://www.typescriptlang.org/docs/handbook/2/conditional-types.html\" target=\"_blank\">conditional type</a>, non-null assertion เป็นต้น</li>\n\n\n\n<li>หานักพัฒนาที่เก่ง ๆ ได้ง่ายขึ้น</li>\n</ul>\n\n\n\n<p><strong>ขั้นตอนการ migrate เป็นดังนี้</strong></p>\n\n\n\n<p>จากการศึกษาของทางทีมพบว่า<br />มีทั้ง Zapier, Airtable และ Stripe ที่ทำการ migrate ไปยัง TypeScript แล้ว<br />ซึ่งทำการ migrate แบบ bigbang หรือทั้งหมดด้วย Codemod<br />มีขั้นตอนดังนี้</p>\n\n\n\n<ul>\n<li>ทำการ setup TypeScript และ Lint</li>\n\n\n\n<li>ทำการ config VSCode เพื่อสนับสนุน TypeScript ให้ดีขึ้น</li>\n\n\n\n<li>ทำการแปลง code จาก Flow ไปยัง TypeScript </li>\n\n\n\n<li>รวมทั้งทำการ generate type ของ dependency ต่าง ๆ ด้วย</li>\n\n\n\n<li>ในการใช้ codemod ยังมีข้อผิดหลาด หรือ ไม่ตรงกับความต้องการ ก็ทำการแก้ไขและส่ง patch ไปยัง codemod ด้วย</li>\n\n\n\n<li>ทำการแก้ไข error ต่าง  ๆ จาก ESLint</li>\n\n\n\n<li>ทำการ integrate เข้ากับส่วนต่าง ๆ ของระบบ</li>\n\n\n\n<li>และก่อนที่จะทำการ rollout ออกไป ต้องทำการ validation หรือการ test นั่นเอง</li>\n\n\n\n<li>การทดสอบทำตามแนวทางของ <a href=\"https://kentcdodds.com/blog/the-testing-trophy-and-testing-classifications\" target=\"_blank\">Trophy testing</a></li>\n</ul>\n\n\n\n<p>สุดท้ายทำการ rollout ซึ่งก็ต้องระมัดระวังด้วยเช่นกัน<br />โดยทำ rollout plan ขึ้นมา ว่าจะต้องทำอย่างไรบ้าง<br />และวางแผนด้วยว่า ถ้ามีปัญหาจะ rollback หรือ จัดการอย่างไรด้วย</p>\n\n\n\n<p>เป็นอีกแนวทางที่น่าสนใจ<br />ลองอ่านรายละเอียดกันเพิ่มเติมดูครับ</p>\n\n\n\n<p><br /></p>\n","author":"somkiat","siteTitle":"cc :: somkiat","siteHash":"3a23a5a4389e1e40c6fbb16520a8cc20df5b3591c25145ce72aaa18b19e48201","entryHash":"8cd729e036fd9827aff18f06136c6a15b28ba6fab2897b489073389815a7d32c","category":"Thai"}