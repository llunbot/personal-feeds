{"title":"Simplify governance with declarative policies","link":"https://aws.amazon.com/blogs/aws/simplify-governance-with-declarative-policies/","date":1733085751000,"content":"<p>Today, I am happy to announce declarative policies, a new capability that helps you declare and enforce desired configuration for a given AWS Service at scale across your organization.</p> \n<p>It is common for customers to create standards within their organizations for how cloud resources should be configured. For example, they might require blocking public access for Amazon EBS snapshots. They want these standards to be defined once centrally and enforced across all their accounts, including those that join the organization in the future. Additionally, whenever a cloud operator attempts to configure a resource in a way that does not meet the standard, they want that operator to receive a useful, actionable error message that explains how to remediate the configuration.</p> \n<p>Declarative policies address these challenges by helping you to define and enforce desired configuration for AWS services with a few clicks or commands. You can select the configuration you want such as “block public access for VPCs” and AWS will automatically ensure that the desired state is enforced across your multi-account environment (or parts of it) once you attach the policy. This approach reduces the complexity of achieving the desired configuration. Once the configuration is set, it is maintained, even as new features or new APIs are added. Additionally, with declarative policies, administrators have visibility into the current state of service attributes across their environment, and – unlike access control policies, which cannot leak information to those without permissions – end users see custom error messages configured by their organization’s administrators, redirecting them to internal resources or support channels.</p> \n<p>“ABSA Group operates in a heavily regulated environment and as we adopt more services, we use SCP policy exclusions to restrict actions and Config rules to detect violations. However, we must create an exception for every new API or feature. With declarative policies, we can simply set VPC Block Public Access to true and have peace of mind that no users, service-linked roles, or future APIs can facilitate public access in our AWS Organizations.” explains Vojtech Mencl, Lead Product Engineer at ABSA, a multinational banking and financial services conglomerate based in Johannesburg, South Africa.</p> \n<p>“With custom error messages, we can easily redirect end users to an internal portal for more information on why their action failed. This drastically reduces the operational complexity for governance and accelerates our migration to AWS.” says Matt Draper, Principal Engineer at ABSA.</p> \n<p>At this launch, declarative policies supports <a href=\"https://aws.amazon.com/ec2/\">Amazon Elastic Compute Cloud (Amazon EC2)</a>, <a href=\"https://aws.amazon.com/vpc/\">Amazon Virtual Private Cloud (Amazon VPC)</a>, and <a href=\"https://aws.amazon.com/ebs/\">Amazon Elastic Block Store (Amazon EBS)</a> services. Available service attributes include enforcing IMDSv2, allowing troubleshooting though serial console, allowed <a href=\"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/AMIs.html\">Amazon Machine Image (AMI)</a> settings, and blocking public access for Amazon EBS snapshots, Amazon EC2 AMI, and VPC. When new accounts are added to an organization, they will inherit the declarative policy applied at the organization, organizational unit (OU) or account level.</p> \n<p>You can create declarative policies through the <a href=\"https://aws.amazon.com/organizations/\">AWS Organizations</a> console, <a href=\"https://aws.amazon.com/cli/\">AWS Command Line Interface (AWS CLI)</a>, <a href=\"https://aws.amazon.com/cloudformation/\">AWS CloudFormation</a>, or through <a href=\"https://aws.amazon.com/controltower/\">AWS Control Tower</a>. Policies can be applied at the organization, OU, or account level. When attached, declarative policies prevent non-compliant actions regardless of whether they were invoked using an <a href=\"https://aws.amazon.com/iam/\">AWS Identity and Access Management (IAM)</a> role you created or by an AWS service using a <a href=\"https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_create-service-linked-role.html\">service-linked role</a>.</p> \n<p><span><strong>Getting started with declarative policies<br /> </strong></span>To demonstrate declarative policies, I will walk you through an example. Let’s say that as the security administrator for a large enterprise with hundreds of AWS accounts, I’m responsible for maintaining our organization’s strict security posture. At our company, we have several critical security requirements: we maintain tight control over internet access across all our networks, we only allow AMIs from specific trusted providers, and we need to ensure that no VPC resources are accidentally exposed to the public internet. With declarative policies, I can implement these requirements efficiently. Let me show you how I set this up in my environment.</p> \n<p>I go to the <a href=\"https://console.aws.amazon.com/organizations/v2/\">AWS Organizations console</a> and choose <strong>Policies</strong> in the navigation pane. I choose <strong>Declarative policies for EC2 </strong>under the <strong>Supported policy types</strong>.</p> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/11/07/01-AWSNEWS-2074.png\"><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/11/07/01-AWSNEWS-2074.png\" width=\"3032\" height=\"1500\" /></a></p> \n<p>I choose <strong>Enable declarative policies for EC2</strong> to enable the feature.</p> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/11/07/02-AWSNEWS-2074.png\"><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/11/07/02-AWSNEWS-2074.png\" width=\"1754\" height=\"518\" /></a></p> \n<p>After declarative policies is enabled, I can define and enforce desired configurations for EC2 across all of the accounts in my AWS Organizations.</p> \n<p>Before I create declarative policies, as the organization’s administrator, I want to understand the current status of my AWS environment using the account status report, which is a feature of declarative policies. The report offers both a summary view and a detailed CSV file, covering all accounts and AWS Regions within a selected organizational scope. It helps me assess readiness before attaching a policy.</p> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/11/12/10-AWSNEWS-2074.png\"><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/11/12/10-AWSNEWS-2074.png\" width=\"861\" height=\"294\" /></a></p> \n<p>On the next page, I choose <strong>Generate status report</strong>. I choose an <a href=\"https://aws.amazon.com/s3/\">Amazon Simple Storage Service (Amazon S3)</a> bucket under <strong>Report S3 URI</strong> and choose accounts and OUs to include in the report scope.</p> \n<p>Note that the S3 bucket requires the following policy attached to it in order to store the status report:</p> \n<pre><code>{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Sid\": \"DeclarativePoliciesReportBucket\",\n            \"Effect\": \"Allow\",\n            \"Principal\": {\n                \"Service\": [\n                    \"report.declarative-policies-ec2.amazonaws.com\"\n                ]\n            },\n            \"Action\": [\n                \"s3:PutObject\"\n            ],\n            \"Resource\": \"arn:aws:s3:::&lt;bucketName&gt;/*\",\n            \"Condition\": {\n                \"StringEquals\": {\n                    \"aws:SourceArn\": \"arn:&lt;partition&gt;:declarative-policies-ec2:&lt;region&gt;:&lt;accountId&gt;:*\"\n                }\n            }\n        }\n    ]\n}</code></pre> \n<p>I choose <strong>Submit</strong>.</p> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/11/12/15-AWSNEWS-2074.png\"><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/11/12/15-AWSNEWS-2074.png\" width=\"855\" height=\"717\" /></a></p> \n<p>When complete, the report is stored in the Amazon S3 bucket I specified. On the <strong>View account status report</strong> page, I can choose between multiple reports from <strong>Reports</strong> dropdown to observe what is the current status of various attributes.</p> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/11/22/25-AWSNEWS-2074.png\"><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/11/22/25-AWSNEWS-2074.png\" width=\"1452\" height=\"893\" /></a></p> \n<p>I check the Amazon S3 bucket I provided to store a CSV file, which provides the detailed readiness report. I observe what my current state is across my organization unit across different regions.</p> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/11/22/26-AWSNEWS-2074.png\"><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/11/22/26-AWSNEWS-2074.png\" width=\"1368\" height=\"862\" /></a></p> \n<p>After I assess the account status, I continue to create a policy. I choose <strong>Create policy </strong>on the <strong>Declarative policies for EC2</strong> page.</p> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/11/12/11-AWSNEWS-2074.png\"><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/11/12/11-AWSNEWS-2074.png\" width=\"862\" height=\"294\" /></a></p> \n<p>On the next page, I enter a <strong>Policy name </strong>and optionally a <strong>Policy description</strong>.</p> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/11/07/04-AWSNEWS-2074.png\"><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/11/07/04-AWSNEWS-2074.png\" width=\"1922\" height=\"1304\" /></a></p> \n<p>In this demo, I use <strong>Visual Editor</strong> to show how to add service attributes. These attributes include Serial Console Access, Instance Metadata Defaults, Image Block Public Access, Snapshot Block Public Access, VPC Block Public Access, and Allowed Image Settings. I can use <strong>JSON Editor</strong> to add them manually or to observe the policies I added using <strong>Visual Editor</strong>. First, I choose <strong>VPC Block Public Access</strong> to control internet access for resources in my VPC from internet gateways. I choose <strong>Block ingress</strong> under <strong>Internet gateway state</strong>. When enabled, this immediately prevents public access without mutating resources and can be rolled back.</p> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/11/12/12-AWSNEWS-2074.png\"><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/11/12/12-AWSNEWS-2074.png\" width=\"853\" height=\"470\" /></a></p> \n<p>As a second attribute, I choose <strong>Allowed Image Settings</strong> to control the allowed images criteria for AMIs. This is useful because I can ensure all instance launches use a golden AMI that an account or set of accounts generates in my organization, or one provided by a vendor like Amazon or Ubuntu. I choose <strong>Enabled</strong> under <strong>Allowed Image Settings</strong>. I choose <strong>amazon</strong> under <strong>Provider</strong>. Declarative policies provides transparency with customizable error messages to help reduce end-user frustration. You can optionally add a <strong>Custom error message</strong> to be displayed when organization members are unable to perform a restricted action. To complete the process of generating the policy, I choose <strong>Create policy</strong>.</p> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/11/21/23-AWSNEWS-2074.png\"><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/11/21/23-AWSNEWS-2074.png\" width=\"851\" height=\"798\" /></a></p> \n<p>Now, I need to attach the policy to my organization or specific OUs. I choose <strong>Attach policy</strong> under <strong>Actions</strong>.</p> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/11/12/14-AWSNEWS-2074.png\"><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/11/12/14-AWSNEWS-2074.png\" width=\"846\" height=\"315\" /></a></p> \n<p>I choose my organization or specific OUs and choose <strong>Attach policy</strong>.</p> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/11/07/08-AWSNEWS-2074.png\"><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/11/07/08-AWSNEWS-2074.png\" width=\"1908\" height=\"1058\" /></a></p> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/11/21/24-AWSNEWS-2074.png\"><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/11/21/24-AWSNEWS-2074.png\" width=\"844\" height=\"863\" /></a></p> \n<p>When an account joins an organization or an OU, the declarative policy attached to it takes immediate effect and all subsequent non-compliant actions will fail (except for VPC Block Public Access, which will immediately curtail public access). Existing resources in the account will not be deleted.</p> \n<p><span><strong>Now available<br /> </strong></span>Declarative policies streamlines governance for AWS customers by reducing policy maintenance overhead, providing consistent enforcement across accounts, and offering transparency to administrators and end users.</p> \n<p>Declarative policies are now available in AWS commercial, China and AWS GovCloud (US) Regions.</p> \n<p>To learn more about declarative policies and start enforcing them in your organization, visit the <a href=\"https://docs.aws.amazon.com/organizations/latest/userguide/orgs_manage_policies_declarative.html\">declarative policies</a> documentation.</p> \n<a href=\"https://www.linkedin.com/in/esrakayabali/\">— Esra</a>","author":"Esra Kayabali","siteTitle":"AWS News Blog","siteHash":"6093e072e4117ec22616e844cb857d03ca62c57a411a8affc77cb5e8b6b15bf6","entryHash":"3be5037aa01fbd6c1e14445f02694910de8d81fee4bb9512fc0c060ee6353d54","category":"Tech"}