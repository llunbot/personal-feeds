{"title":"บันทึกแนวทางการทดสอบ AWS Serverless app","link":"https://www.somkiat.cc/how-to-test-aws-serverless-app/","date":1747318878000,"content":"<p><img width=\"150\" height=\"150\" src=\"https://www.somkiat.cc/wp-content/uploads/2025/05/localstack-01-150x150.png\" alt=\"\" loading=\"lazy\" srcset=\"https://www.somkiat.cc/wp-content/uploads/2025/05/localstack-01-150x150.png 150w, https://www.somkiat.cc/wp-content/uploads/2025/05/localstack-01-75x75.png 75w\" /></p>\n<p>คำถามเกี่ยวการทดสอบจาก class Full Stack Testing ที่น่าสนใจ<br />เราจะทำการทดสอบ Serverless app บน AWS อย่างไรกันบ้าง ?<br />เพื่อช่วยเพิ่มคุณภาพและความเร็วในการพัฒนาและส่งมอบงาน (Quality and Speed)<br />ดังนี้เรามาดูกันว่า ทำอย่างไรได้บ้าง ?</p>\n\n\n\n<span></span>\n\n\n\n<p><strong>จากคำถามที่ถามมานั้น</strong></p>\n\n\n\n<p>ผมก็มีประสบการณ์มาบ้างนิดหน่อย<br />โดยเริ่มต้นจากเอกสาร <a href=\"https://docs.aws.amazon.com/prescriptive-guidance/latest/serverless-application-testing/introduction.html\" target=\"_blank\">Testing serverless applications on AWS</a><br />ซึ่งจะมีแนวทางการทดสอบทั้ง</p>\n\n\n\n<ul>\n<li>Unit test</li>\n\n\n\n<li>Integration test</li>\n\n\n\n<li>E2E test</li>\n\n\n\n<li>การใช้งาน Emulator และ Mock เข้ามาช่วยในการทดสอบ</li>\n</ul>\n\n\n\n<p>มาดูแนวทางที่ได้แนะนำไปได้เล็กน้อย<br />มีขั้นตอนดังนี้</p>\n\n\n\n<p><strong>ขั้นตอนที่ 1 ทำการสร้าง App ด้วย <a href=\"https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/install-sam-cli.html\" target=\"_blank\">AWS Serverless Application Model (SAM) CLI</a></strong></p>\n\n\n\n<p>โดยสร้างเป็น Java project + Apache Maven ดังนี้</p>\n\n\n\n[gist id=\"5bcddd219635b3c249d35d1f8c59965e\" file=\"1.txt\"]\n\n\n\n<p><strong>ขั้นตอนที่ 2 ทำการแก้ไข code ให้เป็นไปตามความต้องการ</strong></p>\n\n\n\n<p>สิ่งที่ต้องการคือ  Serverless app หรือ Lambda function นั้น<br />จะทำการรับ message หรือ event จาก <a href=\"https://aws.amazon.com/sqs/\" target=\"_blank\">Amazon SQS</a> (Simple Queue Service)<br />ทำการแก้ไข code ใน handler ของ function ได้ดังนี้</p>\n\n\n\n[gist id=\"5bcddd219635b3c249d35d1f8c59965e\" file=\"SQSLambdaHandler.java\"]\n\n\n\n<p><strong>ขั้นตอนที่ 3 ทำการทดสอบในรูปแบบใดได้บ้าง ?</strong></p>\n\n\n\n<p>รูปแบบที่แนะนำประกอบไปด้วย 3 แบบดังนี้</p>\n\n\n\n<p><strong>แบบที่ 1 ทำการทดสอบผ่าน SAM CLI ไปเลย</strong></p>\n\n\n\n<p>โดยทำการสร้าง message หรือ event ในรูปแบบของไฟล์ JSON<br />จากนั้นทำการส่งผ่าน SAM CLI ได้เลย</p>\n\n\n\n[gist id=\"5bcddd219635b3c249d35d1f8c59965e\" file=\"2.txt\"]\n\n\n\n<p><strong>แบบที่ 2 ทำการจำลองการส่ง message หรือ event ผ่าน Amazon SQS ไปเลย</strong></p>\n\n\n\n<p>แต่แทนที่จะใช้ queue บนระบบ Cloud<br />แต่ทำการเปลี่ยนมาใช้งานบน local ด้วย <strong><a href=\"https://github.com/localstack/localstack\" target=\"_blank\">LocalStack</a></strong></p>\n\n\n\n<figure><a href=\"https://www.somkiat.cc/wp-content/uploads/2025/05/localstack-01.png\"><img src=\"https://www.somkiat.cc/wp-content/uploads/2025/05/localstack-01-1024x576.png\" alt=\"\" width=\"580\" height=\"325\" /></a></figure>\n\n\n\n<p>แต่เพิ่มความง่ายในการติดตั้งและใช้ในการทดสอบบน local<br />จึงใช้งานผ่าน <a href=\"https://java.testcontainers.org/modules/localstack/\" target=\"_blank\">Test Containers ซึ่งมี LocalStack module</a> มาให้ด้วย<br />โดยในการใช้งานจะเปิด SQS service ขึ้นมาใช้งาน<br />การใช้งานจะเขียนใน test case ด้วย JUnit 5 ดังนี้</p>\n\n\n\n[gist id=\"5bcddd219635b3c249d35d1f8c59965e\" file=\"SQSLambdaHandlerTest.java\"]\n\n\n\n<p>ขั้นตอนการทำงานคือ</p>\n\n\n\n<ul>\n<li>สร้าง Queue ใน SQS </li>\n\n\n\n<li>การการสร้าง message หรือ event และส่งเข้าไปยัง Queue</li>\n\n\n\n<li>ทำการรับหรืออ่าน message หรือ event เข้า Queue</li>\n\n\n\n<li>มีได้ message หรือ event มาแล้ว ทำการสร้างเข้าไปยัง handler function เพื่อทำงาน</li>\n\n\n\n<li>ทำการตรวจสอบผลการทำงานของ function</li>\n</ul>\n\n\n\n<p>เพียงเท่านี้ก็สามารถทดสอบแบบง่าย ๆ  ได้แล้ว</p>\n\n\n\n<p><strong>แบบที่ 3 ทำการทดสอบ handler function ตรง ๆ  ได้เลย ซึ่งทำงานร่วมกับ Mockito</strong></p>\n\n\n\n[gist id=\"5bcddd219635b3c249d35d1f8c59965e\" file=\"SQSLambdaHandlerUnitTest.java\"]\n\n\n\n<p>ลองทดสอบกันดูครับ<br />เป็นแนวทางที่ทำให้เราเข้าใจการทำงานของระบบ<br />และทำการสร้าง environment ในการพัฒนาและทดสอบให้คล้ายกับของจริงมากที่สุด<br />ขอให้สนุกกับการทดสอบ<br /></p>\n","author":"somkiat","siteTitle":"cc :: somkiat","siteHash":"3a23a5a4389e1e40c6fbb16520a8cc20df5b3591c25145ce72aaa18b19e48201","entryHash":"924635c8a404fd9177128675e3bf4ff65e300fbee8c9b1b964a4339b154e2e6a","category":"Thai"}