{"title":"Open Source PC Emulator UTM Blocked by Apple for Notarization, Including Through EU Marketplaces","link":"https://mjtsai.com/blog/2024/06/14/utm-blocked-outside-app-store-via-notarization/","date":1718740132000,"content":"\n<p>Michael Tsai:</p>\n\n<blockquote>\n  <p>This is confusing, but I think what Apple is saying is that, even\nwith notarization, apps are <a href=\"https://developer.apple.com/support/dma-and-apps-in-the-eu/\">not allowed</a> to “download\nexecutable code.” <a href=\"https://social.treehouse.systems/@curioustommy/112584688843571641\">Rule 2.5.2</a> says apps may not “download,\ninstall, or execute code” except for limited educational purposes.\n<a href=\"https://developer.apple.com/app-store/review/guidelines/\">Rule 4.7</a> makes an exception to this so that retro game\nemulators and some other app types <em>can</em> run code “that is not\nembedded in the binary.” This is grayed out when you select “Show\nNotarization Review Guidelines Only”, meaning that the exception\nonly applies <em>within</em> the App Store. Thus, the general prohibition\nremains in effect for App Marketplaces and Web Distribution. But\nit seems like this wasn’t initially clear to Apple, either,\nbecause the review process <a href=\"https://appleinsider.com/articles/24/06/09/apple-appears-to-have-drawn-a-fuzzy-line-for-iphone-about-what-counts-as-console-emulation\">took two months</a>.</p>\n\n<p>This also seems inconsistent with the fact that the Delta emulator\n<em>is</em> allowed to be notarized outside the App Store. It doesn’t\nmake much sense for the rules to be <em>more</em> lax <em>within</em> the App\nStore. I first thought the mistake was that Apple didn’t mean to\ngray out 4.7 for notarization. Then everything would make sense.\nBut the clarification states that 4.7 is <em>not</em> intended to apply\nto notarization.</p>\n\n<p>The bottom line for me is that Apple doesn’t want general-purpose\nemulators, it’s questionable whether the DMA lets it block them,\nand even siding with Apple on this it isn’t consistently applying\nits own rules.</p>\n</blockquote>\n\n<p>Confusing indeed. Apple’s stance on this seems inscrutable and arbitrary: retro game emulators are, <a href=\"https://sixcolors.com/post/2024/04/emulate-all-the-things-apple/\">at long last</a>, acceptable, but general PC emulators are not. Such arbitrary policy decisions related to the purpose of the app are fine for the App Store (legally speaking), but clearly not compliant with the DMA. That’s one of the few areas where the DMA is clear. Apple can, of course, ban (say) porno apps from the App Store, but can’t refuse to notarize them for distribution outside the App Store in the EU.</p>\n\n<p>Apple has a security leg to stand on <a href=\"http://wingolog.org/archives/2011/06/21/security-implications-of-jit-compilation\">when it comes to JIT compilation</a>, but the version of UTM (UTM SE) that was held up in review for two months, and ultimately rejected by Apple, <em>doesn’t use a JIT</em>. And because it doesn’t use <a href=\"https://en.wikipedia.org/wiki/Just-in-time_compilation\">a JIT</a>, performance is poor; hence the UTM developers’ <a href=\"https://x.com/UTMapp/status/1799647652134654045\">deeming it not worth fighting about</a>. Apple goes into depth on the security challenges pertaining to JIT compilation <a href=\"https://developer.apple.com/documentation/browserenginekit/protecting-code-compiled-just-in-time\">in its documentation for BrowserEngineKit</a>, the framework for developing non-WebKit browser engines for distribution in the EU. That’s ostensibly the reason why developers need a special entitlement to use a custom browser engine — JavaScript engines need a JIT to perform well but JITs pose a security risk.</p>\n\n<p>In an earlier revision of this post, I suggested that <a href=\"https://apps.apple.com/us/app/delta-game-emulator/id1048524688\">Delta</a> — Riley Testut’s excellent and wildly popular retro Nintendo console emulator for iOS — uses a JIT. There <a href=\"https://github.com/rileytestut/DSDeltaCore/tree/6c84366b3a76045782905293c9616e33f5da1a35\">is indeed a JIT in Delta’s source code repository</a>, but Testut informs me that it’s currently only enabled through the version of AltStore <a href=\"https://altstore.io/#Downloads\">distributed through sideloading</a>. Delta’s JIT is removed from the versions of Delta in the App Store and AltStore PAL (the EU app marketplace), because of Apple’s restrictions on JIT compilers. No app with a JIT is going to pass review by Apple, including for distribution outside the App Store in the EU. That restriction should, in theory, be permitted under the DMA on security grounds. But how the no-JIT version of UTM could be rejected for notarization, I do not see.</p>\n\n<p>(Thinking about BrowserEngineKit makes me wonder: Now that over four months have passed since Apple announced its initial DMA compliance plans, has even a single browser developer announced plans to bring their own rendering engine to iOS in the EU? As far as I know the answer is no. It’s entirely possible Apple went to all the trouble of creating BrowserEngineKit for compliance with the DMA, but no one is actually going to use it because no browser developer deems the EU market worth forking their browser for, solely for distribution outside the App Store — while on the hook for the 50-euro-cents-per-download Core Technology Fee if such a browser becomes popular.)</p>\n\n<div>\n<a href=\"https://daringfireball.net/linked/2024/06/18/utm-notarization\"> ★ </a>\n</div>\n\n\t","author":"John Gruber","siteTitle":"Daring Fireball","siteHash":"fc569638025dadf22a867470f8215f38855cf50e975782a6c989909474292a36","entryHash":"a02c22fbc62df4469d20c922325926796a7a42a74d442bfdc5d6c6a7e00d5166","category":"Tech"}