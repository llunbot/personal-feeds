{"title":"0254 | ต่อ Sofar Inverter HYD 6000-EP เข้า Home Assistant","link":"https://www.icez.net/blog/167514/0254-integrate-sofar-inverter-hyd-6000-ep-to-home-assistant","date":1668267859000,"content":"<p>วิธีนี้สำหรับ Sofar Inverter ที่ตัว logger มี serial ขึ้นต้นด้วย 23xxxxxxxx นะครับ</p>\n<h3>[แก้ไข]</h3>\n<ul>\n<li>เขียนเสร็จปุ๊ป มี update แก้ให้รันใน raspberry pi ได้มาเลย เข้าไปดูได้ที่ repository นี้ <a href=\"https://github.com/kubaceg/sofar_g3_lsw3_logger_reader\">https://github.com/kubaceg/sofar_g3_lsw3_logger_reader</a></li>\n</ul>\n<h3>สิ่งที่ต้องมีก่อน</h3>\n<ul>\n<li>home assistant</li>\n<li>mqtt broker (ใช้ public หรือ private ก็ได้ตามสะดวก)</li>\n<li>linux x86 ซักเครื่องที่เชื่อมต่อไปหา inverter wifi interface ได้ (ใช้บน raspberry pi/arm ไม่ได้เนื่องจากคนเขียนเค้าบอกว่าเขียนรีบๆ มาใช้เอง)</li>\n<li>โปรแกรม fetch data =&gt; load ได้จาก <a href=\"https://github.com/XtheOne/Inverter-Data-Logger/issues/37#issuecomment-1303091265\">XtheOne/Inverter-Data-Logger issue #37</a> ดู link sofar-export.zip</li>\n<li>docker compose</li>\n</ul>\n<h3>ขั้นตอน</h3>\n<ul>\n<li>แตกไฟล์ sofar-export.zip แล้วเข้าไปใน folder ที่เก็บไฟล์</li>\n<li>แก้ไฟล์ Dockerfile เป็นตามนี้</li>\n</ul>\n<pre><code>FROM golang:1.19-bullseye\n\nADD . /src\n\nRUN apt update &amp;&amp; apt install -y ca-certificates tzdata &amp;&amp; \\\n  cd /src &amp;&amp; go build &amp;&amp; cp -av /src/sofar /\n\nCMD [\"/sofar\"]\n</code></pre>\n<ul>\n<li>สร้างไฟล์ docker-compose.yml ตามด้านล่าง ใน folder เดียวกัน แก้ค่าสามจุดตามนี้\n<ul>\n<li>23xxxxxxxx เป็นเลข serial ที่โชว์ในหน้าเว็บที่เข้าไปดู inverter (login user admin/admin)</li>\n<li>แก้ค่า tcp://user:pass@mqttserverip:mqttport ตาม mqtt broker ที่ใช้</li>\n<li>แก้ sofarinverterip เป็นเลข IP ของตัว inverter</li>\n</ul>\n</li>\n</ul>\n<pre><code>services:\n  sofar-export:\n    image: sofar-export\n    build: ./\n    restart: unless-stopped\n    command: /sofar -logger-serial 23xxxxxxxx -mqtt-url tcp://user:pass@mqttserverip:mqttport -port sofarinverterip:8899\n</code></pre>\n<ul>\n<li>เสร็จแล้วสั่ง start docker service ขึ้นมา</li>\n</ul>\n<pre><code>docker compose up -d\n</code></pre>\n<ul>\n<li>แล้วไปเซ็ต mqtt sensor ใน home assistant (ใส่ใน configuration.yaml) ประมาณนี้ *** parameter ยังไม่ได้ทดสอบ แก้ไขเองตามสะดวก ***</li>\n</ul>\n<pre><code>mqtt:\n  sensor:\n    - name: inverter_Frequency_Grid\n      state_topic: \"/sensors/energy/inverter2/All\"\n      value_template: \"{{ value_json.Frequency_Grid / 100 }}\"\n      unit_of_measurement: \"Hz\"\n      state_class: \"measurement\"\n      device_class: \"frequency\"\n    - name: inverter_PV_Generation_Today\n      state_topic: \"/sensors/energy/inverter2/All\"\n      value_template: \"{{ value_json.PV_Generation_Today * 10}}\"\n      unit_of_measurement: \"Wh\"\n      state_class: \"measurement\"\n      device_class: \"energy\"\n    - name: inverter_PV_Generation_Total\n      state_topic: \"/sensors/energy/inverter2/All\"\n      value_template: \"{{ value_json.PV_Generation_Total * 100}}\"\n      unit_of_measurement: \"Wh\"\n      state_class: \"measurement\"\n      device_class: \"energy\"\n    - name: inverter_ActivePower_Load_Sys\n      state_topic: \"/sensors/energy/inverter2/All\"\n      value_template: \"{{ value_json.ActivePower_Load_Sys * 10}}\"\n      unit_of_measurement: \"W\"\n      state_class: \"measurement\"\n      device_class: \"power\"\n    - name: inverter_ActivePower_PV_Ext\n      state_topic: \"/sensors/energy/inverter2/All\"\n      value_template: \"{{ value_json.ActivePower_PV_Ext * 10}}\"\n      unit_of_measurement: \"W\"\n      state_class: \"measurement\"\n      device_class: \"power\"\n    - name: inverter_ActivePower_Output_R\n      state_topic: \"/sensors/energy/inverter2/All\"\n      value_template: \"{{ value_json.ActivePower_Output_R * 10}}\"\n      unit_of_measurement: \"W\"\n      state_class: \"measurement\"\n      device_class: \"power\"\n    - name: inverter_ActivePower_Output_Total\n      state_topic: \"/sensors/energy/inverter2/All\"\n      value_template: \"{{ value_json.ActivePower_Output_Total * 10}}\"\n      unit_of_measurement: \"W\"\n      state_class: \"measurement\"\n      device_class: \"power\"\n    - name: inverter_ActivePower_PCC_R\n      state_topic: \"/sensors/energy/inverter2/All\"\n      value_template: \"{{ value_json.ActivePower_PCC_R * 10}}\"\n      unit_of_measurement: \"W\"\n      state_class: \"measurement\"\n      device_class: \"power\"\n    - name: inverter_ActivePower_PCC_Total\n      state_topic: \"/sensors/energy/inverter2/All\"\n      value_template: \"{{ value_json.ActivePower_PCC_Total * 10}}\"\n      unit_of_measurement: \"W\"\n      state_class: \"measurement\"\n      device_class: \"power\"\n    - name: inverter_Voltage_Phase_R\n      state_topic: \"/sensors/energy/inverter2/All\"\n      value_template: \"{{ value_json.Voltage_Phase_R / 10}}\"\n      unit_of_measurement: \"V\"\n      state_class: \"measurement\"\n      device_class: \"voltage\"\n    - name: inverter_Voltage_PV1\n      state_topic: \"/sensors/energy/inverter2/All\"\n      value_template: \"{{ value_json.Voltage_PV1 / 10}}\"\n      unit_of_measurement: \"V\"\n      state_class: \"measurement\"\n      device_class: \"voltage\"\n    - name: inverter_Voltage_PV2\n      state_topic: \"/sensors/energy/inverter2/All\"\n      value_template: \"{{ value_json.Voltage_PV2 / 10}}\"\n      unit_of_measurement: \"V\"\n      state_class: \"measurement\"\n      device_class: \"voltage\"\n    - name: inverter_Current_PV1\n      state_topic: \"/sensors/energy/inverter2/All\"\n      value_template: \"{{ value_json.Current_PV1 / 100 }}\"\n      unit_of_measurement: \"A\"\n      state_class: \"measurement\"\n      device_class: \"current\"\n    - name: inverter_Current_PV2\n      state_topic: \"/sensors/energy/inverter2/All\"\n      value_template: \"{{ value_json.Current_PV2 / 100}}\"\n      unit_of_measurement: \"A\"\n      state_class: \"measurement\"\n      device_class: \"current\"\n    - name: inverter_Current_Output_R\n      state_topic: \"/sensors/energy/inverter2/All\"\n      value_template: \"{{ value_json.Current_Output_R / 100 }}\"\n      unit_of_measurement: \"A\"\n      state_class: \"measurement\"\n      device_class: \"current\"\n    - name: inverter_Temperature_Env1\n      state_topic: \"/sensors/energy/inverter2/All\"\n      value_template: \"{{ value_json.Temperature_Env1 }}\"\n      unit_of_measurement: \"C\"\n      state_class: \"measurement\"\n      device_class: \"temperature\"\n    - name: inverter_Temperature_HeatSink1\n      state_topic: \"/sensors/energy/inverter2/All\"\n      value_template: \"{{ value_json.HeatSink1 }}\"\n      unit_of_measurement: \"C\"\n      state_class: \"measurement\"\n      device_class: \"temperature\"\n</code></pre>","author":"icez","siteTitle":"icez network","siteHash":"88787adba55f9deb5660f47c4b8baf580eb765815e4a6d536737656e8ab8bde4","entryHash":"9a121b0556856d2add5bf3bfaf6322597697b345cfca5471012ccb5ac8f3416a","category":"Thai"}