{"title":"How To Build A Geocoding App In Vue.js Using Mapbox","link":"https://smashingmagazine.com/2021/06/building-geocoding-app-vue-mapbox/","date":1623063600000,"content":"<p>Pinpoint accuracy and modularity are among the perks that make geocodes the perfect means of finding a particular location.</p>\n<p>In this guide, we’ll build a <a href=\"https://github.com/smashingmagazine/Tutorials/tree/Geocoding-app-vue\">simple geocoding app</a> from scratch, using Vue.js and Mapbox. We’ll cover the process from building the front-end scaffolding up to building a geocoder to handle forward geocoding and reverse geocoding. To get the most out of this guide, you’ll need a basic understanding of JavaScript and Vue.js and how to make API calls.</p>\nWhat Is Geocoding?\n<p>Geocoding is the transformation of text-based locations to geographic coordinates (typically, longitude and latitude) that indicate a location in the world.</p>\n<p>Geocoding is of two types: <strong>forward and reverse</strong>. Forward geocoding converts location texts to geographic coordinates, whereas reverse geocoding converts coordinates to location texts.</p>\n<p>In other words, reverse geocoding turns 40.714224, -73.961452 into “277 Bedford Ave, Brooklyn”, and forward geocoding does the opposite, turning “277 Bedford Ave, Brooklyn” into 40.714224, -73.961452.</p>\n<p>To give more insight, we will build a mini web app that uses an interactive web map with custom markers to display location coordinates, which we will subsequently decode to location texts.</p>\n<p>Our app will have the following basic functions:</p>\n<ul>\n<li>give the user access to an interactive map display with a marker;</li>\n<li>allow the user to move the marker at will, while displaying coordinates;</li>\n<li>return a text-based location or location coordinates upon request by the user.</li>\n</ul>\nSet Up Project Using Vue CLI\n<p>We’ll make use of the <a href=\"https://github.com/smashingmagazine/Tutorials/tree/geocoder/boilerplate\">boilerplate found in this repository</a>. It contains a new project with the Vue CLI and <code>yarn</code> as a package manager. You’ll need to clone the repository. Ensure that you’re working from the <code>geocoder/boilerplate</code> branch.</p>\nSet Up File Structure of Application\n<p>Next, we will need to set up our project’s file structure. Rename the <code>Helloworld.vue</code> file in the component’s folder to <code>Index.vue</code>, and leave it blank for now. Go ahead and copy the following into the <code>App.vue</code> file:</p>\n<pre><code>&lt;template&gt;\n  &lt;div id=\"app\"&gt;\n    &lt;!--Navbar Here --&gt;\n    &lt;div&gt;\n      &lt;nav&gt;\n        &lt;div class=\"header\"&gt;\n          &lt;h3&gt;Geocoder&lt;/h3&gt;\n        &lt;/div&gt;\n      &lt;/nav&gt;\n    &lt;/div&gt;\n    &lt;!--Index Page Here --&gt;\n    &lt;index /&gt;\n  &lt;/div&gt;\n&lt;/template&gt;\n&lt;script&gt;\nimport index from \"./components/index.vue\";\nexport default {\n  name: \"App\",\n  components: {\n    index,\n  },\n};\n&lt;/script&gt;</code></pre>\n\n<p>Here, we’ve imported and then registered the recently renamed component locally. We’ve also added a navigation bar to lift our app’s aesthetics.</p>\n<p>We need an <code>.env</code> file to load the environment variables. Go ahead and add one in the root of your project folder.</p>\nInstall Required Packages and Libraries\n<p>To kickstart the development process, we will need to install the required libraries. Here’s a list of the ones we’ll be using for this project:</p>\n<ol>\n<li><strong>Mapbox GL JS</strong><br />This JavaScript library uses WebGL to render interactive maps from <a href=\"https://docs.mapbox.com/help/glossary/vector-tiles/\">vector tiles</a> and <a href=\"https://docs.mapbox.com/mapbox-gl-js/style-spec/\">Mapbox</a>.</li>\n<li><strong>Mapbox-gl-geocoder</strong><br />This geocoder control for Mapbox GL will help with our forward geocoding.</li>\n<li><strong>Dotenv</strong><br />We won’t have to install this because it comes preinstalled with the Vue CLI. It helps us to load environment variables from an <code>.env</code> file into <a href=\"https://nodejs.org/docs/latest/api/process.html#process_process_env\"><code>process.env</code></a>. This way, we can keep our configurations separate from our code.</li>\n<li><strong>Axios</strong><br />This library will help us make HTTP requests.</li>\n</ol>\n<p>Install the packages in your CLI according to your preferred package manager. If you’re using Yarn, run the command below:</p>\n<pre><code>cd geocoder &amp;&amp; yarn add mapbox-gl @mapbox/mapbox-gl-geocoder axios</code></pre>\n\n<p>If you’re using npm, run this:</p>\n<pre><code>cd geocoder &amp;&amp; npm i mapbox-gl @mapbox/mapbox-gl-geocoder axios --save</code></pre>\n\n<p>We first had to enter the <code>geocoder</code> folder before running the installation command.</p>\nScaffolding the Front End With Vue.js\n<p>Let’s go ahead and create a layout for our app. We will need an element to house our map, a region to display the coordinates while listening to the marker’s movement on the map, and something to display the location when we call the reverse geocoding API. We can house all of this within a card component.</p>\n<p>Copy the following into your <code>Index.vue</code> file:</p>\n<pre><code>&lt;template&gt;\n  &lt;div class=\"main\"&gt;\n    &lt;div class=\"flex\"&gt;\n      &lt;!-- Map Display here --&gt;\n      &lt;div class=\"map-holder\"&gt;\n        &lt;div id=\"map\"&gt;&lt;/div&gt;\n      &lt;/div&gt;\n      &lt;!-- Coordinates Display here --&gt;\n      &lt;div class=\"dislpay-arena\"&gt;\n        &lt;div class=\"coordinates-header\"&gt;\n          &lt;h3&gt;Current Coordinates&lt;/h3&gt;\n          &lt;p&gt;Latitude:&lt;/p&gt;\n          &lt;p&gt;Longitude:&lt;/p&gt;\n        &lt;/div&gt;\n        &lt;div class=\"coordinates-header\"&gt;\n          &lt;h3&gt;Current Location&lt;/h3&gt;\n          &lt;div class=\"form-group\"&gt;\n            &lt;input\n              type=\"text\"\n              class=\"location-control\"\n              :value=\"location\"\n              readonly\n            /&gt;\n            &lt;button type=\"button\" class=\"copy-btn\"&gt;Copy&lt;/button&gt;\n          &lt;/div&gt;\n          &lt;button type=\"button\" class=\"location-btn\"&gt;Get Location&lt;/button&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n    &lt;/div&gt;\n  &lt;/div&gt;\n&lt;/template&gt;</code></pre>\n\n<p>To see what we currently have, start your development server. For Yarn:</p>\n<pre><code>yarn serve</code></pre>\n\n<p>Or for npm:</p>\n<pre><code>npm run serve</code></pre>\n\n<p>Our app should look like this now:</p>\n<p><img src=\"https://cloud.netlifyusercontent.com/assets/344dbf88-fdf9-42bb-adb4-46f01eedd629/2db65f59-f1f9-4373-b2b1-8514d763b09d/1-building-geocoding-app-vue-mapbox.png\" /></p>\n<p>The blank spot to the left looks off. It should house our map display. Let’s add that.</p>\nInteractive Map Display With Mapbox\n<p>The first thing we need to do is gain access to the Mapbox GL and Geocoder libraries. We’ll start by importing the Mapbox GL and Geocoder libraries in the <code>Index.vue</code> file.</p>\n<pre><code>import axios from \"axios\";\nimport mapboxgl from \"mapbox-gl\";\nimport MapboxGeocoder from \"@mapbox/mapbox-gl-geocoder\";\nimport \"@mapbox/mapbox-gl-geocoder/dist/mapbox-gl-geocoder.css\";</code></pre>\n\n<p>Mapbox requires a unique <a href=\"https://docs.mapbox.com/help/glossary/access-token/\">access token</a> to compute map vector tiles. <a href=\"https://docs.mapbox.com/help/glossary/access-token/\">Get yours</a>, and add it as an environmental variable in your <code>.env</code> file.</p>\n<pre><code>.env</code></pre>\n\n<pre><code>VUE_APP_MAP_ACCESS_TOKEN=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</code></pre>\n\n<p>We also need to define properties that will help with putting our map tiles together in our data instance. Add the following below the spot where we imported the libraries:</p>\n<pre><code>export default {\n  data() {\n    return {\n      loading: false,\n      location: \"\",\n      access_token: process.env.VUE_APP_MAP_ACCESS_TOKEN,\n      center: [0, 0],\n      map: {},\n    };\n  },\n}</code></pre>\n\n<ul>\n<li>The <code>location</code> property will be modeled to the input that we have in our scaffolding. We will use this to handle reverse geocoding (i.e. display a location from the coordinates).</li>\n<li>The <code>center</code> property houses our coordinates (longitude and latitude). This is critical to putting our map tiles together, as we will see shortly.</li>\n<li>The <code>access_token</code> property refers to our environmental variable, which we added earlier.</li>\n<li>The <code>map</code> property serves as a constructor for our map component.</li>\n</ul>\n<p>Let’s proceed to create a method that plots our interactive map with our forward geocoder embedded in it. This method is our base function, serving as an intermediary between our component and Mapbox GL; we will call this method <code>createMap</code>. Add this below the data object:</p>\n<pre><code>mounted() {\n  this.createMap()\n},\n\nmethods: {\n  async createMap() {\n    try {\n      mapboxgl.accessToken = this.access_token;\n      this.map = new mapboxgl.Map({\n        container: \"map\",\n        style: \"mapbox://styles/mapbox/streets-v11\",\n        center: this.center,\n        zoom: 11,\n      });\n\n    } catch (err) {\n      console.log(\"map error\", err);\n    }\n  },\n},\n</code></pre>\n\n<p>To create our map, we’ve specified a <code>container</code> that houses the map, a <code>style</code> property for our map’s display format, and a <code>center</code> property to house our coordinates. The <code>center</code> property is an array type and holds the longitude and latitude.</p>\n<p>Mapbox GL JS initializes our map based on these parameters on the page and returns a <code>Map</code> object to us. The <code>Map</code> object refers to the map on our page, while exposing methods and properties that enable us to interact with the map. We’ve stored this returned object in our data instance, <code>this.map</code>.</p>\nForward Geocoding With Mapbox Geocoder\n<p>Now, we will add the geocoder and custom marker. The geocoder handles forward geocoding by transforming text-based locations to coordinates. This will appear in the form of a search input box appended to our map.</p>\n<p>Add the following below the <code>this.map</code> initialization that we have above:</p>\n<pre><code>let geocoder =  new MapboxGeocoder({\n    accessToken: this.access_token,\n    mapboxgl: mapboxgl,\n    marker: false,\n  });\n\nthis.map.addControl(geocoder);\n\ngeocoder.on(\"result\", (e) =&gt; {\n  const marker = new mapboxgl.Marker({\n    draggable: true,\n    color: \"#D80739\",\n  })\n    .setLngLat(e.result.center)\n    .addTo(this.map);\n  this.center = e.result.center;\n  marker.on(\"dragend\", (e) =&gt; {\n    this.center = Object.values(e.target.getLngLat());\n  });\n});</code></pre>\n\n\nHere, we’ve first created a new instance of a geocoder using the `MapboxGeocoder` constructor. This initializes a geocoder based on the parameters provided and returns an object, exposed to methods and events. The `accessToken` property refers to our Mapbox access token, and `mapboxgl` refers to the [map library](https://docs.mapbox.com/#maps) currently used.\n\nCore to our app is the custom marker; the geocoder comes with one by default. This, however, wouldn’t give us all of the customization we need; hence, we’ve disabled it.\n\nMoving along, we’ve passed our newly created geocoder as a parameter to the `addControl` method, exposed to us by our map object. `addControl` accepts a `control` as a parameter.\n\nTo create our custom marker, we’ve made use of an event exposed to us by our geocoder object. The `on` event listener enables us to subscribe to events that happen within the geocoder. It accepts various [events](https://github.com/mapbox/mapbox-gl-geocoder/blob/master/API.md#on) as parameters. We’re listening to the `result` event, which is fired when an input is set.\n\nIn a nutshell, on `result`, our marker constructor creates a marker, based on the parameters we have provided (a draggable attribute and color, in this case). It returns an object, with which we use the `setLngLat` method to get our coordinates. We append the custom marker to our existing map using the `addTo` method. Finally, we update the `center` property in our instance with the new coordinates.\n\nWe also have to track the movement of our custom marker. We’ve achieved this by using the `dragend` event listener, and we updated our `center` property with the current coordinates.\n\nLet’s update the template to display our interactive map and forward geocoder. Update the coordinates display section in our template with the following:\n\n<pre><code>&lt;div class=\"coordinates-header\"&gt;\n  &lt;h3&gt;Current Coordinates&lt;/h3&gt;\n  &lt;p&gt;Latitude: {{ center[0] }}&lt;/p&gt;\n  &lt;p&gt;Longitude: {{ center[1] }}&lt;/p&gt;\n&lt;/div&gt;\n</code></pre>\n\n<p>Remember how we always updated our <code>center</code> property following an event? We are displaying the coordinates here based on the current value.</p>\n<p>To lift our app’s aesthetics, add the following CSS file in the <code>head</code> section of the <code>index.html</code> file. Put this file in the public folder.</p>\n<div>\n<pre><code>&lt;link href=\"<a href=\"https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.css&quot;\">https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.css\"</a> rel=\"stylesheet\" /&gt;</code></pre>\n</div>\n\n<p>Our app should look like this now:</p>\n<p><img src=\"https://cloud.netlifyusercontent.com/assets/344dbf88-fdf9-42bb-adb4-46f01eedd629/94ec158a-9a69-4349-8676-38307bfda229/2-building-geocoding-app-vue-mapbox.png\" /></p>\nReverse Geocode Location With Mapbox API\n<p>Now, we will handle reverse geocoding our coordinates to text-based locations. Let’s write a method that handles that and trigger it with the <code>Get Location</code> button in our template.</p>\n<p>Reverse geocoding in Mapbox is handled by the reverse geocoding API. This accepts <code>longitude</code>, <code>latitude</code>, and <code>access token</code> as request parameters. This call returns a response payload — typically, with various details. Our concern is the first object in the <code>features</code> array, where the reverse geocoded location is.</p>\n<p>We’ll need to create a function that sends the <code>longitude</code>, <code>latitude</code> and <code>access_token</code> of the location we want to get to the Mapbox API. We need to send them in order to get the details of that location.</p>\n<p>Finally, we need to update the <code>location</code> property in our instance with the value of the <code>place_name</code> key in the object.</p>\n<p>Below the <code>createMap()</code> function, let’s add a new function that handles what we want. This is how it should look:</p>\n<div>\n<pre><code>async getLocation() {\n  try {\n    this.loading = true;\n    const response = await axios.get(\n      <code>https://api.mapbox.com/geocoding/v5/mapbox.places/${this.center[0]},${this.center[1]}.json?access_token=${this.access_token}</code>\n    );\n    this.loading = false;\n    this.location = response.data.features[0].place_name;\n  } catch (err) {\n    this.loading = false;\n    console.log(err);\n  }\n},\n</code></pre>\n</div>\n\n<p>This function makes a <code>GET</code> request to the Mapbox API. The response contains <code>place_name</code> — the name of the selected location. We get this from the response and then set it as the value of <code>this.location</code>.</p>\n<p>With that done, we need to edit and set up the button that will call this function we have created. We’ll make use of a <code>click</code> event listener — which will call the <code>getLocation</code> method when a user clicks on it. Go ahead and edit the button component to this.</p>\n<pre><code>&lt;button\n  type=\"button\"\n  :disabled=\"loading\"\n  :class=\"{ disabled: loading }\"\n  class=\"location-btn\"\n  @click=\"getLocation\"\n&gt;\n  Get Location\n&lt;/button&gt;\n</code></pre>\n\n<p>As icing on the cake, let’s attach a function to copy the displayed location to the clipboard. Add this just below the <code>getLocation</code> function:</p>\n<pre><code>copyLocation() {\n  if (this.location) {\n    navigator.clipboard.writeText(this.location);\n    alert(\"Location Copied\")\n  }\n  return;\n},\n</code></pre>\n\n<p>Update the <code>Copy</code> button component to trigger this:</p>\n<pre><code>&lt;button type=\"button\" class=\"copy-btn\" @click=\"copyLocation\"&gt;</code></pre>\n\nConclusion\n<p>In this guide, we’ve looked at geocoding using Mapbox. We built a geocoding app that transforms text-based locations to coordinates, displaying the location on an interactive map, and that converts coordinates to text-based locations, according to the user’s request. This guide is just the beginning. A lot more could be achieved with the geocoding APIs, such as changing the presentation of the map using the various <a href=\"https://docs.mapbox.com/api/maps/styles/\">map styles</a> provided by Mapbox.</p>\n<ul>\n<li><em>The source code is <a href=\"https://github.com/smashingmagazine/Tutorials/tree/Geocoding-app-vue\">available on GitHub</a>.</em></li>\n</ul>\n<h3>Resources</h3>\n<ul>\n<li>“<a href=\"https://docs.mapbox.com/api/search/geocoding/\">Geocoding</a>”, Mapbox documentation</li>\n<li>“<a href=\"https://docs.mapbox.com/api/maps/styles/\">Styles</a>”, Mapbox documentation</li>\n<li>“<a href=\"https://cli.vuejs.org/guide/mode-and-env.html#using-env-variables-in-client-side-code\">Using Env Variables in Client-Side Code</a>”, in “Modes and Environment Variables”, Vue CLI</li>\n</ul>","author":"","siteTitle":"Articles on Smashing Magazine — For Web Designers And Developers","siteHash":"ab069ca35bf300e9db0da36f49701f66485a5b0d2db0471dfeee07cef6204939","entryHash":"349b68e5e4edd3750876cb0219a1295951caa35eebbbcf7bd52a44f962add675","category":"Tech"}