{"title":"โครงการ Infisical รายงานการย้ายจาก MongoDB ไป PostgreSQL ชี้ เซ็ตอัพและหาคนดูแงง่ายกว่า ประหยัดค่าใช้จ่าย","link":"https://www.blognone.com/node/138994","date":1711856169000,"content":"<div><div><div><p>Infisical โครงการแพลตฟอร์มเก็บความลับ (secret management platform) แบบโอเพนซอร์ส รายงานถึงการย้ายระบบฐานข้อมูลจาก MongoDB มาเป็น PostgreSQL ว่าประสบความสำเร็จดีและทำให้การเซ็ตอัพโครงการใช้งานเองทำได้ง่ายขึ้น</p>\n<p>ทางโครงการระบุว่าเลือก MongoDB พร้อมกับ Mongoose ORM เพราะทีมงานเคยชินกับ stack นี้ที่สุด และตอนแรกไม่ได้คิดว่าจะมีผู้ใช้พยายามติดตั้งแพลตฟอร์มใช้งานเองมากนัก แต่หลังจากโครงการได้รับความนิยม MongoDB กลับเป็นคอขวดเนื่องจากฟีเจอร์สำคัญคือการทำ transaction จำเป็นต้องติดตั้งแบบคลัสเตอร์แบบโปรดักชั่นและคนที่เชี่ยวชาญการเซ็ตอัพ MongoDB ก็หาได้ยากกว่า  ขณะที่ฝั่งนักพัฒนาเองหลายครั้งก็อยากได้ฟีเจอร์ฝั่ง SQL เช่น CASCADE ที่สามารถลบข้อมูลที่เกี่ยวข้องออกไปพร้อมกันทีเดียวได้</p>\n<p>ปัญหาอีกอย่างหนึ่งของ MongoDB คือการเปลี่ยนไลเซนส์ไปเป็น SSPL ทำให้ผู้ให้บริการคลาวด์ไม่สามารถอัพเกรดไปใช้เวอร์ชั่นล่าสุดได้ ทำให้ผู้ใช้ของ Infisical ไม่สามารถใช้บริการฐานข้อมูลคลาวด์ได้อิสระ</p>\n<p>ทาง Infisical เลือกระหว่างการใช้ฐานข้อมูลภายใน เช่น SQLite กับฐานข้อมูลภายนอกอย่าง PostgreSQL และตัดสินใจเลือก PostgreSQL เพราะเมื่อต้องการขยายแอปพลิเคชั่นเป็นคลัสเตอร์ไม่ต้องอิมพลีเมนต์ด้วยตัวเอง สำหรับระบบ ORM นั้นโครงการเลือก Knex.js ที่เป็น query builder แทนที่จะเป็น ORM เต็มรูปแบบ เพราะต้องการควบคุมคิวรีสุดท้ายได้ แต่ยังดูแลง่ายกว่าการเขียนคิวรีเองตรงๆ</p>\n<p>กระบวนการย้ายฐานข้อมูลของ Infisical Cloud กินเวลา 6 ชั่วโมงที่ระบบจะเปิดให้ลูกค้าอ่านข้อมูลได้เท่านั้นแต่เขียนไม่ได้ ระบบจะย้ายข้อมูลไปยัง PostgreSQL แล้วตรวจสอบข้อมูลว่ายังอยู่ครบ หลังจากนั้นจึงชี้ DNS ไปยังเซิร์ฟเวอร์ใหม่ โดยรวมมีปัญหาเพียงไม่กี่รายการ และแก้ไขได้หมดภายใน 36 ชั่วโมงหลังการย้าย และเมื่อย้ายมาแล้วแอปพลิเคชั่นเสีย overhead น้อยลงทำให้ค่าใช้จ่ายฐานข้อมูลลดลง 50% ขณะที่ตัวแอปพลิเคชั่นมีการตรวจสอบข้อมูลทีี่ระดับฐานข้อมูลละเอียดขึ้น ตัดปัญหาชนิดข้อมูลไม่ตรงกันเพราะเดิมชนิดข้อมูลนั้นไปบังคับที่ระดับ Mongoose</p>\n<p>โดยรวมโครงการย้ายออกจาก MongoDB ครั้งนี้กินเวลา 3-4 เดือน และทีมงานพอใจกับการย้ายอย่างมาก แต่แนะนำว่าหากใครจะทำตามให้คิดอย่างระมัดระวังก่อนย้าย</p>\n<p>ที่มา - <a href=\"https://infisical.com/blog/postgresql-migration-technical\">Infisical</a></p>\n<p><img src=\"https://infisical.com/_next/image?url=%2Fstatic%2Fimages%2Fpostgresql-migration-technical.png&amp;w=1920&amp;q=75\" /></p>\n</div></div></div><div><div>Topics: </div><div><div><a href=\"/topics/database\">Database</a></div><div><a href=\"/topics/postgresql\">PostgreSQL</a></div><div><a href=\"/topics/mongodb\">MongoDB</a></div></div></div>","author":"lew","siteTitle":"Blognone","siteHash":"ededadcf18490b3937e7dd89ebe8c00dc129addbdf1ebe4aff1f458146693da0","entryHash":"7f57ed54915246ebb37738fc80a118de00f865fc13b592682fb892e799264b39","category":"Thai"}