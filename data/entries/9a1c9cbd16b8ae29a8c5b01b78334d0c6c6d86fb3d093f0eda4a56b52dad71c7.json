{"title":"Consul 1.19 improves Kubernetes workflows, snapshot support, and Nomad integration","link":"https://www.hashicorp.com/blog/consul-1-19-improves-kubernetes-workflows-snapshot-support-and-nomad-integration","date":1718218800000,"content":"<p>HashiCorp Consul 1.19 is now generally available, reinforcing our commitment to improve the user experience, provide more flexibility, and enhance integration points. Consul is a service networking platform that provides global service discovery across any environment. Consul’s service mesh secures and connects network services running across multiple runtimes, platforms, clouds, and on-premises datacenters. Version 1.19 improves operator workflows to connect to external services, allow multi-location storage for Consul snapshots, and support additional Consul features for HashiCorp Nomad. </p>\n\n<h2>Improved external service registration on Kubernetes</h2>\n\n<p>Consul 1.19 introduces a new <code>Registration</code> custom resource definition (CRD) that simplifies the process of registering external services into the mesh. Consul service mesh already supports routing to services outside of the mesh through <a href=\"https://developer.hashicorp.com/consul/docs/connect/gateways/terminating-gateway\">terminating gateways</a>. Those are still required, however there are advantages to using the new <code>Registration</code> CRD. </p>\n\n<p>Prior to Consul 1.19, operators registered external services into the mesh using Consul’s catalog APIs and following this three-step process:</p>\n\n<ol>\n<li>Register the service into Consul’s catalog using the HTTP API.</li>\n<li>Create and assign an access control list (ACL) policy to the terminating gateway that lets it act as a proxy for the external service.</li>\n<li>Configure the terminating gateway to act as a proxy for the external service through the terminating gateway customer resource definition (CRD).</li>\n</ol>\n\n<p>The new <code>Registration</code> CRD simplifies this process because it’s a Kubernetes-native method for registering services into Consul and automatically updating the terminating gateway ACLs. This provides operators with a consistent Kubernetes-centric workflow for registering and managing access to external services.</p>\n\n<h2>Save Consul snapshots to multiple locations</h2>\n\n<p>The latest release allows Consul snapshots to be stored in multiple destinations. This is an upgrade to the snapshot agent in Consul Enterprise, which lets users take Consul snapshots for disaster recovery or to restore to a previously known state and configuration. Prior to 1.19, users could store snapshots to either a local path or to a remote object-store destination, but not both. </p>\n\n<p>Consul 1.19 supports saving Consul snapshots to multiple destinations including NFS mounts, SAN attached storage, or object storage like Amazon S3, Google Cloud Storage, and Microsoft Azure Blob storage. This feature helps improve recovery time objectives (RTO) with higher availability that allows organizations to employ <a href=\"https://www.techtarget.com/searchdatabackup/definition/3-2-1-Backup-Strategy\">3-2-1 backup</a> strategies, which require that there are always <em>three</em> available copies stored across <em>two</em> different types of media, including <em>one</em> copy in an offsite location. </p>\n\n<h2>Improved integration with Nomad</h2>\n\n<p>Consul has long supported multiple runtimes and platforms, which allow multi-cluster service discovery and service mesh capabilities in any on-premises or cloud environment. Consul supports runtimes for Kubernetes, virtual machines, Amazon ECS, AWS Lambda, and our own cluster orchestrator: Nomad.</p>\n\n<p>Consul 1.19 further improves Nomad support with integrations for the Consul API gateway, transparent proxy, and enterprise features like admin partitions. </p>\n\n<p>Users can now deploy <strong>Consul API gateways</strong> on Nomad, letting external clients reach services inside the mesh. This includes API requests from clients across various protocols (TCP/HTTP) to the appropriate backend service. The Consul API gateway also helps with load balancing ingress traffic to backend service instances, modifying HTTP headers for requests, and splitting traffic between multiple services based on weighted ratios.</p>\n\n<p>Consul’s <strong>transparent proxy</strong> helps simplify adoption and usage of Consul service mesh. Prior to the support of transparent proxy, Consul service mesh on Nomad required addressing upstream services using the explicit address on the local proxy for the <a href=\"https://developer.hashicorp.com/nomad/docs/v1.8.x/job-specification/upstreams\"><code>upstream</code></a> service. With transparent proxy, service mesh traffic will automatically route to upstream services without requiring developers to change their application configuration.</p>\n\n<p><strong>Admin partitions</strong> provide multi-tenancy, allowing multiple teams to autonomously manage their application services. Admin partitions reduce overall management tasks and costs at scale by consolidating workloads across shared Consul and Nomad control planes. Admin partitions also simplify service discovery and traffic communication between multiple clouds and runtimes.</p>\n\n<h2>Learn more about Consul 1.19</h2>\n\n<p>The latest Consul release provides significant improvements in many areas: Operators can more easily register and connect to external services. Options to store concurrent snapshots in multiple locations help improve availability. Nomad now has first-class feature support, similar to other runtimes, including Kubernetes and VMs. We are excited for customers to try out these new capabilities.</p>\n\n<p>For details on registering external services using the new <code>Registration</code> CRD, please refer to the updated <a href=\"https://developer.hashicorp.com/consul/docs/k8s/deployment-configurations/external-service\">Consul documentation</a>.</p>\n\n<p>More details on the Consul integration with Nomad are available in the <a href=\"https://www.hashicorp.com/blog/nomad-1-8-adds-exec2-task-driver-support-consul-api-gateway-transparent-proxy\">Nomad 1.8 release blog</a>. A tutorial showing how to deploy <a href=\"https://developer.hashicorp.com/nomad/tutorials/integrate-consul/deploy-api-gateway-on-nomad\">Consul API gateway on Nomad</a> is also available. </p>\n\n<p>Get started with HashiCorp Consul through our many <a href=\"https://developer.hashicorp.com/consul/tutorials\">tutorials</a> for both beginners and advanced users. You can start a free trial with <a href=\"https://portal.cloud.hashicorp.com/sign-up\">HCP Consul</a> or <a href=\"https://www.hashicorp.com/products/consul/trial\">self-managed Consul Enterprise</a> to test out commercial features like snapshot agent and admin partitions.</p>\n","author":"Blake Covarrubias","siteTitle":"HashiCorp Blog","siteHash":"219aa6310b3388f2335eba49871f4df9581f2c58eaeb5e498363b54e835b7001","entryHash":"9a1c9cbd16b8ae29a8c5b01b78334d0c6c6d86fb3d093f0eda4a56b52dad71c7","category":"Tech"}