{"title":"สรุปจากการอ่านบทความ How Quora scaled MySQL to 100k+ Queries Per Second ?","link":"https://www.somkiat.cc/note-from-how-quora-scaled-mysql/","date":1692502811000,"content":"<p><img width=\"150\" height=\"150\" src=\"https://www.somkiat.cc/wp-content/uploads/2023/08/scale-database-150x150.png\" alt loading=\"lazy\" srcset=\"https://www.somkiat.cc/wp-content/uploads/2023/08/scale-database-150x150.png 150w, https://www.somkiat.cc/wp-content/uploads/2023/08/scale-database-75x75.png 75w\" /></p>\n<figure><a href=\"https://www.somkiat.cc/wp-content/uploads/2023/08/scale-database.png\"><img src=\"https://www.somkiat.cc/wp-content/uploads/2023/08/scale-database.png\" alt width=\"587\" height=\"334\" /></a></figure>\n\n\n\n<p>เห็นใน feed มีการ share บทความเรื่อง <a href=\"https://blog.quastor.org/p/quora-scaled-mysql-100k-queries-per-second\" target=\"_blank\">How Quora scaled MySQL to 100k+ Queries Per Second</a><br />เป็นการ scale MySQL database ของระบบ <a href=\"https://www.quora.com/\">Quora</a><br />ซึ่งเป็นระบบถามตอบปัญหาต่าง ๆ นั่นเอง<br />โดยมีการใช้งานคร่าว ๆ คือ</p>\n\n\n\n<ul>\n<li>ผู้ใช้งานจำนวน 300 ล้านคนต่อเดือน</li>\n\n\n\n<li>มีการ post คำถามประมาณ 10,000 post ต่อวัน</li>\n</ul>\n\n\n\n<p>ข้อมูลต่าง ๆ จะเก็บไว้ใน MySQL นั่นเอง<br />ดังนั้นมาดูกันว่าทางระบบทำการ scale กันอย่างไร</p>\n\n\n\n<span></span>\n\n\n\n<p><strong>ในการจัดการนั้น จะแบ่งออกเป็น 3 เรื่องตามรูปแบบของการใช้งาน</strong></p>\n\n\n\n<ul>\n<li>จำนวนการอ่านข้อมูล (Select)</li>\n\n\n\n<li>จำนวนการเขียนข้อมูล (Insert, Update, Delete)</li>\n\n\n\n<li>ขนาดของข้อมูลที่จัดเก็บ</li>\n</ul>\n\n\n\n<p>มารายละเอียดแต่ละหัวข้อดังนี้</p>\n\n\n\n<p><strong>เรื่องที่ 1 จำนวนการอ่านข้อมูล (Select)</strong></p>\n\n\n\n<p>เนื่องจากระบบ Quora นั้นมีอัตราการอ่านข้อมูลที่สูงมาก ๆ<br />การ scale ด้านอ่านข้อมูลจึงสำคัญมาก ๆ<br />ซึ่งจะแบ่งการจัดการหรือปรับปรุงเป็น 2 เรื่องหลัก ๆ คือ</p>\n\n\n\n<ul>\n<li>Query ที่ซับซ้อน เนื่องจากใช้งาน CPU สูงมาก ๆ รวมไปถึงการ join ที่เยอะ ๆ (ลูกอีช่าง join) และการ aggregate ข้อมูล (group by) รวมทั้งการดึงข้อมูลใน table ที่มีจำนวน row เยอะ</li>\n\n\n\n<li>ในเรื่องหนึ่ง ๆ มีจำนวนการดึงข้อมูลที่สูง หรือ บ่อย ๆ ต้องทำการขยาย หรือ เพิ่มเครื่อง หรือต้องมีการทำ caching ขึ้นมา</li>\n</ul>\n\n\n\n<p>โดยรวม ๆ แล้ว ต้องให้ database ทำงานเท่าที่จำเป็นเท่านั้น<br />ไม่ควรให้ทำงานอะไรที่เยอะเกินไป<br />ยกตัวอย่างเช่น </p>\n\n\n\n<ul>\n<li>ถ้าต้อง join เยอะ ๆ ก็ลดการ join ด้วยการทำ pre-aggregation/join ไว้ก่อนดีกว่าไหม</li>\n\n\n\n<li>ใช้งาน paging เพื่อลดการดูข้อมูลลงไป</li>\n</ul>\n\n\n\n<p>ส่วนในการใช้งาน caching ก็ต้องระวังการ cache ที่ไม่ดีด้วยเช่นกัน<br />ไม่ใช่ต้อง caching ข้อมูลทั้งหมดเสมอไป</p>\n\n\n\n<p>ใน table ใด มีข้อมูลที่เยอะ ๆ ก็ต้องระวัง<br />เพราะว่า เปลือง resource มาก ๆ performance ก็แย่<br />การ backup ก็ลำบาก<br />ดังนั้น ต้องเข้าใจก่อนว่าข้อมูลอะไรที่ต้องการใช้งาน หรือ ใช้งานจริง ๆ<br />อะไรที่ไม่ใช้ก็ลบทิ้งไปบ้าง (retention policy)<br />หรือต้อง split ข้อมูลเป็นกลุ่ม ๆ ตามการใช้งานเป็นต้น</p>\n\n\n\n<p><strong><em>ส่วนเรื่องการจัดการ storage ของ database จะใช้งาน <a href=\"https://rocksdb.org/\" target=\"_blank\">RockDB</a></em></strong></p>\n\n\n\n<p><strong>เรื่องที่ 2 จำนวนการเขียนข้อมูล (Insert, Update, Delete)</strong></p>\n\n\n\n<p>ในระบบมีการเขียนข้อมูลที่ไม่เยอะมากนัก<br />โดย MySQL จะเป็น cluster (master/slave)<br />ก็ยังมีปัญหาการ sync ข้อมูลจาก master ไปยัง slave ที่ช้า เมื่อมีการใช้งานเยอะขึ้น<br />เลยปรับมาใช้การ sunc แบบ parallel แทน<br />ถ้าส่วนงานไหนที่ต้องเขียนเยอะ ๆ จะใช้งาน HBase แทน<br />รายละเอียดการ <a href=\"https://quoraengineering.quora.com/Optimizing-the-databases-at-Quora\" target=\"_blank\">optimize database</a> เพิ่มเติม</p>\n\n\n\n<figure><a href=\"https://www.somkiat.cc/wp-content/uploads/2023/08/main-qimg-5091b62e88ef85eeaa94a2722cb77b30.webp\"><img src=\"https://www.somkiat.cc/wp-content/uploads/2023/08/main-qimg-5091b62e88ef85eeaa94a2722cb77b30.webp\" alt width=\"551\" height=\"314\" /></a></figure>\n\n\n\n<p></p>\n\n\n\n<p><strong>Reference Websites</strong></p>\n\n\n\n<ul>\n<li><a href=\"https://quoraengineering.quora.com/MySQL-sharding-at-Quora\" target=\"_blank\">MySQL sharding at Quora</a></li>\n\n\n\n<li><a href=\"https://quoraengineering.quora.com/Optimizing-the-databases-at-Quora\" target=\"_blank\">Optimizing the databases at Quora</a></li>\n</ul>\n","author":"somkiat","siteTitle":"cc :: somkiat","siteHash":"3a23a5a4389e1e40c6fbb16520a8cc20df5b3591c25145ce72aaa18b19e48201","entryHash":"594e14b56bbaa8c129114f50e9f9ed5b546214b31a8e8ac2ea35de0c99cf0670","category":"Thai"}