{"title":"[Go] มาดูสิ่งที่น่าสนใจใน Echo framework","link":"https://www.somkiat.cc/go-with-echo-framework/","date":1632560310000,"content":"<div id=\"readability-page-1\" class=\"page\"><div id=\"page\"><article><div id=\"content_box\"><header><div><p><time>September 25, 2021</time> <span><a href=\"https://www.somkiat.cc/category/programming/\" rel=\"category tag\">Programming</a></span></p></div></header><div><figure><img src=\"https://www.somkiat.cc/wp-content/uploads/2021/09/go-echo-1024x581.png\" alt=\"\" width=\"485\" height=\"275\" srcset=\"https://www.somkiat.cc/wp-content/uploads/2021/09/go-echo-1024x581.png 1024w, https://www.somkiat.cc/wp-content/uploads/2021/09/go-echo-300x170.png 300w, https://www.somkiat.cc/wp-content/uploads/2021/09/go-echo-768x436.png 768w, https://www.somkiat.cc/wp-content/uploads/2021/09/go-echo.png 1508w\" sizes=\"(max-width: 485px) 100vw, 485px\"></figure><p>จากการพัฒนาระบบงานหนึ่งอยู่<br>เพิ่งสังเกตเห็นว่า <strong><a href=\"https://github.com/labstack/echo/releases/tag/v4.6.0\" target=\"_blank\" rel=\"noreferrer noopener\">Echo framework 4.6.0</a></strong> ออกมาแล้ว<br>ซึ่งเป็น web framework สำหรับการพัฒนา web/api ด้วยภาษา Go<br>โดยใน version นี้ได้เพิ่มความสามารถใหม่มา<br>คือ <strong><a href=\"https://github.com/labstack/echo/blob/master/middleware/request_logger.go\" target=\"_blank\" rel=\"noreferrer noopener\">Request Logger middleware</a></strong><br>ช่วยทำให้การจัดการ log รวมทั้งการใช้งาน log library อื่น ๆ ได้ง่ายขึ้น<br>มาดูตัวอย่างการใช้งานกันนิดหน่อย</p><div itemprop=\"text\" id=\"gist112009128\" translate=\"no\"><table data-tab-size=\"8\" data-paste-markdown-skip=\"\"><tbody><tr><td id=\"file-1-txt-L1\" data-line-number=\"1\"></td><td id=\"file-1-txt-LC1\">go mod tidy</td></tr><tr><td id=\"file-1-txt-L2\" data-line-number=\"2\"></td><td id=\"file-1-txt-LC2\">go: finding module for package github.com/labstack/echo/v4/middleware</td></tr><tr><td id=\"file-1-txt-L3\" data-line-number=\"3\"></td><td id=\"file-1-txt-LC3\">go: finding module for package github.com/labstack/echo/v4</td></tr><tr><td id=\"file-1-txt-L4\" data-line-number=\"4\"></td><td id=\"file-1-txt-LC4\">go: found github.com/labstack/echo/v4 in github.com/labstack/echo/v4 v4.6.0</td></tr><tr><td id=\"file-1-txt-L5\" data-line-number=\"5\"></td><td id=\"file-1-txt-LC5\">go: found github.com/labstack/echo/v4/middleware in github.com/labstack/echo/v4 v4.6.0</td></tr></tbody></table></div><p><strong>จากนั้นสามารถเปลี่ยน log library ได้เลย</strong><br>ไม่ว่าจะเป็น zap หรือ logrus ก็ได้ ตามที่ต้องการ<br>เนื่องจาก Echo 4.6.0 ได้เตรียมไว้ให้ดังนี้</p><div itemprop=\"text\" id=\"gist112009128\" translate=\"no\"><table data-tab-size=\"8\" data-paste-markdown-skip=\"\"><tbody><tr><td id=\"file-logger-go-L1\" data-line-number=\"1\"></td><td id=\"file-logger-go-LC1\"><span>func</span> <span>Logger</span>() echo.<span>MiddlewareFunc</span> {</td></tr><tr><td id=\"file-logger-go-L2\" data-line-number=\"2\"></td><td id=\"file-logger-go-LC2\"><span>return</span> <span>LoggerWithConfig</span>(<span>DefaultLoggerConfig</span>)</td></tr><tr><td id=\"file-logger-go-L3\" data-line-number=\"3\"></td><td id=\"file-logger-go-LC3\">}</td></tr><tr><td id=\"file-logger-go-L4\" data-line-number=\"4\"></td><td id=\"file-logger-go-LC4\"></td></tr><tr><td id=\"file-logger-go-L5\" data-line-number=\"5\"></td><td id=\"file-logger-go-LC5\"><span>// LoggerWithConfig returns a Logger middleware with config.</span></td></tr><tr><td id=\"file-logger-go-L6\" data-line-number=\"6\"></td><td id=\"file-logger-go-LC6\"><span>// See: `Logger()`.</span></td></tr><tr><td id=\"file-logger-go-L7\" data-line-number=\"7\"></td><td id=\"file-logger-go-LC7\"><span>func</span> <span>LoggerWithConfig</span>(<span>config</span> <span>LoggerConfig</span>) echo.<span>MiddlewareFunc</span> {</td></tr><tr><td id=\"file-logger-go-L8\" data-line-number=\"8\"></td><td id=\"file-logger-go-LC8\"><span>// Defaults</span></td></tr><tr><td id=\"file-logger-go-L9\" data-line-number=\"9\"></td><td id=\"file-logger-go-LC9\"><span>if</span> <span>config</span>.<span>Skipper</span> <span>==</span> <span>nil</span> {</td></tr><tr><td id=\"file-logger-go-L10\" data-line-number=\"10\"></td><td id=\"file-logger-go-LC10\"><span>config</span>.<span>Skipper</span> <span>=</span> <span>DefaultLoggerConfig</span>.<span>Skipper</span></td></tr><tr><td id=\"file-logger-go-L11\" data-line-number=\"11\"></td><td id=\"file-logger-go-LC11\">}</td></tr><tr><td id=\"file-logger-go-L12\" data-line-number=\"12\"></td><td id=\"file-logger-go-LC12\"><span>if</span> <span>config</span>.<span>Format</span> <span>==</span> <span>\"\"</span> {</td></tr><tr><td id=\"file-logger-go-L13\" data-line-number=\"13\"></td><td id=\"file-logger-go-LC13\"><span>config</span>.<span>Format</span> <span>=</span> <span>DefaultLoggerConfig</span>.<span>Format</span></td></tr><tr><td id=\"file-logger-go-L14\" data-line-number=\"14\"></td><td id=\"file-logger-go-LC14\">}</td></tr><tr><td id=\"file-logger-go-L15\" data-line-number=\"15\"></td><td id=\"file-logger-go-LC15\"><span>if</span> <span>config</span>.<span>Output</span> <span>==</span> <span>nil</span> {</td></tr><tr><td id=\"file-logger-go-L16\" data-line-number=\"16\"></td><td id=\"file-logger-go-LC16\"><span>config</span>.<span>Output</span> <span>=</span> <span>DefaultLoggerConfig</span>.<span>Output</span></td></tr><tr><td id=\"file-logger-go-L17\" data-line-number=\"17\"></td><td id=\"file-logger-go-LC17\">}</td></tr><tr><td id=\"file-logger-go-L18\" data-line-number=\"18\"></td><td id=\"file-logger-go-LC18\"></td></tr><tr><td id=\"file-logger-go-L19\" data-line-number=\"19\"></td><td id=\"file-logger-go-LC19\"><span>config</span>.<span>template</span> <span>=</span> <span>fasttemplate</span>.<span>New</span>(<span>config</span>.<span>Format</span>, <span>\"${\"</span>, <span>\"}\"</span>)</td></tr><tr><td id=\"file-logger-go-L20\" data-line-number=\"20\"></td><td id=\"file-logger-go-LC20\"><span>config</span>.<span>colorer</span> <span>=</span> <span>color</span>.<span>New</span>()</td></tr><tr><td id=\"file-logger-go-L21\" data-line-number=\"21\"></td><td id=\"file-logger-go-LC21\"><span>config</span>.<span>colorer</span>.<span>SetOutput</span>(<span>config</span>.<span>Output</span>)</td></tr><tr><td id=\"file-logger-go-L22\" data-line-number=\"22\"></td><td id=\"file-logger-go-LC22\"><span>config</span>.<span>pool</span> <span>=</span> <span>&amp;</span>sync.<span>Pool</span>{</td></tr><tr><td id=\"file-logger-go-L23\" data-line-number=\"23\"></td><td id=\"file-logger-go-LC23\"><span>New</span>: <span>func</span>() <span>interface</span>{} {</td></tr><tr><td id=\"file-logger-go-L24\" data-line-number=\"24\"></td><td id=\"file-logger-go-LC24\"><span>return</span> <span>bytes</span>.<span>NewBuffer</span>(<span>make</span>([]<span>byte</span>, <span>256</span>))</td></tr><tr><td id=\"file-logger-go-L25\" data-line-number=\"25\"></td><td id=\"file-logger-go-LC25\">},</td></tr><tr><td id=\"file-logger-go-L26\" data-line-number=\"26\"></td><td id=\"file-logger-go-LC26\">}</td></tr></tbody></table></div><p>ใครที่ยังใช้ Echo 4.5 อยู่ ก็ทำการ upgrade ได้แล้ว<br>และอย่าลืม <strong>$go test ./…</strong> ด้วยนะ</p></div><div><p><img alt=\"\" src=\"https://secure.gravatar.com/avatar/e5cb9aad7bf4f0e43462bd51d6ff7021?s=90&amp;d=mm&amp;r=g\" srcset=\"https://secure.gravatar.com/avatar/e5cb9aad7bf4f0e43462bd51d6ff7021?s=180&amp;d=mm&amp;r=g 2x\" height=\"90\" width=\"90\"></p><h4>Article by <a href=\"https://www.facebook.com/somkiatspns\">Somkiat Puisungnoen</a></h4><p>To be Craftmanship</p></div></div></article></div></div>","author":"somkiat","siteTitle":"cc :: somkiat","siteHash":"3a23a5a4389e1e40c6fbb16520a8cc20df5b3591c25145ce72aaa18b19e48201","entryHash":"1a88cbc88e0cbc26f40b258c1f6d1a97aba248cd01a62fd02a9758a27982d723","category":"Thai"}