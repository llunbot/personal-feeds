{"title":"Terraform 1.10 improves handling secrets in state with ephemeral values","link":"https://www.hashicorp.com/blog/terraform-1-10-improves-handling-secrets-in-state-with-ephemeral-values","date":1732730400000,"content":"<p>Today, we are announcing the general availability of HashiCorp Terraform 1.10, which is <a href=\"https://developer.hashicorp.com/terraform/install?product_intent=terraform\">ready for download</a> and immediately available for use in <a href=\"https://www.hashicorp.com/products/terraform\">HCP Terraform</a>. This version introduces ephemeral values, for secure secrets handling and other improvements. </p>\n\n<h2>Ephemeral values to enable secure handling of secrets</h2>\n\n<p>Terraform’s management of infrastructure involves handling secrets, such as private keys, certifications, API tokens, etc. As an example, a data source may be used to fetch a secret and write it to a managed resource’s attribute. Or a secret is generated by a resource type (e.g. a random password) and is written to another resource type like a dedicated secrets manager. </p>\n\n<p>Today, these secrets get persisted in the plan or state file. Since the secrets are stored in plaintext within these artifacts, any mismanaged access to the files would compromise the secrets. We’ve been working on a feature to improve the security of this workflow, and it’s now ready for Terraform 1.10.. </p>\n\n<p>To enable secure handling of secrets, we’re introducing ephemeral values. These values are not stored in any artifact. Not the plan file or the statefile. They are not expected to remain consistent from plan to apply, or from one plan/apply round to the next. Ephemeral values encompass the following language constructs:</p>\n\n<ul>\n<li><strong>Ephemeral input variables and output variables:</strong> Similar to marking a value as <code>sensitive</code>, you can now mark the input variables and output variables as <code>ephemeral</code>. Marking an input variable as <code>ephemeral</code> is useful for data that only needs to exist temporarily, such as a short-lived token or session identifier.</li>\n<li><strong>Ephemeral resources:</strong> A new third resource mode alongside managed resource types and data resources. These are declared with <code>ephemeral</code> blocks, which declare that something needs to be created or fetched separately for each Terraform phase, then used to configure some other ephemeral object, and then explicitly closed before the end of the phase.</li>\n<li><strong>Managed resources’ write-only attribute:</strong> A new attribute for managed resources, which has a property that can only be written to, not read. Write-only attributes will be available in Terraform 1.11.</li>\n</ul>\n\n<p>Ephemeral values represent an advancement in how Terraform helps you manage your infrastructure. Whether you are using it to generate credentials, fetch a token, or setting up a temporary network tunnel, ephemeral values will ensure that these values are not persisted in Terraform artifacts. </p>\n\n<h3>Ephemeral values in practice</h3>\n\n<p>In this example, an ephemeral resource is being used to fetch a secret from AWS Secrets Manager, which is then used to initialize the PostgresSQL provider. Before Terraform 1.10, a data source was used to fetch the secret, in which case the secret value would be stored in both the plan and state file. With the introduction of ephemeral values, the secret is now kept secure because it is no longer stored in any artifact.</p>\n<pre><code>provider \"aws\" {\n  region = \"eu-west-2\"\n}\n\ndata \"aws_db_instance\" \"example\" {\n  db_instance_identifier = \"testdbinstance\"\n}\n\nephemeral \"aws_secretsmanager_secret_version\" \"db_master\" {\n  secret_id = data.aws_db_instance.example.master_user_secret[0].secret_arn\n}\n\nlocals {\n  credentials = jsondecode(ephemeral.aws_secretsmanager_secret.db_master.secret_string)\n}\n\nprovider \"postgresql\" {\n  host     = data.aws_db_instance.example.address\n  port     = data.aws_db_instance.example.port\n  username = local.credentials[\"username\"]\n  password = local.credentials[\"password\"]\n}\n\nresource \"postgresql_database\" \"db\" {\n  name = \"new_db\"\n}</code></pre><h2>Available in Terraform 1.10</h2>\n\n<p>The Terraform 1.10 release includes ephemeral input and output variables, ephemeral resources, and new functions (<code>ephemeralasnull</code>, <code>terraform.applying</code>). There are currently ephemeral resources available for three different providers:</p>\n\n<ul>\n<li><strong>AWS:</strong> <code>aws_secretsmanager_secret_version</code>, <code>aws_lambda_invocation</code></li>\n<li><strong>Azure:</strong> <code>azurerm_key_vault_secret, azurerm_key_vault_certificate</code></li>\n<li><strong>Kubernetes:</strong> <code>kubernetes_token_request</code>, <code>kubernetes_certificate_signing_request</code></li>\n</ul>\n\n<p>Ephemeral resources are currently available in the AWS, Azure, Kubernetes, and <a href=\"https://registry.terraform.io/providers/hashicorp/random/latest/docs\">random</a> providers, and will be supported in the Google Cloud  provider on December 9th. Ephemeral resources in Google Cloud will include:</p>\n\n<ul>\n<li><strong>Google Cloud:</strong> <code>google_service_account_access_token</code>, <code>google_service_account_id_token</code>, <code>google_service_account_jwt</code>, <code>google_service_account_key</code></li>\n</ul>\n\n<h2>Other improvements and next steps</h2>\n\n<p>Terraform 1.10 also includes other enhancements outlined in the <a href=\"https://github.com/hashicorp/terraform/blob/v1.10/CHANGELOG.md\">changelog</a>. One key inclusion is more performance improvements:</p>\n\n<ul>\n<li><strong>Performance improvements:</strong> We refactored plan changes and reduced repeated decoding in resource state to improve plan and apply performances. This will help mitigate performance issues when a large number of resource instances are evaluated.</li>\n</ul>\n\n<p>To get started with HashiCorp Terraform:</p>\n\n<ul>\n<li><a href=\"https://developer.hashicorp.com/terraform/downloads\">Download Terraform 1.10</a></li>\n<li><a href=\"https://app.terraform.io/public/signup/account\">Sign up for a free HCP Terraform account</a></li>\n<li><a href=\"https://developer.hashicorp.com/terraform/language/v1.10.x/upgrade-guides\">Read the Terraform 1.10 upgrade guide</a></li>\n<li>Get hands-on with tutorials at <a href=\"https://developer.hashicorp.com/terraform/tutorials\">HashiCorp Developer</a></li>\n</ul>\n\n<p>As always, this release wouldn't have been possible without the great community feedback we've received via GitHub issues, HashiCorp Discuss forums, and from our customers. Thank you!</p>\n","author":"Garvita Rai","siteTitle":"HashiCorp Blog","siteHash":"219aa6310b3388f2335eba49871f4df9581f2c58eaeb5e498363b54e835b7001","entryHash":"4f1ea90ed4ae63329d0f114c0344b851cfb12de016ce8379ba56aeeeed9121c1","category":"Tech"}