{"title":"Build faster, more cost-efficient, highly accurate models with Amazon Bedrock Model Distillation (preview)","link":"https://aws.amazon.com/blogs/aws/build-faster-more-cost-efficient-highly-accurate-models-with-amazon-bedrock-model-distillation-preview/","date":1733246362000,"content":"<p>Today, we’re announcing the availability of <a href=\"https://aws.amazon.com/bedrock/model-distillation/\">Amazon Bedrock Model Distillation</a> in preview that automates the process of creating a distilled model for your specific use case by generating responses from a <a href=\"https://aws.amazon.com/what-is/foundation-models/\">large foundation model</a> (FM) called a teacher model and fine-tunes a smaller FM called a student model with the generated responses. It uses data synthesis techniques to improve response from a teacher model. Amazon Bedrock then hosts the final distilled model for inference giving you a faster and more cost-efficient model with accuracy close to the teacher model, for your use case.</p> \n<p>Customers are excited to use the most powerful and accurate FMs on Amazon Bedrock for their <a href=\"https://aws.amazon.com/ai/generative-ai/\">generative AI</a> applications. But for some use cases, the latency associated with these models isn’t ideal. In addition, customers are looking for better price performance as they scale their generative AI applications to many billions of user interactions. To reduce latency and be more cost-efficient for their use case, customers are turning to smaller models. However, for some use cases, smaller models can’t provide optimal accuracy. Fine-tuning models requires an additional skillset to create the high-quality labeled datasets to increase model accuracy for customer’s use cases.</p> \n<p>With Amazon Bedrock Model Distillation, you can increase the accuracy of a smaller-sized student model to mimic a higher-performance teacher model with the process of knowledge transfer. You can create distilled models that for a certain use case, are up to five times faster and up to 75 percent less expensive than original large models, with less than two percent accuracy loss for use cases such as <a href=\"https://aws.amazon.com/what-is/retrieval-augmented-generation/\">Retrieval Augmented Generation</a> (RAG), by transferring knowledge from a teacher model of your choice to a student model in the same family.</p> \n<p><strong><u>How does it work?</u></strong><br /> Amazon Bedrock Model Distillation generates responses from teacher models, improves response generation from a teacher model by adding proprietary data synthesis, and fine-tunes a student model.</p> \n<p><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/11/30/2024-bedrock-model-distillation-1-diagram.jpg\" width=\"1800\" height=\"627\" />Amazon Bedrock employs various data synthesis techniques to enhance response generation from the teacher model and create high-quality fine-tuning datasets. These techniques are tailored to specific use cases. For instance, Amazon Bedrock may augment the training dataset by generating similar prompts, effectively increasing the volume of the fine-tuning dataset.</p> \n<p>Alternatively, it can produce high-quality teacher responses by using provided prompt-response pairs as golden examples. At preview, Amazon Bedrock Model Distillation supports Anthropic, Meta, and Amazon models.</p> \n<p><u><strong>Get started with Amazon Bedrock Model Distillation</strong></u><br /> To get started, go to the <a href=\"https://console.aws.amazon.com/bedrock\">Amazon Bedrock console</a> and choose Custom models in the left navigation pane. Now you have three customization methods: Fine-tuning, Distillation, and Continued pre-training.</p> \n<p>Choose <strong>Create Distillation job</strong> to start fine-tuning your model using model distillation.</p> \n<p><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/11/30/2024-bedrock-model-distillation-2-custom-models-1.png\" width=\"2516\" height=\"1384\" /></p> \n<p>Enter your distilled model name and job name.</p> \n<p><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/11/26/2024-bedrock-model-distillation-3-create-model-name.png\" width=\"1664\" height=\"1232\" /></p> \n<p>Then, choose the teacher model and, based on your choice of the teacher model, select a student model from the list of available student models. The teacher and the student model must be from the same family. For example, if you choose Meta Llama 3.1 405B Instruct model as a teacher model, you can only choose either Llama 3.1 70B or 8B Instruct model as a student model.</p> \n<p><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/11/26/2024-bedrock-model-distillation-3-create-model-select.png\" width=\"1654\" height=\"938\" /></p> \n<p>To generate synthetic data, set the value of <strong>Max response length</strong>, an inference parameter to determine the response generated by the teacher model. Choose the distillation input dataset located in your <a href=\"https://aws.amazon.com/s3\">Amazon Simple Storage Service (Amazon S3)</a> bucket. This input dataset presents the prompts or golden prompt-response pairs for your use case. The input files must be in the dataset format according to your model. To learn more, visit <a href=\"https://docs.aws.amazon.com/bedrock/latest/userguide/model-customization-prepare.html\">Prepare the datasets</a> in the Amazon Bedrock User Guide.</p> \n<p><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/11/26/2024-bedrock-model-distillation-3-create-model-synthetic-data.png\" width=\"1660\" height=\"1050\" /></p> \n<p>Then, choose <strong>Create Distillation job</strong> after setting up the Amazon S3 location to store the distillation output metrics data and permissions to write to Amazon S3 on your behalf.</p> \n<p><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/11/26/2024-bedrock-model-distillation-3-create-model-others.png\" width=\"1670\" height=\"1264\" /></p> \n<p>After the distillation job is created successfully, you can track the training progress on the <strong>Jobs</strong> tab, and the model will be available on the <strong>Models</strong> tab.</p> \n<p><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/11/26/2024-bedrock-model-distillation-4-job-list.png\" width=\"2106\" height=\"720\" /></p> \n<p><strong><u>Using production data with Amazon Bedrock Model Distillation</u></strong><br /> If you want to reuse your production data for distillation and skip generating teacher responses again, you do so by turning on model invocation logging to collect invocation logs, model input data, and model output data for all invocations in your AWS account used in Amazon Bedrock. Adding request metadata helps you to easily filter invocation logs at a later point.</p> \n<pre><code>request_params = {\n    'modelId': 'meta.llama3-1-405b-instruct-v1:0',\n    'messages': [\n        {\n            'role': 'user',\n            'content': [\n                {\n                    \"text\": \"What is model distillation in generative AI?\"\n                }\n            ]\n        }\n    },\n    'requestMetadata': {\n    \"ProjectName\": \"myLlamaDistilledModel\",\n    \"CodeName\": \"myDistilledCode\"\n    }\n}\nresponse = bedrock_runtime_client.converse(**request_params)\npprint(response)\n---\n'output': {'message': {'content': [{'text': '\\n''\\n'\n    'Model distillation is a technique in generative AI that involves training a smaller,'\n    'more efficient model (the '\"student\") to mimic the behavior of a larger, '\n    'more complex model '(the \"teacher\"). The goal of model distillation is to'\n    'transfer the knowledge and capabilities of the teacher model to the student model,'\n    'allowing the student to perform similarly well on a given task, but with much less computational'\n    'resources and memory.\\n'\n    '\\n'}]\n    }\n}</code></pre> \n<p>Next, when using Amazon Bedrock Model Distillation, select a teacher model whose accuracy you want to aim for your use case and a student model that you want to fine-tune. Then give access to Amazon Bedrock to read your invocation logs. Here, you can specify the request metadata filters so that only specific logs, which are valid for your use case, are read to fine-tune the student model. The teacher model selected for distillation and the model used in the invocation logs must be the same if you want Amazon Bedrock to reuse the responses from invocation logs.</p> \n<p><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/11/26/2024-bedrock-model-distillation-5-synthetic-data-invocations.png\" width=\"1662\" height=\"1638\" /></p> \n<p><strong><u>Inference from your distilled model</u></strong><br /> Before using the distilled model, you need to purchase <a href=\"https://docs.aws.amazon.com/bedrock/latest/userguide/prov-throughput.html\">Provisioned Throughput for Amazon Bedrock</a> and then use the resulting distilled model for inference. When you purchase Provisioned Throughput, you can select a commitment term, choose the number of model units, and check estimated hourly, daily, and monthly costs.</p> \n<p><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2024/11/26/2024-bedrock-model-distillation-6-inference.png\" width=\"1686\" height=\"936\" /></p> \n<p>You can complete the model distillation job using <a href=\"https://docs.aws.amazon.com/bedrock/latest/APIReference/welcome.html\">AWS APIs</a>, <a href=\"https://aws.amazon.com/developer/tools/\">AWS SDKs</a>, or the <a href=\"https://aws.amazon.com/cli\">AWS Command Line Interface (AWS CLI)</a>. To learn more about using the AWS CLI, visit <a href=\"https://docs.aws.amazon.com/bedrock/latest/userguide/model-customization-code-samples.html\">Code samples for model customization</a> in the AWS documentation.</p> \n<p><strong><u>Things to know</u></strong><br /> Here are a few important things to know.</p> \n<ul> \n <li>Model distillation aims to increase the accuracy of the student model to match the performance of the teacher model for your specific use case. Before you begin model distillation, we recommend that you evaluate different teacher models for your use case and select the teacher model that works well for your use case.</li> \n <li>We recommend optimizing your prompts for your use case against which you find the teacher model accuracy to be acceptable. Submit these prompts as the distillation input data.</li> \n <li>To choose a corresponding student model to fine-tune, evaluate the latency profiles of different student model options for your use case. The final distilled model will have the same latency profile as the student model that you select.</li> \n <li>If a specific student model already performs well for your use case, then we recommend using the student model as is instead of creating a distilled model.</li> \n</ul> \n<p><strong><u>Join the preview!</u></strong><br /> <a href=\"https://aws.amazon.com/bedrock/model-distillation/\">Amazon Bedrock Model Distillation</a> is now available in preview in the US East (N. Virginia) and US West (Oregon) <a href=\"https://docs.aws.amazon.com/glossary/latest/reference/glos-chap.html#region\">AWS Regions</a>. Check the <a href=\"https://docs.aws.amazon.com/bedrock/latest/userguide/models-regions.html\">full Region list</a> for future updates. To learn more, visit <a href=\"https://docs.aws.amazon.com/bedrock/latest/userguide/model-distillation.html\">Model Distillation</a> in the Amazon Bedrock User Guide.</p> \n<p>You pay the cost to generate synthetic data by the teacher model and the cost to fine-tune the student model during model distillation. After the distilled model is created, you pay the cost to store the distilled model monthly. Inference from the distilled model is charged under Provisioned Throughput per hour per model unit. To learn more, visit the <a href=\"http://aws.amazon.com/bedrock/pricing\">Amazon Bedrock Pricing</a> page.</p> \n<p>Give Amazon Bedrock Model Distillation a try in the <a href=\"https://console.amazon.com/bedrock/home#custom-models\">Amazon Bedrock console</a> today and send feedback to <a href=\"https://repost.aws/tags/TAQeKlaPaNRQ2tWB6P7KrMag/amazon-bedrock\">AWS re:Post for Amazon Bedrock</a> or through your usual AWS Support contacts.</p> \n<p>— <a href=\"https://twitter.com/channyun\">Channy</a></p>","author":"Channy Yun (윤석찬)","siteTitle":"AWS News Blog","siteHash":"6093e072e4117ec22616e844cb857d03ca62c57a411a8affc77cb5e8b6b15bf6","entryHash":"030cae6a1bdfd46afe1f826bbf0fd2c268b3e2912d36093e0f6944821ee368dc","category":"Tech"}