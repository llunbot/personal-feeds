{"title":"ตอบคำถามเรื่อง การใช้งาน ORM (Object-Relational Mapping)","link":"https://www.somkiat.cc/database-sql-or-orm/","date":1703749173000,"content":"<p><img width=\"150\" height=\"150\" src=\"https://www.somkiat.cc/wp-content/uploads/2023/12/sql-vs-orm-150x150.png\" loading=\"lazy\" srcset=\"https://www.somkiat.cc/wp-content/uploads/2023/12/sql-vs-orm-150x150.png 150w, https://www.somkiat.cc/wp-content/uploads/2023/12/sql-vs-orm-75x75.png 75w\" /></p>\n<figure><a href=\"https://www.somkiat.cc/wp-content/uploads/2023/12/sql-vs-orm.png\"><img src=\"https://www.somkiat.cc/wp-content/uploads/2023/12/sql-vs-orm.png\" /></a></figure>\n\n\n\n<p>จากการแบ่งปันการพัฒนา RESTful API ด้วยภาษา Go<br />มีคำถามว่า ในการจัดการข้อมูลใน database ควรใช้อะไรดี ?<br />จะใช้งาน <a href=\"https://en.wikipedia.org/wiki/Object%E2%80%93relational_mapping\" target=\"_blank\">ORM</a> หรือ Native SQL ดี ?<br />จึงทำการสรุปคำตอบไว้นิดหน่อย</p>\n\n\n\n<span></span>\n\n\n\n<p><strong>มาดูในภาษา Go หรือภาษาอื่น ๆ จะมีแนวทางจัดการข้อมูลใน database ดังนี้</strong></p>\n\n\n\n<ul>\n<li><strong>Native SQL</strong> คือ เขียนชุดคำสั่ง SELECT, INSERT, UPDATE และ DELETE เอง</li>\n\n\n\n<li><strong>SQL Builder</strong> จะเป็น library ช่วยให้สร้างชุดคำสั่ง SQL ง่าย ๆ</li>\n\n\n\n<li><strong>ORM</strong> เป็นตัวช่วยในการ mapping ระหว่าง table ใน database กับ Data/Entity class ในภาษาต่าง ๆ เช่น Go ก็คือ Struct ส่วนใน Java ก็เป็น Class หรือ record นั่นเอง เช่น GORM และ XORM</li>\n</ul>\n\n\n\n<p><strong>ถ้าแนะนำจากประสบการณ์นิดหน่อยที่ผ่านมานั้น</strong></p>\n\n\n\n<p>ให้เริ่มจากการใช้งานแบบ Native SQL ก่อน<br />เพื่อให้ให้รู้และเข้าใจว่าแต่ละขั้นตอนเป็นอย่างไร <br />ประกอบไปด้วย</p>\n\n\n\n<ul>\n<li>การ config พวก database driver</li>\n\n\n\n<li>การสร้าง database connection ไปจนถึงพวก connection pool</li>\n\n\n\n<li>การสร้าง statement สำหรับทำการ execute ชุดคำสั่ง SQL ทั้ง CRUD</li>\n\n\n\n<li>การดึงข้อมูลใน table มาอนู่ในรูปแบบของ data class และ struct</li>\n\n\n\n<li>การจัดการ transaction ของการทำงาน เพื่อให้เข้าใจ boundary ของ transaction</li>\n\n\n\n<li>การคิด resource ต่าง ๆ ที่สร้างออกมา เช่น database connection เป็นต้น</li>\n</ul>\n\n\n\n<p>โดยตอนนี้เราสามารถมีเครื่องมือช่วยเหลือ<br />ทั้ง <strong><a href=\"https://www.somkiat.cc/generate-go-code-from-sqlc-and-dbml/\" target=\"_blank\">DBML และ sqlc</a></strong></p>\n\n\n\n<p><strong>ต่อมาจึงเริ่มมาที่ SQL Builder และ ORM ต่อไป</strong></p>\n\n\n\n<p>แต่ก็มีทั้งข้อดีและข้อเสีย<br />ข้อดีคือ productivity ในการพัฒนาจะดีมาก ๆ<br />เพราะว่าช่วยลดขั้นตอนที่ไม่จำเป็นออกไปเยอะมาก ๆ<br />เราสนใจเพียงการออกแบบ และ mapping เท่านั้น<br />แต่สิ่งที่น่ากลัว หรือ ต้องพึงระวังคือ การทำงานภายในที่เราไม่รู้ !!<br />ต้องทำความเข้าใจอย่างมาก <br />ยกตัวอย่างเช่น</p>\n\n\n\n<ul>\n<li>การจัดการความสัมพันธ์ หรือ relation ของแต่ละ table/entity</li>\n\n\n\n<li>การดึงข้อมูลจาก table ที่มีความสัมพันธ์กันว่าดึงอย่างไร เยอะไหม เช่น eager และ lazy loading เป็นต้น</li>\n\n\n\n<li>อย่าลืมดูชุดคำสั่งที่ ORM ทำการ generate ออกมาด้วยเสมอ</li>\n\n\n\n<li>เมื่อมีข้อมูลเยอะขึ้น อย่าลืมทำการทดสอบ เพื่อดูเรื่อง performance ด้วย</li>\n\n\n\n<li>เรื่องของ explain หรือ analyze SQL ก็สำคัญมาก ๆ</li>\n\n\n\n<li>ยิ่งมีความซับซ้อนมากขึ้น ยิ่งต้องระวัง</li>\n</ul>\n\n\n\n<figure><a href=\"https://www.somkiat.cc/wp-content/uploads/2023/12/main-qimg-b7f189faf359f8d793d6092808e5b6f1.webp\"><img src=\"https://www.somkiat.cc/wp-content/uploads/2023/12/main-qimg-b7f189faf359f8d793d6092808e5b6f1.webp\" width=\"517\" height=\"382\" /></a></figure>\n\n\n\n<p><strong>อีกอย่างการใช้งาน ORM ต้องเข้าใจแนวคิดด้วย</strong></p>\n\n\n\n<p>ว่าพยายามให้เป็นการออกแบบ table ต่าง ๆ ด้วย <strong>code-first</strong><br />จากนั้นทำการ generate ไปยัง database server อีกที<br />แต่สิ่งที่เจอบ่อยมาก ๆ มักจะตรงข้ามคือ<br />คนออกแบบ table ก็ไปทำที่ database server ไป<br />ส่วน developer ก็เขียน mapping เอาเอง<br />ต่างฝ่ายต่างทำ ทำให้ปัญหาเกิดขึ้นเยอะ !!</p>\n\n\n\n<p>ลองศึกษาเพิ่มเติมกันดูครับ<br />เดี๋ยวนี้มีให้เลือกเยอะมาก ๆ<br />หรือดู library ของภาษา Go เพิ่มได้ที่ <a href=\"https://github.com/avelino/awesome-go\" target=\"_blank\">Awesome Go</a></p>\n\n\n\n<p><strong>Reference Websites</strong></p>\n\n\n\n<ul>\n<li><a href=\"https://www.prisma.io/dataguide/types/relational/comparing-sql-query-builders-and-orms\" target=\"_blank\">Comparing SQL, query builders, and ORMs</a></li>\n\n\n\n<li><a href=\"https://betterprogramming.pub/avoid-orm-in-go-use-pure-sql-instead-3ae7f0485b37\" target=\"_blank\">Avoid ORM in Go — Use Pure SQL Instead</a></li>\n\n\n\n<li><a href=\"https://martinfowler.com/bliki/OrmHate.html\" target=\"_blank\">OrmHate</a></li>\n</ul>\n\n\n\n<p><br /></p>\n","author":"somkiat","siteTitle":"cc :: somkiat","siteHash":"3a23a5a4389e1e40c6fbb16520a8cc20df5b3591c25145ce72aaa18b19e48201","entryHash":"e4bb52c0bf444830fb2b3b246fedcb92cde43a7d469e62ac13063bf8140256fb","category":"Thai"}