{"title":"Introducing Athena Provisioned Capacity","link":"https://aws.amazon.com/blogs/aws/introducing-athena-provisioned-capacity/","date":1682711643000,"content":"<p>Today we launch the ability to provision capacity to run your <a href=\"https://aws.amazon.com/athena/?trk=d5067b05-43fa-42f2-aa85-f46620ab8616&amp;sc_channel=el\">Athena</a> queries.</p> \n<p>Athena is a query service that makes it simple to analyze data in <a href=\"https://aws.amazon.com/s3/\">Amazon Simple Storage Service (Amazon S3)</a> data lakes and 30 different data sources, including on-premises data sources or other cloud systems, using standard SQL queries. Athena is serverless, so there is no infrastructure to manage, and–until today–you pay only for the queries that you run. Starting today, you can get dedicated capacity for your queries and use new workload management features to prioritize, control, and scale your most important queries, paying only for the capacity you provision.</p> \n<p>At AWS, 90 percent of the new services and features are driven by your direct feedback. Many of you Athena customers told us that, when running a large volume of queries, you sometimes experience queuing, which might slow down some applications or business processes. To work around this, you typically create a query prioritization mechanism to prioritize mission-critical queries over less critical, interactive, or exploratory queries. This prioritization mechanism helps to get the highest priority queries run first, at the price of building and maintaining code or business processes outside of Athena itself. You also told us it is difficult to forecast your Athena costs. Athena charges by the volume of data scanned, which is often difficult to predict as it depends on the size of your data set, the construction of the user queries, and the storage format for the data.</p> \n<p>We heard this feedback, and today, we introduce the capability to provision dedicated query processing capacity at scale. With provisioned capacity, you provision a dedicated set of compute resources to run your queries. This always-on capacity can serve your business-critical queries with near-zero latency and no queuing. It gives you control over workload performance characteristics such as cost, concurrency, and query prioritization. Similar to provisioned capacity for other AWS services, you pay only for the capacity provisioned, not for the actual usage. With provisioned capacity, your Athena bills are predictable, and you do not have to limit user queries to stay within your monthly budget. I’ll share more about the billing model down below.</p> \n<p>Behind the scenes, Athena maintains a large pool of compute in each AWS Region that it operates in. You can think of this as one large pool of compute, divided logically across customers. When you reserve capacity in Athena, the capacity is held for your exclusive use. You can choose which queries run on the capacity you provisioned and which run on Athena’s multi-tenant, on-demand capacity. Multiple queries can share the capacity you provisioned. You may add additional capacity units at any time, based on your evolving business requirements. You may also adjust the provisioned capacity down after a minimum period of time of 8 hours.</p> \n<p>The unit of capacity is a Data Processing Unit (DPU). A single DPU is equivalent to four vCPU and 16 Gb RAM. The minimum capacity you may provision is 24 DPU for 8 hours. This new provisioned capacity for Athena is ideal for those of you running any volume of queries, but the sweet spot to start using provisioned capacity is when you spend $100 or more per month on Athena.</p> \n<p>The number of DPUs you need depends on your goals and analysis patterns. For example, if you need queries to start immediately and without queuing, you should provision enough DPUs to meet your peak concurrent query demand. Provisioning fewer DPUs than your peak demand is allowed, but may result in queuing. When this occurs, queries are held in a queue and executed when capacity is available. If your goal is to run queries within a fixed budget, you can use the <a href=\"https://calculator.aws/\">AWS Pricing Calculator</a> to determine the number of DPUs that meets your budget. Lastly, remember that data size, storage format, and query construction influence the number of DPU a query requires. You can increase query performance by compressing, partitioning, and converting your data into columnar formats. <a href=\"https://docs.aws.amazon.com/athena/latest/ug/capacity-management-requirements.html\">Athena’s documentation provides you with guidelines to determine how much capacity you might require to run multiple queries</a> at the same time.</p> \n<p><span><strong>How Does It Work?<br /> </strong></span>Getting started is a three-step process. I navigate to the Athena page in the <a href=\"https://console.aws.amazon.com\">AWS Management Console</a> and select <strong>Capacity Reservations</strong> on the left-side navigation menu.</p> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2023/05/03/2023-05-03_12-26-15.png\"><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2023/05/03/2023-05-03_12-26-15.png\" alt=\"Athena Capacity Reservation landing page in the console\" width=\"800\" height=\"273\" /></a></p> \n<p>I select the <strong>Create capacity reservation</strong> button at the top right of the page.</p> \n<p>On the <strong>Create capacity reservation</strong> page, I enter a <strong>Capacity reservation name</strong> and the number of DPUs I want to provision.</p> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2023/05/03/2023-05-03_12-26-54.png\"><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2023/05/03/2023-05-03_12-26-54.png\" alt=\"Athena Capacity Reservation - Create Reservation\" width=\"800\" height=\"684\" /></a></p> \n<p>I select <strong>Review</strong> to review my choices, and I select <strong>Create capacity reservation</strong> to create my reservation. After a brief period of time, the capacity reservation status becomes <img src=\"https://s.w.org/images/core/emoji/14.0.0/72x72/2705.png\" alt=\"✅\" /> <span>Active</span>.</p> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2023/05/03/2023-05-03_12-31-49.png\"><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2023/05/03/2023-05-03_12-31-49.png\" alt=\"Athena Capacity Reservation - Status\" width=\"800\" height=\"414\" /></a></p> \n<p>The third and last step is to create a <a href=\"https://docs.aws.amazon.com/athena/latest/ug/manage-queries-control-costs-with-workgroups.html\">workgroup</a> and assign the workgroup to the provisioned capacity. A workgroup is an Athena mechanism allowing you to separate users, teams, applications, or workloads to set limits on the amount of data each query or the entire workgroup can process and to track costs.</p> \n<p>Queries belonging to the assigned workgroup will run on the capacity you provisioned. Capacity may be shared with multiple workgroups as long as they all use the same Athena engine version. This concept, depicted in the diagram below, is surfaced through a capacity allocation policy, which defines how capacity is assigned over workgroups. This gives you the flexibility to run queries with more or less capacity, depending on your business needs.</p> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2023/04/27/aws_news_blog_diagram-02.png\"><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2023/04/27/aws_news_blog_diagram-02.png\" alt=\"Athena Capacity Reservation - shared workgroups\" width=\"800\" height=\"286\" /></a></p> \n<p>To create a workgroup, I navigate to the <strong>Workgroups</strong> section of the Athena page. Then, I select <strong>Create workgroup</strong>.</p> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2023/05/03/2023-05-03_12-28-20.png\"><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2023/05/03/2023-05-03_12-28-20.png\" alt=\"Athena Capacity Reservation - Create Workgroup\" width=\"800\" height=\"760\" /></a></p> \n<p>I make sure the analytics engine selected in the reservation matches the one in the workgroup.</p> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2023/05/03/2023-05-03_12-28-28.png\"><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2023/05/03/2023-05-03_12-28-28.png\" alt=\"Athena Capacity Reservation - select analytic engine\" width=\"800\" height=\"286\" /></a>Then, I go back to the capacity reservation I just created, and I select <strong>Add workgroups</strong> to add the workgroup I just created.</p> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2023/05/03/2023-05-03_12-32-52.png\"><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2023/05/03/2023-05-03_12-32-52.png\" alt=\"Athena Capacity Reservation - select analytic engine\" width=\"800\" height=\"381\" /></a></p> \n<p>That’s it! Now that the configuration is ready, I can run my queries. Existing queries will run on the provisioned capacity unmodified. I make sure to select the workgroup I just created when I run queries. I choose a workgroup on the top right side of the query editor, or use the <code>--work-group</code> argument on the AWS command line, such as:</p> \n<pre><code>aws athena start-query-execution --work-group AWSNewsBlog</code></pre> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2023/05/03/2023-05-03_12-29-38.png\"><img loading=\"lazy\" src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2023/05/03/2023-05-03_12-29-38.png\" alt=\"Athena Capacity Reservation - Select workgroup\" width=\"800\" height=\"343\" /></a></p> \n<p><span><strong>Availability and Pricing<br /> </strong></span>As I explained in the introduction, we charge for the number of DPUs you provisioned and the duration. The minimum duration is 8 hours, and after that, billing is per minute. You can release the provisioned capacity at any time. Cancellations within the minimum duration period are billed for the full term, and capacity is deallocated as soon as all currently running queries are terminated.</p> \n<p>Queries run from a workgroup assigned to a provisioned capacity are not billed for the amount of data scanned. You effectively pay a flat rate depending on the provisioned capacity, not the usage. If you have excess capacity, you can reduce the number of DPUs you provisioned or add workgroups to consume the excess capacity.</p> \n<p>As usual, <a href=\"https://aws.amazon.com/athena/pricing/?trk=e6515a16-8975-4b96-b381-c8f1ac7d8260&amp;sc_channel=el\">the Athena pricing page</a> has all the details.</p> \n<p>Athena provisioned capacity is available today in US East (Ohio, N. Virginia), US West (Oregon), Asia Pacific (Singapore, Sydney, Tokyo), and Europe (Ireland, Stockholm) AWS Regions.</p> \n<p><strong><a href=\"https://console.aws.amazon.com/athena/home?trk=3d11295b-b3f7-4af7-ae56-107b4cc75bc1&amp;sc_channel=el\">Go and provision your Athena capacity today!</a></strong></p> \n<a href=\"https://twitter.com/sebsto\">-- seb</a>","author":"Sébastien Stormacq","siteTitle":"AWS News Blog","siteHash":"6093e072e4117ec22616e844cb857d03ca62c57a411a8affc77cb5e8b6b15bf6","entryHash":"0767a44a835ee8c2cbd2f10c9fac6e85258f74e83272d00cb0aa6996c6da938a","category":"Tech"}