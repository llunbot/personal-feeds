{"title":"Consul 1.17 GA adds locality-aware routing and multi-port support","link":"https://www.hashicorp.com/blog/consul-1-17-ga-adds-locality-aware-routing-and-multi-port-support","date":1699477200000,"content":"<p>We're excited to announce that HashiCorp Consul 1.17 is now generally available. This release introduces a number of significant enhancements for HashiCorp Consul, our service networking solution that helps users discover and securely connect any  application. These new capabilities help organizations enhance workflow management, increase reliability and scale, and bolster security for operators as they leverage a <a href=\"https://hashicorp.com/cloud-operating-model\">cloud operating model</a> for service networking.</p>\n\n<p>Some of the notable updates include:</p>\n\n<ul>\n<li><strong>Locality-aware service mesh routing within a Consul datacenter:</strong> Optimizes traffic routing within datacenters, prioritizing local instances for lower latency and reduced costs.</li>\n<li><strong>Sameness groups (Enterprise):</strong> Simplifies multi-cluster operations, enhancing service reliability for enterprises.</li>\n<li><strong>Multi-port support (beta):</strong> A new, simplified way to onboard modern distributed applications that require different ports for various traffic types for intricate client-server communication</li>\n</ul>\n\n<p>Here is a closer look at all the new enhancements in Consul 1.17:</p>\n\n<h2>Policy and security</h2>\n\n<p>Consul 1.17 enhances policy and security by introducing locality-aware routing for low-latency connections and JWT-based authentication and authorization support for API Gateway.</p>\n\n<h3>Locality-aware service mesh routing within a Consul datacenter</h3>\n\n<p>Consul is designed to be deployed in private networking environments that have low latency and high bandwidth. Consul refers to these environments as <a href=\"https://developer.hashicorp.com/consul/docs/install/glossary#datacenter\">datacenters</a>. In the public cloud, a datacenter is equivalent to a region.</p>\n\n<p>In Consul service mesh, requests to upstream services are routed by the downstream proxy to any healthy and available upstream instance within the datacenter.</p>\n<img src=\"https://www.datocms-assets.com/2885/1696950171-locality-aware-25.png\" alt=\"Downstream\" /><p>This type of random connection distribution is sufficient for most environments as it allows the load on an upstream service to be spread across all available instances. However, in some situations it may be desirable to ensure that traffic stays within the same availability zone in order to decrease latency or reduce inter-zone data transfer costs.</p>\n\n<p>To address this issue, Consul 1.17 introduces support for locality-aware service mesh routing. Locality-aware routing lets operators prioritize routing to upstream instances located in the same zone over instances in alternate zones.</p>\n<img src=\"https://www.datocms-assets.com/2885/1696950160-locality-aware-50.png\" alt=\"Downstream\" /><p>By keeping traffic within a zone, operators can reduce service-to-service latency, which helps improve overall service performance and decrease infrastructure costs. If all of the instances of an upstream service within a zone are unavailable, the service mesh will automatically fail over to healthy instances in adjacent zones, ensuring service connectivity and availability within the datacenter. </p>\n<p>For more information, refer to the documentation for <a href=\"https://developer.hashicorp.com/consul/docs/connect/manage-traffic/route-to-local-upstreams\">locality-aware routing</a>.</p>\n\n<h3>API Gateway supports JWT-based authentication and authorization</h3>\n\n<p>In Consul 1.17, the API Gateway can now be configured with policies that control access to services based on JSON Web Tokens (JWT) embedded in the network traffic sent by external clients. </p>\n\n<p>These policies can control access to services and even specific URLs based on the claims contained in JWTs. This capability lets administrators control access to services from outside the service mesh without having to modify services that don’t support JWT-based authentication/authorization.</p>\n\n<p>Refer to the API gateway JWT documentation for <a href=\"https://developer.hashicorp.com/consul/docs/connect/gateways/api-gateway/secure-traffic/verify-jwts-vms\">virtual machines</a> and <a href=\"https://developer.hashicorp.com/consul/docs/connect/gateways/api-gateway/secure-traffic/verify-jwts-k8s\">Kubernetes-orchestrated networks</a> for more information.</p>\n\n<h2>Reliability and scale</h2>\n\n<p>Consul 1.17 bolsters reliability with sameness groups and rate limiting for services. Consul is multi-cloud and platform-agnostic, and simplified Amazon ECS deployments help operators scale.</p>\n\n<h3>Sameness groups</h3>\n\n<p>In June, <a href=\"https://www.hashicorp.com/blog/consul-1-16-enhances-service-mesh-reliability-user-experience-and-security\">Consul Enterprise 1.16</a> introduced sameness groups as a beta feature. Sameness groups allow operators to logically group Consul peers and partitions that share common administration, and create policies to export services, configure service failover, or authorize service traffic in a uniform fashion for members of the group. In Consul 1.17, sameness groups have graduated to general availability. </p>\n<img src=\"https://www.datocms-assets.com/2885/1686608864-sameness-groups-example-edited.png\" alt=\"Examples\" /><p>Enterprises can use sameness groups to simplify operations and increase service availability for multi-cluster or multi-region deployments.</p>\n\n<p>Refer to the documentation for <a href=\"https://developer.hashicorp.com/consul/docs/connect/cluster-peering/usage/create-sameness-groups\">creating sameness groups</a> or <a href=\"https://developer.hashicorp.com/consul/docs/k8s/connect/cluster-peering/usage/create-sameness-groups\">creating sameness groups on Kubernetes</a> for more information.</p>\n\n<h3>Traffic rate limiting for services</h3>\n\n<p>Consul service mesh now supports HTTP request rate limiting of network traffic to services. The rate limiting is configured per service and is applied per service instance. Operators can set HTTP request rate limits for the service instance or separate rate limits for specific URL paths. The rate limiting configuration includes settings for requests per second (RPS) as well as maximum request burst size. </p>\n\n<p>These rate limiting capabilities help operators protect service instances from being overloaded, prefer traffic meeting certain criteria, or ensure service capacity is shared fairly. </p>\n\n<p>For more information, refer to the product documentation for <a href=\"https://developer.hashicorp.com/consul/docs/connect/l7-traffic/rate-limiting\">rate limiting</a>. </p>\n\n<h3>Simplified service mesh deployments on Amazon ECS with Consul dataplane</h3>\n\n<p>As part of Consul 1.17 we are also announcing Consul on ECS 0.7, which introduces a simplified service mesh deployment architecture that eliminates the need to deploy Consul clients per task on Amazon ECS. The new architecture deploys a new Consul dataplane component that is injected as a sidecar in the ECS task. This dataplane container image packages both an Envoy container and Consul dataplane binary.</p>\n\n<p>For more information, refer to the product documentation for <a href=\"https://developer.hashicorp.com/consul/docs/ecs\">Consul ECS</a>.</p>\n\n<h2>Simplified workflow management</h2>\n\n<p>The new APIs in Consul 1.17 simplify workflow management by enabling multi-port services and flexible routing. The specific enhancements include Consul catalog v2 API and multi-port services, both in beta.</p>\n\n<h3>Consul catalog v2 API (beta)</h3>\n<img src=\"https://www.datocms-assets.com/2885/1696950149-v1_service_instances_v2_workloads.png\" alt=\"Each\" /><p>Consul 1.17 includes a new set of APIs for interacting with the catalog, authenticating traffic using workload identities, and for managing Consul service mesh. These collective sets of APIs are now exposed under the new v2 API paths and are enabled using a v2 API feature flag. These APIs are the foundation for future versions of Consul and introduce a new catalog model that decouples services, service instances, and service identity by introducing new Consul resources called <em>service</em>, <em>workload</em>, and <em>workload identity</em>. (Note: These APIs are still in beta and under active development, so we don’t recommend using them in production.) </p>\n\n<p>For more information, refer to the <a href=\"https://developer.hashicorp.com/consul/docs/k8s/multiport#catalog-api-v2-beta\">Catalog API v2</a> section in the documentation.</p>\n\n<h3>Multi-port services in Consul (beta)</h3>\n<img src=\"https://www.datocms-assets.com/2885/1699462251-v2-consul-catalog-api.png\" alt=\"In\" /><p>Starting with Consul 1.17, Consul users can register services with multiple ports per service using the v2 catalog API. Consul service mesh now allows services on the v2 API to call one another when utilizing transparent proxy over multiple ports and allows operators to authorize traffic between services over specific ports. </p>\n\n<p>A key improvement to support multi-port services is that workloads (i.e. pods) can now use only a single sidecar proxy for all ports exposed by the workload. The reduction of resources and the ability to call services using transparent proxy simplifies usage and reduces the operational overhead for managing Consul service mesh. </p>\n\n<p>In addition, the v2 API allows routing to workloads selected by multiple services, similar to how Kubernetes allows routing to the same pod using multiple services. This unlocks additional workflows, such as hostname-based canary routing and routing via headless services in Kubernetes native deployments, which were difficult to do in the v1 API. We look forward to seeing how users will use the increased flexibility to deploy an even broader range of applications onto Consul service mesh.     </p>\n\n<p>For more information, refer to the documentation for <a href=\"https://developer.hashicorp.com/consul/docs/k8s/multiport\">Multi-port services in Consul service mesh</a>. Support for other runtimes outside of Kubernetes is planned for future releases of Consul.   </p>\n\n<h2>Next steps for HashiCorp Consul</h2>\n\n<p>Our goal is for Consul to enable a consistent, enterprise-ready control plane to discover and securely connect any application. Consul 1.17 includes enhanced workflow management, reliability, and security for service networking. With improved failover, security measures, user experience, and extensibility, Consul empowers organizations to build resilient and efficient applications in distributed environments. </p>\n\n<p>We are excited for users to try these new Consul updates and further expand their service mesh implementations. Here’s how to get started:</p>\n\n<ul>\n<li>Learn more in the <a href=\"https://developer.hashicorp.com/consul/docs\">Consul documentation</a>.</li>\n<li>Get started with Consul 1.17 by installing the latest Helm chart, provided in the <a href=\"https://developer.hashicorp.com/consul/docs/k8s/multiport\">Consul Kubernetes documentation</a>.</li>\n<li>Try Consul Enterprise by starting a <a href=\"https://www.hashicorp.com/products/consul/trial\">free trial</a>.</li>\n<li>Get started with <a href=\"https://portal.cloud.hashicorp.com/sign-up?ajs_aid=926749b0-06a3-4daa-a16b-25b562d8289b&amp;product_intent=consul\">HCP Consul</a></li>\n</ul>\n","author":"Ashher Syed","siteTitle":"HashiCorp Blog","siteHash":"219aa6310b3388f2335eba49871f4df9581f2c58eaeb5e498363b54e835b7001","entryHash":"99134f4776a9eaf223427e32b8d0e39f5ac404c4eacc573ddd5db8692432d2ac","category":"Tech"}